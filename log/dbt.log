2021-04-19 16:28:58.490970 (Thread-1): On model.tech_audit.search_console_keyword_stats: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.tech_audit.search_console_keyword_stats"} */


  create or replace table `seo-data-pipeline-89`.`adp_thecifhw`.`search_console_keyword_stats`
  
  
  OPTIONS()
  as (
    with gsc as (

	SELECT 
	a.date, 
	unix_date, 
	b.unix_run_date,
	b.unix_mom_date,
	b.unix_yoy_date,	
	a.account,
	a.site,
	a.domain,
	url,
	keyword,
	sum(impressions) impressions,
	sum(clicks) clicks,
	CASE WHEN sum(impressions) > 0 THEN sum(clicks) / sum(impressions) END as ctr,
	CASE WHEN sum(impressions) > 0 THEN sum(avg_position*impressions)/sum(impressions) ELSE null END as avg_position
	FROM `seo-data-pipeline-89`.`adp_thecifhw`.`search_console_keyword_proc_url_mapping` a 
	LEFT JOIN `seo-data-pipeline-89`.`adp_thecifhw`.`dates` b
		ON (
			a.site = b.site AND
			( a.unix_date = b.unix_run_date OR a.unix_date = b.unix_mom_date OR a.unix_date = b.unix_yoy_date )
		)
	WHERE branded_flag = 0 
	GROUP BY a.date, unix_date, unix_run_date, unix_mom_date, unix_yoy_date, account, a.site, a.domain, url, keyword
)

SELECT
date,
account,
site,
domain,
url,
keyword,
CASE WHEN clicks_mom_pct > 0 THEN 'Rising' 
	WHEN clicks_mom_pct < 0 THEN 'Falling'
	WHEN clicks_mom_pct = 0 THEN 'Flat'
	WHEN clicks_mom_pct is null THEN 'New this Month'
	ELSE null END as keyword_bucket,
impressions_30d,
clicks_30d,
sum(clicks_30d) OVER (PARTITION BY date, site) as total_clicks_30d,
ctr_30d,
avg_position_30d,
impressions_mom,
impressions_mom_pct,
clicks_mom,
clicks_mom_pct,
ctr_mom,
avg_position_mom,
impressions_yoy,
clicks_yoy,
clicks_yoy_pct,
ctr_yoy,
avg_position_yoy
FROM (

	SELECT  
	date,
	account,
	site,
	domain,
	url,
	keyword,
	sum(impressions_30d) as impressions_30d,
	sum(clicks_30d) clicks_30d,
	max(ctr_30d) as ctr_30d,
	max(avg_position_30d) as avg_position_30d,
	sum(impressions_mom) as impressions_mom,
	CASE WHEN sum(impressions_mom) > 0 THEN (sum(impressions_30d) - sum(impressions_mom)) / sum(impressions_mom) ELSE null END as impressions_mom_pct,
	sum(impressions_30d) - sum(impressions_mom) as impressions_mom_gain,
	sum(clicks_mom) clicks_mom,
	CASE WHEN sum(clicks_mom) > 0 THEN (sum(clicks_30d) - sum(clicks_mom)) / sum(clicks_mom) ELSE null END as clicks_mom_pct,
	max(ctr_mom) as ctr_mom,
	min(avg_position_mom) as avg_position_mom,
	sum(impressions_yoy) as impressions_yoy,
	sum(clicks_yoy) clicks_yoy,
	CASE WHEN sum(clicks_yoy) > 0 THEN (sum(clicks_30d) - sum(clicks_yoy)) / sum(clicks_yoy) ELSE null END as clicks_yoy_pct,
	max(ctr_yoy) as ctr_yoy,
	min(avg_position_yoy) as avg_position_yoy
	FROM (

		SELECT
		date_from_unix_date(unix_run_date) date,
		account,
		site,
		domain,
		url,
		keyword,
		case when unix_date = unix_run_date then impressions else null end as impressions_30d,
		case when unix_date = unix_run_date then clicks else null end as clicks_30d,
		case when unix_date = unix_run_date then ctr else null end as ctr_30d,
		case when unix_date = unix_run_date then avg_position else null end as avg_position_30d,
		null as impressions_mom,
		null as clicks_mom,
		null as ctr_mom,
		null as avg_position_mom,
		null as impressions_yoy,
		null as clicks_yoy,
		null as ctr_yoy,
		null as avg_position_yoy
		FROM gsc

		UNION ALL	

		SELECT
		date_from_unix_date(unix_run_date) date,
		account,
		site,
		domain,
		url,
		keyword,
		null as impressions_30d,
		null as clicks_30d,
		null as ctr_30d,
		null as avg_position_30d,
		case when unix_date = unix_mom_date then impressions else null end as impressions_mom,
		case when unix_date = unix_mom_date then clicks else null end as clicks_mom,
		case when unix_date = unix_mom_date then ctr else null end as ctr_mom,
		case when unix_date = unix_mom_date then avg_position else null end as avg_position_mom,
		null as impressions_yoy,
		null as clicks_yoy,
		null as ctr_yoy,
		null as avg_position_yoy
		FROM gsc

		UNION ALL

		SELECT
		date_from_unix_date(unix_run_date) date,
		account,
		site,
		domain,
		url,
		keyword,
		null as impressions_30d,
		null as clicks_30d,
		null as ctr_30d,
		null as avg_position_30d,
		null as impressions_mom,
		null as clicks_mom,
		null as ctr_mom,
		null as avg_position_mom,
		case when unix_date = unix_yoy_date then impressions else null end as impressions_yoy,
		case when unix_date = unix_yoy_date then clicks else null end as clicks_yoy,
		case when unix_date = unix_yoy_date then ctr else null end as ctr_yoy,
		case when unix_date = unix_yoy_date then avg_position else null end as avg_position_yoy
		FROM gsc
	)
	group by date, account, site, domain, url, keyword
)
  );
    
2021-04-19 16:28:59.250918 (Thread-40): handling poll request
2021-04-19 16:28:59.251359 (Thread-40): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'd178ec37-7b39-42b2-b063-b88e83fe10fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa03cdfa760>]}
2021-04-19 16:28:59.253297 (Thread-40): sending response (<Response 10956 bytes [200 OK]>) to 10.0.7.215
2021-04-19 16:29:00.907290 (Thread-41): handling poll request
2021-04-19 16:29:00.907709 (Thread-41): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'd178ec37-7b39-42b2-b063-b88e83fe10fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa03da72280>]}
2021-04-19 16:29:00.908572 (Thread-41): sending response (<Response 285 bytes [200 OK]>) to 10.0.21.196
2021-04-19 16:29:01.605616 (Thread-1): finished collecting timing info
2021-04-19 16:29:01.606462 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd2dee09f-521a-45b5-af69-4db908d4d9f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f59016e5430>]}
2021-04-19 16:29:01.607508 (Thread-1): 16:29:01 | 15 of 25 OK created table model adp_thecifhw.search_console_keyword_stats [CREATE TABLE (4.4k rows, 501.1 KB processed) in 3.39s]
2021-04-19 16:29:01.607594 (Thread-1): Finished running node model.tech_audit.search_console_keyword_stats
2021-04-19 16:29:01.607707 (Thread-1): Began running node model.tech_audit.ga_stats
2021-04-19 16:29:01.608597 (Thread-1): 16:29:01 | 16 of 25 START table model adp_thecifhw.ga_stats..................... [RUN]
2021-04-19 16:29:01.608826 (Thread-1): Acquiring new bigquery connection "model.tech_audit.ga_stats".
2021-04-19 16:29:01.608901 (Thread-1): Compiling model.tech_audit.ga_stats
2021-04-19 16:29:01.620913 (Thread-1): Writing injected SQL for node "model.tech_audit.ga_stats"
2021-04-19 16:29:01.652276 (Thread-1): finished collecting timing info
2021-04-19 16:29:01.656642 (Thread-1): Opening a new connection, currently in state closed
2021-04-19 16:29:01.872480 (Thread-1): Writing runtime SQL for node "model.tech_audit.ga_stats"
2021-04-19 16:29:01.913335 (Thread-1): On model.tech_audit.ga_stats: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.tech_audit.ga_stats"} */


  create or replace table `seo-data-pipeline-89`.`adp_thecifhw`.`ga_stats`
  
  
  OPTIONS()
  as (
    with ga as (

	SELECT 
	a.date report_date, 
	unix_date, 
	b.unix_run_date,
	b.unix_mom_date,
	b.unix_yoy_date,
	a.account, 
	a.site, 
	a.domain,
	url, 
	sessions,
	transaction_revenue,
	transactions,
	ecommerce_conversion_rate,
	goal_completions_all_goals,
	goal_conversion_rate_all_goals,
	bounce_rate,
	avg_seconds_on_site
	FROM `seo-data-pipeline-89`.`adp_thecifhw`.`ga_proc_url_mapping` a
	LEFT JOIN `seo-data-pipeline-89`.`adp_thecifhw`.`dates` b
	ON (
		a.site = b.site AND
		( a.unix_date = b.unix_run_date OR a.unix_date = b.unix_mom_date OR a.unix_date >= b.unix_yoy_date )
	)
)

SELECT  
date,
account,
site,
domain,
url,
sum(sessions_30d) as sessions_30d,
sum(transaction_revenue_30d) transaction_revenue_30d,
sum(transactions_30d) as transactions_30d,
max(ecommerce_conversion_rate_30d) as ecommerce_conversion_rate_30d,
sum(goal_completions_all_goals_30d) as goal_completions_all_goals_30d,
max(goal_conversion_rate_all_goals_30d) as goal_conversion_rate_all_goals_30d,
max(bounce_rate_30d) bounce_rate_30d,
max(avg_seconds_on_site_30d) as avg_seconds_on_site_30d,
sum(sessions_mom) as sessions_mom,
sum(transaction_revenue_mom) transaction_revenue_mom,
sum(transactions_mom) as transactions_mom,
max(ecommerce_conversion_rate_mom) as ecommerce_conversion_rate_mom,
sum(goal_completions_all_goals_mom) as goal_completions_all_goals_mom,
max(goal_conversion_rate_all_goals_mom) as goal_conversion_rate_all_goals_mom,
max(bounce_rate_mom) bounce_rate_mom,
max(avg_seconds_on_site_mom) as avg_seconds_on_site_mom,
sum(sessions_yoy) as sessions_yoy,
sum(transaction_revenue_yoy) transaction_revenue_yoy,
sum(transactions_yoy) as transactions_yoy,
max(ecommerce_conversion_rate_yoy) as ecommerce_conversion_rate_yoy,
sum(goal_completions_all_goals_yoy) as goal_completions_all_goals_yoy,
max(goal_conversion_rate_all_goals_yoy) as goal_conversion_rate_all_goals_yoy,
max(bounce_rate_yoy) bounce_rate_yoy,
max(avg_seconds_on_site_yoy) as avg_seconds_on_site_yoy,
sum(sessions_ttm) as sessions_ttm,
sum(transaction_revenue_ttm) transaction_revenue_ttm,
sum(transactions_ttm) as transactions_ttm,
max(ecommerce_conversion_rate_ttm) as ecommerce_conversion_rate_ttm,
sum(goal_completions_all_goals_ttm) as goal_completions_all_goals_ttm,
max(goal_conversion_rate_all_goals_ttm) as goal_conversion_rate_all_goals_ttm,
max(bounce_rate_ttm) bounce_rate_ttm,
max(avg_seconds_on_site_ttm) as avg_seconds_on_site_ttm,
CASE WHEN sum(transactions_30d) > 0 THEN sum(transactions_30d)
		ELSE sum(goal_completions_all_goals_30d) END as blended_conversions_30d,
CASE WHEN max(ecommerce_conversion_rate_30d) > 0 THEN max(ecommerce_conversion_rate_30d)
	ELSE max(goal_conversion_rate_all_goals_30d) END as blended_conversion_rate_30d
FROM (

	SELECT
	date_from_unix_date(unix_run_date) date,
	account,
	site,
	domain,
	url,
	case when unix_date = unix_run_date then sessions else null end as sessions_30d,
	case when unix_date = unix_run_date then transaction_revenue else null end as transaction_revenue_30d,
	case when unix_date = unix_run_date then transactions else null end as transactions_30d,
	case when unix_date = unix_run_date then ecommerce_conversion_rate else null end as ecommerce_conversion_rate_30d,
	case when unix_date = unix_run_date then goal_completions_all_goals else null end as goal_completions_all_goals_30d,
	case when unix_date = unix_run_date then goal_conversion_rate_all_goals else null end as goal_conversion_rate_all_goals_30d,
	case when unix_date = unix_run_date then bounce_rate else null end as bounce_rate_30d,
	case when unix_date = unix_run_date then avg_seconds_on_site else null end as avg_seconds_on_site_30d,
	null as sessions_mom,
	null as transaction_revenue_mom,
	null as transactions_mom,
	null as ecommerce_conversion_rate_mom,
	null as goal_completions_all_goals_mom,
	null as goal_conversion_rate_all_goals_mom,
	null as bounce_rate_mom,
	null as avg_seconds_on_site_mom,
	null as sessions_yoy,
	null as transaction_revenue_yoy,
	null as transactions_yoy,
	null as ecommerce_conversion_rate_yoy,
	null as goal_completions_all_goals_yoy,
	null as goal_conversion_rate_all_goals_yoy,
	null as bounce_rate_yoy,
	null as avg_seconds_on_site_yoy,
	null as sessions_ttm,
	null as transaction_revenue_ttm,
	null as transactions_ttm,
	null as ecommerce_conversion_rate_ttm,
	null as goal_completions_all_goals_ttm,
	null as goal_conversion_rate_all_goals_ttm,
	null as bounce_rate_ttm,
	null as avg_seconds_on_site_ttm
	FROM ga

	UNION ALL	

	SELECT
	date_from_unix_date(unix_run_date) date,
	account,
	site,
	domain,
	url,
	null as sessions_30d,
	null as transaction_revenue_30d,
	null as transactions_30d,
	null as ecommerce_conversion_rate_30d,
	null as goal_completions_all_goals_30d,
	null as goal_conversion_rate_all_goals_30d,
	null as bounce_rate_30d,
	null as avg_seconds_on_site_30d,	
	case when unix_date = unix_mom_date then sessions else null end as sessions_mom,
	case when unix_date = unix_mom_date then transaction_revenue else null end as transaction_revenue_mom,
	case when unix_date = unix_mom_date then transactions else null end as transactions_mom,
	case when unix_date = unix_mom_date then ecommerce_conversion_rate else null end as ecommerce_conversion_rate_mom,
	case when unix_date = unix_mom_date then goal_completions_all_goals else null end as goal_completions_all_goals_mom,
	case when unix_date = unix_mom_date then goal_conversion_rate_all_goals else null end as goal_conversion_rate_all_goals_mom,
	case when unix_date = unix_mom_date then bounce_rate else null end as bounce_rate_mom,
	case when unix_date = unix_mom_date then avg_seconds_on_site else null end as avg_seconds_on_site_mom,
	null as sessions_yoy,
	null as transaction_revenue_yoy,
	null as transactions_yoy,
	null as ecommerce_conversion_rate_yoy,
	null as goal_completions_all_goals_yoy,
	null as goal_conversion_rate_all_goals_yoy,
	null as bounce_rate_yoy,
	null as avg_seconds_on_site_yoy,
	null as sessions_ttm,
	null as transaction_revenue_ttm,
	null as transactions_ttm,
	null as ecommerce_conversion_rate_ttm,
	null as goal_completions_all_goals_ttm,
	null as goal_conversion_rate_all_goals_ttm,
	null as bounce_rate_ttm,
	null as avg_seconds_on_site_ttm
	FROM ga	

	UNION ALL

	SELECT
	date_from_unix_date(unix_run_date) date,
	account,
	site,
	domain,
	url,
	null as sessions_30d,
	null as transaction_revenue_30d,
	null as transactions_30d,
	null as ecommerce_conversion_rate_30d,
	null as goal_completions_all_goals_30d,
	null as goal_conversion_rate_all_goals_30d,
	null as bounce_rate_30d,
	null as avg_seconds_on_site_30d,	
	null as sessions_mom,
	null as transaction_revenue_mom,
	null as transactions_mom,
	null as ecommerce_conversion_rate_mom,
	null as goal_completions_all_goals_mom,
	null as goal_conversion_rate_all_goals_mom,
	null as bounce_rate_mom,
	null as avg_seconds_on_site_mom,
	case when unix_date = unix_yoy_date then sessions else null end as sessions_yoy,
	case when unix_date = unix_yoy_date then transaction_revenue else null end as transaction_revenue_yoy,
	case when unix_date = unix_yoy_date then transactions else null end as transactions_yoy,
	case when unix_date = unix_yoy_date then ecommerce_conversion_rate else null end as ecommerce_conversion_rate_yoy,
	case when unix_date = unix_yoy_date then goal_completions_all_goals else null end as goal_completions_all_goals_yoy,
	case when unix_date = unix_yoy_date then goal_conversion_rate_all_goals else null end as goal_conversion_rate_all_goals_yoy,
	case when unix_date = unix_yoy_date then bounce_rate else null end as bounce_rate_yoy,
	case when unix_date = unix_yoy_date then avg_seconds_on_site else null end as avg_seconds_on_site_yoy,
	null as sessions_ttm,
	null as transaction_revenue_ttm,
	null as transactions_ttm,
	null as ecommerce_conversion_rate_ttm,
	null as goal_completions_all_goals_ttm,
	null as goal_conversion_rate_all_goals_ttm,
	null as bounce_rate_ttm,
	null as avg_seconds_on_site_ttm
	FROM ga		

	UNION ALL

	SELECT
	date_from_unix_date(unix_run_date) date,
	account,
	site,
	domain,
	url,
	null as sessions_30d,
	null as transaction_revenue_30d,
	null as transactions_30d,
	null as ecommerce_conversion_rate_30d,
	null as goal_completions_all_goals_30d,
	null as goal_conversion_rate_all_goals_30d,
	null as bounce_rate_30d,
	null as avg_seconds_on_site_30d,	
	null as sessions_mom,
	null as transaction_revenue_mom,
	null as transactions_mom,
	null as ecommerce_conversion_rate_mom,
	null as goal_completions_all_goals_mom,
	null as goal_conversion_rate_all_goals_mom,
	null as bounce_rate_mom,
	null as avg_seconds_on_site_mom,
	null as sessions_yoy,
	null as transaction_revenue_yoy,
	null as transactions_yoy,
	null as ecommerce_conversion_rate_yoy,
	null as goal_completions_all_goals_yoy,
	null as goal_conversion_rate_all_goals_yoy,
	null as bounce_rate_yoy,
	null as avg_seconds_on_site_yoy,
	case when unix_date > unix_yoy_date then sessions else null end as sessions_ttm,
	case when unix_date > unix_yoy_date then transaction_revenue else null end as transaction_revenue_ttm,
	case when unix_date > unix_yoy_date then transactions else null end as transactions_ttm,
	case when unix_date > unix_yoy_date then ecommerce_conversion_rate else null end as ecommerce_conversion_rate_ttm,
	case when unix_date > unix_yoy_date then goal_completions_all_goals else null end as goal_completions_all_goals_ttm,
	case when unix_date > unix_yoy_date then goal_conversion_rate_all_goals else null end as goal_conversion_rate_all_goals_ttm,
	case when unix_date > unix_yoy_date then bounce_rate else null end as bounce_rate_ttm,
	case when unix_date > unix_yoy_date then avg_seconds_on_site else null end as avg_seconds_on_site_ttm
	FROM ga			
)
group by date, account, site, domain, url
  );
    
2021-04-19 16:29:03.607811 (Thread-42): handling poll request
2021-04-19 16:29:03.608225 (Thread-42): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'd178ec37-7b39-42b2-b063-b88e83fe10fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa03cd94730>]}
2021-04-19 16:29:03.610175 (Thread-42): sending response (<Response 16025 bytes [200 OK]>) to 10.0.21.196
2021-04-19 16:29:05.400960 (Thread-1): finished collecting timing info
2021-04-19 16:29:05.401795 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd2dee09f-521a-45b5-af69-4db908d4d9f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f59016687c0>]}
2021-04-19 16:29:05.402834 (Thread-1): 16:29:05 | 16 of 25 OK created table model adp_thecifhw.ga_stats................ [CREATE TABLE (189.0 rows, 13.4 KB processed) in 3.79s]
2021-04-19 16:29:05.402924 (Thread-1): Finished running node model.tech_audit.ga_stats
2021-04-19 16:29:05.403035 (Thread-1): Began running node model.tech_audit.search_console_url_stats
2021-04-19 16:29:05.403976 (Thread-1): 16:29:05 | 17 of 25 START table model adp_thecifhw.search_console_url_stats..... [RUN]
2021-04-19 16:29:05.404185 (Thread-1): Acquiring new bigquery connection "model.tech_audit.search_console_url_stats".
2021-04-19 16:29:05.404258 (Thread-1): Compiling model.tech_audit.search_console_url_stats
2021-04-19 16:29:05.413159 (Thread-1): Writing injected SQL for node "model.tech_audit.search_console_url_stats"
2021-04-19 16:29:05.449124 (Thread-1): finished collecting timing info
2021-04-19 16:29:05.455616 (Thread-1): Opening a new connection, currently in state closed
2021-04-19 16:29:05.651197 (Thread-1): Writing runtime SQL for node "model.tech_audit.search_console_url_stats"
2021-04-19 16:29:05.689486 (Thread-1): On model.tech_audit.search_console_url_stats: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.tech_audit.search_console_url_stats"} */


  create or replace table `seo-data-pipeline-89`.`adp_thecifhw`.`search_console_url_stats`
  
  
  OPTIONS()
  as (
    with gsc as (

	SELECT 
	a.date, 
	unix_date, 
	b.unix_run_date,
	b.unix_mom_date,
	b.unix_yoy_date,
	a.account, 
	a.site, 
	a.domain,
	url, 
	impressions,
	clicks,
	ctr,
	avg_position
	FROM `seo-data-pipeline-89`.`adp_thecifhw`.`search_console_url_proc_url_mapping` a
	LEFT JOIN `seo-data-pipeline-89`.`adp_thecifhw`.`dates` b
	ON (
		a.site = b.site AND
		( a.unix_date = b.unix_run_date OR a.unix_date = b.unix_mom_date OR a.unix_date >= b.unix_yoy_date )
	)
)

SELECT  
date,
account,
site,
domain,
url,
sum(impressions_30d) as impressions_30d,
sum(clicks_30d) clicks_30d,
max(ctr_30d) as ctr_30d,
max(avg_position_30d) as avg_position_30d,
sum(impressions_mom) as impressions_mom,
sum(clicks_mom) clicks_mom,
max(ctr_mom) as ctr_mom,
min(avg_position_mom) as avg_position_mom,
sum(impressions_yoy) as impressions_yoy,
sum(clicks_yoy) clicks_yoy,
max(ctr_yoy) as ctr_yoy,
min(avg_position_yoy) as avg_position_yoy,
sum(impressions_ttm) as impressions_ttm,
sum(clicks_ttm) clicks_ttm,
max(ctr_ttm) as ctr_ttm,
min(avg_position_ttm) as avg_position_ttm
FROM (

	SELECT
	date_from_unix_date(unix_run_date) date,
	account,
	site,
	domain,
	url,
	case when unix_date = unix_run_date then impressions else null end as impressions_30d,
	case when unix_date = unix_run_date then clicks else null end as clicks_30d,
	case when unix_date = unix_run_date then ctr else null end as ctr_30d,
	case when unix_date = unix_run_date then avg_position else null end as avg_position_30d,
	null as impressions_mom,
	null as clicks_mom,
	null as ctr_mom,
	null as avg_position_mom,
	null as impressions_yoy,
	null as clicks_yoy,
	null as ctr_yoy,
	null as avg_position_yoy,
	null as impressions_ttm,
	null as clicks_ttm,
	null as ctr_ttm,
	null as avg_position_ttm	
	FROM gsc

	UNION ALL	

	SELECT
	date_from_unix_date(unix_run_date) date,
	account,
	site,
	domain,
	url,
	null as impressions_30d,
	null as clicks_30d,
	null as ctr_30d,
	null as avg_position_30d,
	case when unix_date = unix_mom_date then impressions else null end as impressions_mom,
	case when unix_date = unix_mom_date then clicks else null end as clicks_mom,
	case when unix_date = unix_mom_date then ctr else null end as ctr_mom,
	case when unix_date = unix_mom_date then avg_position else null end as avg_position_mom,
	null as impressions_yoy,
	null as clicks_yoy,
	null as ctr_yoy,
	null as avg_position_yoy,
	null as impressions_ttm,
	null as clicks_ttm,
	null as ctr_ttm,
	null as avg_position_ttm	
	FROM gsc

	UNION ALL

	SELECT
	date_from_unix_date(unix_run_date) date,
	account,
	site,
	domain,
	url,
	null as impressions_30d,
	null as clicks_30d,
	null as ctr_30d,
	null as avg_position_30d,
	null as impressions_mom,
	null as clicks_mom,
	null as ctr_mom,
	null as avg_position_mom,
	case when unix_date = unix_yoy_date then impressions else null end as impressions_yoy,
	case when unix_date = unix_yoy_date then clicks else null end as clicks_yoy,
	case when unix_date = unix_yoy_date then ctr else null end as ctr_yoy,
	case when unix_date = unix_yoy_date then avg_position else null end as avg_position_yoy,
	null as impressions_ttm,
	null as clicks_ttm,
	null as ctr_ttm,
	null as avg_position_ttm	
	FROM gsc

	UNION ALL

	SELECT
	date_from_unix_date(unix_run_date) date,
	account,
	site,
	domain,
	url,
	null as impressions_30d,
	null as clicks_30d,
	null as ctr_30d,
	null as avg_position_30d,
	null as impressions_mom,
	null as clicks_mom,
	null as ctr_mom,
	null as avg_position_mom,
	case when unix_date = unix_yoy_date then impressions else null end as impressions_yoy,
	case when unix_date = unix_yoy_date then clicks else null end as clicks_yoy,
	case when unix_date = unix_yoy_date then ctr else null end as ctr_yoy,
	case when unix_date = unix_yoy_date then avg_position else null end as avg_position_yoy,
	case when unix_date > unix_yoy_date then impressions else null end as impressions_ttm,
	case when unix_date > unix_yoy_date then clicks else null end as clicks_ttm,
	case when unix_date > unix_yoy_date then ctr else null end as ctr_ttm,
	case when unix_date > unix_yoy_date then avg_position else null end as avg_position_ttm
	FROM gsc
)
group by date, account, site, domain, url
  );
    
2021-04-19 16:29:05.949743 (Thread-43): handling poll request
2021-04-19 16:29:05.950169 (Thread-43): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'd178ec37-7b39-42b2-b063-b88e83fe10fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa03cd94460>]}
2021-04-19 16:29:05.952113 (Thread-43): sending response (<Response 10532 bytes [200 OK]>) to 10.0.2.242
2021-04-19 16:29:07.927701 (Thread-44): handling poll request
2021-04-19 16:29:07.930351 (Thread-44): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'd178ec37-7b39-42b2-b063-b88e83fe10fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa03cda4580>]}
2021-04-19 16:29:07.931291 (Thread-44): sending response (<Response 284 bytes [200 OK]>) to 10.0.19.198
2021-04-19 16:29:08.584485 (Thread-1): finished collecting timing info
2021-04-19 16:29:08.585277 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd2dee09f-521a-45b5-af69-4db908d4d9f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f590160cb80>]}
2021-04-19 16:29:08.586259 (Thread-1): 16:29:08 | 17 of 25 OK created table model adp_thecifhw.search_console_url_stats [CREATE TABLE (369.0 rows, 41.2 KB processed) in 3.18s]
2021-04-19 16:29:08.586345 (Thread-1): Finished running node model.tech_audit.search_console_url_stats
2021-04-19 16:29:08.587160 (Thread-1): Began running node model.tech_audit.agg_traffic
2021-04-19 16:29:08.588059 (Thread-1): 16:29:08 | 18 of 25 START table model adp_thecifhw.agg_traffic.................. [RUN]
2021-04-19 16:29:08.588271 (Thread-1): Acquiring new bigquery connection "model.tech_audit.agg_traffic".
2021-04-19 16:29:08.588348 (Thread-1): Compiling model.tech_audit.agg_traffic
2021-04-19 16:29:08.600236 (Thread-1): Writing injected SQL for node "model.tech_audit.agg_traffic"
2021-04-19 16:29:08.902729 (Thread-1): finished collecting timing info
2021-04-19 16:29:08.907390 (Thread-1): Opening a new connection, currently in state closed
2021-04-19 16:29:09.084349 (Thread-1): Writing runtime SQL for node "model.tech_audit.agg_traffic"
2021-04-19 16:29:09.133126 (Thread-1): On model.tech_audit.agg_traffic: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.tech_audit.agg_traffic"} */


  create or replace table `seo-data-pipeline-89`.`adp_thecifhw`.`agg_traffic`
  
  
  OPTIONS()
  as (
    SELECT 
date,
site,
domain,
url,
ifnull(sum(impressions_30d), 0) impressions_30d,
ifnull(max(total_impressions_30d), 0) total_impressions_30d,
ifnull(max(med_impressions_30d), 0) med_impressions_30d,
ifnull(max(top_10pct_impressions_30d), 0) top_10pct_impressions_30d,
ifnull(sum(clicks_30d), 0) clicks_30d,
ifnull(max(total_clicks_30d), 0) total_clicks_30d,
ifnull(max(ctr_30d), 0) ctr_30d,
ifnull(max(med_ctr_30d), 0) med_ctr_30d,
ifnull(CASE WHEN max(total_impressions_30d) > 0 THEN max(total_clicks_30d) / max(total_impressions_30d) ELSE null END, 0) as total_ctr_30d,
ifnull(max(avg_position_30d), 0) avg_position_30d,
ifnull(sum(impressions_mom), 0) impressions_mom,
ifnull(max(total_impressions_mom), 0) total_impressions_mom,
ifnull(sum(clicks_mom), 0) clicks_mom,
ifnull(max(total_clicks_mom), 0) total_clicks_mom,
ifnull(max(ctr_mom), 0) ctr_mom,
ifnull(CASE WHEN max(total_impressions_mom) > 0 THEN max(total_clicks_mom) / max(total_impressions_mom) ELSE null END, 0) as total_ctr_mom,
ifnull(max(avg_position_mom), 0) avg_position_mom,
ifnull(sum(impressions_yoy), 0) impressions_yoy,
ifnull(max(total_impressions_yoy), 0) total_impressions_yoy,
ifnull(sum(clicks_yoy), 0) clicks_yoy,
ifnull(max(total_clicks_yoy), 0) total_clicks_yoy,
ifnull(max(ctr_yoy), 0) ctr_yoy,
ifnull(CASE WHEN max(total_impressions_yoy) > 0 THEN max(total_clicks_yoy) / max(total_impressions_yoy) ELSE null END, 0) as total_ctr_yoy,
ifnull(max(avg_position_yoy), 0) avg_position_yoy,
ifnull(sum(impressions_ttm), 0) impressions_ttm,
ifnull(sum(clicks_ttm), 0) clicks_ttm,
ifnull(max(ctr_ttm), 0) ctr_ttm,
ifnull(max(avg_position_ttm), 0) avg_position_ttm,
ifnull(sum(top_3_keywords), 0) top_3_keywords,
ifnull(sum(top_5_keywords), 0) top_5_keywords,
ifnull(sum(top_10_keywords), 0) top_10_keywords,
ifnull(sum(top_20_keywords), 0) top_20_keywords,
max(main_keyword) main_keyword,
max(main_impressions) main_impressions,
max(main_clicks) main_clicks,
max(main_avg_position) main_avg_position,
max(main_top_url) main_top_url,
max(main_top_url_clicks) main_top_url_clicks,
max(best_keyword) best_keyword,
max(best_impressions) best_impressions,
max(best_clicks) best_clicks,
max(best_avg_position) best_avg_position,
max(best_top_url) best_top_url,
max(best_top_url_clicks) best_top_url_clicks,
ifnull(sum(sessions_30d), 0) sessions_30d,
ifnull(max(total_organic_sessions_30d), 0) total_organic_sessions_30d,
ifnull(max(bottom_quartile_sessions_30d), 0) bottom_quartile_sessions_30d,
ifnull(max(med_sessions_30d), 0) med_sessions_30d,
ifnull(max(top_quartile_sessions_30d), 0) top_quartile_sessions_30d,	
ifnull(sum(transaction_revenue_30d), 0) transaction_revenue_30d,
ifnull(sum(transactions_30d), 0) transactions_30d,
ifnull(max(total_organic_transactions_30d), 0) total_organic_transactions_30d,
ifnull(max(ecommerce_conversion_rate_30d), 0) ecommerce_conversion_rate_30d,
ifnull(max(med_transaction_conversion_rate_30d), 0) med_transaction_conversion_rate_30d,
ifnull(CASE WHEN max(total_organic_sessions_30d) > 0 THEN max(total_organic_transactions_30d) / max(total_organic_sessions_30d) ELSE null END, 0) as total_organic_ecommerce_conversion_rate_30d,
ifnull(sum(goal_completions_all_goals_30d), 0) goal_completions_all_goals_30d,
ifnull(max(total_organic_goal_completions_all_goals_30d), 0) total_organic_goal_completions_all_goals_30d,
ifnull(max(goal_conversion_rate_all_goals_30d), 0) goal_conversion_rate_all_goals_30d,
ifnull(CASE WHEN max(total_organic_sessions_30d) > 0 THEN max(total_organic_goal_completions_all_goals_30d) / max(total_organic_sessions_30d) ELSE null END, 0) as total_organic_goal_conversion_rate_30d,
ifnull(max(blended_conversions_30d), 0) blended_conversions_30d,	
ifnull(max(blended_conversion_rate_30d), 0) blended_conversion_rate_30d,	
ifnull(max(bottom_quartile_blended_conversions_30d), 0) bottom_quartile_blended_conversions_30d,	
ifnull(max(med_blended_conversions_30d), 0) med_blended_conversions_30d,	
ifnull(max(top_quartile_blended_conversions_30d), 0) top_quartile_blended_conversions_30d,	
ifnull(max(bottom_quartile_blended_conversion_rate_30d), 0) bottom_quartile_blended_conversion_rate_30d,	
ifnull(max(med_blended_conversion_rate_30d), 0) med_blended_conversion_rate_30d,	
ifnull(max(top_quartile_blended_conversion_rate_30d), 0) top_quartile_blended_conversion_rate_30d, 
ifnull(max(bounce_rate_30d), 0) bounce_rate_30d,
ifnull(max(avg_seconds_on_site_30d), 0) avg_seconds_on_site_30d,
ifnull(max(med_goal_conversion_rate_30d),0) med_goal_conversion_rate_30d,
ifnull(sum(sessions_mom), 0) sessions_mom,
ifnull(max(total_organic_sessions_mom), 0) total_organic_sessions_mom,
ifnull(sum(transaction_revenue_mom), 0) transaction_revenue_mom,
ifnull(sum(transactions_mom), 0) transactions_mom,
ifnull(max(total_organic_transactions_mom), 0) total_organic_transactions_mom,
ifnull(max(ecommerce_conversion_rate_mom), 0) ecommerce_conversion_rate_mom,
ifnull(CASE WHEN max(total_organic_sessions_mom) > 0 THEN max(total_organic_transactions_mom) / max(total_organic_sessions_mom) ELSE null END, 0) as total_organic_ecommerce_conversion_rate_mom,
ifnull(sum(goal_completions_all_goals_mom), 0) goal_completions_all_goals_mom,
ifnull(max(total_organic_goal_completions_all_goals_mom), 0) total_organic_goal_completions_all_goals_mom,
ifnull(max(goal_conversion_rate_all_goals_mom), 0) goal_conversion_rate_all_goals_mom,
ifnull(CASE WHEN max(total_organic_sessions_mom) > 0 THEN max(total_organic_goal_completions_all_goals_mom) / max(total_organic_sessions_mom) ELSE null END, 0) as total_organic_goal_conversion_rate_mom,
ifnull(max(bounce_rate_mom), 0) bounce_rate_mom,
ifnull(max(avg_seconds_on_site_mom), 0) avg_seconds_on_site_mom,
ifnull(sum(sessions_yoy), 0) sessions_yoy,
ifnull(max(total_organic_sessions_yoy), 0) total_organic_sessions_yoy,
ifnull(sum(transaction_revenue_yoy), 0) transaction_revenue_yoy,
ifnull(sum(transactions_yoy), 0) transactions_yoy,
ifnull(max(total_organic_transactions_yoy), 0) total_organic_transactions_yoy,
ifnull(max(ecommerce_conversion_rate_yoy), 0) ecommerce_conversion_rate_yoy,
ifnull(CASE WHEN max(total_organic_sessions_yoy) > 0 THEN max(total_organic_transactions_yoy) / max(total_organic_sessions_yoy) ELSE null END, 0) as total_organic_ecommerce_conversion_rate_yoy,
ifnull(sum(goal_completions_all_goals_yoy), 0) goal_completions_all_goals_yoy,
ifnull(max(total_organic_goal_completions_all_goals_yoy), 0) total_organic_goal_completions_all_goals_yoy,
ifnull(max(goal_conversion_rate_all_goals_yoy), 0) goal_conversion_rate_all_goals_yoy,
ifnull(CASE WHEN max(total_organic_sessions_yoy) > 0 THEN max(total_organic_goal_completions_all_goals_yoy) / max(total_organic_sessions_yoy) ELSE null END, 0) as total_organic_goal_conversion_rate_yoy,
ifnull(max(bounce_rate_yoy), 0) bounce_rate_yoy,
ifnull(max(avg_seconds_on_site_yoy), 0) avg_seconds_on_site_yoy,
ifnull(sum(sessions_ttm), 0) sessions_ttm,
ifnull(sum(transaction_revenue_ttm), 0) transaction_revenue_ttm,
ifnull(sum(transactions_ttm), 0) transactions_ttm,
ifnull(max(ecommerce_conversion_rate_ttm), 0) ecommerce_conversion_rate_ttm,
ifnull(sum(goal_completions_all_goals_ttm), 0) goal_completions_all_goals_ttm,
ifnull(max(goal_conversion_rate_all_goals_ttm), 0) goal_conversion_rate_all_goals_ttm,
ifnull(max(bounce_rate_ttm), 0) bounce_rate_ttm,
ifnull(max(avg_seconds_on_site_ttm), 0) avg_seconds_on_site_ttm
FROM (

	SELECT 
	date,
	account,
	site,
	domain,
	url,
	impressions_30d,
	sum(impressions_30d) over w1 as total_impressions_30d,
	PERCENTILE_DISC(impressions_30d, 0.5 IGNORE NULLS) OVER w1 AS med_impressions_30d,
	PERCENTILE_DISC(impressions_30d, 0.9 IGNORE NULLS) OVER w1 AS top_10pct_impressions_30d,		
	clicks_30d,
	sum(clicks_30d) over w1 as total_clicks_30d,
	ctr_30d,	
	PERCENTILE_DISC(ctr_30d, 0.5 IGNORE NULLS) OVER w1 AS med_ctr_30d,
	avg_position_30d,
	impressions_mom,
	sum(impressions_mom) over w1 as total_impressions_mom,
	clicks_mom,
	sum(clicks_mom) over w1 as total_clicks_mom,
	ctr_mom,
	avg_position_mom,
	impressions_yoy,
	sum(impressions_yoy) over w1 as total_impressions_yoy,
	clicks_yoy,
	sum(clicks_yoy) over w1 as total_clicks_yoy,
	ctr_yoy,	
	avg_position_yoy,	
	impressions_ttm,
	clicks_ttm,
	ctr_ttm,	
	avg_position_ttm,		
	null as top_3_keywords,
	null as top_5_keywords,
	null as top_10_keywords,
	null as top_20_keywords,
	'' as main_keyword,
	null as main_impressions,
	null as main_clicks,
	null as main_avg_position,
	'' as main_top_url,
	null as main_top_url_clicks,
	'' as best_keyword,
	null as best_impressions,
	null as best_clicks,
	null as best_avg_position,
	'' as best_top_url,
	null as best_top_url_clicks,
	null as sessions_30d,
	null as total_organic_sessions_30d,
	null as bottom_quartile_sessions_30d,
	null as med_sessions_30d,
	null as top_quartile_sessions_30d,	
	null as transaction_revenue_30d,
	null as transactions_30d,
	null as total_organic_transactions_30d,
	null as ecommerce_conversion_rate_30d,
	null as med_transaction_conversion_rate_30d,
	null as goal_completions_all_goals_30d,
	null as total_organic_goal_completions_all_goals_30d,
	null as goal_conversion_rate_all_goals_30d,
	null as med_goal_conversion_rate_30d,
	null as blended_conversions_30d,	
	null as bottom_quartile_blended_conversions_30d,	
	null as med_blended_conversions_30d,	
	null as top_quartile_blended_conversions_30d,	
	null as blended_conversion_rate_30d,	
	null as bottom_quartile_blended_conversion_rate_30d,	
	null as med_blended_conversion_rate_30d,	
	null as top_quartile_blended_conversion_rate_30d, 
	null as bounce_rate_30d,
	null as avg_seconds_on_site_30d,
	null as sessions_mom,
	null as total_organic_sessions_mom,
	null as transaction_revenue_mom,
	null as transactions_mom,
	null as total_organic_transactions_mom,
	null as ecommerce_conversion_rate_mom,
	null as goal_completions_all_goals_mom,
	null as total_organic_goal_completions_all_goals_mom,
	null as goal_conversion_rate_all_goals_mom,
	null as bounce_rate_mom,
	null as avg_seconds_on_site_mom,
	null as sessions_yoy,
	null as total_organic_sessions_yoy,
	null as transaction_revenue_yoy,
	null as transactions_yoy,
	null as total_organic_transactions_yoy,
	null as ecommerce_conversion_rate_yoy,
	null as goal_completions_all_goals_yoy,
	null as total_organic_goal_completions_all_goals_yoy,
	null as goal_conversion_rate_all_goals_yoy,
	null as bounce_rate_yoy,
	null as avg_seconds_on_site_yoy,
	null as sessions_ttm,
	null as transaction_revenue_ttm,
	null as transactions_ttm,
	null as ecommerce_conversion_rate_ttm,
	null as goal_completions_all_goals_ttm,
	null as goal_conversion_rate_all_goals_ttm,
	null as bounce_rate_ttm,
	null as avg_seconds_on_site_ttm
	FROM `seo-data-pipeline-89`.`adp_thecifhw`.`search_console_url_stats`
	WINDOW w1 as (PARTITION BY date, site)

	UNION ALL  

	SELECT 
	date,
	account,
	site,
	domain,
	url,
	null as impressions_30d,
	null as total_impressions_30d,
	null as med_impressions_30d,
	null as top_10pct_impressions_30d,
	null as clicks_30d,
	null as total_clicks_30d,
	null as ctr_30d,
	null as med_ctr_30d,
	null as avg_position_30d,
	null as impressions_mom,
	null as total_impressions_mom,
	null as clicks_mom,
	null as total_clicks_mom,
	null as ctr_mom,
	null as avg_position_mom,
	null as impressions_yoy,
	null as total_impressions_yoy,
	null as clicks_yoy,
	null as total_clicks_yoy,
	null as ctr_yoy,
	null as avg_position_yoy,		
	null as impressions_ttm,
	null as clicks_ttm,
	null as ctr_ttm,
	null as avg_position_ttm,			
	top_3_keywords,
	top_5_keywords,
	top_10_keywords,
	top_20_keywords,
	main_keyword,
	main_impressions,
	main_clicks,
	main_avg_position,
	main_top_url,
	main_top_url_clicks,
	best_keyword,
	best_impressions,
	best_clicks,
	best_avg_position,
	best_top_url,
	best_top_url_clicks,
	null as sessions_30d,
	null as total_organic_sessions_30d,
	null as bottom_quartile_sessions_30d,
	null as med_sessions_30d,
	null as top_quartile_sessions_30d,	
	null as transaction_revenue_30d,
	null as transactions_30d,
	null as total_organic_transactions_30d,
	null as ecommerce_conversion_rate_30d,
	null as med_transaction_conversion_rate_30d,
	null as goal_completions_all_goals_30d,
	null as total_organic_goal_completions_all_goals_30d,
	null as goal_conversion_rate_all_goals_30d,
	null as med_goal_conversion_rate_30d,
	null as blended_conversions_30d,	
	null as bottom_quartile_blended_conversions_30d,	
	null as med_blended_conversions_30d,	
	null as top_quartile_blended_conversions_30d,	
	null as blended_conversion_rate_30d,	
	null as bottom_quartile_blended_conversion_rate_30d,	
	null as med_blended_conversion_rate_30d,	
	null as top_quartile_blended_conversion_rate_30d, 
	null as bounce_rate_30d,
	null as avg_seconds_on_site_30d,
	null as sessions_mom,
	null as total_organic_sessions_mom,
	null as transaction_revenue_mom,
	null as transactions_mom,
	null as total_organic_transactions_mom,
	null as ecommerce_conversion_rate_mom,
	null as goal_completions_all_goals_mom,
	null as total_organic_goal_completions_all_goals_mom,
	null as goal_conversion_rate_all_goals_mom,
	null as bounce_rate_mom,
	null as avg_seconds_on_site_mom,
	null as sessions_yoy,
	null as total_organic_sessions_yoy,
	null as transaction_revenue_yoy,
	null as transactions_yoy,
	null as total_organic_transactions_yoy,
	null as ecommerce_conversion_rate_yoy,
	null as goal_completions_all_goals_yoy,
	null as total_organic_goal_completions_all_goals_yoy,
	null as goal_conversion_rate_all_goals_yoy,
	null as bounce_rate_yoy,
	null as avg_seconds_on_site_yoy,
	null as sessions_ttm,
	null as transaction_revenue_ttm,
	null as transactions_ttm,
	null as ecommerce_conversion_rate_ttm,
	null as goal_completions_all_goals_ttm,
	null as goal_conversion_rate_all_goals_ttm,
	null as bounce_rate_ttm,
	null as avg_seconds_on_site_ttm
	FROM `seo-data-pipeline-89`.`adp_thecifhw`.`search_console_url_keyword_stats`

	UNION ALL  

	SELECT 
	date,
	account,
	site,
	domain,
	url,
	null as impressions_30d,
	null as total_impressions_30d,
	null as med_impressions_30d,
	null as top_10pct_impressions_30d,	
	null as clicks_30d,
	null as total_clicks_30d,
	null as ctr_30d,
	null as med_ctr_30d,
	null as avg_position_30d,
	null as impressions_mom,
	null as total_impressions_mom,
	null as clicks_mom,
	null as total_clicks_mom,
	null as ctr_mom,
	null as avg_position_mom,
	null as impressions_yoy,
	null as total_impressions_yoy,
	null as clicks_yoy,
	null as total_clicks_yoy,
	null as ctr_yoy,
	null as avg_position_yoy,		
	null as impressions_ttm,
	null as clicks_ttm,
	null as ctr_ttm,
	null as avg_position_ttm,			
	null as top_3_keywords,
	null as top_5_keywords,
	null as top_10_keywords,
	null as top_20_keywords,
	'' as main_keyword,
	null as main_impressions,
	null as main_clicks,
	null as main_avg_position,
	'' as main_top_url,
	null as main_top_url_clicks,
	'' as best_keyword,
	null as best_impressions,
	null as best_clicks,
	null as best_avg_position,
	'' as best_top_url,
	null as best_top_url_clicks,
	sessions_30d,
	sum(sessions_30d) over w1 as total_organic_sessions_30d,
	PERCENTILE_DISC(sessions_30d, 0.25 IGNORE NULLS) OVER w1 AS bottom_quartile_sessions_30d,
	PERCENTILE_DISC(sessions_30d, 0.5 IGNORE NULLS) OVER w1 AS med_sessions_30d,
	PERCENTILE_DISC(sessions_30d, 0.75 IGNORE NULLS) OVER w1 AS top_quartile_sessions_30d,		
	transaction_revenue_30d,
	transactions_30d,
	sum(transactions_30d) over w1 as total_organic_transactions_30d,
	ecommerce_conversion_rate_30d,
	PERCENTILE_DISC(ecommerce_conversion_rate_30d, 0.5 IGNORE NULLS) OVER w1 AS med_transaction_conversion_rate_30d,
	goal_completions_all_goals_30d,
	sum(goal_completions_all_goals_30d) over w1 as total_organic_goal_completions_all_goals_30d,
	goal_conversion_rate_all_goals_30d,
	PERCENTILE_DISC(goal_conversion_rate_all_goals_30d, 0.5 IGNORE NULLS) OVER w1 AS med_goal_conversion_rate_30d,
	blended_conversions_30d,	
	PERCENTILE_DISC(blended_conversions_30d, 0.25 IGNORE NULLS) OVER w1 AS bottom_quartile_blended_conversions_30d,	
	PERCENTILE_DISC(blended_conversions_30d, 0.5 IGNORE NULLS) OVER w1 AS med_blended_conversions_30d,	
	PERCENTILE_DISC(blended_conversions_30d, 0.75 IGNORE NULLS) OVER w1 AS top_quartile_blended_conversions_30d,	
	blended_conversion_rate_30d,	
	PERCENTILE_DISC(blended_conversion_rate_30d, 0.25 IGNORE NULLS) OVER w1 AS bottom_quartile_blended_conversion_rate_30d,	
	PERCENTILE_DISC(blended_conversion_rate_30d, 0.5 IGNORE NULLS) OVER w1 AS med_blended_conversion_rate_30d,	
	PERCENTILE_DISC(blended_conversion_rate_30d, 0.75 IGNORE NULLS) OVER w1 AS top_quartile_blended_conversion_rate_30d, 
	bounce_rate_30d,
	avg_seconds_on_site_30d,
	sessions_mom,
	sum(sessions_mom) over w1 as total_organic_sessions_mom,
	transaction_revenue_mom,
	transactions_mom,
	sum(transactions_mom) over w1 as total_organic_transactions_mom,
	ecommerce_conversion_rate_mom,
	goal_completions_all_goals_mom,
	sum(goal_completions_all_goals_mom) over w1 as total_organic_goal_completions_all_goals_mom,
	goal_conversion_rate_all_goals_mom,
	bounce_rate_mom,
	avg_seconds_on_site_mom,
	sessions_yoy,
	sum(sessions_yoy) over w1 as total_organic_sessions_yoy,
	transaction_revenue_yoy,
	transactions_yoy,
	sum(transactions_yoy) over w1 as total_organic_transactions_yoy,
	ecommerce_conversion_rate_yoy,
	goal_completions_all_goals_yoy,
	sum(goal_completions_all_goals_yoy) over w1 as total_organic_goal_completions_all_goals_yoy,
	goal_conversion_rate_all_goals_yoy,
	bounce_rate_yoy,
	avg_seconds_on_site_yoy,
	sessions_ttm,
	transaction_revenue_ttm,
	transactions_ttm,
	ecommerce_conversion_rate_ttm,
	goal_completions_all_goals_ttm,
	goal_conversion_rate_all_goals_ttm,
	bounce_rate_ttm,
	avg_seconds_on_site_ttm
	FROM `seo-data-pipeline-89`.`adp_thecifhw`.`ga_stats`  
	WINDOW w1 as (PARTITION BY date, site)
) 
WHERE date is not null
GROUP BY date, site, domain, url
  );
    
2021-04-19 16:29:09.956003 (Thread-45): handling poll request
2021-04-19 16:29:09.956438 (Thread-45): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'd178ec37-7b39-42b2-b063-b88e83fe10fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa03cda4640>]}
2021-04-19 16:29:09.958418 (Thread-45): sending response (<Response 24523 bytes [200 OK]>) to 10.0.40.83
2021-04-19 16:29:11.676856 (Thread-1): finished collecting timing info
2021-04-19 16:29:11.677650 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd2dee09f-521a-45b5-af69-4db908d4d9f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f59016448e0>]}
2021-04-19 16:29:11.680576 (Thread-1): 16:29:11 | 18 of 25 OK created table model adp_thecifhw.agg_traffic............. [CREATE TABLE (381.0 rows, 103.0 KB processed) in 3.09s]
2021-04-19 16:29:11.680689 (Thread-1): Finished running node model.tech_audit.agg_traffic
2021-04-19 16:29:11.681405 (Thread-1): Began running node model.tech_audit.agg_all
2021-04-19 16:29:11.682253 (Thread-1): 16:29:11 | 19 of 25 START table model adp_thecifhw.agg_all...................... [RUN]
2021-04-19 16:29:11.682460 (Thread-1): Acquiring new bigquery connection "model.tech_audit.agg_all".
2021-04-19 16:29:11.682532 (Thread-1): Compiling model.tech_audit.agg_all
2021-04-19 16:29:11.692097 (Thread-1): Writing injected SQL for node "model.tech_audit.agg_all"
2021-04-19 16:29:11.731516 (Thread-1): finished collecting timing info
2021-04-19 16:29:11.735831 (Thread-1): Opening a new connection, currently in state closed
2021-04-19 16:29:11.917880 (Thread-1): Writing runtime SQL for node "model.tech_audit.agg_all"
2021-04-19 16:29:11.950682 (Thread-1): On model.tech_audit.agg_all: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.tech_audit.agg_all"} */


  create or replace table `seo-data-pipeline-89`.`adp_thecifhw`.`agg_all`
  
  
  OPTIONS()
  as (
    SELECT 
coalesce(a.date, b.report_date) date, 
crawl_date,
coalesce(a.site, b.site) site,
coalesce(a.domain, b.domain) domain,
coalesce(a.url, b.url) url,
CASE 
	WHEN http_status_code is not null AND sessions_30d > 0 AND impressions_30d > 0 THEN 'Deepcrawl, GA, GSC'
	WHEN http_status_code is not null AND sessions_30d > 0 THEN 'Deepcrawl, GA'
	WHEN http_status_code is not null AND impressions_30d > 0 THEN 'Deepcrawl, GSC'
	WHEN http_status_code is not null THEN 'Deepcrawl' 
	WHEN sessions_30d > 0 AND impressions_30d > 0 THEN 'GA, GSC'
	WHEN sessions_30d > 0 THEN 'GA'
	WHEN impressions_30d > 0 THEN 'GSC'
	ELSE null END as found_at,
-- deepcrawl data
case when found_at_sitemap is not null then 'yes' else 'no' end as in_sitemap,
found_at_sitemap,
CASE WHEN b.page_type is null THEN 'None (missing from crawl)'
	ELSE b.page_type END as page_type,
url_stripped,
url_protocol,
canonical_url_protocol,
protocol_match,
protocol_count,
canonical_url,
canonical_status,
urls_to_canonical,
first_subfolder,
second_subfolder,
last_subfolder,
last_subfolder_canonical,
http_status_code,
level,
schema_type,
header_content_type,
word_count, 
page_title,
case when regexp_contains(page_title, main_keyword) OR regexp_contains(page_title, best_keyword)  then 1
	when ( main_keyword is not null or main_keyword != '' ) then 0 else 2 end as title_contains_top_keyword,
page_title_length,
description,
case when regexp_contains(description, main_keyword) OR regexp_contains(description, best_keyword) then 1 
	when ( main_keyword is not null or main_keyword != '' ) then 0 else 2 end as description_contains_top_keyword,
description_length,
indexable,
robots_noindex,
meta_noindex,
CASE WHEN robots_noindex = TRUE or meta_noindex = TRUE then 1 else 0 end as is_noindex,
is_self_canonical,
redirected_to_url,
found_at_url,
rel_next_url,
rel_prev_url,
links_in_count internal_links_in_count,
bottom_quartile_internal_links_in_count,
top_quartile_internal_links_in_count,
links_out_count,
external_links_count,
internal_links_count internal_links_out_count,
bottom_quartile_internal_links_out_count,
flag_paginated,
case when regexp_contains(coalesce(a.url, b.url), r'\/\d') then 1 else 0 end as url_contains_digit,
h1_tag,
h2_tag,
redirect_chain,
redirected_to_status_code,
is_redirect_loop,
duplicate_page,
duplicate_page_count,
duplicate_body,
duplicate_body_count,
-- gsc + ga data
sessions_30d,
bottom_quartile_sessions_30d,
med_sessions_30d,
top_quartile_sessions_30d,
total_organic_sessions_30d,
CASE WHEN total_organic_sessions_30d > 0 THEN sessions_30d / total_organic_sessions_30d ELSE null END as pct_of_organic_sessions_30d,
transaction_revenue_30d,
transactions_30d,
CASE WHEN total_organic_transactions_30d > 0 THEN transactions_30d / total_organic_transactions_30d ELSE null END as pct_of_organic_transactions_30d,
ecommerce_conversion_rate_30d,
med_transaction_conversion_rate_30d,
goal_completions_all_goals_30d,
CASE WHEN total_organic_goal_completions_all_goals_30d > 0 THEN goal_completions_all_goals_30d / total_organic_goal_completions_all_goals_30d ELSE null END as pct_of_organic_goal_completions_all_goals_30d,
goal_conversion_rate_all_goals_30d,
med_goal_conversion_rate_30d,
blended_conversions_30d,	
bottom_quartile_blended_conversions_30d,	
med_blended_conversions_30d,	
top_quartile_blended_conversions_30d,	
blended_conversion_rate_30d,	
bottom_quartile_blended_conversion_rate_30d,	
med_blended_conversion_rate_30d,	
top_quartile_blended_conversion_rate_30d,
bounce_rate_30d,
avg_seconds_on_site_30d,
sessions_mom,
case when sessions_mom > 0 then (sessions_30d-sessions_mom)/sessions_mom else null end sessions_mom_pct,
case when total_organic_sessions_mom > 0 then (total_organic_sessions_30d-total_organic_sessions_mom)/total_organic_sessions_mom else null end total_organic_sessions_mom_pct,
transaction_revenue_mom,
case when transaction_revenue_mom > 0 then (transaction_revenue_30d-transaction_revenue_mom)/transaction_revenue_mom else null end transaction_revenue_mom_pct,
transactions_mom,
case when transactions_mom > 0 then (transactions_30d-transactions_mom)/transactions_mom else null end transactions_mom_pct,
ecommerce_conversion_rate_mom,
case when ecommerce_conversion_rate_mom > 0 then (ecommerce_conversion_rate_30d-ecommerce_conversion_rate_mom)/ecommerce_conversion_rate_mom else null end ecommerce_conversion_rate_mom_pct,
case when total_organic_ecommerce_conversion_rate_mom > 0 then (total_organic_ecommerce_conversion_rate_30d-total_organic_ecommerce_conversion_rate_mom)/total_organic_ecommerce_conversion_rate_mom else null end total_organic_ecommerce_conversion_rate_mom_pct,
goal_completions_all_goals_mom,
case when goal_completions_all_goals_mom > 0 then (goal_completions_all_goals_30d-goal_completions_all_goals_mom)/goal_completions_all_goals_mom else null end goal_completions_all_goals_mom_pct,
goal_conversion_rate_all_goals_mom,
case when goal_conversion_rate_all_goals_mom > 0 then (goal_conversion_rate_all_goals_30d-goal_conversion_rate_all_goals_mom)/goal_conversion_rate_all_goals_mom else null end goal_conversion_rate_all_goals_mom_pct,
case when total_organic_goal_conversion_rate_mom > 0 then (total_organic_goal_conversion_rate_30d-total_organic_goal_conversion_rate_mom)/total_organic_goal_conversion_rate_mom else null end total_organic_goal_conversion_rate_mom_pct,
sessions_yoy,
case when sessions_yoy > 0 then (sessions_30d-sessions_yoy)/sessions_yoy else null end sessions_yoy_pct,
case when total_organic_sessions_yoy > 0 then (total_organic_sessions_30d-total_organic_sessions_yoy)/total_organic_sessions_yoy else null end total_organic_sessions_yoy_pct,
transaction_revenue_yoy,
case when transaction_revenue_yoy > 0 then (transaction_revenue_30d-transaction_revenue_yoy)/transaction_revenue_yoy else null end transaction_revenue_yoy_pct,
transactions_yoy,
case when transactions_yoy > 0 then (transactions_30d-transactions_yoy)/transactions_yoy else null end transactions_yoy_pct,
ecommerce_conversion_rate_yoy,
case when ecommerce_conversion_rate_yoy > 0 then (ecommerce_conversion_rate_30d-ecommerce_conversion_rate_yoy)/ecommerce_conversion_rate_yoy else null end ecommerce_conversion_rate_yoy_pct,
case when total_organic_ecommerce_conversion_rate_yoy > 0 then (total_organic_ecommerce_conversion_rate_30d-total_organic_ecommerce_conversion_rate_yoy)/total_organic_ecommerce_conversion_rate_yoy else null end total_organic_ecommerce_conversion_rate_yoy_pct,
goal_completions_all_goals_yoy,
case when transactions_yoy > 0 then (goal_completions_all_goals_30d-goal_completions_all_goals_yoy)/transactions_yoy else null end goal_completions_all_goals_yoy_pct,
goal_conversion_rate_all_goals_yoy,
case when goal_conversion_rate_all_goals_yoy > 0 then (goal_conversion_rate_all_goals_30d-goal_conversion_rate_all_goals_yoy)/goal_conversion_rate_all_goals_yoy else null end goal_conversion_rate_all_goals_yoy_pct,
case when total_organic_goal_conversion_rate_yoy > 0 then (total_organic_goal_conversion_rate_30d-total_organic_goal_conversion_rate_yoy)/total_organic_goal_conversion_rate_yoy else null end total_organic_goal_conversion_rate_yoy_pct,
sessions_ttm,
transaction_revenue_ttm,
transactions_ttm,
ecommerce_conversion_rate_ttm,
goal_completions_all_goals_ttm,
goal_conversion_rate_all_goals_ttm,
bounce_rate_ttm,
avg_seconds_on_site_ttm,
case when sessions_30d > sessions_mom then TRUE else FALSE end as gaining_traffic_mom,
case when sessions_30d > sessions_yoy then TRUE else FALSE end as gaining_traffic_yoy,
backlink_count,
backlink_domain_count ref_domain_count,
med_ref_domain_count,
bottom_quartile_ref_domain_count,
impressions_30d,
total_impressions_30d,
CASE WHEN total_impressions_30d > 0 THEN impressions_30d / total_impressions_30d ELSE null END as pct_of_total_impressions_30d,
med_impressions_30d,
top_10pct_impressions_30d,
clicks_30d,
total_clicks_30d,
ctr_30d,
med_ctr_30d,
total_ctr_30d,
avg_position_30d,
impressions_mom,
total_impressions_mom,
case when impressions_mom > 0 then (impressions_30d-impressions_mom)/impressions_mom else null end impressions_mom_pct,
case when total_impressions_mom > 0 then (total_impressions_30d-total_impressions_mom)/total_impressions_mom else null end total_impressions_mom_pct,
clicks_mom,
total_clicks_mom,
case when clicks_mom > 0 then (clicks_30d-clicks_mom)/clicks_mom else null end clicks_mom_pct,
case when total_clicks_mom > 0 then (total_clicks_30d-total_clicks_mom)/total_clicks_mom else null end total_clicks_mom_pct,
ctr_mom,
total_ctr_mom,
case when ctr_mom > 0 then (ctr_30d-ctr_mom)/ctr_mom else null end ctr_mom_pct,
case when total_ctr_mom > 0 then (total_ctr_30d-total_ctr_mom)/total_ctr_mom else null end total_ctr_mom_pct,
avg_position_mom,
impressions_yoy,
total_impressions_yoy,
case when impressions_yoy > 0 then (impressions_30d-impressions_yoy)/impressions_yoy else null end impressions_yoy_pct,
case when total_impressions_yoy > 0 then (total_impressions_30d-total_impressions_yoy)/total_impressions_yoy else null end total_impressions_yoy_pct,
clicks_yoy,
total_clicks_yoy,
case when clicks_yoy > 0 then (clicks_30d-clicks_yoy)/clicks_yoy else null end clicks_yoy_pct,
case when total_clicks_yoy > 0 then (total_clicks_30d-total_clicks_yoy)/total_clicks_yoy else null end total_clicks_yoy_pct,
ctr_yoy,	
total_ctr_yoy,
case when ctr_yoy > 0 then (ctr_30d-ctr_yoy)/ctr_yoy else null end ctr_yoy_pct,
case when total_ctr_yoy > 0 then (total_ctr_30d-total_ctr_yoy)/total_ctr_yoy else null end total_ctr_yoy_pct,
impressions_ttm,
clicks_ttm,
ctr_ttm,
avg_position_ttm,
avg_position_yoy,	
top_3_keywords,
top_5_keywords,
top_10_keywords,
top_20_keywords,
main_keyword,
main_impressions,
main_clicks,
main_avg_position,
main_top_url,
CASE WHEN main_top_url != a.url and main_keyword != '' THEN 1 ELSE 0 END as main_keyword_cannibalization_flag,
main_top_url_clicks,
best_keyword,
best_impressions,
best_clicks,
best_avg_position,
best_top_url,
best_top_url_clicks,
CASE WHEN best_top_url != a.url and best_keyword != '' THEN 1 ELSE 0 END as best_keyword_cannibalization_flag
FROM 
  `seo-data-pipeline-89`.`adp_thecifhw`.`agg_traffic` a
FULL OUTER JOIN `seo-data-pipeline-89`.`adp_thecifhw`.`deepcrawl_stats` b
ON ( a.url = b.url
	and a.site = b.site
	and a.date = b.report_date )
  );
    
2021-04-19 16:29:12.366156 (Thread-46): handling poll request
2021-04-19 16:29:12.366578 (Thread-46): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'd178ec37-7b39-42b2-b063-b88e83fe10fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa03cda4fa0>]}
2021-04-19 16:29:12.368578 (Thread-46): sending response (<Response 16214 bytes [200 OK]>) to 10.0.7.215
2021-04-19 16:29:14.020771 (Thread-47): handling poll request
2021-04-19 16:29:14.021230 (Thread-47): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'd178ec37-7b39-42b2-b063-b88e83fe10fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa03cdb96a0>]}
2021-04-19 16:29:14.022314 (Thread-47): sending response (<Response 284 bytes [200 OK]>) to 10.0.45.98
2021-04-19 16:29:14.547197 (Thread-1): finished collecting timing info
2021-04-19 16:29:14.548017 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd2dee09f-521a-45b5-af69-4db908d4d9f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f59015ec400>]}
2021-04-19 16:29:14.548977 (Thread-1): 16:29:14 | 19 of 25 OK created table model adp_thecifhw.agg_all................. [CREATE TABLE (438.0 rows, 668.3 KB processed) in 2.87s]
2021-04-19 16:29:14.549061 (Thread-1): Finished running node model.tech_audit.agg_all
2021-04-19 16:29:14.549915 (Thread-1): Began running node model.tech_audit.actions_proc
2021-04-19 16:29:14.550822 (Thread-1): 16:29:14 | 20 of 25 START table model adp_thecifhw.actions_proc................. [RUN]
2021-04-19 16:29:14.551032 (Thread-1): Acquiring new bigquery connection "model.tech_audit.actions_proc".
2021-04-19 16:29:14.551122 (Thread-1): Compiling model.tech_audit.actions_proc
2021-04-19 16:29:14.560685 (Thread-1): Writing injected SQL for node "model.tech_audit.actions_proc"
2021-04-19 16:29:14.611423 (Thread-1): finished collecting timing info
2021-04-19 16:29:14.615773 (Thread-1): Opening a new connection, currently in state closed
2021-04-19 16:29:14.820352 (Thread-1): Writing runtime SQL for node "model.tech_audit.actions_proc"
2021-04-19 16:29:14.867753 (Thread-1): On model.tech_audit.actions_proc: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.tech_audit.actions_proc"} */


  create or replace table `seo-data-pipeline-89`.`adp_thecifhw`.`actions_proc`
  
  
  OPTIONS()
  as (
    with agg_all as (

	SELECT
	date,
	crawl_date,
	site,
	domain,
	url,
	found_at,
	found_at_sitemap,
	canonical_url,
	page_type,
	url_stripped,
	url_protocol,
	canonical_url_protocol,
	protocol_match,
	protocol_count,
	canonical_status,
	urls_to_canonical,
	first_subfolder,
	second_subfolder,
	last_subfolder,
	last_subfolder_canonical,
	http_status_code,
	level,
	schema_type,
	header_content_type,
	word_count, 
	page_title,
	title_contains_top_keyword,
	page_title_length,
	description,
	description_contains_top_keyword,
	description_length,
	indexable,
	robots_noindex,
	meta_noindex,
	is_noindex,
	is_self_canonical,
	redirected_to_url,
	found_at_url,
	rel_next_url,
	rel_prev_url,
	flag_paginated,
	internal_links_in_count,
	bottom_quartile_internal_links_in_count,
	top_quartile_internal_links_in_count,
	links_out_count,
	external_links_count,
	internal_links_out_count,
	bottom_quartile_internal_links_out_count,
	h1_tag,
	h2_tag,
	redirect_chain,
	redirected_to_status_code,
	is_redirect_loop,
	duplicate_page,
	duplicate_page_count,
	duplicate_body,
	duplicate_body_count,
	url_contains_digit,

	-- ga + gsc data
	sessions_30d,
	lag(sessions_30d) over mom as sessions_30d_mom,
	bottom_quartile_sessions_30d,
	med_sessions_30d,
	pct_of_organic_sessions_30d,
	transaction_revenue_30d,
	lag(transaction_revenue_30d) over mom as transaction_revenue_30d_mom,
	transactions_30d,
	lag(transactions_30d) over mom as transactions_30d_mom,
	pct_of_organic_transactions_30d,
	ecommerce_conversion_rate_30d,
	med_transaction_conversion_rate_30d,
	goal_completions_all_goals_30d,
	lag(goal_completions_all_goals_30d) over mom as goal_completions_all_goals_30d_mom,
	pct_of_organic_goal_completions_all_goals_30d,
	goal_conversion_rate_all_goals_30d,
	med_goal_conversion_rate_30d,
	blended_conversions_30d,	
	blended_conversion_rate_30d,
	bounce_rate_30d,
	avg_seconds_on_site_30d,
	sessions_mom,
	sessions_mom_pct,
	total_organic_sessions_mom_pct,
	transaction_revenue_mom,
	transaction_revenue_mom_pct,
	transactions_mom,
	transactions_mom_pct,
	ecommerce_conversion_rate_mom_pct,
	total_organic_ecommerce_conversion_rate_mom_pct,
	goal_completions_all_goals_mom,
	goal_completions_all_goals_mom_pct,
	goal_conversion_rate_all_goals_mom_pct,
	total_organic_goal_conversion_rate_mom_pct,
	sessions_yoy,
	sessions_yoy_pct,
	total_organic_sessions_yoy_pct,
	transaction_revenue_yoy,
	transaction_revenue_yoy_pct,
	transactions_yoy,
	transactions_yoy_pct,
	ecommerce_conversion_rate_yoy_pct,
	total_organic_ecommerce_conversion_rate_yoy_pct,
	goal_completions_all_goals_yoy,
	goal_completions_all_goals_yoy_pct,
	goal_conversion_rate_all_goals_yoy_pct,
	total_organic_goal_conversion_rate_yoy_pct,
	sessions_ttm,
	transaction_revenue_ttm,
	transactions_ttm,
	ecommerce_conversion_rate_ttm,
	goal_completions_all_goals_ttm,
	goal_conversion_rate_all_goals_ttm,
	bounce_rate_ttm,
	avg_seconds_on_site_ttm,
	gaining_traffic_mom,
	gaining_traffic_yoy,
	backlink_count,
	ref_domain_count,
	med_ref_domain_count,
	bottom_quartile_ref_domain_count,
	impressions_30d,
	pct_of_total_impressions_30d,
	med_impressions_30d,
	top_10pct_impressions_30d,
	total_impressions_30d,
	clicks_30d,
	total_clicks_30d,
	ctr_30d,
	med_ctr_30d,
	total_ctr_30d,
	avg_position_30d,
	impressions_mom,
	total_impressions_mom,
	impressions_mom_pct,
	total_impressions_mom_pct,
	clicks_mom,
	total_clicks_mom,
	clicks_mom_pct,
	total_clicks_mom_pct,
	ctr_mom,
	total_ctr_mom,
	ctr_mom_pct,
	total_ctr_mom_pct,
	avg_position_mom,
	impressions_yoy,
	total_impressions_yoy,
	impressions_yoy_pct,
	total_impressions_yoy_pct,
	clicks_yoy,
	total_clicks_yoy,
	clicks_yoy_pct,
	total_clicks_yoy_pct,
	ctr_yoy,	
	total_ctr_yoy,
	ctr_yoy_pct,
	total_ctr_yoy_pct,
	avg_position_yoy,
	impressions_ttm,
	clicks_ttm,
	ctr_ttm,
	avg_position_ttm,	
	top_3_keywords,
	top_5_keywords,
	top_10_keywords,
	top_20_keywords,
	main_keyword,
	main_impressions,
	main_clicks,
	main_avg_position,
	main_top_url,
	main_keyword_cannibalization_flag,
	main_top_url_clicks,
	best_keyword,
	best_impressions,
	best_clicks,
	best_avg_position,
	best_top_url,
	best_top_url_clicks,
	best_keyword_cannibalization_flag
	FROM `seo-data-pipeline-89`.`adp_thecifhw`.`agg_all`
	WHERE found_at is not null
	WINDOW mom as (PARTITION BY site,domain,url ORDER BY date asc)	
)




SELECT
date,
crawl_date,
site,
domain,
url,
found_at,
found_at_sitemap,
canonical_url,
page_type,

--indicative actions roll up to each other, nested one by one
case
	when http_status_code in (403, 404) AND cast(backlink_count as int64) > 0 AND internal_links_in_count > 0  THEN '301 redirect + remove internal link from found_at_url' 
	when http_status_code in (403, 404) AND backlink_count > 0 THEN '301 redirect'
	when http_status_code in (403, 404) THEN 'Remove internal link from found_at_url'
	when http_status_code = 302 THEN '301 redirect to redirected_to_url'
	when http_status_code = 301 and lower(redirect_chain) = 'true' THEN 'Fix redirect chain'
	-- modify potentially to recommend fixing link to point to redirected_to_url
	when http_status_code = 301 and lower(redirect_chain) = 'false' THEN 'Leave 301 as is'
	when http_status_code in (403, 404) THEN '404, investigate'
	else '' end as http_status_action,

case 
	-- added < 200 word count condition 2/26/20
	when canonical_status = 'canonicalized' then ''
	when (http_status_code != 200 or is_noindex = 1 or word_count < 200 ) and found_at_sitemap is not null then concat('Remove from sitemap: ', coalesce(found_at_sitemap) ) 
	when is_noindex = 0 and found_at_sitemap is null and flag_paginated = 0 and url not like '%/page/%' and sessions_30d > 0 and http_status_code = 200 then 'Likely add to sitemap'
	else '' end as sitemap_action,

case 
	when http_status_code in (301, 403, 404) then ''
	when canonical_status = 'missing_canonical' then 'Missing canonical'
	when canonical_status = 'canonicalized' and flag_paginated = 1 and is_self_canonical = FALSE then 'Self-canonicalize, paginated page'
	when canonical_status = 'canonicalized' then 'Canonicalized, leave as is'
	else '' end as canonical_action,

case
	when http_status_code is null and sessions_ttm > 0 and url not like '%404%' and url not like '%403%' and flag_paginated = 0 then 'Missing from crawl'
	when http_status_code is null and sessions_30d = 0 and flag_paginated = 0 then 'Page likely removed'
	-- updated sessions_ttm threshold to 100
	when sessions_ttm < 100 and sessions_30d = 0 and canonical_status != 'canonicalized' and is_noindex = 0 and flag_paginated = 0 then 'Review content for relevance (potential noindex)'
	else '' end as crawl_action,		

-- review page_type classification algo
-- push these schema classifications down into a lower proc model (and push other proc from deepcrawl up)
case 
	when http_status_code != 200 OR flag_paginated = 1 OR canonical_status = 'canonicalized' then '' 
	when level >= 2 and schema_type not like '%breadcrumb%' then 'Add breadcrumb schema' 
	when page_type = 'product' and schema_type not like '%product%' then 'Add product schema'
	-- when page_type = 'product_category' and schema_type not like '%itemlistordertype%' then 'Add itemlistordertype schema'
	when page_type = 'blog' and schema_type not like '%article%' then 'Add article schema'
	when page_type = 'local' and schema_type not like '%localbusiness%' then 'Add localbusiness schema'
	when page_type = 'homepage' and schema_type not like '%organization%' then 'Add organization schema'
	else '' END as schema_action,


-- analytics actions are separate from other actions - only display if admin_action in ('', 'add to sitemap', 'missing from crawl')

CASE WHEN http_status_code != 200 OR flag_paginated = 1 OR canonical_status = 'canonicalized'  THEN '' 
	WHEN http_status_code = 200 AND main_keyword_cannibalization_flag = 1 AND best_keyword_cannibalization_flag = 1 AND main_keyword = best_keyword AND is_self_canonical = TRUE THEN 'Cannibalizing main keyword'
	WHEN http_status_code = 200 AND main_keyword_cannibalization_flag = 1 AND best_keyword_cannibalization_flag = 1 AND main_keyword != best_keyword AND is_self_canonical = TRUE THEN 'Cannibalizing main + best keywords'
	WHEN http_status_code = 200 AND main_keyword_cannibalization_flag = 1 AND best_keyword_cannibalization_flag = 0 AND is_self_canonical = TRUE THEN 'Cannibalizing main keyword'
	WHEN http_status_code = 200 AND main_keyword_cannibalization_flag = 0 AND best_keyword_cannibalization_flag = 1 AND is_self_canonical = TRUE THEN 'Cannibalizing best keyword'
	ELSE '' END as cannibalization_action,

CASE WHEN http_status_code != 200 OR flag_paginated = 1 OR canonical_status = 'canonicalized' THEN '' 
	WHEN http_status_code = 200 AND sessions_30d != 0 AND sessions_30d_mom != 0 AND (sessions_30d - sessions_30d_mom)/sessions_30d > 0 AND total_organic_sessions_mom_pct > 0 AND (sessions_30d - sessions_30d_mom)/sessions_30d > (total_organic_sessions_mom_pct*1.25) THEN 'Rising content'
	WHEN http_status_code = 200 AND sessions_30d != 0 AND sessions_30d_mom != 0 AND (sessions_30d - sessions_30d_mom)/sessions_30d > 0 AND total_organic_sessions_mom_pct < 0 THEN 'Rising content'
	WHEN http_status_code = 200 AND sessions_30d != 0 AND sessions_30d_mom != 0 AND (sessions_30d - sessions_30d_mom)/sessions_30d < 0 AND total_organic_sessions_mom_pct < 0 AND (sessions_30d - sessions_30d_mom)/sessions_30d < (total_organic_sessions_mom_pct*1.25) THEN 'Falling content'
	WHEN http_status_code = 200 AND sessions_30d != 0 AND sessions_30d_mom != 0 AND (sessions_30d - sessions_30d_mom)/sessions_30d < 0 AND total_organic_sessions_mom_pct > 0 THEN 'Falling content'
	ELSE '' END as content_trajectory,
		
CASE WHEN http_status_code != 200 OR flag_paginated = 1 OR canonical_status = 'canonicalized' THEN ''
	WHEN http_status_code = 200 AND sessions_30d < 5 and transactions_30d = 0 and goal_completions_all_goals_30d = 0 and backlink_count > 0 THEN 'Potential 301: low traffic, has external links'
	WHEN http_status_code = 200 AND sessions_30d < 5 and transactions_30d = 0 and goal_completions_all_goals_30d = 0 and backlink_count = 0  THEN 'Potential removal: low traffic, 0 conversions or backlinks'
	WHEN http_status_code = 200 AND page_type = 'lead generation' and transactions_30d = 0 and goal_completions_all_goals_30d = 0 
	AND ( transactions_ttm > 0 or goal_completions_all_goals_ttm > 0 ) THEN 'inactive lead gen page: 0 conversions'
	ELSE '' END as content_action,

CASE WHEN http_status_code != 200 OR flag_paginated = 1 OR canonical_status = 'canonicalized' THEN '' 
	WHEN http_status_code = 200 AND internal_links_out_count <= bottom_quartile_internal_links_out_count and ( sessions_30d > med_sessions_30d or ref_domain_count >= med_ref_domain_count ) THEN 'Add internal outlinks'
	WHEN http_status_code = 200 AND internal_links_in_count <= bottom_quartile_internal_links_in_count and ( sessions_30d > med_sessions_30d or ref_domain_count >= med_ref_domain_count ) THEN 'Add internal inlinks'
	WHEN http_status_code = 200 AND internal_links_in_count >= top_quartile_internal_links_in_count and ( sessions_30d <= bottom_quartile_sessions_30d or ref_domain_count <= bottom_quartile_ref_domain_count ) THEN 'Reduce internal inlinks'
	ELSE '' END as internal_link_action,

CASE WHEN http_status_code != 200 OR flag_paginated = 1 OR canonical_status = 'canonicalized' THEN '' 
	WHEN http_status_code = 200 AND ((main_avg_position >= 3 and main_avg_position <= 25 ) or ( best_avg_position >= 3 and best_avg_position <= 25 )) THEN 'Target external links: KWs within reach'
	WHEN http_status_code = 200 AND ( top_20_keywords - top_3_keywords ) >= 3 THEN 'Target external links: KWs within reach'
	WHEN http_status_code = 200 AND sessions_mom_pct > total_organic_sessions_mom_pct AND ref_domain_count < med_ref_domain_count THEN 'Target external links: rising content'
	ELSE '' END as external_link_action,

CASE WHEN http_status_code != 200 OR flag_paginated = 1 OR canonical_status = 'canonicalized' THEN '' 
	WHEN http_status_code = 200 AND (description is null or page_title is null ) and http_status_code is not null then 'Metas missing' 
	WHEN http_status_code = 200 AND (title_contains_top_keyword + description_contains_top_keyword) = 0 AND (best_impressions > 0 OR main_impressions > 0) then concat('Update metas to include main or best keyword') 
	WHEN http_status_code = 200 AND impressions_mom_pct > total_impressions_mom_pct and ctr_30d < med_ctr_30d AND (best_impressions > 0 OR main_impressions > 0) THEN 'Low CTR: review meta relevance for top keywords'
	else '' end as meta_rewrite_action,

-- category actions (only display pagination_action if category_action is blank)

-- case when page_type = 'category' and page_type_rank > 10 and sessions_30d < 5 and url not like '%/page/%' then concat('potential 301 to top category: ', first_value(url) over (partition by page_type, domain, date order by page_type_rank asc)) else '' end as category_action,
'' as category_action,

case when page_type = 'category' and flag_paginated = 0 and url_contains_digit = 1 then 'Needs pagination' else '' end as pagination_action,

url_stripped,
url_protocol,
canonical_url_protocol,
protocol_match,
protocol_count,
canonical_status,
urls_to_canonical,
first_subfolder,
second_subfolder,
last_subfolder,
last_subfolder_canonical,
http_status_code,
level,
schema_type,
header_content_type,
word_count, 
page_title,
title_contains_top_keyword,
page_title_length,
description,
description_contains_top_keyword,
description_length,
indexable,
robots_noindex,
meta_noindex,
is_noindex,
is_self_canonical,
redirected_to_url,
found_at_url,
rel_next_url,
rel_prev_url,
flag_paginated,
internal_links_in_count,
bottom_quartile_internal_links_in_count,
top_quartile_internal_links_in_count,
links_out_count,
external_links_count,
internal_links_out_count,
bottom_quartile_internal_links_out_count,
h1_tag,
h2_tag,
redirect_chain,
redirected_to_status_code,
is_redirect_loop,
duplicate_page,
duplicate_page_count,
duplicate_body,
duplicate_body_count,

-- ga + gsc data
sessions_30d,
sessions_30d_mom,
bottom_quartile_sessions_30d,
med_sessions_30d,
pct_of_organic_sessions_30d,
transaction_revenue_30d,
transaction_revenue_30d_mom,
transactions_30d,
transactions_30d_mom,
pct_of_organic_transactions_30d,
ecommerce_conversion_rate_30d,
med_transaction_conversion_rate_30d,
goal_completions_all_goals_30d,
goal_completions_all_goals_30d_mom,
pct_of_organic_goal_completions_all_goals_30d,
goal_conversion_rate_all_goals_30d,
med_goal_conversion_rate_30d,
blended_conversions_30d,	
blended_conversion_rate_30d,
bounce_rate_30d,
avg_seconds_on_site_30d,
sessions_mom,
sessions_mom_pct,
total_organic_sessions_mom_pct,
transaction_revenue_mom,
transaction_revenue_mom_pct,
transactions_mom,
transactions_mom_pct,
ecommerce_conversion_rate_mom_pct,
total_organic_ecommerce_conversion_rate_mom_pct,
goal_completions_all_goals_mom,
goal_completions_all_goals_mom_pct,
goal_conversion_rate_all_goals_mom_pct,
total_organic_goal_conversion_rate_mom_pct,
sessions_yoy,
sessions_yoy_pct,
total_organic_sessions_yoy_pct,
transaction_revenue_yoy,
transaction_revenue_yoy_pct,
transactions_yoy,
transactions_yoy_pct,
ecommerce_conversion_rate_yoy_pct,
total_organic_ecommerce_conversion_rate_yoy_pct,
goal_completions_all_goals_yoy,
goal_completions_all_goals_yoy_pct,
goal_conversion_rate_all_goals_yoy_pct,
total_organic_goal_conversion_rate_yoy_pct,
sessions_ttm,
transaction_revenue_ttm,
transactions_ttm,
ecommerce_conversion_rate_ttm,
goal_completions_all_goals_ttm,
goal_conversion_rate_all_goals_ttm,
bounce_rate_ttm,
avg_seconds_on_site_ttm,
gaining_traffic_mom,
gaining_traffic_yoy,
backlink_count,
ref_domain_count,
med_ref_domain_count,
bottom_quartile_ref_domain_count,
impressions_30d,
pct_of_total_impressions_30d,
med_impressions_30d,
top_10pct_impressions_30d,
total_impressions_30d,
clicks_30d,
total_clicks_30d,
ctr_30d,
med_ctr_30d,
total_ctr_30d,
avg_position_30d,
impressions_mom,
total_impressions_mom,
impressions_mom_pct,
total_impressions_mom_pct,
clicks_mom,
total_clicks_mom,
clicks_mom_pct,
total_clicks_mom_pct,
ctr_mom,
total_ctr_mom,
ctr_mom_pct,
total_ctr_mom_pct,
avg_position_mom,
impressions_yoy,
total_impressions_yoy,
impressions_yoy_pct,
total_impressions_yoy_pct,
clicks_yoy,
total_clicks_yoy,
clicks_yoy_pct,
total_clicks_yoy_pct,
ctr_yoy,	
total_ctr_yoy,
ctr_yoy_pct,
total_ctr_yoy_pct,
avg_position_yoy,
impressions_ttm,
clicks_ttm,
ctr_ttm,
avg_position_ttm,	
top_3_keywords,
top_5_keywords,
top_10_keywords,
top_20_keywords,
main_keyword,
main_impressions,
main_clicks,
main_avg_position,
main_top_url,
main_keyword_cannibalization_flag,
main_top_url_clicks,
best_keyword,
best_impressions,
best_clicks,
best_avg_position,
best_top_url,
best_top_url_clicks,
best_keyword_cannibalization_flag
FROM agg_all
-- WHERE ( sessions_30d > 0 or sessions_mom > 0 or sessions_yoy > 0 or page_type is not null )
  );
    
2021-04-19 16:29:15.922302 (Thread-48): handling poll request
2021-04-19 16:29:15.922771 (Thread-48): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'd178ec37-7b39-42b2-b063-b88e83fe10fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa03cda4550>]}
2021-04-19 16:29:15.924953 (Thread-48): sending response (<Response 23361 bytes [200 OK]>) to 10.0.8.139
2021-04-19 16:29:18.192823 (Thread-49): handling poll request
2021-04-19 16:29:18.193242 (Thread-49): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'd178ec37-7b39-42b2-b063-b88e83fe10fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa03cd94b80>]}
2021-04-19 16:29:18.194101 (Thread-49): sending response (<Response 285 bytes [200 OK]>) to 10.0.21.196
2021-04-19 16:29:18.424541 (Thread-1): finished collecting timing info
2021-04-19 16:29:18.425340 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd2dee09f-521a-45b5-af69-4db908d4d9f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f59015a11f0>]}
2021-04-19 16:29:18.426318 (Thread-1): 16:29:18 | 20 of 25 OK created table model adp_thecifhw.actions_proc............ [CREATE TABLE (422.0 rows, 620.4 KB processed) in 3.87s]
2021-04-19 16:29:18.426401 (Thread-1): Finished running node model.tech_audit.actions_proc
2021-04-19 16:29:18.427158 (Thread-1): Began running node model.tech_audit.actions_hierarchy
2021-04-19 16:29:18.428016 (Thread-1): 16:29:18 | 21 of 25 START table model adp_thecifhw.actions_hierarchy............ [RUN]
2021-04-19 16:29:18.428218 (Thread-1): Acquiring new bigquery connection "model.tech_audit.actions_hierarchy".
2021-04-19 16:29:18.428289 (Thread-1): Compiling model.tech_audit.actions_hierarchy
2021-04-19 16:29:18.436211 (Thread-1): Writing injected SQL for node "model.tech_audit.actions_hierarchy"
2021-04-19 16:29:18.467471 (Thread-1): finished collecting timing info
2021-04-19 16:29:18.471864 (Thread-1): Opening a new connection, currently in state closed
2021-04-19 16:29:18.667658 (Thread-1): Writing runtime SQL for node "model.tech_audit.actions_hierarchy"
2021-04-19 16:29:18.699341 (Thread-1): On model.tech_audit.actions_hierarchy: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.tech_audit.actions_hierarchy"} */


  create or replace table `seo-data-pipeline-89`.`adp_thecifhw`.`actions_hierarchy`
  
  
  OPTIONS()
  as (
    SELECT
date,
crawl_date,
site,
domain,
url,
found_at,
found_at_sitemap,
found_at_url,
canonical_url,
canonical_status,
page_type,
CASE WHEN sessions_30d = sessions_ttm AND sessions_30d > 0 and http_status_code=200 THEN 1
	ELSE 0 END as new_content_flag,
CASE 
	WHEN lower(http_status_action) like '%redirect%' THEN 'High'
	WHEN lower(crawl_action) like '%missing from crawl%' THEN 'High'
	WHEN lower(crawl_action) like '%potential noindex%' THEN 'Medium'	
	WHEN lower(http_status_action) like '%remove internal link%' THEN 'High'	
	WHEN lower(sitemap_action) like '%remove from sitemap%' or ( lower(sitemap_action) = 'likely add to sitemap' and pct_of_organic_sessions_30d > .05 )  THEN 'High'
	WHEN lower(sitemap_action) = 'likely add to sitemap' THEN 'Medium'
	WHEN lower(canonical_action) in ('missing canonical', 'self-canonicalize, paginated page') THEN 'High'
	ELSE '' END as admin_action_priority,
CASE WHEN impressions_30d >= top_10pct_impressions_30d THEN 'High'
	WHEN impressions_30d >= med_impressions_30d THEN 'Medium'
	ELSE 'Low' END as mktg_action_priority,	
case 
	when http_status_action != '' then http_status_action
	when crawl_action != '' then crawl_action
	when lower(sitemap_action) not in ('leave as is', '') then sitemap_action
	when lower(canonical_action) not in ('leave as is', '') then canonical_action
	else '' end as top_admin_action,
case 
	when http_status_action != '' then concat(cast(http_status_code as string),' page status')
	when http_status_code is null and lower(crawl_action) like '%missing%' then 'not crawled by deepcrawl'
	when lower(crawl_action) like '%removed%' then 'not crawled, 0 traffic'
	when crawl_action != '' then '0 traffic'
	when lower(sitemap_action) like '%remove%' then '301, 404, noindexed or thin page'
	when sitemap_action != '' then 'page missing from sitemap'
	when lower(canonical_action) = 'missing canonical' then 'canonical url not found in crawl'
	when lower(crawl_action) like 'block crawl to:%' then 'subfolder receives no traffic'
	when lower(crawl_action) = 'noindex' then 'page receives no organic traffic'
	else '' end as top_admin_action_reason,
crawl_action,
CASE 
	WHEN lower(crawl_action) like '%missing from crawl%' THEN 'High'
	WHEN lower(crawl_action) like '%potential noindex%' THEN 'Medium'	
	ELSE '' END as crawl_action_priority,
http_status_action,
CASE WHEN lower(http_status_action) like '%redirect%' THEN 'High' ELSE '' END as http_status_action_priority,
sitemap_action,
CASE 
	WHEN lower(sitemap_action) like '%remove from sitemap%' or ( sitemap_action = 'likely add to sitemap' and pct_of_organic_sessions_30d > .05 )  THEN 'High'
	WHEN lower(sitemap_action) = 'likely add to sitemap' THEN 'Medium'
	ELSE '' END as sitemap_action_priority,
canonical_action,
CASE WHEN lower(canonical_action) in ('missing canonical', 'self-canonicalize, paginated page') THEN 'High' ELSE '' END as canonical_action_priority,
schema_action,
-- concat(content_action,meta_rewrite_action,pagination_action,external_link_action,schema_action) on_off_page_action,
concat(
	CASE WHEN content_action = '' THEN '' ELSE concat("content_action: ", content_action) END,
	CASE WHEN meta_rewrite_action = '' THEN '' ELSE concat("meta_rewrite_action: ", meta_rewrite_action) END,
	CASE WHEN external_link_action = '' THEN '' ELSE concat("external_link_action: ", external_link_action) END,
	CASE WHEN schema_action = '' THEN '' ELSE concat("schema_action: ", schema_action) END ) on_off_page_action,
concat(
	CASE WHEN internal_link_action = '' THEN '' ELSE concat("internal_link_action: ", internal_link_action) END,
	CASE WHEN category_action = '' THEN '' ELSE concat("category_action: ", category_action) END,
	CASE WHEN cannibalization_action = '' THEN '' ELSE concat("cannibalization_action: ", cannibalization_action) END ) architecture_action,
# analytics actions are separate from indicative actions - only display if admin_action in ('', 'add to sitemap', 'missing from crawl')
cannibalization_action,
content_trajectory,
content_action,
case when http_status_code = 200 then internal_link_action else '' end as internal_link_action,
case when http_status_code = 200 then external_link_action else '' end as external_link_action,
case when http_status_code = 200 then meta_rewrite_action else '' end as meta_rewrite_action,
case when http_status_code = 200 then category_action else '' end as category_action,
case when http_status_code = 200 then pagination_action else '' end as pagination_action,
url_protocol,
canonical_url_protocol,
protocol_match,
protocol_count,
first_subfolder,
second_subfolder,
last_subfolder,
http_status_code,
level,
schema_type,
header_content_type,
word_count, 
page_title,
title_contains_top_keyword,
page_title_length,
description,
description_contains_top_keyword,
description_length,
robots_noindex,
meta_noindex,
is_noindex,
redirected_to_url,
h1_tag,
h2_tag,
redirect_chain,
redirected_to_status_code,
is_redirect_loop,
duplicate_page,
duplicate_page_count,
duplicate_body,
duplicate_body_count,
sessions_30d,
pct_of_organic_sessions_30d,
transaction_revenue_30d,
transactions_30d,
pct_of_organic_transactions_30d,
ecommerce_conversion_rate_30d,
med_transaction_conversion_rate_30d,
goal_completions_all_goals_30d,
pct_of_organic_goal_completions_all_goals_30d,
goal_conversion_rate_all_goals_30d,
med_goal_conversion_rate_30d,
blended_conversions_30d,	
blended_conversion_rate_30d,
bounce_rate_30d,
avg_seconds_on_site_30d,
sessions_mom,
sessions_mom_pct,
transaction_revenue_mom,
transaction_revenue_mom_pct,
transactions_mom,
transactions_mom_pct,
goal_completions_all_goals_mom,
goal_completions_all_goals_mom_pct,
sessions_yoy,
sessions_yoy_pct,
transaction_revenue_yoy,
transaction_revenue_yoy_pct,
transactions_yoy,
transactions_yoy_pct,
goal_completions_all_goals_yoy,
goal_completions_all_goals_yoy_pct,
sessions_ttm,
transaction_revenue_ttm,
transactions_ttm,
ecommerce_conversion_rate_ttm,
goal_completions_all_goals_ttm,
goal_conversion_rate_all_goals_ttm,
bounce_rate_ttm,
avg_seconds_on_site_ttm,
gaining_traffic_mom,
gaining_traffic_yoy,
backlink_count,
ref_domain_count,
med_ref_domain_count,
internal_links_in_count,
internal_links_out_count,
impressions_30d,
pct_of_total_impressions_30d,
med_impressions_30d,
top_10pct_impressions_30d,
clicks_30d,
ctr_30d,
avg_position_30d,
impressions_mom,
impressions_mom_pct,
clicks_mom,
clicks_mom_pct,
ctr_mom,
ctr_mom_pct,
avg_position_mom,
impressions_yoy,
impressions_yoy_pct,
clicks_yoy,
ctr_yoy,	
ctr_yoy_pct,
avg_position_yoy,	
impressions_ttm,
clicks_ttm,
ctr_ttm,
avg_position_ttm,
top_3_keywords,
top_5_keywords,
top_10_keywords,
top_20_keywords,
main_keyword,
main_impressions,
main_clicks,
main_avg_position,
main_top_url,
main_keyword_cannibalization_flag,
main_top_url_clicks,
best_keyword,
best_impressions,
best_clicks,
best_avg_position,
best_top_url,
best_top_url_clicks,
best_keyword_cannibalization_flag
FROM `seo-data-pipeline-89`.`adp_thecifhw`.`actions_proc`
  );
    
2021-04-19 16:29:19.970797 (Thread-50): handling poll request
2021-04-19 16:29:19.973031 (Thread-50): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'd178ec37-7b39-42b2-b063-b88e83fe10fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa03cdb97c0>]}
2021-04-19 16:29:19.975017 (Thread-50): sending response (<Response 13127 bytes [200 OK]>) to 10.0.37.247
2021-04-19 16:29:20.940425 (Thread-1): finished collecting timing info
2021-04-19 16:29:20.941509 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd2dee09f-521a-45b5-af69-4db908d4d9f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f59014fafa0>]}
2021-04-19 16:29:20.943027 (Thread-1): 16:29:20 | 21 of 25 OK created table model adp_thecifhw.actions_hierarchy....... [CREATE TABLE (422.0 rows, 538.4 KB processed) in 2.51s]
2021-04-19 16:29:20.943148 (Thread-1): Finished running node model.tech_audit.actions_hierarchy
2021-04-19 16:29:20.943998 (Thread-1): Began running node model.tech_audit.actions_diffs
2021-04-19 16:29:20.945266 (Thread-1): 16:29:20 | 22 of 25 START table model adp_thecifhw.actions_diffs................ [RUN]
2021-04-19 16:29:20.945605 (Thread-1): Acquiring new bigquery connection "model.tech_audit.actions_diffs".
2021-04-19 16:29:20.945712 (Thread-1): Compiling model.tech_audit.actions_diffs
2021-04-19 16:29:20.959516 (Thread-1): Writing injected SQL for node "model.tech_audit.actions_diffs"
2021-04-19 16:29:21.001056 (Thread-1): finished collecting timing info
2021-04-19 16:29:21.005358 (Thread-1): Opening a new connection, currently in state closed
2021-04-19 16:29:21.194355 (Thread-1): Writing runtime SQL for node "model.tech_audit.actions_diffs"
2021-04-19 16:29:21.231365 (Thread-1): On model.tech_audit.actions_diffs: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.tech_audit.actions_diffs"} */


  create or replace table `seo-data-pipeline-89`.`adp_thecifhw`.`actions_diffs`
  
  
  OPTIONS()
  as (
    SELECT
date,
crawl_date,
site,
domain,
url,
http_status_code,
level,
found_at,
found_at_url,
found_at_sitemap,
found_at_sitemap_prev,
CASE WHEN found_at_sitemap != found_at_sitemap_prev THEN 'Modified' ELSE 'No change' END as sitemap_diff,
CASE WHEN found_at_sitemap != found_at_sitemap_first THEN 'Modified' ELSE 'No change' END as sitemap_diff_first,
canonical_url,
canonical_url_prev,
CASE WHEN canonical_url != canonical_url_prev THEN 'Modified' ELSE 'No change' END as canonical_url_diff,
CASE WHEN canonical_url != canonical_url_prev THEN 'Modified' ELSE 'No change' END as canonical_url_diff_first,
canonical_status,
canonical_status_prev,
CASE WHEN canonical_status != canonical_status_prev THEN 'Modified' ELSE 'No change' END as canonical_status_diff,
CASE WHEN canonical_status != canonical_status_first THEN 'Modified' ELSE 'No change' END as canonical_status_diff_first,
page_type,
page_type_prev,
CASE WHEN page_type != page_type_prev THEN 'Modified' ELSE 'No change' END as page_type_diff,
CASE WHEN page_type != page_type_first THEN 'Modified' ELSE 'No change' END as page_type_diff_first,
admin_action_priority,
mktg_action_priority,
top_admin_action,
top_admin_action_reason,
top_admin_action_prev,
CASE WHEN top_admin_action_prev != '' and top_admin_action = '' THEN 'Fixed'
	WHEN top_admin_action_prev = '' and top_admin_action != '' AND http_status_action not like '%removed%' THEN 'New'
	WHEN top_admin_action_prev != '' and top_admin_action != '' and top_admin_action_prev != top_admin_action THEN 'Changed' 
	WHEN top_admin_action_prev = top_admin_action and top_admin_action != '' THEN 'Recurring' 
	ELSE 'None' END as top_admin_action_diff,
crawl_action,
crawl_action_priority,
crawl_action_prev,
CASE WHEN crawl_action_prev != '' and crawl_action = '' THEN 'Fixed'
	WHEN crawl_action_prev = '' and crawl_action != '' AND http_status_action not like '%removed%' THEN 'New'
	WHEN crawl_action_prev != '' and crawl_action != '' and crawl_action_prev != crawl_action THEN 'Changed' 
	WHEN crawl_action_prev = crawl_action AND crawl_action not like '%removed%' AND crawl_action != '' THEN 'Recurring' 
	ELSE 'None' END as crawl_action_diff,
http_status_action,
http_status_action_priority,
http_status_action_prev,
CASE WHEN http_status_action_prev != '' and http_status_action = '' THEN 'Fixed'
	WHEN http_status_action_prev = '' and http_status_action != '' THEN 'New'
	WHEN http_status_action_prev != '' and http_status_action != '' and http_status_action_prev != http_status_action THEN 'Changed' 
	WHEN http_status_action_prev = http_status_action AND http_status_action not like '%leave as is%' AND http_status_action != '' THEN 'Recurring' 
	ELSE 'None' END as http_status_action_diff,
sitemap_action,
sitemap_action_priority,
sitemap_action_prev,
CASE WHEN sitemap_action_prev != '' and sitemap_action = '' THEN 'Fixed'
	WHEN sitemap_action_prev = '' and sitemap_action != '' THEN 'New'
	WHEN sitemap_action_prev != '' and sitemap_action != '' and sitemap_action_prev != sitemap_action THEN 'Changed' 
	WHEN sitemap_action_prev = sitemap_action and sitemap_action != '' THEN 'Recurring' 
	ELSE 'None' END as sitemap_action_diff,
canonical_action,
canonical_action_priority,
canonical_action_prev,
CASE WHEN canonical_action_prev != '' and canonical_action = '' THEN 'Fixed'
	WHEN canonical_action_prev = '' and canonical_action != '' THEN 'New'
	WHEN canonical_action_prev != '' and canonical_action != '' and canonical_action_prev != canonical_action THEN 'Changed' 
	WHEN canonical_action_prev = canonical_action AND canonical_action not like '%leave as is%' and canonical_action != '' THEN 'Recurring' 
	ELSE 'None' END as canonical_action_diff,
schema_action,
schema_action_prev,
CASE WHEN schema_action_prev != '' and schema_action = '' THEN 'Fixed'
	WHEN schema_action_prev = '' and schema_action != '' THEN 'New'
	WHEN schema_action_prev != '' and schema_action != '' and schema_action_prev != schema_action THEN 'Changed' 
	WHEN schema_action_prev = schema_action and schema_action != '' THEN 'Recurring' 
	ELSE 'None' END as schema_action_diff,
on_off_page_action,
architecture_action,
cannibalization_action,
cannibalization_action_prev,
CASE WHEN cannibalization_action_prev != '' and cannibalization_action = '' THEN 'Fixed'
	WHEN cannibalization_action_prev = '' and cannibalization_action != '' THEN 'New'
	WHEN cannibalization_action_prev != '' and cannibalization_action != '' and cannibalization_action_prev != cannibalization_action THEN 'Changed' 
	WHEN cannibalization_action_prev = cannibalization_action and cannibalization_action != '' THEN 'Recurring' 
	ELSE 'None' END as cannibalization_action_diff,	
content_trajectory,
content_trajectory_first,
content_action,
content_action_prev,
CASE WHEN content_action_prev != '' and content_action = '' THEN 'Fixed'
	WHEN content_action_prev = '' and content_action != '' THEN 'New'
	WHEN content_action_prev != '' and content_action != '' and content_action_prev != content_action THEN 'Changed' 
	WHEN content_action_prev = content_action and content_action != '' THEN 'Recurring' 
	ELSE 'None' END as content_action_diff,
internal_link_action,
internal_link_action_prev,
CASE WHEN internal_link_action_prev != '' and internal_link_action = '' THEN 'Fixed'
	WHEN internal_link_action_prev = '' and internal_link_action != '' THEN 'New'
	WHEN internal_link_action_prev != '' and internal_link_action != '' and internal_link_action_prev != internal_link_action THEN 'Changed' 
	WHEN internal_link_action_prev = internal_link_action and internal_link_action != '' THEN 'Recurring' 
	ELSE 'None' END as internal_link_action_diff,
external_link_action,
external_link_action_prev,
CASE WHEN external_link_action_prev != '' and external_link_action = '' THEN 'Fixed'
	WHEN external_link_action_prev = '' and external_link_action != '' THEN 'New'
	WHEN external_link_action_prev != '' and external_link_action != '' and external_link_action_prev != external_link_action THEN 'Changed' 
	WHEN external_link_action_prev = external_link_action and external_link_action != '' THEN 'Recurring' 
	ELSE 'None' END as external_link_action_diff,
meta_rewrite_action,
meta_rewrite_action_prev,
CASE WHEN meta_rewrite_action_prev != '' and meta_rewrite_action = '' THEN 'Fixed'
	WHEN meta_rewrite_action_prev = '' and meta_rewrite_action != '' THEN 'New'
	WHEN meta_rewrite_action_prev != '' and meta_rewrite_action != '' and meta_rewrite_action_prev != meta_rewrite_action THEN 'Changed' 
	WHEN meta_rewrite_action_prev = meta_rewrite_action and meta_rewrite_action != '' THEN 'Recurring' 
	ELSE 'None' END as meta_rewrite_action_diff,			

is_noindex,
is_noindex_prev,
CASE WHEN is_noindex != is_noindex_prev THEN 1 ELSE 0 END as is_noindex_diff,
redirected_to_url,
redirected_to_url_prev,
CASE WHEN redirected_to_url != redirected_to_url_prev THEN 1 ELSE 0 END as redirect_diff,
-- schema changes

schema_type,
schema_type_prev,
schema_type_first,
CASE WHEN schema_type != schema_type_prev THEN 'Modified schema'
	ELSE 'No change' END as schema_type_diff, 
CASE WHEN schema_type != schema_type_first THEN 'Modified schema'
	ELSE 'No change' END as schema_type_diff_first, 	

-- meta changes
page_title,
page_title_prev,
page_title_first,
CASE WHEN page_title != page_title_prev THEN 1 ELSE 0 END as page_title_diff,
description,
description_prev,
description_first,
CASE WHEN page_title != page_title_prev AND description != description_prev THEN 'Modified title + description'
	WHEN page_title != page_title_prev THEN 'Modified title'
	WHEN description != description_prev THEN 'Modified description'
	ELSE 'No change' END as meta_title_description_diff, 
CASE WHEN page_title != page_title_first AND description != description_first THEN 'Modified title + description'
	WHEN page_title != page_title_first THEN 'Modified title'
	WHEN description != description_first THEN 'Modified description'
	ELSE 'No change' END as meta_title_description_diff_first, 

-- content changes
CASE WHEN new_content_flag = 1 THEN 'New page'
	ELSE 'Existing page' END as new_content_prev,
CASE WHEN new_content_flag_first >= 1 THEN 'New page'
	ELSE 'Existing page' END as new_content_first,		
CASE WHEN word_count_prev > 0 AND abs((word_count-word_count_prev)/word_count_prev) > .2
	AND (h1_tag != h1_tag_prev OR h2_tag != h2_tag_prev)
	THEN 'Modified word count + headers'
	WHEN word_count_prev > 0 AND abs((word_count-word_count_prev)/word_count_prev) > .2
	THEN 'Modfified word count'
	WHEN (h1_tag != h1_tag_prev OR h2_tag != h2_tag_prev)
	THEN 'Modified headers'
	ELSE 'No change' END as body_content_diff,
CASE WHEN word_count_first > 0 AND abs((word_count-word_count_first)/word_count_first) > .2
	AND (h1_tag != h1_tag_first OR h2_tag != h2_tag_first)
	THEN 'Modified word count + headers'
	WHEN word_count_first > 0 AND abs((word_count-word_count_first)/word_count_first) > .2
	THEN 'Modified word count'
	WHEN (h1_tag != h1_tag_first OR h2_tag != h2_tag_first)
	THEN 'Modified headers'
	ELSE 'No change' END as body_content_diff_first,	
word_count, 
word_count_prev, 
word_count_first, 
h1_tag,
h1_tag_prev,
h1_tag_first,
h2_tag,
h2_tag_prev,
h2_tag_first,

-- link changes
backlink_count,
backlink_count_prev,
backlink_count_first,
CASE WHEN backlink_count > backlink_count_prev THEN 'Gaining'
	WHEN backlink_count < backlink_count_prev THEN 'Losing'
	ELSE 'No change' END as backlink_count_diff,
CASE WHEN backlink_count > backlink_count_first THEN 'Gaining'
	WHEN backlink_count < backlink_count_first THEN 'Losing'
	ELSE 'No change' END as backlink_count_diff_first,	
ref_domain_count,
ref_domain_count_prev,
ref_domain_count_first,
ref_domain_count - ref_domain_count_prev as ref_domain_count_gained,
ref_domain_count - ref_domain_count_first as ref_domain_count_gained_first,
CASE WHEN ref_domain_count > ref_domain_count_prev THEN 'Gaining'
	WHEN ref_domain_count < ref_domain_count_prev THEN 'Losing'
	ELSE 'No change' END as ref_domain_count_diff,
CASE WHEN ref_domain_count > ref_domain_count_first THEN 'Gaining'
	WHEN ref_domain_count < ref_domain_count_first THEN 'Losing'
	ELSE 'No change' END as ref_domain_count_diff_first,	
internal_links_in_count,
internal_links_in_count_prev,
internal_links_in_count_first,
CASE WHEN internal_links_in_count > internal_links_in_count_prev THEN 'Gaining'
	WHEN internal_links_in_count < internal_links_in_count_prev THEN 'Losing'
	ELSE 'No change' END as internal_links_in_count_diff,
CASE WHEN internal_links_in_count > internal_links_in_count_first THEN 'Gaining'
	WHEN internal_links_in_count < internal_links_in_count_first THEN 'Losing'
	ELSE 'No change' END as internal_links_in_count_diff_first,	
internal_links_out_count,
internal_links_out_count_prev,
internal_links_out_count_first,
CASE WHEN internal_links_out_count > internal_links_out_count_prev THEN 'Gaining'
	WHEN internal_links_out_count < internal_links_out_count_prev THEN 'Losing'
	ELSE 'No change' END as internal_links_out_count_diff,
CASE WHEN internal_links_out_count > internal_links_out_count_first THEN 'Gaining'
	WHEN internal_links_out_count < internal_links_out_count_first THEN 'Losing'
	ELSE 'No change' END as internal_links_out_count_diff_first,	

-- analytics anomalies
top_3_keywords,
top_3_keywords_prev,
top_3_keywords_first,
top_3_keywords - top_3_keywords_prev as top_3_keywords_gained,
top_3_keywords - top_3_keywords_first as top_3_keywords_gained_first,
CASE WHEN top_3_keywords > top_3_keywords_prev THEN 'Gaining'
	WHEN top_3_keywords < top_3_keywords_prev THEN 'Losing'
	ELSE 'No change' END as top_3_keywords_diff,
CASE WHEN top_3_keywords > top_3_keywords_first THEN 'Gaining'
	WHEN top_3_keywords < top_3_keywords_first THEN 'Losing'
	ELSE 'No change' END as top_3_keywords_diff_first,	
top_10_keywords,
top_10_keywords_prev,
top_10_keywords_first,
top_10_keywords - top_10_keywords_prev as top_10_keywords_gained,
top_10_keywords - top_10_keywords_first as top_10_keywords_gained_first,
CASE WHEN top_10_keywords > top_10_keywords_prev THEN 'Gaining'
	WHEN top_10_keywords < top_10_keywords_prev THEN 'Losing'
	ELSE 'No change' END as top_10_keywords_diff,
CASE WHEN top_10_keywords > top_10_keywords_first THEN 'Gaining'
	WHEN top_10_keywords < top_10_keywords_first THEN 'Losing'
	ELSE 'No change' END as top_10_keywords_diff_first,	
top_20_keywords,
top_20_keywords_prev,
top_20_keywords_first,
top_20_keywords - top_20_keywords_prev as top_20_keywords_gained,
top_20_keywords - top_20_keywords_first as top_20_keywords_gained_first,
CASE WHEN top_20_keywords > top_20_keywords_prev THEN 'Gaining'
	WHEN top_20_keywords < top_20_keywords_prev THEN 'Losing'
	ELSE 'No change' END as top_20_keywords_diff,
CASE WHEN top_20_keywords > top_20_keywords_first THEN 'Gaining'
	WHEN top_20_keywords < top_20_keywords_first THEN 'Losing'
	ELSE 'No change' END as top_20_keywords_diff_first,		
sessions_30d,
sessions_ttm,
pct_of_organic_sessions_30d,
transaction_revenue_30d,
transactions_30d,
bounce_rate_30d,
avg_seconds_on_site_30d,
goal_completions_all_goals_30d,
pct_of_organic_transactions_30d,
impressions_30d,
clicks_30d,
avg_position_30d,
main_keyword,
main_top_url,
main_impressions,
main_clicks,
main_avg_position,
best_keyword,
best_top_url,
best_impressions,
best_clicks,
best_avg_position,
impressions_mom_pct,
ctr_mom_pct,
sessions_mom_pct,
sessions_yoy_pct
FROM (
	SELECT
	date,
	crawl_date,
	site,
	domain,
	url,
	http_status_code,
	admin_action_priority,
	mktg_action_priority,
	sitemap_action_priority,
	crawl_action_priority,
	http_status_action_priority,
	canonical_action_priority,
	found_at,
	found_at_sitemap,
	found_at_url,
	level,
	schema_type,
	lag(schema_type) over w1 as schema_type_prev,
	first_value(schema_type) over w1 as schema_type_first,
	lag(found_at_sitemap) over w1 as found_at_sitemap_prev,
	first_value(found_at_sitemap) over w1 as found_at_sitemap_first,
	canonical_url,
	lag(canonical_url) over w1 as canonical_url_prev,
	first_value(canonical_url) over w1 as canonical_url_first,
	canonical_status,
	lag(canonical_status) over w1 as canonical_status_prev,
	first_value(canonical_status) over w1 as canonical_status_first,
	page_type,
	lag(page_type) over w1 as page_type_prev,
	first_value(page_type) over w1 as page_type_first,
	top_admin_action,
	top_admin_action_reason,
	lag(top_admin_action) over w1 as top_admin_action_prev,	
	crawl_action,
	lag(crawl_action) over w1 as crawl_action_prev,
	http_status_action,
	lag(http_status_action) over w1 as http_status_action_prev,
	sitemap_action,
	lag(sitemap_action) over w1 as sitemap_action_prev,
	canonical_action,
	lag(canonical_action) over w1 as canonical_action_prev,
	schema_action,
	lag(schema_action) over w1 as schema_action_prev,
	on_off_page_action,
	architecture_action,
	# analytics actions are separate from indicative actions - only display if admin_action in ('', 'add to sitemap', 'missing from crawl')
	cannibalization_action,
	lag(cannibalization_action) over w1 as cannibalization_action_prev,
	content_trajectory,
	first_value(content_trajectory ignore nulls) over w1 as content_trajectory_first,
	content_action,
	lag(content_action) over w1 as content_action_prev,
	internal_link_action,
	lag(internal_link_action) over w1 as internal_link_action_prev,
	external_link_action,
	lag(external_link_action) over w1 as external_link_action_prev,
	meta_rewrite_action,
	lag(meta_rewrite_action) over w1 as meta_rewrite_action_prev,

	-- noindex / redirect
	is_noindex,
	lag(is_noindex) over w1 as is_noindex_prev,
	redirected_to_url,
	lag(redirected_to_url) over w1 as redirected_to_url_prev,

	-- content changes
	word_count, 
	lag(word_count) over w1 as word_count_prev, 
	first_value(word_count) over w1 as word_count_first, 	
	page_title,
	lag(page_title) over w1 as page_title_prev,
	first_value(page_title) over w1 as page_title_first,	
	description,
	lag(description) over w1 as description_prev,
	first_value(description) over w1 as description_first,		
	h1_tag,
	lag(h1_tag) over w1 as h1_tag_prev,
	first_value(h1_tag) over w1 as h1_tag_first,	
	h2_tag,
	lag(h2_tag) over w1 as h2_tag_prev,
	first_value(h2_tag) over w1 as h2_tag_first,	

	-- link changes
	backlink_count,
	lag(backlink_count) over w1 as backlink_count_prev,
	first_value(backlink_count) over w1 as backlink_count_first,
	ref_domain_count,
	lag(ref_domain_count) over w1 as ref_domain_count_prev,
	first_value(ref_domain_count) over w1 as ref_domain_count_first,
	internal_links_in_count,
	lag(internal_links_in_count) over w1 as internal_links_in_count_prev,
	first_value(internal_links_in_count) over w1 as internal_links_in_count_first,
	internal_links_out_count,
	lag(internal_links_out_count) over w1 as internal_links_out_count_prev,
	first_value(internal_links_out_count) over w1 as internal_links_out_count_first,

	-- analytics anomalies
	top_3_keywords,
	lag(top_3_keywords) over w1 as top_3_keywords_prev,
	first_value(top_3_keywords) over w1 as top_3_keywords_first,
	top_10_keywords,
	lag(top_10_keywords) over w1 as top_10_keywords_prev,
	first_value(top_10_keywords) over w1 as top_10_keywords_first,
	top_20_keywords,
	lag(top_20_keywords) over w1 as top_20_keywords_prev,
	first_value(top_20_keywords) over w1 as top_20_keywords_first,
	
	new_content_flag,
	sum(new_content_flag) over w1 as new_content_flag_first,

	impressions_mom_pct,
	ctr_mom_pct,
	sessions_mom_pct,
	sessions_yoy_pct,

	-- are analytics necessary here?
	sessions_30d,
	sessions_ttm,
	pct_of_organic_sessions_30d,
	transaction_revenue_30d,
	transactions_30d,
	bounce_rate_30d,
	avg_seconds_on_site_30d,
	goal_completions_all_goals_30d,
	pct_of_organic_transactions_30d,
	impressions_30d,
	clicks_30d,
	avg_position_30d,
	main_keyword,
	main_top_url,
	main_impressions,
	main_clicks,
	main_avg_position,
	best_keyword,
	best_top_url,
	best_impressions,
	best_clicks,
	best_avg_position
	-- ecommerce_conversion_rate_30d,
	-- med_transaction_conversion_rate_30d,
	-- goal_completions_all_goals_30d,
	-- pct_of_organic_goal_completions_all_goals_30d,
	-- goal_conversion_rate_all_goals_30d,
	-- med_goal_conversion_rate_30d,
	-- bounce_rate_30d,
	-- avg_seconds_on_site_30d,
	-- sessions_mom,
	-- sessions_mom_pct,
	-- transaction_revenue_mom,
	-- transaction_revenue_mom_pct,
	-- transactions_mom,
	-- transactions_mom_pct,
	-- goal_completions_all_goals_mom,
	-- goal_completions_all_goals_mom_pct,
	-- sessions_yoy,
	-- sessions_yoy_pct,
	-- transaction_revenue_yoy,
	-- transaction_revenue_yoy_pct,
	-- transactions_yoy,
	-- transactions_yoy_pct,
	-- goal_completions_all_goals_yoy,
	-- goal_completions_all_goals_yoy_pct,
	-- sessions_ttm,
	-- transaction_revenue_ttm,
	-- transactions_ttm,
	-- ecommerce_conversion_rate_ttm,
	-- goal_completions_all_goals_ttm,
	-- goal_conversion_rate_all_goals_ttm,
	-- bounce_rate_ttm,
	-- avg_seconds_on_site_ttm,
	-- gaining_traffic_mom,
	-- gaining_traffic_yoy,
	-- impressions_30d,
	-- clicks_30d,
	-- ctr_30d,
	-- avg_position_30d,
	-- impressions_mom,
	-- impressions_mom_pct,
	-- clicks_mom,
	-- clicks_mom_pct,
	-- ctr_mom,
	-- ctr_mom_pct,
	-- avg_position_mom,
	-- impressions_yoy,
	-- impressions_yoy_pct,
	-- clicks_yoy,
	-- ctr_yoy,	
	-- ctr_yoy_pct,
	-- avg_position_yoy,	
	-- impressions_ttm,
	-- clicks_ttm,
	-- ctr_ttm,
	-- avg_position_ttm,
	-- top_3_keywords,
	-- top_5_keywords,
	-- top_10_keywords,
	-- top_20_keywords,
	-- main_keyword,
	-- main_impressions,
	-- main_clicks,
	-- main_avg_position,
	-- main_top_url,
	-- main_keyword_cannibalization_flag,
	-- main_top_url_clicks,
	-- best_keyword,
	-- best_impressions,
	-- best_clicks,
	-- best_avg_position,
	-- best_top_url,
	-- best_top_url_clicks,
	-- best_keyword_cannibalization_flag
	FROM `seo-data-pipeline-89`.`adp_thecifhw`.`actions_hierarchy`
	WHERE found_at is not null
	WINDOW w1 as (PARTITION BY site, url ORDER BY date asc)

)
  );
    
2021-04-19 16:29:21.976697 (Thread-51): handling poll request
2021-04-19 16:29:21.977114 (Thread-51): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'd178ec37-7b39-42b2-b063-b88e83fe10fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa03cdb9940>]}
2021-04-19 16:29:21.979254 (Thread-51): sending response (<Response 26449 bytes [200 OK]>) to 10.0.45.98
2021-04-19 16:29:23.612403 (Thread-1): finished collecting timing info
2021-04-19 16:29:23.613213 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd2dee09f-521a-45b5-af69-4db908d4d9f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f590144a9d0>]}
2021-04-19 16:29:23.614690 (Thread-1): 16:29:23 | 22 of 25 OK created table model adp_thecifhw.actions_diffs........... [CREATE TABLE (422.0 rows, 375.3 KB processed) in 2.67s]
2021-04-19 16:29:23.614780 (Thread-1): Finished running node model.tech_audit.actions_diffs
2021-04-19 16:29:23.614884 (Thread-1): Began running node model.tech_audit.actions_count
2021-04-19 16:29:23.615787 (Thread-1): 16:29:23 | 23 of 25 START table model adp_thecifhw.actions_count................ [RUN]
2021-04-19 16:29:23.616005 (Thread-1): Acquiring new bigquery connection "model.tech_audit.actions_count".
2021-04-19 16:29:23.616078 (Thread-1): Compiling model.tech_audit.actions_count
2021-04-19 16:29:23.630205 (Thread-1): Writing injected SQL for node "model.tech_audit.actions_count"
2021-04-19 16:29:23.650486 (Thread-1): finished collecting timing info
2021-04-19 16:29:23.655063 (Thread-1): Opening a new connection, currently in state closed
2021-04-19 16:29:23.835681 (Thread-1): Writing runtime SQL for node "model.tech_audit.actions_count"
2021-04-19 16:29:23.852519 (Thread-1): On model.tech_audit.actions_count: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.tech_audit.actions_count"} */


  create or replace table `seo-data-pipeline-89`.`adp_thecifhw`.`actions_count`
  
  
  OPTIONS()
  as (
    SELECT
date,
site,
action_type,
action,
count(distinct(url)) url_count,
sum(pct_of_organic_sessions_30d) pct_of_organic_sessions_30d
FROM (

	SELECT
	date,
	site,
	'Technical' as action_type,
	top_admin_action as action,
	url,
	pct_of_organic_sessions_30d
	FROM `seo-data-pipeline-89`.`adp_thecifhw`.`actions_hierarchy`
	WHERE crawl_action not like '%removed%'
	AND top_admin_action != '' AND top_admin_action is not null

	UNION ALL

	SELECT
	date,
	site,
	'On-page' as action_type,
	schema_action as action,
	url,
	pct_of_organic_sessions_30d
	FROM `seo-data-pipeline-89`.`adp_thecifhw`.`actions_hierarchy`
	WHERE schema_action != '' AND schema_action is not null

	UNION ALL

	SELECT
	date,
	site,
	'On-page' as action_type,
	meta_rewrite_action as action,
	url,
	pct_of_organic_sessions_30d
	FROM `seo-data-pipeline-89`.`adp_thecifhw`.`actions_hierarchy`
	WHERE meta_rewrite_action != '' AND meta_rewrite_action is not null	

	UNION ALL

	SELECT
	date,
	site,
	'On-page' as action_type,
	content_action as action,
	url,
	pct_of_organic_sessions_30d
	FROM `seo-data-pipeline-89`.`adp_thecifhw`.`actions_hierarchy`
	WHERE content_action != '' 

	UNION ALL

	SELECT
	date,
	site,
	'Off-page' as action_type,
	external_link_action as action,
	url,
	pct_of_organic_sessions_30d
	FROM `seo-data-pipeline-89`.`adp_thecifhw`.`actions_hierarchy`
	WHERE external_link_action != '' AND external_link_action is not null		

	UNION ALL

	SELECT
	date,
	site,
	'Architecture' as action_type,
	cannibalization_action as action,
	url,
	pct_of_organic_sessions_30d
	FROM `seo-data-pipeline-89`.`adp_thecifhw`.`actions_hierarchy`	
	WHERE cannibalization_action != '' AND cannibalization_action is not null

	UNION ALL

	SELECT
	date,
	site,
	'Architecture' as action_type,
	internal_link_action as action,
	url,
	pct_of_organic_sessions_30d
	FROM `seo-data-pipeline-89`.`adp_thecifhw`.`actions_hierarchy`		
	WHERE internal_link_action != '' AND internal_link_action is not null

	UNION ALL

	SELECT
	date,
	site,
	'Architecture' as action_type,
	category_action as action,
	url,
	pct_of_organic_sessions_30d
	FROM `seo-data-pipeline-89`.`adp_thecifhw`.`actions_hierarchy`		
	WHERE category_action != '' AND category_action is not null	
)
GROUP BY date, site, action_type, action
  );
    
2021-04-19 16:29:24.268099 (Thread-52): handling poll request
2021-04-19 16:29:24.268518 (Thread-52): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'd178ec37-7b39-42b2-b063-b88e83fe10fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa03cd46070>]}
2021-04-19 16:29:24.270429 (Thread-52): sending response (<Response 8574 bytes [200 OK]>) to 10.0.8.139
2021-04-19 16:29:25.939277 (Thread-53): handling poll request
2021-04-19 16:29:25.939702 (Thread-53): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'd178ec37-7b39-42b2-b063-b88e83fe10fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa03cd467c0>]}
2021-04-19 16:29:25.940566 (Thread-53): sending response (<Response 285 bytes [200 OK]>) to 10.0.2.242
2021-04-19 16:29:26.380288 (Thread-1): finished collecting timing info
2021-04-19 16:29:26.381091 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd2dee09f-521a-45b5-af69-4db908d4d9f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f59014fafa0>]}
2021-04-19 16:29:26.382056 (Thread-1): 16:29:26 | 23 of 25 OK created table model adp_thecifhw.actions_count........... [CREATE TABLE (35.0 rows, 66.0 KB processed) in 2.76s]
2021-04-19 16:29:26.382136 (Thread-1): Finished running node model.tech_audit.actions_count
2021-04-19 16:29:26.382242 (Thread-1): Began running node model.tech_audit.actions_data_studio
2021-04-19 16:29:26.383065 (Thread-1): 16:29:26 | 24 of 25 START table model adp_thecifhw.actions_data_studio.......... [RUN]
2021-04-19 16:29:26.383270 (Thread-1): Acquiring new bigquery connection "model.tech_audit.actions_data_studio".
2021-04-19 16:29:26.383342 (Thread-1): Compiling model.tech_audit.actions_data_studio
2021-04-19 16:29:26.391473 (Thread-1): Writing injected SQL for node "model.tech_audit.actions_data_studio"
2021-04-19 16:29:26.411559 (Thread-1): finished collecting timing info
2021-04-19 16:29:26.511883 (Thread-1): Opening a new connection, currently in state closed
2021-04-19 16:29:26.689219 (Thread-1): Writing runtime SQL for node "model.tech_audit.actions_data_studio"
2021-04-19 16:29:26.707460 (Thread-1): On model.tech_audit.actions_data_studio: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.tech_audit.actions_data_studio"} */


  create or replace table `seo-data-pipeline-89`.`adp_thecifhw`.`actions_data_studio`
  
  
  OPTIONS()
  as (
    SELECT
date,
crawl_date,
site,
domain,
url,
found_at,
page_type,
found_at_sitemap,
found_at_url,
canonical_url,
canonical_status,
top_admin_action,
top_admin_action_reason,
crawl_action,
http_status_action,
sitemap_action,
canonical_action,
schema_action,
cannibalization_action,
content_trajectory,
content_action,
internal_link_action,
external_link_action,
meta_rewrite_action,
category_action,
pagination_action,
url_protocol,
canonical_url_protocol,
protocol_match,
protocol_count,
http_status_code,
level,
schema_type,
header_content_type,
word_count, 
page_title,
title_contains_top_keyword,
page_title_length,
description,
description_contains_top_keyword,
description_length,
robots_noindex,
meta_noindex,
is_noindex,
redirected_to_url,
h1_tag,
h2_tag,
redirect_chain,
redirected_to_status_code,
is_redirect_loop,
duplicate_page,
duplicate_page_count,
duplicate_body,
duplicate_body_count,
sessions_30d,
pct_of_organic_sessions_30d,
transaction_revenue_30d,
transactions_30d,
pct_of_organic_transactions_30d,
ecommerce_conversion_rate_30d,
med_transaction_conversion_rate_30d,
goal_completions_all_goals_30d,
pct_of_organic_goal_completions_all_goals_30d,
goal_conversion_rate_all_goals_30d,
med_goal_conversion_rate_30d,
blended_conversions_30d,	
blended_conversion_rate_30d,
bounce_rate_30d,
avg_seconds_on_site_30d,
sessions_mom,
sessions_mom_pct,
transaction_revenue_mom,
transaction_revenue_mom_pct,
transactions_mom,
transactions_mom_pct,
goal_completions_all_goals_mom,
goal_completions_all_goals_mom_pct,
sessions_yoy,
sessions_yoy_pct,
transaction_revenue_yoy,
transaction_revenue_yoy_pct,
transactions_yoy,
transactions_yoy_pct,
goal_completions_all_goals_yoy,
goal_completions_all_goals_yoy_pct,
sessions_ttm,
transaction_revenue_ttm,
transactions_ttm,
ecommerce_conversion_rate_ttm,
goal_completions_all_goals_ttm,
goal_conversion_rate_all_goals_ttm,
bounce_rate_ttm,
avg_seconds_on_site_ttm,
gaining_traffic_mom,
gaining_traffic_yoy,
backlink_count,
ref_domain_count,
med_ref_domain_count,
internal_links_in_count,
internal_links_out_count,
impressions_30d,
clicks_30d,
ctr_30d,
avg_position_30d,
impressions_mom,
impressions_mom_pct,
clicks_mom,
clicks_mom_pct,
ctr_mom,
ctr_mom_pct,
avg_position_mom,
impressions_yoy,
impressions_yoy_pct,
clicks_yoy,
ctr_yoy,	
ctr_yoy_pct,
avg_position_yoy,	
impressions_ttm,
clicks_ttm,
ctr_ttm,
avg_position_ttm,
top_5_keywords,
top_10_keywords,
top_20_keywords,
main_keyword,
main_impressions,
main_clicks,
main_avg_position,
main_top_url,
main_keyword_cannibalization_flag,
main_top_url_clicks,
best_keyword,
best_impressions,
best_clicks,
best_avg_position,
best_top_url,
best_top_url_clicks,
best_keyword_cannibalization_flag,
on_off_page_action,
architecture_action
FROM `seo-data-pipeline-89`.`adp_thecifhw`.`actions_hierarchy`
  );
    
2021-04-19 16:29:27.935550 (Thread-54): handling poll request
2021-04-19 16:29:27.935972 (Thread-54): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'd178ec37-7b39-42b2-b063-b88e83fe10fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa03cd46880>]}
2021-04-19 16:29:27.937902 (Thread-54): sending response (<Response 8907 bytes [200 OK]>) to 10.0.9.82
2021-04-19 16:29:28.712120 (Thread-1): finished collecting timing info
2021-04-19 16:29:28.712908 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd2dee09f-521a-45b5-af69-4db908d4d9f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f59081e3670>]}
2021-04-19 16:29:28.713886 (Thread-1): 16:29:28 | 24 of 25 OK created table model adp_thecifhw.actions_data_studio..... [CREATE TABLE (422.0 rows, 519.6 KB processed) in 2.33s]
2021-04-19 16:29:28.713970 (Thread-1): Finished running node model.tech_audit.actions_data_studio
2021-04-19 16:29:28.714077 (Thread-1): Began running node model.tech_audit.actions_diffs_count
2021-04-19 16:29:28.714895 (Thread-1): 16:29:28 | 25 of 25 START table model adp_thecifhw.actions_diffs_count.......... [RUN]
2021-04-19 16:29:28.715100 (Thread-1): Acquiring new bigquery connection "model.tech_audit.actions_diffs_count".
2021-04-19 16:29:28.715173 (Thread-1): Compiling model.tech_audit.actions_diffs_count
2021-04-19 16:29:28.731422 (Thread-1): Writing injected SQL for node "model.tech_audit.actions_diffs_count"
2021-04-19 16:29:28.764204 (Thread-1): finished collecting timing info
2021-04-19 16:29:28.768648 (Thread-1): Opening a new connection, currently in state closed
2021-04-19 16:29:28.937091 (Thread-1): Writing runtime SQL for node "model.tech_audit.actions_diffs_count"
2021-04-19 16:29:28.971837 (Thread-1): On model.tech_audit.actions_diffs_count: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.tech_audit.actions_diffs_count"} */


  create or replace table `seo-data-pipeline-89`.`adp_thecifhw`.`actions_diffs_count`
  
  
  OPTIONS()
  as (
    SELECT
date,
site,
'Technical' as action_type,
page_type,
crawl_action as action,
crawl_action_diff as status,
crawl_action_priority as priority,
url,
sessions_30d,
pct_of_organic_sessions_30d,
transaction_revenue_30d,
transactions_30d,
pct_of_organic_transactions_30d,
impressions_mom_pct,
ctr_mom_pct,
sessions_mom_pct,
backlink_count_diff,
ref_domain_count_diff,
internal_links_in_count_diff,
internal_links_out_count_diff,
top_3_keywords_diff,
top_10_keywords_diff
FROM `seo-data-pipeline-89`.`adp_thecifhw`.`actions_diffs`
WHERE crawl_action not like '%removed%'
AND crawl_action_diff not in ('None','')
AND crawl_action_diff is not null

UNION ALL

SELECT
date,
site,
'Technical' as action_type,
page_type,
http_status_action as action,
http_status_action_diff as status,
http_status_action_priority as priority,
url,
sessions_30d,
pct_of_organic_sessions_30d,
transaction_revenue_30d,
transactions_30d,
pct_of_organic_transactions_30d,
impressions_mom_pct,
ctr_mom_pct,
sessions_mom_pct,
backlink_count_diff,
ref_domain_count_diff,
internal_links_in_count_diff,
internal_links_out_count_diff,
top_3_keywords_diff,
top_10_keywords_diff
FROM `seo-data-pipeline-89`.`adp_thecifhw`.`actions_diffs`
WHERE http_status_action_diff not in ('None','')
AND http_status_action_diff is not null

UNION ALL

SELECT
date,
site,
'Technical' as action_type,
page_type,
sitemap_action as action,
sitemap_action_diff as status,
sitemap_action_priority as priority,
url,
sessions_30d,
pct_of_organic_sessions_30d,
transaction_revenue_30d,
transactions_30d,
pct_of_organic_transactions_30d,
impressions_mom_pct,
ctr_mom_pct,
sessions_mom_pct,
backlink_count_diff,
ref_domain_count_diff,
internal_links_in_count_diff,
internal_links_out_count_diff,
top_3_keywords_diff,
top_10_keywords_diff
FROM `seo-data-pipeline-89`.`adp_thecifhw`.`actions_diffs`
WHERE sitemap_action_diff not in ('None','')
AND sitemap_action_diff is not null


UNION ALL

SELECT
date,
site,
'Technical' as action_type,
page_type,
canonical_action as action,
canonical_action_diff as status,
canonical_action_priority as priority,
url,
sessions_30d,
pct_of_organic_sessions_30d,
transaction_revenue_30d,
transactions_30d,
pct_of_organic_transactions_30d,
impressions_mom_pct,
ctr_mom_pct,
sessions_mom_pct,
backlink_count_diff,
ref_domain_count_diff,
internal_links_in_count_diff,
internal_links_out_count_diff,
top_3_keywords_diff,
top_10_keywords_diff
FROM `seo-data-pipeline-89`.`adp_thecifhw`.`actions_diffs`
WHERE canonical_action_diff not in ('None','')
AND canonical_action_diff is not null

UNION ALL

SELECT
date,
site,
'On-page' as action_type,
page_type,
content_action as action,
content_action_diff as status,
mktg_action_priority as priority,
url,
sessions_30d,
pct_of_organic_sessions_30d,
transaction_revenue_30d,
transactions_30d,
pct_of_organic_transactions_30d,
impressions_mom_pct,
ctr_mom_pct,
sessions_mom_pct,
backlink_count_diff,
ref_domain_count_diff,
internal_links_in_count_diff,
internal_links_out_count_diff,
top_3_keywords_diff,
top_10_keywords_diff
FROM `seo-data-pipeline-89`.`adp_thecifhw`.`actions_diffs`
WHERE content_action_diff not in ('None','')
AND content_action_diff is not null

UNION ALL

SELECT
date,
site,
'On-page' as action_type,
page_type,
schema_action as action,
schema_action_diff as status,
mktg_action_priority as priority,
url,
sessions_30d,
pct_of_organic_sessions_30d,
transaction_revenue_30d,
transactions_30d,
pct_of_organic_transactions_30d,
impressions_mom_pct,
ctr_mom_pct,
sessions_mom_pct,
backlink_count_diff,
ref_domain_count_diff,
internal_links_in_count_diff,
internal_links_out_count_diff,
top_3_keywords_diff,
top_10_keywords_diff
FROM `seo-data-pipeline-89`.`adp_thecifhw`.`actions_diffs`
WHERE schema_action_diff not in ('None','')
AND schema_action_diff is not null

UNION ALL

SELECT
date,
site,
'On-page' as action_type,
page_type,
meta_rewrite_action as action,
meta_rewrite_action_diff as status,
mktg_action_priority as priority,
url,
sessions_30d,
pct_of_organic_sessions_30d,
transaction_revenue_30d,
transactions_30d,
pct_of_organic_transactions_30d,
impressions_mom_pct,
ctr_mom_pct,
sessions_mom_pct,
backlink_count_diff,
ref_domain_count_diff,
internal_links_in_count_diff,
internal_links_out_count_diff,
top_3_keywords_diff,
top_10_keywords_diff
FROM `seo-data-pipeline-89`.`adp_thecifhw`.`actions_diffs`
WHERE meta_rewrite_action_diff not in ('None','')
AND meta_rewrite_action_diff is not null

UNION ALL

SELECT
date,
site,
'Off-page' as action_type,
page_type,
external_link_action as action,
external_link_action_diff as status,
mktg_action_priority as priority,
url,
sessions_30d,
pct_of_organic_sessions_30d,
transaction_revenue_30d,
transactions_30d,
pct_of_organic_transactions_30d,
impressions_mom_pct,
ctr_mom_pct,
sessions_mom_pct,
backlink_count_diff,
ref_domain_count_diff,
internal_links_in_count_diff,
internal_links_out_count_diff,
top_3_keywords_diff,
top_10_keywords_diff
FROM `seo-data-pipeline-89`.`adp_thecifhw`.`actions_diffs`
WHERE external_link_action_diff not in ('None','')
AND external_link_action_diff is not null


UNION ALL

SELECT
date,
site,
'Architecture' as action_type,
page_type,
cannibalization_action as action,
cannibalization_action_diff as status,
mktg_action_priority as priority,
url,
sessions_30d,
pct_of_organic_sessions_30d,
transaction_revenue_30d,
transactions_30d,
pct_of_organic_transactions_30d,
impressions_mom_pct,
ctr_mom_pct,
sessions_mom_pct,
backlink_count_diff,
ref_domain_count_diff,
internal_links_in_count_diff,
internal_links_out_count_diff,
top_3_keywords_diff,
top_10_keywords_diff
FROM `seo-data-pipeline-89`.`adp_thecifhw`.`actions_diffs`
WHERE cannibalization_action_diff not in ('None','')
AND cannibalization_action_diff is not null


UNION ALL

SELECT
date,
site,
'Architecture' as action_type,
page_type,
internal_link_action as action,
internal_link_action_diff as status,
mktg_action_priority as priority,
url,
sessions_30d,
pct_of_organic_sessions_30d,
transaction_revenue_30d,
transactions_30d,
pct_of_organic_transactions_30d,
impressions_mom_pct,
ctr_mom_pct,
sessions_mom_pct,
backlink_count_diff,
ref_domain_count_diff,
internal_links_in_count_diff,
internal_links_out_count_diff,
top_3_keywords_diff,
top_10_keywords_diff
FROM `seo-data-pipeline-89`.`adp_thecifhw`.`actions_diffs`
WHERE internal_link_action_diff not in ('None','')
AND internal_link_action_diff is not null
  );
    
2021-04-19 16:29:29.954361 (Thread-55): handling poll request
2021-04-19 16:29:29.955035 (Thread-55): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'd178ec37-7b39-42b2-b063-b88e83fe10fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa03cd46ee0>]}
2021-04-19 16:29:29.957046 (Thread-55): sending response (<Response 12989 bytes [200 OK]>) to 10.0.45.98
2021-04-19 16:29:30.912937 (Thread-1): finished collecting timing info
2021-04-19 16:29:30.913923 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd2dee09f-521a-45b5-af69-4db908d4d9f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5901445550>]}
2021-04-19 16:29:30.915438 (Thread-1): 16:29:30 | 25 of 25 OK created table model adp_thecifhw.actions_diffs_count..... [CREATE TABLE (536.0 rows, 137.0 KB processed) in 2.20s]
2021-04-19 16:29:30.915554 (Thread-1): Finished running node model.tech_audit.actions_diffs_count
2021-04-19 16:29:30.916872 (MainThread): Acquiring new bigquery connection "master".
2021-04-19 16:29:30.917192 (MainThread): 16:29:30 | 
2021-04-19 16:29:30.917259 (MainThread): 16:29:30 | Finished running 25 table models in 78.38s.
2021-04-19 16:29:30.917308 (MainThread): Connection 'master' was properly closed.
2021-04-19 16:29:30.917350 (MainThread): Connection 'model.tech_audit.actions_diffs_count' was properly closed.
2021-04-19 16:29:31.046526 (MainThread): 
2021-04-19 16:29:31.046715 (MainThread): Completed successfully
2021-04-19 16:29:31.046823 (MainThread): 
Done. PASS=25 WARN=0 ERROR=0 SKIP=0 TOTAL=25
2021-04-19 16:29:31.934892 (Thread-56): handling poll request
2021-04-19 16:29:31.935372 (Thread-56): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'd178ec37-7b39-42b2-b063-b88e83fe10fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa03cd463d0>]}
2021-04-19 16:29:31.995624 (Thread-56): sending response (<Response 521422 bytes [200 OK]>) to 10.0.25.165
2021-04-19 16:29:32.592549 (Thread-57): handling status request
2021-04-19 16:29:32.592994 (Thread-57): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'd178ec37-7b39-42b2-b063-b88e83fe10fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa03cd698e0>]}
2021-04-19 16:29:32.602409 (Thread-57): sending response (<Response 32826 bytes [200 OK]>) to 10.0.45.98
2021-10-13 16:32:48.084172 (MainThread): Running with dbt=0.18.1
2021-10-13 16:32:48.253347 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.rpc.server.RPCServerTask'>, debug=False, defer=None, exclude=None, host='0.0.0.0', log_cache_events=False, log_format='default', models=None, partial_parse=True, port=8580, profile='user', profiles_dir='/usr/src/develop/.dbt', project_dir=None, record_timing_info=None, rpc_method=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='rpc', write_json=True)
2021-10-13 16:32:48.261878 (MainThread): Tracking: tracking
2021-10-13 16:32:48.285111 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa22061b760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa220639580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa220639910>]}
2021-10-13 16:32:48.285503 (MainThread): Serving RPC server at 0.0.0.0:8580, pid=21
2021-10-13 16:32:48.285878 (MainThread): Supported methods: ['cli_args', 'compile', 'compile_sql', 'deps', 'docs.generate', 'gc', 'get-manifest', 'kill', 'poll', 'ps', 'run', 'run-operation', 'run_sql', 'seed', 'snapshot', 'snapshot-freshness', 'status', 'test']
2021-10-13 16:32:48.286097 (MainThread): Send requests to http://localhost:8580/jsonrpc
2021-10-13 16:32:48.317857 (Thread-12): Parsing macros/generate_schema_name.sql
2021-10-13 16:32:48.319418 (Thread-12): Parsing macros/catalog.sql
2021-10-13 16:32:48.326243 (Thread-12): Parsing macros/adapters.sql
2021-10-13 16:32:48.343818 (Thread-12): Parsing macros/etc.sql
2021-10-13 16:32:48.345011 (Thread-12): Parsing macros/materializations/table.sql
2021-10-13 16:32:48.353998 (Thread-12): Parsing macros/materializations/seed.sql
2021-10-13 16:32:48.356505 (Thread-12): Parsing macros/materializations/view.sql
2021-10-13 16:32:48.359052 (Thread-12): Parsing macros/materializations/snapshot.sql
2021-10-13 16:32:48.360792 (Thread-12): Parsing macros/materializations/incremental.sql
2021-10-13 16:32:48.372246 (Thread-12): Parsing macros/materializations/copy.sql
2021-10-13 16:32:48.376918 (Thread-12): Parsing macros/core.sql
2021-10-13 16:32:48.380269 (Thread-12): Parsing macros/materializations/helpers.sql
2021-10-13 16:32:48.388441 (Thread-12): Parsing macros/materializations/view/view.sql
2021-10-13 16:32:48.394197 (Thread-12): Parsing macros/materializations/view/create_or_replace_view.sql
2021-10-13 16:32:48.398730 (Thread-12): Parsing macros/materializations/seed/seed.sql
2021-10-13 16:32:48.417763 (Thread-12): Parsing macros/materializations/snapshot/strategies.sql
2021-10-13 16:32:48.433009 (Thread-12): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-10-13 16:32:48.434707 (Thread-12): Parsing macros/materializations/snapshot/snapshot.sql
2021-10-13 16:32:48.460943 (Thread-12): Parsing macros/materializations/table/table.sql
2021-10-13 16:32:48.467122 (Thread-12): Parsing macros/materializations/common/merge.sql
2021-10-13 16:32:48.480244 (Thread-12): Parsing macros/materializations/incremental/incremental.sql
2021-10-13 16:32:48.486414 (Thread-12): Parsing macros/materializations/incremental/helpers.sql
2021-10-13 16:32:48.488195 (Thread-12): Parsing macros/etc/get_custom_alias.sql
2021-10-13 16:32:48.489115 (Thread-12): Parsing macros/etc/datetime.sql
2021-10-13 16:32:48.497055 (Thread-12): Parsing macros/etc/query.sql
2021-10-13 16:32:48.498074 (Thread-12): Parsing macros/etc/get_custom_database.sql
2021-10-13 16:32:48.499632 (Thread-12): Parsing macros/etc/get_custom_schema.sql
2021-10-13 16:32:48.501514 (Thread-12): Parsing macros/etc/is_incremental.sql
2021-10-13 16:32:48.503033 (Thread-12): Parsing macros/adapters/common.sql
2021-10-13 16:32:48.542700 (Thread-12): Parsing macros/schema_tests/accepted_values.sql
2021-10-13 16:32:48.545232 (Thread-12): Parsing macros/schema_tests/not_null.sql
2021-10-13 16:32:48.546674 (Thread-12): Parsing macros/schema_tests/relationships.sql
2021-10-13 16:32:48.548467 (Thread-12): Parsing macros/schema_tests/unique.sql
2021-10-13 16:32:48.565210 (Thread-12): Parsing macros/logger/pretty_time.sql
2021-10-13 16:32:48.571690 (Thread-12): Parsing macros/logger/log_info.sql
2021-10-13 16:32:48.578334 (Thread-12): Parsing macros/logger/pretty_log_format.sql
2021-10-13 16:32:48.586704 (Thread-12): Parsing macros/sql/pivot.sql
2021-10-13 16:32:48.597619 (Thread-12): Parsing macros/sql/star.sql
2021-10-13 16:32:48.606485 (Thread-12): Parsing macros/sql/surrogate_key.sql
2021-10-13 16:32:48.615352 (Thread-12): Parsing macros/sql/get_query_results_as_dict.sql
2021-10-13 16:32:48.623494 (Thread-12): Parsing macros/sql/get_column_values.sql
2021-10-13 16:32:48.634035 (Thread-12): Parsing macros/sql/groupby.sql
2021-10-13 16:32:48.641844 (Thread-12): Parsing macros/sql/get_tables_by_pattern_sql.sql
2021-10-13 16:32:48.653366 (Thread-12): Parsing macros/sql/nullcheck_table.sql
2021-10-13 16:32:48.660771 (Thread-12): Parsing macros/sql/get_tables_by_prefix_sql.sql
2021-10-13 16:32:48.668628 (Thread-12): Parsing macros/sql/get_relations_by_pattern.sql
2021-10-13 16:32:48.677755 (Thread-12): Parsing macros/sql/get_relations_by_prefix.sql
2021-10-13 16:32:48.687264 (Thread-12): Parsing macros/sql/safe_add.sql
2021-10-13 16:32:48.695773 (Thread-12): Parsing macros/sql/unpivot.sql
2021-10-13 16:32:48.708725 (Thread-12): Parsing macros/sql/generate_series.sql
2021-10-13 16:32:48.718971 (Thread-12): Parsing macros/sql/nullcheck.sql
2021-10-13 16:32:48.726229 (Thread-12): Parsing macros/sql/union.sql
2021-10-13 16:32:48.740787 (Thread-12): Parsing macros/materializations/insert_by_period_materialization.sql
2021-10-13 16:32:48.770340 (Thread-12): Parsing macros/web/get_url_parameter.sql
2021-10-13 16:32:48.778355 (Thread-12): Parsing macros/web/get_url_path.sql
2021-10-13 16:32:48.788588 (Thread-12): Parsing macros/web/get_url_host.sql
2021-10-13 16:32:48.796132 (Thread-12): Parsing macros/datetime/date_spine.sql
2021-10-13 16:32:48.806711 (Thread-12): Parsing macros/schema_tests/expression_is_true.sql
2021-10-13 16:32:48.814263 (Thread-12): Parsing macros/schema_tests/not_constant.sql
2021-10-13 16:32:48.821249 (Thread-12): Parsing macros/schema_tests/at_least_one.sql
2021-10-13 16:32:48.829845 (Thread-12): Parsing macros/schema_tests/equality.sql
2021-10-13 16:32:48.839540 (Thread-12): Parsing macros/schema_tests/test_not_null_where.sql
2021-10-13 16:32:48.847526 (Thread-12): Parsing macros/schema_tests/equal_rowcount.sql
2021-10-13 16:32:48.856205 (Thread-12): Parsing macros/schema_tests/test_unique_where.sql
2021-10-13 16:32:48.863547 (Thread-12): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2021-10-13 16:32:48.875933 (Thread-12): Parsing macros/schema_tests/relationships_where.sql
2021-10-13 16:32:48.884625 (Thread-12): Parsing macros/schema_tests/unique_combination_of_columns.sql
2021-10-13 16:32:48.893555 (Thread-12): Parsing macros/schema_tests/recency.sql
2021-10-13 16:32:48.900883 (Thread-12): Parsing macros/schema_tests/cardinality_equality.sql
2021-10-13 16:32:48.908922 (Thread-12): Parsing macros/geo/haversine_distance.sql
2021-10-13 16:32:48.915990 (Thread-12): Parsing macros/cross_db_utils/split_part.sql
2021-10-13 16:32:48.924438 (Thread-12): Parsing macros/cross_db_utils/length.sql
2021-10-13 16:32:48.932596 (Thread-12): Parsing macros/cross_db_utils/current_timestamp.sql
2021-10-13 16:32:48.942580 (Thread-12): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2021-10-13 16:32:48.949054 (Thread-12): Parsing macros/cross_db_utils/right.sql
2021-10-13 16:32:48.957212 (Thread-12): Parsing macros/cross_db_utils/hash.sql
2021-10-13 16:32:48.965116 (Thread-12): Parsing macros/cross_db_utils/replace.sql
2021-10-13 16:32:48.973261 (Thread-12): Parsing macros/cross_db_utils/concat.sql
2021-10-13 16:32:48.982990 (Thread-12): Parsing macros/cross_db_utils/_is_relation.sql
2021-10-13 16:32:48.990255 (Thread-12): Parsing macros/cross_db_utils/identifier.sql
2021-10-13 16:32:48.998745 (Thread-12): Parsing macros/cross_db_utils/datediff.sql
2021-10-13 16:32:49.014586 (Thread-12): Parsing macros/cross_db_utils/dateadd.sql
2021-10-13 16:32:49.023395 (Thread-12): Parsing macros/cross_db_utils/datatypes.sql
2021-10-13 16:32:49.037639 (Thread-12): Parsing macros/cross_db_utils/position.sql
2021-10-13 16:32:49.046051 (Thread-12): Parsing macros/cross_db_utils/literal.sql
2021-10-13 16:32:49.053326 (Thread-12): Parsing macros/cross_db_utils/_is_ephemeral.sql
2021-10-13 16:32:49.060867 (Thread-12): Parsing macros/cross_db_utils/width_bucket.sql
2021-10-13 16:32:49.071654 (Thread-12): Parsing macros/cross_db_utils/date_trunc.sql
2021-10-13 16:32:49.079120 (Thread-12): Parsing macros/cross_db_utils/except.sql
2021-10-13 16:32:49.087010 (Thread-12): Parsing macros/cross_db_utils/safe_cast.sql
2021-10-13 16:32:49.096951 (Thread-12): Parsing macros/cross_db_utils/last_day.sql
2021-10-13 16:32:49.106712 (Thread-12): Parsing macros/cross_db_utils/intersect.sql
2021-10-13 16:32:49.279876 (Thread-12): Acquiring new bigquery connection "model.tech_audit.agg_all".
2021-10-13 16:32:49.310759 (Thread-12): Acquiring new bigquery connection "model.tech_audit.agg_traffic".
2021-10-13 16:32:49.332636 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_diffs_count".
2021-10-13 16:32:49.357315 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_diffs".
2021-10-13 16:32:49.377741 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_count".
2021-10-13 16:32:49.400628 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_data_studio".
2021-10-13 16:32:49.417766 (Thread-12): Acquiring new bigquery connection "model.tech_audit.domains_proc".
2021-10-13 16:32:49.432861 (Thread-12): Acquiring new bigquery connection "model.tech_audit.crawl_dates".
2021-10-13 16:32:49.454631 (Thread-12): Acquiring new bigquery connection "model.tech_audit.dates".
2021-10-13 16:32:49.473322 (Thread-12): Acquiring new bigquery connection "model.tech_audit.ga_stats".
2021-10-13 16:32:49.492046 (Thread-12): Acquiring new bigquery connection "model.tech_audit.ga_proc_url_mapping".
2021-10-13 16:32:49.511390 (Thread-12): Acquiring new bigquery connection "model.tech_audit.ga_proc".
2021-10-13 16:32:49.532176 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_keyword_stats".
2021-10-13 16:32:49.550094 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_url_proc_url_mapping".
2021-10-13 16:32:49.568628 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_url_keyword_stats".
2021-10-13 16:32:49.589658 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_keyword_proc_url_mapping".
2021-10-13 16:32:49.613764 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_url_stats".
2021-10-13 16:32:49.635198 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_keyword_proc".
2021-10-13 16:32:49.653640 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_url_proc".
2021-10-13 16:32:49.672287 (Thread-12): Acquiring new bigquery connection "model.tech_audit.deepcrawl_proc".
2021-10-13 16:32:49.691793 (Thread-12): Acquiring new bigquery connection "model.tech_audit.deepcrawl_latest_crawl_proc".
2021-10-13 16:32:49.707095 (Thread-12): Acquiring new bigquery connection "model.tech_audit.deepcrawl_url_proc".
2021-10-13 16:32:49.721036 (Thread-12): Acquiring new bigquery connection "model.tech_audit.deepcrawl_stats".
2021-10-13 16:32:49.735049 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_proc".
2021-10-13 16:32:49.749511 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_hierarchy".
2021-10-13 16:33:12.527228 (MainThread): Running with dbt=0.18.1
2021-10-13 16:33:12.679772 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.rpc.server.RPCServerTask'>, debug=False, defer=None, exclude=None, host='0.0.0.0', log_cache_events=False, log_format='default', models=None, partial_parse=True, port=8580, profile='user', profiles_dir='/usr/src/develop/.dbt', project_dir=None, record_timing_info=None, rpc_method=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='rpc', write_json=True)
2021-10-13 16:33:12.691644 (MainThread): Tracking: tracking
2021-10-13 16:33:12.711251 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efd7dc10340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efd592b9430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efd592b97c0>]}
2021-10-13 16:33:12.711612 (MainThread): Serving RPC server at 0.0.0.0:8580, pid=21
2021-10-13 16:33:12.711978 (MainThread): Supported methods: ['cli_args', 'compile', 'compile_sql', 'deps', 'docs.generate', 'gc', 'get-manifest', 'kill', 'poll', 'ps', 'run', 'run-operation', 'run_sql', 'seed', 'snapshot', 'snapshot-freshness', 'status', 'test']
2021-10-13 16:33:12.712183 (MainThread): Send requests to http://localhost:8580/jsonrpc
2021-10-13 16:33:12.737422 (Thread-12): Parsing macros/generate_schema_name.sql
2021-10-13 16:33:12.738989 (Thread-12): Parsing macros/catalog.sql
2021-10-13 16:33:12.745209 (Thread-12): Parsing macros/adapters.sql
2021-10-13 16:33:12.762604 (Thread-12): Parsing macros/etc.sql
2021-10-13 16:33:12.763770 (Thread-12): Parsing macros/materializations/table.sql
2021-10-13 16:33:12.772782 (Thread-12): Parsing macros/materializations/seed.sql
2021-10-13 16:33:12.775326 (Thread-12): Parsing macros/materializations/view.sql
2021-10-13 16:33:12.777906 (Thread-12): Parsing macros/materializations/snapshot.sql
2021-10-13 16:33:12.779635 (Thread-12): Parsing macros/materializations/incremental.sql
2021-10-13 16:33:12.791329 (Thread-12): Parsing macros/materializations/copy.sql
2021-10-13 16:33:12.796071 (Thread-12): Parsing macros/core.sql
2021-10-13 16:33:12.799479 (Thread-12): Parsing macros/materializations/helpers.sql
2021-10-13 16:33:12.807673 (Thread-12): Parsing macros/materializations/view/view.sql
2021-10-13 16:33:12.813445 (Thread-12): Parsing macros/materializations/view/create_or_replace_view.sql
2021-10-13 16:33:12.818044 (Thread-12): Parsing macros/materializations/seed/seed.sql
2021-10-13 16:33:12.836852 (Thread-12): Parsing macros/materializations/snapshot/strategies.sql
2021-10-13 16:33:12.851768 (Thread-12): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-10-13 16:33:12.853466 (Thread-12): Parsing macros/materializations/snapshot/snapshot.sql
2021-10-13 16:33:12.879917 (Thread-12): Parsing macros/materializations/table/table.sql
2021-10-13 16:33:12.886090 (Thread-12): Parsing macros/materializations/common/merge.sql
2021-10-13 16:33:12.899216 (Thread-12): Parsing macros/materializations/incremental/incremental.sql
2021-10-13 16:33:12.905171 (Thread-12): Parsing macros/materializations/incremental/helpers.sql
2021-10-13 16:33:12.906925 (Thread-12): Parsing macros/etc/get_custom_alias.sql
2021-10-13 16:33:12.907836 (Thread-12): Parsing macros/etc/datetime.sql
2021-10-13 16:33:12.915959 (Thread-12): Parsing macros/etc/query.sql
2021-10-13 16:33:12.916983 (Thread-12): Parsing macros/etc/get_custom_database.sql
2021-10-13 16:33:12.918577 (Thread-12): Parsing macros/etc/get_custom_schema.sql
2021-10-13 16:33:12.920496 (Thread-12): Parsing macros/etc/is_incremental.sql
2021-10-13 16:33:12.922061 (Thread-12): Parsing macros/adapters/common.sql
2021-10-13 16:33:12.962716 (Thread-12): Parsing macros/schema_tests/accepted_values.sql
2021-10-13 16:33:12.965274 (Thread-12): Parsing macros/schema_tests/not_null.sql
2021-10-13 16:33:12.966932 (Thread-12): Parsing macros/schema_tests/relationships.sql
2021-10-13 16:33:12.968710 (Thread-12): Parsing macros/schema_tests/unique.sql
2021-10-13 16:33:12.979357 (Thread-12): Parsing macros/logger/pretty_time.sql
2021-10-13 16:33:12.983730 (Thread-12): Parsing macros/logger/log_info.sql
2021-10-13 16:33:12.987837 (Thread-12): Parsing macros/logger/pretty_log_format.sql
2021-10-13 16:33:12.992060 (Thread-12): Parsing macros/sql/pivot.sql
2021-10-13 16:33:12.998857 (Thread-12): Parsing macros/sql/star.sql
2021-10-13 16:33:13.005734 (Thread-12): Parsing macros/sql/surrogate_key.sql
2021-10-13 16:33:13.012223 (Thread-12): Parsing macros/sql/get_query_results_as_dict.sql
2021-10-13 16:33:13.017948 (Thread-12): Parsing macros/sql/get_column_values.sql
2021-10-13 16:33:13.025745 (Thread-12): Parsing macros/sql/groupby.sql
2021-10-13 16:33:13.030269 (Thread-12): Parsing macros/sql/get_tables_by_pattern_sql.sql
2021-10-13 16:33:13.039493 (Thread-12): Parsing macros/sql/nullcheck_table.sql
2021-10-13 16:33:13.044289 (Thread-12): Parsing macros/sql/get_tables_by_prefix_sql.sql
2021-10-13 16:33:13.048842 (Thread-12): Parsing macros/sql/get_relations_by_pattern.sql
2021-10-13 16:33:13.055330 (Thread-12): Parsing macros/sql/get_relations_by_prefix.sql
2021-10-13 16:33:13.062306 (Thread-12): Parsing macros/sql/safe_add.sql
2021-10-13 16:33:13.066916 (Thread-12): Parsing macros/sql/unpivot.sql
2021-10-13 16:33:13.077200 (Thread-12): Parsing macros/sql/generate_series.sql
2021-10-13 16:33:13.084378 (Thread-12): Parsing macros/sql/nullcheck.sql
2021-10-13 16:33:13.089072 (Thread-12): Parsing macros/sql/union.sql
2021-10-13 16:33:13.101680 (Thread-12): Parsing macros/materializations/insert_by_period_materialization.sql
2021-10-13 16:33:13.128275 (Thread-12): Parsing macros/web/get_url_parameter.sql
2021-10-13 16:33:13.134250 (Thread-12): Parsing macros/web/get_url_path.sql
2021-10-13 16:33:13.139901 (Thread-12): Parsing macros/web/get_url_host.sql
2021-10-13 16:33:13.144877 (Thread-12): Parsing macros/datetime/date_spine.sql
2021-10-13 16:33:13.152379 (Thread-12): Parsing macros/schema_tests/expression_is_true.sql
2021-10-13 16:33:13.156703 (Thread-12): Parsing macros/schema_tests/not_constant.sql
2021-10-13 16:33:13.161271 (Thread-12): Parsing macros/schema_tests/at_least_one.sql
2021-10-13 16:33:13.165966 (Thread-12): Parsing macros/schema_tests/equality.sql
2021-10-13 16:33:13.172915 (Thread-12): Parsing macros/schema_tests/test_not_null_where.sql
2021-10-13 16:33:13.177940 (Thread-12): Parsing macros/schema_tests/equal_rowcount.sql
2021-10-13 16:33:13.182760 (Thread-12): Parsing macros/schema_tests/test_unique_where.sql
2021-10-13 16:33:13.187717 (Thread-12): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2021-10-13 16:33:13.196740 (Thread-12): Parsing macros/schema_tests/relationships_where.sql
2021-10-13 16:33:13.202294 (Thread-12): Parsing macros/schema_tests/unique_combination_of_columns.sql
2021-10-13 16:33:13.208970 (Thread-12): Parsing macros/schema_tests/recency.sql
2021-10-13 16:33:13.213824 (Thread-12): Parsing macros/schema_tests/cardinality_equality.sql
2021-10-13 16:33:13.219127 (Thread-12): Parsing macros/geo/haversine_distance.sql
2021-10-13 16:33:13.223900 (Thread-12): Parsing macros/cross_db_utils/split_part.sql
2021-10-13 16:33:13.228530 (Thread-12): Parsing macros/cross_db_utils/length.sql
2021-10-13 16:33:13.232693 (Thread-12): Parsing macros/cross_db_utils/current_timestamp.sql
2021-10-13 16:33:13.238896 (Thread-12): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2021-10-13 16:33:13.242859 (Thread-12): Parsing macros/cross_db_utils/right.sql
2021-10-13 16:33:13.248157 (Thread-12): Parsing macros/cross_db_utils/hash.sql
2021-10-13 16:33:13.252853 (Thread-12): Parsing macros/cross_db_utils/replace.sql
2021-10-13 16:33:13.257125 (Thread-12): Parsing macros/cross_db_utils/concat.sql
2021-10-13 16:33:13.262179 (Thread-12): Parsing macros/cross_db_utils/_is_relation.sql
2021-10-13 16:33:13.266093 (Thread-12): Parsing macros/cross_db_utils/identifier.sql
2021-10-13 16:33:13.270750 (Thread-12): Parsing macros/cross_db_utils/datediff.sql
2021-10-13 16:33:13.282782 (Thread-12): Parsing macros/cross_db_utils/dateadd.sql
2021-10-13 16:33:13.288162 (Thread-12): Parsing macros/cross_db_utils/datatypes.sql
2021-10-13 16:33:13.298362 (Thread-12): Parsing macros/cross_db_utils/position.sql
2021-10-13 16:33:13.303114 (Thread-12): Parsing macros/cross_db_utils/literal.sql
2021-10-13 16:33:13.307077 (Thread-12): Parsing macros/cross_db_utils/_is_ephemeral.sql
2021-10-13 16:33:13.312018 (Thread-12): Parsing macros/cross_db_utils/width_bucket.sql
2021-10-13 16:33:13.319940 (Thread-12): Parsing macros/cross_db_utils/date_trunc.sql
2021-10-13 16:33:13.324794 (Thread-12): Parsing macros/cross_db_utils/except.sql
2021-10-13 16:33:13.329150 (Thread-12): Parsing macros/cross_db_utils/safe_cast.sql
2021-10-13 16:33:13.334226 (Thread-12): Parsing macros/cross_db_utils/last_day.sql
2021-10-13 16:33:13.340073 (Thread-12): Parsing macros/cross_db_utils/intersect.sql
2021-10-13 16:33:13.505217 (Thread-12): Acquiring new bigquery connection "model.tech_audit.agg_all".
2021-10-13 16:33:13.534729 (Thread-12): Acquiring new bigquery connection "model.tech_audit.agg_traffic".
2021-10-13 16:33:13.555252 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_diffs_count".
2021-10-13 16:33:13.578970 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_diffs".
2021-10-13 16:33:13.595638 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_count".
2021-10-13 16:33:13.616265 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_data_studio".
2021-10-13 16:33:13.632134 (Thread-12): Acquiring new bigquery connection "model.tech_audit.domains_proc".
2021-10-13 16:33:13.644566 (Thread-12): Acquiring new bigquery connection "model.tech_audit.crawl_dates".
2021-10-13 16:33:13.660480 (Thread-12): Acquiring new bigquery connection "model.tech_audit.dates".
2021-10-13 16:33:13.677718 (Thread-12): Acquiring new bigquery connection "model.tech_audit.ga_stats".
2021-10-13 16:33:13.694413 (Thread-12): Acquiring new bigquery connection "model.tech_audit.ga_proc_url_mapping".
2021-10-13 16:33:13.710474 (Thread-12): Acquiring new bigquery connection "model.tech_audit.ga_proc".
2021-10-13 16:33:13.729473 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_keyword_stats".
2021-10-13 16:33:13.745756 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_url_proc_url_mapping".
2021-10-13 16:33:13.762430 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_url_keyword_stats".
2021-10-13 16:33:13.779264 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_keyword_proc_url_mapping".
2021-10-13 16:33:13.796715 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_url_stats".
2021-10-13 16:33:13.812069 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_keyword_proc".
2021-10-13 16:33:13.827400 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_url_proc".
2021-10-13 16:33:13.845012 (Thread-12): Acquiring new bigquery connection "model.tech_audit.deepcrawl_proc".
2021-10-13 16:33:13.863767 (Thread-12): Acquiring new bigquery connection "model.tech_audit.deepcrawl_latest_crawl_proc".
2021-10-13 16:33:13.880806 (Thread-12): Acquiring new bigquery connection "model.tech_audit.deepcrawl_url_proc".
2021-10-13 16:33:13.899456 (Thread-12): Acquiring new bigquery connection "model.tech_audit.deepcrawl_stats".
2021-10-13 16:33:13.918236 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_proc".
2021-10-13 16:33:13.936023 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_hierarchy".
2021-10-13 16:33:15.410052 (Thread-13): handling status request
2021-10-13 16:33:15.410652 (Thread-13): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '1cb576c2-9e3c-48a0-926e-3d919fe84600', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efd43f896d0>]}
2021-10-13 16:33:15.416260 (Thread-14): handling status request
2021-10-13 16:33:15.420237 (Thread-13): sending response (<Response 32943 bytes [200 OK]>) to 10.0.8.41
2021-10-13 16:33:15.420614 (Thread-14): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '1cb576c2-9e3c-48a0-926e-3d919fe84600', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efd43f7a910>]}
2021-10-13 16:33:15.428964 (Thread-14): sending response (<Response 32943 bytes [200 OK]>) to 10.0.3.143
2021-10-13 16:33:15.433668 (Thread-15): handling status request
2021-10-13 16:33:15.433949 (Thread-15): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '1cb576c2-9e3c-48a0-926e-3d919fe84600', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efd43f4a3d0>]}
2021-10-13 16:33:15.441454 (Thread-15): sending response (<Response 32943 bytes [200 OK]>) to 10.0.3.143
2021-10-13 16:33:15.449693 (Thread-16): handling status request
2021-10-13 16:33:15.449962 (Thread-16): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '1cb576c2-9e3c-48a0-926e-3d919fe84600', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efd43faca90>]}
2021-10-13 16:33:15.457390 (Thread-16): sending response (<Response 32943 bytes [200 OK]>) to 10.0.13.137
2021-10-13 16:33:15.514698 (Thread-17): handling ps request
2021-10-13 16:33:15.515062 (Thread-17): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '1cb576c2-9e3c-48a0-926e-3d919fe84600', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efd43fa27f0>]}
2021-10-13 16:33:15.516456 (Thread-17): sending response (<Response 104 bytes [200 OK]>) to 10.0.40.89
2021-10-13 16:37:32.166464 (Thread-18): handling status request
2021-10-13 16:37:32.167983 (Thread-18): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '1cb576c2-9e3c-48a0-926e-3d919fe84600', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efd5803c3d0>]}
2021-10-13 16:37:32.175948 (Thread-18): sending response (<Response 32943 bytes [200 OK]>) to 10.0.25.125
2021-10-13 16:37:32.683292 (Thread-19): handling run_sql request
2021-10-13 16:37:32.683731 (Thread-19): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '1cb576c2-9e3c-48a0-926e-3d919fe84600', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efd43f05a00>]}
2021-10-13 16:37:32.686239 (Thread-19): Connection 'model.tech_audit.actions_hierarchy' was properly closed.
2021-10-13 16:37:33.483520 (Thread-19): sending response (<Response 137 bytes [200 OK]>) to 10.0.13.137
2021-10-13 16:37:33.501462 (MainThread): Acquiring new bigquery connection "rpc.tech_audit.request".
2021-10-13 16:37:33.528925 (MainThread): Found 25 models, 0 tests, 0 snapshots, 0 analyses, 327 macros, 0 operations, 0 seed files, 5 sources
2021-10-13 16:37:33.529401 (Thread-1): Acquiring new bigquery connection "rpc.tech_audit.request".
2021-10-13 16:37:33.529507 (Thread-1): Compiling rpc.tech_audit.request
2021-10-13 16:37:33.544043 (Thread-1): finished collecting timing info
2021-10-13 16:37:33.544256 (Thread-1): Opening a new connection, currently in state init
2021-10-13 16:37:33.544618 (Thread-1): On rpc.tech_audit.request: SELECT
date,
crawl_date,
site,
domain,
url,
found_at,
found_at_sitemap,
found_at_url,
canonical_url,
canonical_status,
page_type,
CASE WHEN sessions_30d = sessions_ttm AND sessions_30d > 0 and http_status_code=200 THEN 1
	ELSE 0 END as new_content_flag,
CASE 
	WHEN lower(http_status_action) like '%redirect%' THEN 'High'
	WHEN lower(crawl_action) like '%missing from crawl%' THEN 'High'
	WHEN lower(crawl_action) like '%potential noindex%' THEN 'Medium'	
	WHEN lower(http_status_action) like '%remove internal link%' THEN 'High'	
	WHEN lower(sitemap_action) like '%remove from sitemap%' or ( lower(sitemap_action) = 'likely add to sitemap' and pct_of_organic_sessions_30d > .05 )  THEN 'High'
	WHEN lower(sitemap_action) = 'likely add to sitemap' THEN 'Medium'
	WHEN lower(canonical_action) in ('missing canonical', 'self-canonicalize, paginated page') THEN 'High'
	ELSE '' END as admin_action_priority,
CASE WHEN impressions_30d >= top_10pct_impressions_30d THEN 'High'
	WHEN impressions_30d >= med_impressions_30d THEN 'Medium'
	ELSE 'Low' END as mktg_action_priority,	
case 
	when http_status_action != '' then http_status_action
	when crawl_action != '' then crawl_action
	when lower(sitemap_action) not in ('leave as is', '') then sitemap_action
	when lower(canonical_action) not in ('leave as is', '') then canonical_action
	else '' end as top_admin_action,
case 
	when http_status_action != '' then concat(cast(http_status_code as string),' page status')
	when http_status_code is null and lower(crawl_action) like '%missing%' then 'not crawled by deepcrawl'
	when lower(crawl_action) like '%removed%' then 'not crawled, 0 traffic'
	when crawl_action != '' then '0 traffic'
	when lower(sitemap_action) like '%remove%' then '301, 404, noindexed or thin page'
	when sitemap_action != '' then 'page missing from sitemap'
	when lower(canonical_action) = 'missing canonical' then 'canonical url not found in crawl'
	when lower(crawl_action) like 'block crawl to:%' then 'subfolder receives no traffic'
	when lower(crawl_action) = 'noindex' then 'page receives no organic traffic'
	else '' end as top_admin_action_reason,
crawl_action,
CASE 
	WHEN lower(crawl_action) like '%missing from crawl%' THEN 'High'
	WHEN lower(crawl_action) like '%potential noindex%' THEN 'Medium'	
	ELSE '' END as crawl_action_priority,
http_status_action,
CASE WHEN lower(http_status_action) like '%redirect%' THEN 'High' ELSE '' END as http_status_action_priority,
sitemap_action,
CASE 
	WHEN lower(sitemap_action) like '%remove from sitemap%' or ( sitemap_action = 'likely add to sitemap' and pct_of_organic_sessions_30d > .05 )  THEN 'High'
	WHEN lower(sitemap_action) = 'likely add to sitemap' THEN 'Medium'
	ELSE '' END as sitemap_action_priority,
canonical_action,
CASE WHEN lower(canonical_action) in ('missing canonical', 'self-canonicalize, paginated page') THEN 'High' ELSE '' END as canonical_action_priority,
schema_action,
-- concat(content_action,meta_rewrite_action,pagination_action,external_link_action,schema_action) on_off_page_action,
concat(
	CASE WHEN content_action = '' THEN '' ELSE concat("content_action: ", content_action) END,
	CASE WHEN meta_rewrite_action = '' THEN '' ELSE concat("meta_rewrite_action: ", meta_rewrite_action) END,
	CASE WHEN external_link_action = '' THEN '' ELSE concat("external_link_action: ", external_link_action) END,
	CASE WHEN schema_action = '' THEN '' ELSE concat("schema_action: ", schema_action) END ) on_off_page_action,
concat(
	CASE WHEN internal_link_action = '' THEN '' ELSE concat("internal_link_action: ", internal_link_action) END,
	CASE WHEN category_action = '' THEN '' ELSE concat("category_action: ", category_action) END,
	CASE WHEN cannibalization_action = '' THEN '' ELSE concat("cannibalization_action: ", cannibalization_action) END ) architecture_action,
# analytics actions are separate from indicative actions - only display if admin_action in ('', 'add to sitemap', 'missing from crawl')
cannibalization_action,
content_trajectory,
content_action,
case when http_status_code = 200 then internal_link_action else '' end as internal_link_action,
case when http_status_code = 200 then external_link_action else '' end as external_link_action,
case when http_status_code = 200 then meta_rewrite_action else '' end as meta_rewrite_action,
case when http_status_code = 200 then category_action else '' end as category_action,
case when http_status_code = 200 then pagination_action else '' end as pagination_action,
url_protocol,
canonical_url_protocol,
protocol_match,
protocol_count,
first_subfolder,
second_subfolder,
last_subfolder,
http_status_code,
level,
schema_type,
header_content_type,
word_count, 
page_title,
title_contains_top_keyword,
page_title_length,
description,
description_contains_top_keyword,
description_length,
robots_noindex,
meta_noindex,
is_noindex,
redirected_to_url,
h1_tag,
h2_tag,
redirect_chain,
redirected_to_status_code,
is_redirect_loop,
duplicate_page,
duplicate_page_count,
duplicate_body,
duplicate_body_count,
sessions_30d,
pct_of_organic_sessions_30d,
transaction_revenue_30d,
transactions_30d,
pct_of_organic_transactions_30d,
ecommerce_conversion_rate_30d,
med_transaction_conversion_rate_30d,
goal_completions_all_goals_30d,
pct_of_organic_goal_completions_all_goals_30d,
goal_conversion_rate_all_goals_30d,
med_goal_conversion_rate_30d,
blended_conversions_30d,	
blended_conversion_rate_30d,
bounce_rate_30d,
avg_seconds_on_site_30d,
sessions_mom,
sessions_mom_pct,
transaction_revenue_mom,
transaction_revenue_mom_pct,
transactions_mom,
transactions_mom_pct,
goal_completions_all_goals_mom,
goal_completions_all_goals_mom_pct,
sessions_yoy,
sessions_yoy_pct,
transaction_revenue_yoy,
transaction_revenue_yoy_pct,
transactions_yoy,
transactions_yoy_pct,
goal_completions_all_goals_yoy,
goal_completions_all_goals_yoy_pct,
sessions_ttm,
transaction_revenue_ttm,
transactions_ttm,
ecommerce_conversion_rate_ttm,
goal_completions_all_goals_ttm,
goal_conversion_rate_all_goals_ttm,
bounce_rate_ttm,
avg_seconds_on_site_ttm,
gaining_traffic_mom,
gaining_traffic_yoy,
backlink_count,
ref_domain_count,
med_ref_domain_count,
internal_links_in_count,
internal_links_out_count,
impressions_30d,
pct_of_total_impressions_30d,
med_impressions_30d,
top_10pct_impressions_30d,
clicks_30d,
ctr_30d,
avg_position_30d,
impressions_mom,
impressions_mom_pct,
clicks_mom,
clicks_mom_pct,
ctr_mom,
ctr_mom_pct,
avg_position_mom,
impressions_yoy,
impressions_yoy_pct,
clicks_yoy,
ctr_yoy,	
ctr_yoy_pct,
avg_position_yoy,	
impressions_ttm,
clicks_ttm,
ctr_ttm,
avg_position_ttm,
top_3_keywords,
top_5_keywords,
top_10_keywords,
top_20_keywords,
main_keyword,
main_impressions,
main_clicks,
main_avg_position,
main_top_url,
main_keyword_cannibalization_flag,
main_top_url_clicks,
best_keyword,
best_impressions,
best_clicks,
best_avg_position,
best_top_url,
best_top_url_clicks,
best_keyword_cannibalization_flag
FROM `seo-data-pipeline-89`.`adp_thecifhw`.`actions_proc`
limit 500
/* limit added automatically by dbt cloud */
2021-10-13 16:37:33.896869 (Thread-20): handling poll request
2021-10-13 16:37:33.897347 (Thread-20): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '1cb576c2-9e3c-48a0-926e-3d919fe84600', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efd43bdfca0>]}
2021-10-13 16:37:33.900441 (Thread-20): sending response (<Response 9797 bytes [200 OK]>) to 10.0.3.143
2021-10-13 16:37:35.376574 (Thread-21): handling poll request
2021-10-13 16:37:35.377303 (Thread-21): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '1cb576c2-9e3c-48a0-926e-3d919fe84600', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efd43bdf700>]}
2021-10-13 16:37:35.378186 (Thread-21): sending response (<Response 404 bytes [200 OK]>) to 10.0.36.42
2021-10-13 16:37:36.639836 (Thread-1): finished collecting timing info
2021-10-13 16:37:37.139668 (Thread-22): handling poll request
2021-10-13 16:37:37.140100 (Thread-22): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '1cb576c2-9e3c-48a0-926e-3d919fe84600', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efd43fc6520>]}
2021-10-13 16:37:37.171399 (Thread-22): sending response (<Response 744100 bytes [200 OK]>) to 10.0.36.213
2021-10-13 21:55:34.371022 (MainThread): Running with dbt=0.18.1
2021-10-13 21:55:34.527638 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.rpc.server.RPCServerTask'>, debug=False, defer=None, exclude=None, host='0.0.0.0', log_cache_events=False, log_format='default', models=None, partial_parse=True, port=8580, profile='user', profiles_dir='/usr/src/develop/.dbt', project_dir=None, record_timing_info=None, rpc_method=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='rpc', write_json=True)
2021-10-13 21:55:34.546549 (MainThread): Tracking: tracking
2021-10-13 21:55:34.563565 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f89927606a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f896ddfe460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f896ddfe370>]}
2021-10-13 21:55:34.571406 (MainThread): Serving RPC server at 0.0.0.0:8580, pid=21
2021-10-13 21:55:34.571768 (MainThread): Supported methods: ['cli_args', 'compile', 'compile_sql', 'deps', 'docs.generate', 'gc', 'get-manifest', 'kill', 'poll', 'ps', 'run', 'run-operation', 'run_sql', 'seed', 'snapshot', 'snapshot-freshness', 'status', 'test']
2021-10-13 21:55:34.571981 (MainThread): Send requests to http://localhost:8580/jsonrpc
2021-10-13 21:55:34.606828 (Thread-12): Parsing macros/generate_schema_name.sql
2021-10-13 21:55:34.608367 (Thread-12): Parsing macros/catalog.sql
2021-10-13 21:55:34.614622 (Thread-12): Parsing macros/adapters.sql
2021-10-13 21:55:34.632344 (Thread-12): Parsing macros/etc.sql
2021-10-13 21:55:34.633549 (Thread-12): Parsing macros/materializations/table.sql
2021-10-13 21:55:34.642626 (Thread-12): Parsing macros/materializations/seed.sql
2021-10-13 21:55:34.645162 (Thread-12): Parsing macros/materializations/view.sql
2021-10-13 21:55:34.647770 (Thread-12): Parsing macros/materializations/snapshot.sql
2021-10-13 21:55:34.649508 (Thread-12): Parsing macros/materializations/incremental.sql
2021-10-13 21:55:34.661481 (Thread-12): Parsing macros/materializations/copy.sql
2021-10-13 21:55:34.666261 (Thread-12): Parsing macros/core.sql
2021-10-13 21:55:34.669691 (Thread-12): Parsing macros/materializations/helpers.sql
2021-10-13 21:55:34.677920 (Thread-12): Parsing macros/materializations/view/view.sql
2021-10-13 21:55:34.683824 (Thread-12): Parsing macros/materializations/view/create_or_replace_view.sql
2021-10-13 21:55:34.688815 (Thread-12): Parsing macros/materializations/seed/seed.sql
2021-10-13 21:55:34.708115 (Thread-12): Parsing macros/materializations/snapshot/strategies.sql
2021-10-13 21:55:34.723703 (Thread-12): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-10-13 21:55:34.725422 (Thread-12): Parsing macros/materializations/snapshot/snapshot.sql
2021-10-13 21:55:34.753188 (Thread-12): Parsing macros/materializations/table/table.sql
2021-10-13 21:55:34.759324 (Thread-12): Parsing macros/materializations/common/merge.sql
2021-10-13 21:55:34.772291 (Thread-12): Parsing macros/materializations/incremental/incremental.sql
2021-10-13 21:55:34.778151 (Thread-12): Parsing macros/materializations/incremental/helpers.sql
2021-10-13 21:55:34.779921 (Thread-12): Parsing macros/etc/get_custom_alias.sql
2021-10-13 21:55:34.780906 (Thread-12): Parsing macros/etc/datetime.sql
2021-10-13 21:55:34.789194 (Thread-12): Parsing macros/etc/query.sql
2021-10-13 21:55:34.790256 (Thread-12): Parsing macros/etc/get_custom_database.sql
2021-10-13 21:55:34.791915 (Thread-12): Parsing macros/etc/get_custom_schema.sql
2021-10-13 21:55:34.793857 (Thread-12): Parsing macros/etc/is_incremental.sql
2021-10-13 21:55:34.795458 (Thread-12): Parsing macros/adapters/common.sql
2021-10-13 21:55:34.836547 (Thread-12): Parsing macros/schema_tests/accepted_values.sql
2021-10-13 21:55:34.839152 (Thread-12): Parsing macros/schema_tests/not_null.sql
2021-10-13 21:55:34.840743 (Thread-12): Parsing macros/schema_tests/relationships.sql
2021-10-13 21:55:34.842533 (Thread-12): Parsing macros/schema_tests/unique.sql
2021-10-13 21:55:34.857746 (Thread-12): Parsing macros/logger/pretty_time.sql
2021-10-13 21:55:34.863395 (Thread-12): Parsing macros/logger/log_info.sql
2021-10-13 21:55:34.869464 (Thread-12): Parsing macros/logger/pretty_log_format.sql
2021-10-13 21:55:34.874723 (Thread-12): Parsing macros/sql/pivot.sql
2021-10-13 21:55:34.882712 (Thread-12): Parsing macros/sql/star.sql
2021-10-13 21:55:34.890267 (Thread-12): Parsing macros/sql/surrogate_key.sql
2021-10-13 21:55:34.898099 (Thread-12): Parsing macros/sql/get_query_results_as_dict.sql
2021-10-13 21:55:34.905410 (Thread-12): Parsing macros/sql/get_column_values.sql
2021-10-13 21:55:34.915315 (Thread-12): Parsing macros/sql/groupby.sql
2021-10-13 21:55:34.921128 (Thread-12): Parsing macros/sql/get_tables_by_pattern_sql.sql
2021-10-13 21:55:34.931359 (Thread-12): Parsing macros/sql/nullcheck_table.sql
2021-10-13 21:55:34.937180 (Thread-12): Parsing macros/sql/get_tables_by_prefix_sql.sql
2021-10-13 21:55:34.943135 (Thread-12): Parsing macros/sql/get_relations_by_pattern.sql
2021-10-13 21:55:34.950733 (Thread-12): Parsing macros/sql/get_relations_by_prefix.sql
2021-10-13 21:55:34.958948 (Thread-12): Parsing macros/sql/safe_add.sql
2021-10-13 21:55:34.965596 (Thread-12): Parsing macros/sql/unpivot.sql
2021-10-13 21:55:34.978573 (Thread-12): Parsing macros/sql/generate_series.sql
2021-10-13 21:55:34.987329 (Thread-12): Parsing macros/sql/nullcheck.sql
2021-10-13 21:55:34.993453 (Thread-12): Parsing macros/sql/union.sql
2021-10-13 21:55:35.008355 (Thread-12): Parsing macros/materializations/insert_by_period_materialization.sql
2021-10-13 21:55:35.036415 (Thread-12): Parsing macros/web/get_url_parameter.sql
2021-10-13 21:55:35.043177 (Thread-12): Parsing macros/web/get_url_path.sql
2021-10-13 21:55:35.051705 (Thread-12): Parsing macros/web/get_url_host.sql
2021-10-13 21:55:35.057945 (Thread-12): Parsing macros/datetime/date_spine.sql
2021-10-13 21:55:35.067550 (Thread-12): Parsing macros/schema_tests/expression_is_true.sql
2021-10-13 21:55:35.074612 (Thread-12): Parsing macros/schema_tests/not_constant.sql
2021-10-13 21:55:35.080191 (Thread-12): Parsing macros/schema_tests/at_least_one.sql
2021-10-13 21:55:35.086007 (Thread-12): Parsing macros/schema_tests/equality.sql
2021-10-13 21:55:35.094202 (Thread-12): Parsing macros/schema_tests/test_not_null_where.sql
2021-10-13 21:55:35.100028 (Thread-12): Parsing macros/schema_tests/equal_rowcount.sql
2021-10-13 21:55:35.106204 (Thread-12): Parsing macros/schema_tests/test_unique_where.sql
2021-10-13 21:55:35.112443 (Thread-12): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2021-10-13 21:55:35.123011 (Thread-12): Parsing macros/schema_tests/relationships_where.sql
2021-10-13 21:55:35.130304 (Thread-12): Parsing macros/schema_tests/unique_combination_of_columns.sql
2021-10-13 21:55:35.137686 (Thread-12): Parsing macros/schema_tests/recency.sql
2021-10-13 21:55:35.143666 (Thread-12): Parsing macros/schema_tests/cardinality_equality.sql
2021-10-13 21:55:35.150996 (Thread-12): Parsing macros/geo/haversine_distance.sql
2021-10-13 21:55:35.157354 (Thread-12): Parsing macros/cross_db_utils/split_part.sql
2021-10-13 21:55:35.163811 (Thread-12): Parsing macros/cross_db_utils/length.sql
2021-10-13 21:55:35.170364 (Thread-12): Parsing macros/cross_db_utils/current_timestamp.sql
2021-10-13 21:55:35.180834 (Thread-12): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2021-10-13 21:55:35.187367 (Thread-12): Parsing macros/cross_db_utils/right.sql
2021-10-13 21:55:35.193934 (Thread-12): Parsing macros/cross_db_utils/hash.sql
2021-10-13 21:55:35.199624 (Thread-12): Parsing macros/cross_db_utils/replace.sql
2021-10-13 21:55:35.205021 (Thread-12): Parsing macros/cross_db_utils/concat.sql
2021-10-13 21:55:35.211701 (Thread-12): Parsing macros/cross_db_utils/_is_relation.sql
2021-10-13 21:55:35.217143 (Thread-12): Parsing macros/cross_db_utils/identifier.sql
2021-10-13 21:55:35.223135 (Thread-12): Parsing macros/cross_db_utils/datediff.sql
2021-10-13 21:55:35.236690 (Thread-12): Parsing macros/cross_db_utils/dateadd.sql
2021-10-13 21:55:35.243125 (Thread-12): Parsing macros/cross_db_utils/datatypes.sql
2021-10-13 21:55:35.254258 (Thread-12): Parsing macros/cross_db_utils/position.sql
2021-10-13 21:55:35.260266 (Thread-12): Parsing macros/cross_db_utils/literal.sql
2021-10-13 21:55:35.265448 (Thread-12): Parsing macros/cross_db_utils/_is_ephemeral.sql
2021-10-13 21:55:35.271448 (Thread-12): Parsing macros/cross_db_utils/width_bucket.sql
2021-10-13 21:55:35.280830 (Thread-12): Parsing macros/cross_db_utils/date_trunc.sql
2021-10-13 21:55:35.286608 (Thread-12): Parsing macros/cross_db_utils/except.sql
2021-10-13 21:55:35.292104 (Thread-12): Parsing macros/cross_db_utils/safe_cast.sql
2021-10-13 21:55:35.298178 (Thread-12): Parsing macros/cross_db_utils/last_day.sql
2021-10-13 21:55:35.305202 (Thread-12): Parsing macros/cross_db_utils/intersect.sql
2021-10-13 21:55:35.466195 (Thread-12): Acquiring new bigquery connection "model.tech_audit.agg_all".
2021-10-13 21:55:35.496481 (Thread-12): Acquiring new bigquery connection "model.tech_audit.agg_traffic".
2021-10-13 21:55:35.517402 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_diffs_count".
2021-10-13 21:55:35.542919 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_diffs".
2021-10-13 21:55:35.560968 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_count".
2021-10-13 21:55:35.582978 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_data_studio".
2021-10-13 21:55:35.599244 (Thread-12): Acquiring new bigquery connection "model.tech_audit.domains_proc".
2021-10-13 21:55:35.613388 (Thread-12): Acquiring new bigquery connection "model.tech_audit.crawl_dates".
2021-10-13 21:55:35.629978 (Thread-12): Acquiring new bigquery connection "model.tech_audit.dates".
2021-10-13 21:55:35.649380 (Thread-12): Acquiring new bigquery connection "model.tech_audit.ga_stats".
2021-10-13 21:55:35.668262 (Thread-12): Acquiring new bigquery connection "model.tech_audit.ga_proc_url_mapping".
2021-10-13 21:55:35.685566 (Thread-12): Acquiring new bigquery connection "model.tech_audit.ga_proc".
2021-10-13 21:55:35.705360 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_keyword_stats".
2021-10-13 21:55:35.722514 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_url_proc_url_mapping".
2021-10-13 21:55:35.738889 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_url_keyword_stats".
2021-10-13 21:55:35.756719 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_keyword_proc_url_mapping".
2021-10-13 21:55:35.776154 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_url_stats".
2021-10-13 21:55:35.792859 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_keyword_proc".
2021-10-13 21:55:35.809011 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_url_proc".
2021-10-13 21:55:35.827752 (Thread-12): Acquiring new bigquery connection "model.tech_audit.deepcrawl_proc".
2021-10-13 21:55:35.847151 (Thread-12): Acquiring new bigquery connection "model.tech_audit.deepcrawl_latest_crawl_proc".
2021-10-13 21:55:35.864256 (Thread-12): Acquiring new bigquery connection "model.tech_audit.deepcrawl_url_proc".
2021-10-13 21:55:35.882544 (Thread-12): Acquiring new bigquery connection "model.tech_audit.deepcrawl_stats".
2021-10-13 21:55:35.901452 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_proc".
2021-10-13 21:55:35.919190 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_hierarchy".
2021-10-13 21:55:38.280072 (Thread-13): handling ps request
2021-10-13 21:55:38.281790 (Thread-13): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'd3ce682d-eb34-4153-be81-628028722ff8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f896cab9700>]}
2021-10-13 21:55:38.283388 (Thread-13): sending response (<Response 104 bytes [200 OK]>) to 10.0.31.113
2021-10-13 21:55:38.313880 (Thread-14): handling status request
2021-10-13 21:55:38.314169 (Thread-14): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'd3ce682d-eb34-4153-be81-628028722ff8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f896cb270d0>]}
2021-10-13 21:55:38.322898 (Thread-14): sending response (<Response 32943 bytes [200 OK]>) to 10.0.16.89
2021-10-13 21:55:38.463025 (Thread-15): handling status request
2021-10-13 21:55:38.463449 (Thread-15): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'd3ce682d-eb34-4153-be81-628028722ff8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f896caf45e0>]}
2021-10-13 21:55:38.471517 (Thread-15): sending response (<Response 32943 bytes [200 OK]>) to 10.0.46.62
2021-10-13 21:55:38.496312 (Thread-16): handling status request
2021-10-13 21:55:38.496673 (Thread-16): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'd3ce682d-eb34-4153-be81-628028722ff8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f896caa1f40>]}
2021-10-13 21:55:38.504543 (Thread-16): sending response (<Response 32943 bytes [200 OK]>) to 10.0.32.240
2021-10-13 21:55:38.524314 (Thread-17): handling status request
2021-10-13 21:55:38.524626 (Thread-17): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'd3ce682d-eb34-4153-be81-628028722ff8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f896cb278e0>]}
2021-10-13 21:55:38.532648 (Thread-17): sending response (<Response 32943 bytes [200 OK]>) to 10.0.10.146
2021-10-18 18:21:14.715855 (MainThread): Running with dbt=0.18.1
2021-10-18 18:21:14.878163 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.rpc.server.RPCServerTask'>, debug=False, defer=None, exclude=None, host='0.0.0.0', log_cache_events=False, log_format='default', models=None, partial_parse=True, port=8580, profile='user', profiles_dir='/usr/src/develop/.dbt', project_dir=None, record_timing_info=None, rpc_method=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='rpc', write_json=True)
2021-10-18 18:21:14.890346 (MainThread): Tracking: tracking
2021-10-18 18:21:14.910358 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf4ce595e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf304ac160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf304ac370>]}
2021-10-18 18:21:14.910772 (MainThread): Serving RPC server at 0.0.0.0:8580, pid=21
2021-10-18 18:21:14.911123 (MainThread): Supported methods: ['cli_args', 'compile', 'compile_sql', 'deps', 'docs.generate', 'gc', 'get-manifest', 'kill', 'poll', 'ps', 'run', 'run-operation', 'run_sql', 'seed', 'snapshot', 'snapshot-freshness', 'status', 'test']
2021-10-18 18:21:14.911374 (MainThread): Send requests to http://localhost:8580/jsonrpc
2021-10-18 18:21:14.949371 (Thread-12): Parsing macros/generate_schema_name.sql
2021-10-18 18:21:14.951178 (Thread-12): Parsing macros/catalog.sql
2021-10-18 18:21:14.957656 (Thread-12): Parsing macros/adapters.sql
2021-10-18 18:21:14.975729 (Thread-12): Parsing macros/etc.sql
2021-10-18 18:21:14.977081 (Thread-12): Parsing macros/materializations/table.sql
2021-10-18 18:21:14.986425 (Thread-12): Parsing macros/materializations/seed.sql
2021-10-18 18:21:14.989005 (Thread-12): Parsing macros/materializations/view.sql
2021-10-18 18:21:14.991676 (Thread-12): Parsing macros/materializations/snapshot.sql
2021-10-18 18:21:14.993439 (Thread-12): Parsing macros/materializations/incremental.sql
2021-10-18 18:21:15.005258 (Thread-12): Parsing macros/materializations/copy.sql
2021-10-18 18:21:15.010087 (Thread-12): Parsing macros/core.sql
2021-10-18 18:21:15.013549 (Thread-12): Parsing macros/materializations/helpers.sql
2021-10-18 18:21:15.021868 (Thread-12): Parsing macros/materializations/view/view.sql
2021-10-18 18:21:15.027859 (Thread-12): Parsing macros/materializations/view/create_or_replace_view.sql
2021-10-18 18:21:15.032505 (Thread-12): Parsing macros/materializations/seed/seed.sql
2021-10-18 18:21:15.051890 (Thread-12): Parsing macros/materializations/snapshot/strategies.sql
2021-10-18 18:21:15.068493 (Thread-12): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-10-18 18:21:15.070272 (Thread-12): Parsing macros/materializations/snapshot/snapshot.sql
2021-10-18 18:21:15.097120 (Thread-12): Parsing macros/materializations/table/table.sql
2021-10-18 18:21:15.103407 (Thread-12): Parsing macros/materializations/common/merge.sql
2021-10-18 18:21:15.116561 (Thread-12): Parsing macros/materializations/incremental/incremental.sql
2021-10-18 18:21:15.122291 (Thread-12): Parsing macros/materializations/incremental/helpers.sql
2021-10-18 18:21:15.124079 (Thread-12): Parsing macros/etc/get_custom_alias.sql
2021-10-18 18:21:15.125045 (Thread-12): Parsing macros/etc/datetime.sql
2021-10-18 18:21:15.133174 (Thread-12): Parsing macros/etc/query.sql
2021-10-18 18:21:15.134204 (Thread-12): Parsing macros/etc/get_custom_database.sql
2021-10-18 18:21:15.135816 (Thread-12): Parsing macros/etc/get_custom_schema.sql
2021-10-18 18:21:15.137689 (Thread-12): Parsing macros/etc/is_incremental.sql
2021-10-18 18:21:15.139265 (Thread-12): Parsing macros/adapters/common.sql
2021-10-18 18:21:15.179951 (Thread-12): Parsing macros/schema_tests/accepted_values.sql
2021-10-18 18:21:15.182610 (Thread-12): Parsing macros/schema_tests/not_null.sql
2021-10-18 18:21:15.184129 (Thread-12): Parsing macros/schema_tests/relationships.sql
2021-10-18 18:21:15.185949 (Thread-12): Parsing macros/schema_tests/unique.sql
2021-10-18 18:21:15.204187 (Thread-12): Parsing macros/logger/pretty_time.sql
2021-10-18 18:21:15.212781 (Thread-12): Parsing macros/logger/log_info.sql
2021-10-18 18:21:15.220658 (Thread-12): Parsing macros/logger/pretty_log_format.sql
2021-10-18 18:21:15.228913 (Thread-12): Parsing macros/sql/pivot.sql
2021-10-18 18:21:15.242500 (Thread-12): Parsing macros/sql/star.sql
2021-10-18 18:21:15.254142 (Thread-12): Parsing macros/sql/surrogate_key.sql
2021-10-18 18:21:15.266013 (Thread-12): Parsing macros/sql/get_query_results_as_dict.sql
2021-10-18 18:21:15.276720 (Thread-12): Parsing macros/sql/get_column_values.sql
2021-10-18 18:21:15.290752 (Thread-12): Parsing macros/sql/groupby.sql
2021-10-18 18:21:15.300719 (Thread-12): Parsing macros/sql/get_tables_by_pattern_sql.sql
2021-10-18 18:21:15.316570 (Thread-12): Parsing macros/sql/nullcheck_table.sql
2021-10-18 18:21:15.325152 (Thread-12): Parsing macros/sql/get_tables_by_prefix_sql.sql
2021-10-18 18:21:15.336432 (Thread-12): Parsing macros/sql/get_relations_by_pattern.sql
2021-10-18 18:21:15.347652 (Thread-12): Parsing macros/sql/get_relations_by_prefix.sql
2021-10-18 18:21:15.357582 (Thread-12): Parsing macros/sql/safe_add.sql
2021-10-18 18:21:15.366501 (Thread-12): Parsing macros/sql/unpivot.sql
2021-10-18 18:21:15.380106 (Thread-12): Parsing macros/sql/generate_series.sql
2021-10-18 18:21:15.391219 (Thread-12): Parsing macros/sql/nullcheck.sql
2021-10-18 18:21:15.400620 (Thread-12): Parsing macros/sql/union.sql
2021-10-18 18:21:15.416907 (Thread-12): Parsing macros/materializations/insert_by_period_materialization.sql
2021-10-18 18:21:15.449790 (Thread-12): Parsing macros/web/get_url_parameter.sql
2021-10-18 18:21:15.459001 (Thread-12): Parsing macros/web/get_url_path.sql
2021-10-18 18:21:15.469595 (Thread-12): Parsing macros/web/get_url_host.sql
2021-10-18 18:21:15.478930 (Thread-12): Parsing macros/datetime/date_spine.sql
2021-10-18 18:21:15.491102 (Thread-12): Parsing macros/schema_tests/expression_is_true.sql
2021-10-18 18:21:15.499561 (Thread-12): Parsing macros/schema_tests/not_constant.sql
2021-10-18 18:21:15.507662 (Thread-12): Parsing macros/schema_tests/at_least_one.sql
2021-10-18 18:21:15.516619 (Thread-12): Parsing macros/schema_tests/equality.sql
2021-10-18 18:21:15.527329 (Thread-12): Parsing macros/schema_tests/test_not_null_where.sql
2021-10-18 18:21:15.535545 (Thread-12): Parsing macros/schema_tests/equal_rowcount.sql
2021-10-18 18:21:15.544213 (Thread-12): Parsing macros/schema_tests/test_unique_where.sql
2021-10-18 18:21:15.553162 (Thread-12): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2021-10-18 18:21:15.566445 (Thread-12): Parsing macros/schema_tests/relationships_where.sql
2021-10-18 18:21:15.577077 (Thread-12): Parsing macros/schema_tests/unique_combination_of_columns.sql
2021-10-18 18:21:15.588657 (Thread-12): Parsing macros/schema_tests/recency.sql
2021-10-18 18:21:15.597165 (Thread-12): Parsing macros/schema_tests/cardinality_equality.sql
2021-10-18 18:21:15.607077 (Thread-12): Parsing macros/geo/haversine_distance.sql
2021-10-18 18:21:15.615411 (Thread-12): Parsing macros/cross_db_utils/split_part.sql
2021-10-18 18:21:15.624574 (Thread-12): Parsing macros/cross_db_utils/length.sql
2021-10-18 18:21:15.632746 (Thread-12): Parsing macros/cross_db_utils/current_timestamp.sql
2021-10-18 18:21:15.642544 (Thread-12): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2021-10-18 18:21:15.650144 (Thread-12): Parsing macros/cross_db_utils/right.sql
2021-10-18 18:21:15.659761 (Thread-12): Parsing macros/cross_db_utils/hash.sql
2021-10-18 18:21:15.667579 (Thread-12): Parsing macros/cross_db_utils/replace.sql
2021-10-18 18:21:15.675043 (Thread-12): Parsing macros/cross_db_utils/concat.sql
2021-10-18 18:21:15.684387 (Thread-12): Parsing macros/cross_db_utils/_is_relation.sql
2021-10-18 18:21:15.692899 (Thread-12): Parsing macros/cross_db_utils/identifier.sql
2021-10-18 18:21:15.701618 (Thread-12): Parsing macros/cross_db_utils/datediff.sql
2021-10-18 18:21:15.717850 (Thread-12): Parsing macros/cross_db_utils/dateadd.sql
2021-10-18 18:21:15.726597 (Thread-12): Parsing macros/cross_db_utils/datatypes.sql
2021-10-18 18:21:15.740193 (Thread-12): Parsing macros/cross_db_utils/position.sql
2021-10-18 18:21:15.747833 (Thread-12): Parsing macros/cross_db_utils/literal.sql
2021-10-18 18:21:15.755953 (Thread-12): Parsing macros/cross_db_utils/_is_ephemeral.sql
2021-10-18 18:21:15.764561 (Thread-12): Parsing macros/cross_db_utils/width_bucket.sql
2021-10-18 18:21:15.777253 (Thread-12): Parsing macros/cross_db_utils/date_trunc.sql
2021-10-18 18:21:15.785123 (Thread-12): Parsing macros/cross_db_utils/except.sql
2021-10-18 18:21:15.793756 (Thread-12): Parsing macros/cross_db_utils/safe_cast.sql
2021-10-18 18:21:15.804935 (Thread-12): Parsing macros/cross_db_utils/last_day.sql
2021-10-18 18:21:15.815066 (Thread-12): Parsing macros/cross_db_utils/intersect.sql
2021-10-18 18:21:15.998855 (Thread-12): Acquiring new bigquery connection "model.tech_audit.agg_all".
2021-10-18 18:21:16.030985 (Thread-12): Acquiring new bigquery connection "model.tech_audit.agg_traffic".
2021-10-18 18:21:16.054458 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_diffs_count".
2021-10-18 18:21:16.082742 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_diffs".
2021-10-18 18:21:16.104649 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_count".
2021-10-18 18:21:16.131675 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_data_studio".
2021-10-18 18:21:16.150555 (Thread-12): Acquiring new bigquery connection "model.tech_audit.domains_proc".
2021-10-18 18:21:16.167520 (Thread-12): Acquiring new bigquery connection "model.tech_audit.crawl_dates".
2021-10-18 18:21:16.187757 (Thread-12): Acquiring new bigquery connection "model.tech_audit.dates".
2021-10-18 18:21:16.207553 (Thread-12): Acquiring new bigquery connection "model.tech_audit.ga_stats".
2021-10-18 18:21:16.227846 (Thread-12): Acquiring new bigquery connection "model.tech_audit.ga_proc_url_mapping".
2021-10-18 18:21:16.246901 (Thread-12): Acquiring new bigquery connection "model.tech_audit.ga_proc".
2021-10-18 18:21:16.269489 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_keyword_stats".
2021-10-18 18:21:16.290348 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_url_proc_url_mapping".
2021-10-18 18:21:16.310910 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_url_keyword_stats".
2021-10-18 18:21:16.331475 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_keyword_proc_url_mapping".
2021-10-18 18:21:16.352018 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_url_stats".
2021-10-18 18:21:16.370993 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_keyword_proc".
2021-10-18 18:21:16.390996 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_url_proc".
2021-10-18 18:21:16.410059 (Thread-12): Acquiring new bigquery connection "model.tech_audit.deepcrawl_proc".
2021-10-18 18:21:16.431211 (Thread-12): Acquiring new bigquery connection "model.tech_audit.deepcrawl_latest_crawl_proc".
2021-10-18 18:21:16.451966 (Thread-12): Acquiring new bigquery connection "model.tech_audit.deepcrawl_url_proc".
2021-10-18 18:21:16.471231 (Thread-12): Acquiring new bigquery connection "model.tech_audit.deepcrawl_stats".
2021-10-18 18:21:16.492810 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_proc".
2021-10-18 18:21:16.513941 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_hierarchy".
2022-01-25 01:05:40.194821 (MainThread): Running with dbt=0.18.1
2022-01-25 01:05:40.349333 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.rpc.server.RPCServerTask'>, debug=False, defer=None, exclude=None, host='0.0.0.0', log_cache_events=False, log_format='default', models=None, partial_parse=True, port=8580, profile='user', profiles_dir='/usr/src/develop/.dbt', project_dir=None, record_timing_info=None, rpc_method=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='rpc', write_json=True)
2022-01-25 01:05:40.361792 (MainThread): Tracking: tracking
2022-01-25 01:05:40.380530 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe8a54e3a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe8a37a340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe892c0280>]}
2022-01-25 01:05:40.380932 (MainThread): Serving RPC server at 0.0.0.0:8580, pid=21
2022-01-25 01:05:40.381297 (MainThread): Supported methods: ['cli_args', 'compile', 'compile_sql', 'deps', 'docs.generate', 'gc', 'get-manifest', 'kill', 'poll', 'ps', 'run', 'run-operation', 'run_sql', 'seed', 'snapshot', 'snapshot-freshness', 'status', 'test']
2022-01-25 01:05:40.381505 (MainThread): Send requests to http://localhost:8580/jsonrpc
2022-01-25 01:05:40.407157 (Thread-12): Parsing macros/generate_schema_name.sql
2022-01-25 01:05:40.408767 (Thread-12): Parsing macros/catalog.sql
2022-01-25 01:05:40.415432 (Thread-12): Parsing macros/adapters.sql
2022-01-25 01:05:40.432569 (Thread-12): Parsing macros/etc.sql
2022-01-25 01:05:40.433752 (Thread-12): Parsing macros/materializations/table.sql
2022-01-25 01:05:40.442640 (Thread-12): Parsing macros/materializations/seed.sql
2022-01-25 01:05:40.445125 (Thread-12): Parsing macros/materializations/view.sql
2022-01-25 01:05:40.447657 (Thread-12): Parsing macros/materializations/snapshot.sql
2022-01-25 01:05:40.449386 (Thread-12): Parsing macros/materializations/incremental.sql
2022-01-25 01:05:40.460978 (Thread-12): Parsing macros/materializations/copy.sql
2022-01-25 01:05:40.465689 (Thread-12): Parsing macros/core.sql
2022-01-25 01:05:40.469023 (Thread-12): Parsing macros/materializations/helpers.sql
2022-01-25 01:05:40.477040 (Thread-12): Parsing macros/materializations/view/view.sql
2022-01-25 01:05:40.482699 (Thread-12): Parsing macros/materializations/view/create_or_replace_view.sql
2022-01-25 01:05:40.487198 (Thread-12): Parsing macros/materializations/seed/seed.sql
2022-01-25 01:05:40.505836 (Thread-12): Parsing macros/materializations/snapshot/strategies.sql
2022-01-25 01:05:40.520928 (Thread-12): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-01-25 01:05:40.522580 (Thread-12): Parsing macros/materializations/snapshot/snapshot.sql
2022-01-25 01:05:40.547992 (Thread-12): Parsing macros/materializations/table/table.sql
2022-01-25 01:05:40.554017 (Thread-12): Parsing macros/materializations/common/merge.sql
2022-01-25 01:05:40.566671 (Thread-12): Parsing macros/materializations/incremental/incremental.sql
2022-01-25 01:05:40.572162 (Thread-12): Parsing macros/materializations/incremental/helpers.sql
2022-01-25 01:05:40.573868 (Thread-12): Parsing macros/etc/get_custom_alias.sql
2022-01-25 01:05:40.574770 (Thread-12): Parsing macros/etc/datetime.sql
2022-01-25 01:05:40.582616 (Thread-12): Parsing macros/etc/query.sql
2022-01-25 01:05:40.583606 (Thread-12): Parsing macros/etc/get_custom_database.sql
2022-01-25 01:05:40.585182 (Thread-12): Parsing macros/etc/get_custom_schema.sql
2022-01-25 01:05:40.586977 (Thread-12): Parsing macros/etc/is_incremental.sql
2022-01-25 01:05:40.588498 (Thread-12): Parsing macros/adapters/common.sql
2022-01-25 01:05:40.627586 (Thread-12): Parsing macros/schema_tests/accepted_values.sql
2022-01-25 01:05:40.630209 (Thread-12): Parsing macros/schema_tests/not_null.sql
2022-01-25 01:05:40.631685 (Thread-12): Parsing macros/schema_tests/relationships.sql
2022-01-25 01:05:40.633479 (Thread-12): Parsing macros/schema_tests/unique.sql
2022-01-25 01:05:40.650128 (Thread-12): Parsing macros/logger/pretty_time.sql
2022-01-25 01:05:40.656925 (Thread-12): Parsing macros/logger/log_info.sql
2022-01-25 01:05:40.662839 (Thread-12): Parsing macros/logger/pretty_log_format.sql
2022-01-25 01:05:40.668951 (Thread-12): Parsing macros/sql/pivot.sql
2022-01-25 01:05:40.677513 (Thread-12): Parsing macros/sql/star.sql
2022-01-25 01:05:40.685438 (Thread-12): Parsing macros/sql/surrogate_key.sql
2022-01-25 01:05:40.694255 (Thread-12): Parsing macros/sql/get_query_results_as_dict.sql
2022-01-25 01:05:40.702433 (Thread-12): Parsing macros/sql/get_column_values.sql
2022-01-25 01:05:40.712414 (Thread-12): Parsing macros/sql/groupby.sql
2022-01-25 01:05:40.719300 (Thread-12): Parsing macros/sql/get_tables_by_pattern_sql.sql
2022-01-25 01:05:40.729442 (Thread-12): Parsing macros/sql/nullcheck_table.sql
2022-01-25 01:05:40.735932 (Thread-12): Parsing macros/sql/get_tables_by_prefix_sql.sql
2022-01-25 01:05:40.742065 (Thread-12): Parsing macros/sql/get_relations_by_pattern.sql
2022-01-25 01:05:40.750114 (Thread-12): Parsing macros/sql/get_relations_by_prefix.sql
2022-01-25 01:05:40.758436 (Thread-12): Parsing macros/sql/safe_add.sql
2022-01-25 01:05:40.765684 (Thread-12): Parsing macros/sql/unpivot.sql
2022-01-25 01:05:40.778292 (Thread-12): Parsing macros/sql/generate_series.sql
2022-01-25 01:05:40.788365 (Thread-12): Parsing macros/sql/nullcheck.sql
2022-01-25 01:05:40.795139 (Thread-12): Parsing macros/sql/union.sql
2022-01-25 01:05:40.807625 (Thread-12): Parsing macros/materializations/insert_by_period_materialization.sql
2022-01-25 01:05:40.835987 (Thread-12): Parsing macros/web/get_url_parameter.sql
2022-01-25 01:05:40.842384 (Thread-12): Parsing macros/web/get_url_path.sql
2022-01-25 01:05:40.850020 (Thread-12): Parsing macros/web/get_url_host.sql
2022-01-25 01:05:40.857300 (Thread-12): Parsing macros/datetime/date_spine.sql
2022-01-25 01:05:40.866432 (Thread-12): Parsing macros/schema_tests/expression_is_true.sql
2022-01-25 01:05:40.873737 (Thread-12): Parsing macros/schema_tests/not_constant.sql
2022-01-25 01:05:40.879806 (Thread-12): Parsing macros/schema_tests/at_least_one.sql
2022-01-25 01:05:40.886430 (Thread-12): Parsing macros/schema_tests/equality.sql
2022-01-25 01:05:40.895945 (Thread-12): Parsing macros/schema_tests/test_not_null_where.sql
2022-01-25 01:05:40.902680 (Thread-12): Parsing macros/schema_tests/equal_rowcount.sql
2022-01-25 01:05:40.910140 (Thread-12): Parsing macros/schema_tests/test_unique_where.sql
2022-01-25 01:05:40.917596 (Thread-12): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2022-01-25 01:05:40.929580 (Thread-12): Parsing macros/schema_tests/relationships_where.sql
2022-01-25 01:05:40.937811 (Thread-12): Parsing macros/schema_tests/unique_combination_of_columns.sql
2022-01-25 01:05:40.946414 (Thread-12): Parsing macros/schema_tests/recency.sql
2022-01-25 01:05:40.952741 (Thread-12): Parsing macros/schema_tests/cardinality_equality.sql
2022-01-25 01:05:40.960461 (Thread-12): Parsing macros/geo/haversine_distance.sql
2022-01-25 01:05:40.967662 (Thread-12): Parsing macros/cross_db_utils/split_part.sql
2022-01-25 01:05:40.974550 (Thread-12): Parsing macros/cross_db_utils/length.sql
2022-01-25 01:05:40.981296 (Thread-12): Parsing macros/cross_db_utils/current_timestamp.sql
2022-01-25 01:05:40.989537 (Thread-12): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2022-01-25 01:05:40.995834 (Thread-12): Parsing macros/cross_db_utils/right.sql
2022-01-25 01:05:41.002932 (Thread-12): Parsing macros/cross_db_utils/hash.sql
2022-01-25 01:05:41.010322 (Thread-12): Parsing macros/cross_db_utils/replace.sql
2022-01-25 01:05:41.016286 (Thread-12): Parsing macros/cross_db_utils/concat.sql
2022-01-25 01:05:41.022912 (Thread-12): Parsing macros/cross_db_utils/_is_relation.sql
2022-01-25 01:05:41.028563 (Thread-12): Parsing macros/cross_db_utils/identifier.sql
2022-01-25 01:05:41.035532 (Thread-12): Parsing macros/cross_db_utils/datediff.sql
2022-01-25 01:05:41.158591 (Thread-12): Parsing macros/cross_db_utils/dateadd.sql
2022-01-25 01:05:41.166012 (Thread-12): Parsing macros/cross_db_utils/datatypes.sql
2022-01-25 01:05:41.176909 (Thread-12): Parsing macros/cross_db_utils/position.sql
2022-01-25 01:05:41.183169 (Thread-12): Parsing macros/cross_db_utils/literal.sql
2022-01-25 01:05:41.189552 (Thread-12): Parsing macros/cross_db_utils/_is_ephemeral.sql
2022-01-25 01:05:41.196921 (Thread-12): Parsing macros/cross_db_utils/width_bucket.sql
2022-01-25 01:05:41.206323 (Thread-12): Parsing macros/cross_db_utils/date_trunc.sql
2022-01-25 01:05:41.212910 (Thread-12): Parsing macros/cross_db_utils/except.sql
2022-01-25 01:05:41.220211 (Thread-12): Parsing macros/cross_db_utils/safe_cast.sql
2022-01-25 01:05:41.227829 (Thread-12): Parsing macros/cross_db_utils/last_day.sql
2022-01-25 01:05:41.237298 (Thread-12): Parsing macros/cross_db_utils/intersect.sql
2022-01-25 01:05:41.302939 (Thread-12): Acquiring new bigquery connection "model.tech_audit.agg_all".
2022-01-25 01:05:41.345512 (Thread-12): Acquiring new bigquery connection "model.tech_audit.agg_traffic".
2022-01-25 01:05:41.374260 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_diffs_count".
2022-01-25 01:05:41.401953 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_diffs".
2022-01-25 01:05:41.421430 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_count".
2022-01-25 01:05:41.443739 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_data_studio".
2022-01-25 01:05:41.462230 (Thread-12): Acquiring new bigquery connection "model.tech_audit.domains_proc".
2022-01-25 01:05:41.477155 (Thread-12): Acquiring new bigquery connection "model.tech_audit.crawl_dates".
2022-01-25 01:05:41.494889 (Thread-12): Acquiring new bigquery connection "model.tech_audit.dates".
2022-01-25 01:05:41.513543 (Thread-12): Acquiring new bigquery connection "model.tech_audit.ga_stats".
2022-01-25 01:05:41.532230 (Thread-12): Acquiring new bigquery connection "model.tech_audit.ga_proc_url_mapping".
2022-01-25 01:05:41.549504 (Thread-12): Acquiring new bigquery connection "model.tech_audit.ga_proc".
2022-01-25 01:05:41.569493 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_keyword_stats".
2022-01-25 01:05:41.588342 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_url_proc_url_mapping".
2022-01-25 01:05:41.607693 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_url_keyword_stats".
2022-01-25 01:05:41.628419 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_keyword_proc_url_mapping".
2022-01-25 01:05:41.646683 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_url_stats".
2022-01-25 01:05:41.663606 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_keyword_proc".
2022-01-25 01:05:41.681793 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_url_proc".
2022-01-25 01:05:41.699492 (Thread-12): Acquiring new bigquery connection "model.tech_audit.deepcrawl_proc".
2022-01-25 01:05:41.719947 (Thread-12): Acquiring new bigquery connection "model.tech_audit.deepcrawl_latest_crawl_proc".
2022-01-25 01:05:41.738053 (Thread-12): Acquiring new bigquery connection "model.tech_audit.deepcrawl_url_proc".
2022-01-25 01:05:41.757591 (Thread-12): Acquiring new bigquery connection "model.tech_audit.deepcrawl_stats".
2022-01-25 01:05:41.777693 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_proc".
2022-01-25 01:05:41.798105 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_hierarchy".
2022-01-25 01:05:42.220053 (Thread-13): handling status request
2022-01-25 01:05:42.220535 (Thread-13): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe88f4f070>]}
2022-01-25 01:05:42.229474 (Thread-13): sending response (<Response 32943 bytes [200 OK]>) to 10.0.27.56
2022-01-25 01:05:42.230788 (Thread-14): handling status request
2022-01-25 01:05:42.231173 (Thread-14): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe88c3cd90>]}
2022-01-25 01:05:42.238988 (Thread-14): sending response (<Response 32943 bytes [200 OK]>) to 10.0.25.116
2022-01-25 01:05:42.272897 (Thread-15): handling status request
2022-01-25 01:05:42.273221 (Thread-15): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe8a319a30>]}
2022-01-25 01:05:42.280944 (Thread-15): sending response (<Response 32943 bytes [200 OK]>) to 10.0.25.116
2022-01-25 01:05:42.407903 (Thread-16): handling ps request
2022-01-25 01:05:42.408315 (Thread-16): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe88f4f640>]}
2022-01-25 01:05:42.409795 (Thread-16): sending response (<Response 104 bytes [200 OK]>) to 10.0.27.56
2022-01-25 01:57:52.662252 (Thread-17): handling status request
2022-01-25 01:57:52.664130 (Thread-17): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe8a37a700>]}
2022-01-25 01:57:52.672105 (Thread-17): sending response (<Response 32943 bytes [200 OK]>) to 10.0.24.39
2022-01-25 01:57:53.045602 (Thread-18): handling run_sql request
2022-01-25 01:57:53.046046 (Thread-18): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe88fa2ac0>]}
2022-01-25 01:57:53.048547 (Thread-18): Connection 'model.tech_audit.actions_hierarchy' was properly closed.
2022-01-25 01:57:53.872536 (Thread-18): sending response (<Response 137 bytes [200 OK]>) to 10.0.40.45
2022-01-25 01:57:53.892910 (MainThread): Acquiring new bigquery connection "rpc.tech_audit.request".
2022-01-25 01:57:53.913786 (MainThread): Found 25 models, 0 tests, 0 snapshots, 0 analyses, 327 macros, 0 operations, 0 seed files, 5 sources
2022-01-25 01:57:53.914299 (Thread-1): Acquiring new bigquery connection "rpc.tech_audit.request".
2022-01-25 01:57:53.914409 (Thread-1): Compiling rpc.tech_audit.request
2022-01-25 01:57:53.927115 (Thread-1): finished collecting timing info
2022-01-25 01:57:53.927368 (Thread-1): Opening a new connection, currently in state init
2022-01-25 01:57:53.927768 (Thread-1): On rpc.tech_audit.request: SELECT
site,
domain,
search_console_account,
google_analytics_account
FROM (

	SELECT
	distinct(client_name) site,
	trim(replace(replace(replace(domain,'www.',''),'http://',''),'https://',''),'/') domain,
	domain search_console_account,
	case when data_source = 'Google Analytics' then account end google_analytics_account,
	og_time_of_entry time_of_entry,
	first_value(og_time_of_entry) OVER (PARTITION BY client_name ORDER BY og_time_of_entry DESC) lv
	FROM `seo-data-pipeline-89.bq_sources.accounts`
	WHERE client_name is not null
)
WHERE lv = time_of_entry AND google_analytics_account is not null
group by site, domain, search_console_account, google_analytics_account
limit 500
/* limit added automatically by dbt cloud */
2022-01-25 01:57:54.247766 (Thread-19): handling poll request
2022-01-25 01:57:54.248231 (Thread-19): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe88ffc8e0>]}
2022-01-25 01:57:54.251317 (Thread-19): sending response (<Response 3315 bytes [200 OK]>) to 10.0.25.116
2022-01-25 01:57:54.723132 (Thread-1): Retry attempt 1 of 1 after error: BadRequest('GET https://bigquery.googleapis.com/bigquery/v2/projects/seo-data-pipeline-89/queries/36da4ff8-2598-48be-8934-0a0252c3f4fe?maxResults=0&location=US: Error while reading table: seo-data-pipeline-89.bq_sources.accounts, error message: Spreadsheet not found.')
2022-01-25 01:57:55.586075 (Thread-20): handling poll request
2022-01-25 01:57:55.586523 (Thread-20): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe88ff08e0>]}
2022-01-25 01:57:55.587530 (Thread-20): sending response (<Response 922 bytes [200 OK]>) to 10.0.24.171
2022-01-25 01:57:56.373833 (Thread-1): finished collecting timing info
2022-01-25 01:57:56.374180 (Thread-1): Got an exception: Database Error
  Error while reading table: seo-data-pipeline-89.bq_sources.accounts, error message: Spreadsheet not found.
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/bigquery/connections.py", line 103, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/bigquery/connections.py", line 442, in _retry_and_handle
    return retry.retry_target(
  File "/usr/local/lib/python3.8/dist-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/bigquery/connections.py", line 266, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/bigquery/connections.py", line 428, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/lib/python3.8/dist-packages/google/cloud/bigquery/job.py", line 3207, in result
    super(QueryJob, self).result(retry=retry, timeout=timeout)
  File "/usr/local/lib/python3.8/dist-packages/google/cloud/bigquery/job.py", line 812, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/lib/python3.8/dist-packages/google/api_core/future/polling.py", line 122, in result
    self._blocking_poll(timeout=timeout)
  File "/usr/local/lib/python3.8/dist-packages/google/cloud/bigquery/job.py", line 3103, in _blocking_poll
    super(QueryJob, self)._blocking_poll(timeout=timeout)
  File "/usr/local/lib/python3.8/dist-packages/google/api_core/future/polling.py", line 101, in _blocking_poll
    retry_(self._done_or_raise)()
  File "/usr/local/lib/python3.8/dist-packages/google/api_core/retry.py", line 281, in retry_wrapped_func
    return retry_target(
  File "/usr/local/lib/python3.8/dist-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/lib/python3.8/dist-packages/google/api_core/future/polling.py", line 80, in _done_or_raise
    if not self.done():
  File "/usr/local/lib/python3.8/dist-packages/google/cloud/bigquery/job.py", line 3083, in done
    self._query_results = self._client._get_query_results(
  File "/usr/local/lib/python3.8/dist-packages/google/cloud/bigquery/client.py", line 1288, in _get_query_results
    resource = self._call_api(
  File "/usr/local/lib/python3.8/dist-packages/google/cloud/bigquery/client.py", line 558, in _call_api
    return call()
  File "/usr/local/lib/python3.8/dist-packages/google/api_core/retry.py", line 281, in retry_wrapped_func
    return retry_target(
  File "/usr/local/lib/python3.8/dist-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/lib/python3.8/dist-packages/google/cloud/_http.py", line 423, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/seo-data-pipeline-89/queries/3c179edc-d681-46ee-80a4-ccfee0eeed9d?maxResults=0&location=US: Error while reading table: seo-data-pipeline-89.bq_sources.accounts, error message: Spreadsheet not found.

(job ID: 3c179edc-d681-46ee-80a4-ccfee0eeed9d)

                                   -----Query Job SQL Follows-----                                   

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:SELECT
   2:site,
   3:domain,
   4:search_console_account,
   5:google_analytics_account
   6:FROM (
   7:
   8:	SELECT
   9:	distinct(client_name) site,
  10:	trim(replace(replace(replace(domain,'www.',''),'http://',''),'https://',''),'/') domain,
  11:	domain search_console_account,
  12:	case when data_source = 'Google Analytics' then account end google_analytics_account,
  13:	og_time_of_entry time_of_entry,
  14:	first_value(og_time_of_entry) OVER (PARTITION BY client_name ORDER BY og_time_of_entry DESC) lv
  15:	FROM `seo-data-pipeline-89.bq_sources.accounts`
  16:	WHERE client_name is not null
  17:)
  18:WHERE lv = time_of_entry AND google_analytics_account is not null
  19:group by site, domain, search_console_account, google_analytics_account
  20:limit 500
  21:/* limit added automatically by dbt cloud */
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 333, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 276, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 378, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/rpc/node_runners.py", line 84, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 224, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/bigquery/connections.py", line 275, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/bigquery/connections.py", line 268, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/bigquery/connections.py", line 442, in _retry_and_handle
    return retry.retry_target(
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/bigquery/connections.py", line 107, in exception_handler
    self.handle_error(e, message)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/bigquery/connections.py", line 95, in handle_error
    raise DatabaseException(error_msg)
dbt.exceptions.DatabaseException: Database Error
  Error while reading table: seo-data-pipeline-89.bq_sources.accounts, error message: Spreadsheet not found.
2022-01-25 01:57:56.376876 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': 'Database Error in rpc request (from remote system)\n  Error while reading table: seo-data-pipeline-89.bq_sources.accounts, error message: Spreadsheet not found.', 'raw_sql': "SELECT\r\nsite,\r\ndomain,\r\nsearch_console_account,\r\ngoogle_analytics_account\r\nFROM (\r\n\r\n\tSELECT\r\n\tdistinct(client_name) site,\r\n\ttrim(replace(replace(replace(domain,'www.',''),'http://',''),'https://',''),'/') domain,\r\n\tdomain search_console_account,\r\n\tcase when data_source = 'Google Analytics' then account end google_analytics_account,\r\n\tog_time_of_entry time_of_entry,\r\n\tfirst_value(og_time_of_entry) OVER (PARTITION BY client_name ORDER BY og_time_of_entry DESC) lv\r\n\tFROM `seo-data-pipeline-89.bq_sources.accounts`\r\n\tWHERE client_name is not null\r\n)\r\nWHERE lv = time_of_entry AND google_analytics_account is not null\r\ngroup by site, domain, search_console_account, google_analytics_account\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "SELECT\r\nsite,\r\ndomain,\r\nsearch_console_account,\r\ngoogle_analytics_account\r\nFROM (\r\n\r\n\tSELECT\r\n\tdistinct(client_name) site,\r\n\ttrim(replace(replace(replace(domain,'www.',''),'http://',''),'https://',''),'/') domain,\r\n\tdomain search_console_account,\r\n\tcase when data_source = 'Google Analytics' then account end google_analytics_account,\r\n\tog_time_of_entry time_of_entry,\r\n\tfirst_value(og_time_of_entry) OVER (PARTITION BY client_name ORDER BY og_time_of_entry DESC) lv\r\n\tFROM `seo-data-pipeline-89.bq_sources.accounts`\r\n\tWHERE client_name is not null\r\n)\r\nWHERE lv = time_of_entry AND google_analytics_account is not null\r\ngroup by site, domain, search_console_account, google_analytics_account\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/rpc/sql_commands.py", line 145, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 349, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt/rpc/node_runners.py", line 52, in error_result
    raise error
dbt.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': 'Database Error in rpc request (from remote system)\n  Error while reading table: seo-data-pipeline-89.bq_sources.accounts, error message: Spreadsheet not found.', 'raw_sql': "SELECT\r\nsite,\r\ndomain,\r\nsearch_console_account,\r\ngoogle_analytics_account\r\nFROM (\r\n\r\n\tSELECT\r\n\tdistinct(client_name) site,\r\n\ttrim(replace(replace(replace(domain,'www.',''),'http://',''),'https://',''),'/') domain,\r\n\tdomain search_console_account,\r\n\tcase when data_source = 'Google Analytics' then account end google_analytics_account,\r\n\tog_time_of_entry time_of_entry,\r\n\tfirst_value(og_time_of_entry) OVER (PARTITION BY client_name ORDER BY og_time_of_entry DESC) lv\r\n\tFROM `seo-data-pipeline-89.bq_sources.accounts`\r\n\tWHERE client_name is not null\r\n)\r\nWHERE lv = time_of_entry AND google_analytics_account is not null\r\ngroup by site, domain, search_console_account, google_analytics_account\nlimit 500\n/* limit added automatically by dbt cloud */", 'compiled_sql': "SELECT\r\nsite,\r\ndomain,\r\nsearch_console_account,\r\ngoogle_analytics_account\r\nFROM (\r\n\r\n\tSELECT\r\n\tdistinct(client_name) site,\r\n\ttrim(replace(replace(replace(domain,'www.',''),'http://',''),'https://',''),'/') domain,\r\n\tdomain search_console_account,\r\n\tcase when data_source = 'Google Analytics' then account end google_analytics_account,\r\n\tog_time_of_entry time_of_entry,\r\n\tfirst_value(og_time_of_entry) OVER (PARTITION BY client_name ORDER BY og_time_of_entry DESC) lv\r\n\tFROM `seo-data-pipeline-89.bq_sources.accounts`\r\n\tWHERE client_name is not null\r\n)\r\nWHERE lv = time_of_entry AND google_analytics_account is not null\r\ngroup by site, domain, search_console_account, google_analytics_account\nlimit 500\n/* limit added automatically by dbt cloud */", 'tags': None}, None)
2022-01-25 01:57:56.920240 (Thread-21): handling poll request
2022-01-25 01:57:56.920700 (Thread-21): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe88cacbe0>]}
2022-01-25 01:57:56.921606 (Thread-21): sending response (<Response 17205 bytes [200 OK]>) to 10.0.0.123
2022-01-25 01:58:01.762291 (Thread-22): handling status request
2022-01-25 01:58:01.762720 (Thread-22): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe88c9bfa0>]}
2022-01-25 01:58:01.771472 (Thread-22): sending response (<Response 32943 bytes [200 OK]>) to 10.0.34.138
2022-01-25 01:58:02.112762 (Thread-23): handling run_sql request
2022-01-25 01:58:02.113204 (Thread-23): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe890345b0>]}
2022-01-25 01:58:02.943238 (Thread-23): sending response (<Response 137 bytes [200 OK]>) to 10.0.25.116
2022-01-25 01:58:02.963640 (MainThread): Acquiring new bigquery connection "rpc.tech_audit.request".
2022-01-25 01:58:02.984439 (MainThread): Found 25 models, 0 tests, 0 snapshots, 0 analyses, 327 macros, 0 operations, 0 seed files, 5 sources
2022-01-25 01:58:02.984865 (Thread-1): Acquiring new bigquery connection "rpc.tech_audit.request".
2022-01-25 01:58:02.984972 (Thread-1): Compiling rpc.tech_audit.request
2022-01-25 01:58:03.000622 (Thread-1): finished collecting timing info
2022-01-25 01:58:03.000954 (Thread-1): Opening a new connection, currently in state init
2022-01-25 01:58:03.001492 (Thread-1): On rpc.tech_audit.request: with deepcrawl as (

SELECT
    site,
    crawl_id,
    lag(crawl_id) over w1 previous_crawl_id,
    lead(crawl_id) over w1 next_crawl_id,
    crawl_report_month
    FROM (
      SELECT
      site,
      crawl_id,
      crawl_report_month
      FROM `seo-data-pipeline-89`.`adp_thecifhw`.`deepcrawl_proc`
      GROUP BY site, crawl_id, crawl_report_month
    )
    WINDOW w1 as (PARTITION BY site ORDER BY crawl_id asc)
)

SELECT
site,
run_date,
max(crawl_id_proc) crawl_id,
max(crawl_report_month_proc) crawl_report_month
FROM (

  SELECT
  site,
  run_date,
  crawl_report_month,
  CASE WHEN run_date = crawl_report_month THEN crawl_id
    WHEN crawl_report_month < run_date THEN crawl_id
    WHEN crawl_report_month > run_date and previous_crawl_id is null THEN crawl_id
    ELSE null END as crawl_id_proc,
  CASE WHEN run_date = crawl_report_month THEN crawl_report_month
    WHEN crawl_report_month < run_date THEN crawl_report_month
    WHEN crawl_report_month > run_date and previous_crawl_id is null THEN crawl_report_month
    ELSE null END as crawl_report_month_proc
  FROM (

    SELECT
    a.site,
    a.run_date,
    b.crawl_id,
    b.previous_crawl_id,
    b.next_crawl_id,
    b.crawl_report_month
    FROM `seo-data-pipeline-89`.`adp_thecifhw`.`dates` a
    JOIN deepcrawl b
    ON (
      a.site = b.site
    )
  )
)
GROUP BY site, run_date
limit 500
/* limit added automatically by dbt cloud */
2022-01-25 01:58:03.297081 (Thread-24): handling poll request
2022-01-25 01:58:03.297582 (Thread-24): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe88c89730>]}
2022-01-25 01:58:03.299472 (Thread-24): sending response (<Response 3988 bytes [200 OK]>) to 10.0.0.123
2022-01-25 01:58:04.629986 (Thread-25): handling poll request
2022-01-25 01:58:04.630419 (Thread-25): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe88c891f0>]}
2022-01-25 01:58:04.631324 (Thread-25): sending response (<Response 388 bytes [200 OK]>) to 10.0.11.77
2022-01-25 01:58:05.582913 (Thread-1): finished collecting timing info
2022-01-25 01:58:05.968966 (Thread-26): handling poll request
2022-01-25 01:58:05.969405 (Thread-26): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe88c890a0>]}
2022-01-25 01:58:05.973147 (Thread-26): sending response (<Response 9987 bytes [200 OK]>) to 10.0.7.136
2022-01-25 01:58:26.381108 (Thread-27): handling status request
2022-01-25 01:58:26.382800 (Thread-27): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe88c89dc0>]}
2022-01-25 01:58:26.391851 (Thread-27): sending response (<Response 32943 bytes [200 OK]>) to 10.0.0.123
2022-01-25 01:58:26.735505 (Thread-28): handling run_sql request
2022-01-25 01:58:26.735939 (Thread-28): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe88c89fd0>]}
2022-01-25 01:58:27.550816 (Thread-28): sending response (<Response 137 bytes [200 OK]>) to 10.0.41.222
2022-01-25 01:58:27.571374 (MainThread): Acquiring new bigquery connection "rpc.tech_audit.request".
2022-01-25 01:58:27.591579 (MainThread): Found 25 models, 0 tests, 0 snapshots, 0 analyses, 327 macros, 0 operations, 0 seed files, 5 sources
2022-01-25 01:58:27.592039 (Thread-1): Acquiring new bigquery connection "rpc.tech_audit.request".
2022-01-25 01:58:27.592147 (Thread-1): Compiling rpc.tech_audit.request
2022-01-25 01:58:27.607454 (Thread-1): finished collecting timing info
2022-01-25 01:58:27.607687 (Thread-1): Opening a new connection, currently in state init
2022-01-25 01:58:27.608055 (Thread-1): On rpc.tech_audit.request: WITH ga as (
	SELECT
	account,
	site,
	date,
	count(url) ga_count,
	null as gsc_count
	FROM `seo-data-pipeline-89`.`adp_thecifhw`.`ga_proc` 
	GROUP BY account, site, date
),

gsc as (
	SELECT
	account,
	site,
	date,
	null as ga_count,
	count(url) as gsc_count
	FROM `seo-data-pipeline-89`.`adp_thecifhw`.`search_console_url_proc` 
	GROUP BY account, site, date
)


SELECT
site,
run_date,
mom_date,
yoy_date,
unix_date(run_date) unix_run_date,
unix_date(mom_date) unix_mom_date,
unix_date(yoy_date) unix_yoy_date
FROM (

	SELECT
	site,
	date run_date,
	date_sub(max(date), INTERVAL 1 MONTH) mom_date,
	date_sub(max(date), INTERVAL 12 MONTH) yoy_date
	FROM (
	  SELECT
	  site,
	  date,
	  sum(ga_count) ga_count,
	  sum(gsc_count) gsc_count
	  from (
	    SELECT * FROM ga
	    UNION ALL
	    SELECT * FROM gsc
	    )
	  GROUP BY site, date 
	)
	WHERE ga_count > 0
	OR gsc_count > 0 
	GROUP BY site, date
)
limit 500
/* limit added automatically by dbt cloud */
2022-01-25 01:58:27.937030 (Thread-29): handling poll request
2022-01-25 01:58:27.937536 (Thread-29): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe88cfaaf0>]}
2022-01-25 01:58:27.939445 (Thread-29): sending response (<Response 3568 bytes [200 OK]>) to 10.0.13.8
2022-01-25 01:58:29.285692 (Thread-30): handling poll request
2022-01-25 01:58:29.286132 (Thread-30): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe88cfaee0>]}
2022-01-25 01:58:29.287034 (Thread-30): sending response (<Response 382 bytes [200 OK]>) to 10.0.40.45
2022-01-25 01:58:29.583148 (Thread-1): finished collecting timing info
2022-01-25 01:58:30.630567 (Thread-31): handling poll request
2022-01-25 01:58:30.631028 (Thread-31): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe88cfa0d0>]}
2022-01-25 01:58:30.634645 (Thread-31): sending response (<Response 8052 bytes [200 OK]>) to 10.0.44.76
2022-01-25 01:58:36.651641 (Thread-32): handling status request
2022-01-25 01:58:36.652073 (Thread-32): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe88ce8fa0>]}
2022-01-25 01:58:36.660652 (Thread-32): sending response (<Response 32943 bytes [200 OK]>) to 10.0.35.206
2022-01-25 01:58:37.006181 (Thread-33): handling run_sql request
2022-01-25 01:58:37.006623 (Thread-33): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe88cfa430>]}
2022-01-25 01:58:37.826605 (Thread-33): sending response (<Response 137 bytes [200 OK]>) to 10.0.27.85
2022-01-25 01:58:37.847368 (MainThread): Acquiring new bigquery connection "rpc.tech_audit.request".
2022-01-25 01:58:37.868020 (MainThread): Found 25 models, 0 tests, 0 snapshots, 0 analyses, 327 macros, 0 operations, 0 seed files, 5 sources
2022-01-25 01:58:37.868528 (Thread-1): Acquiring new bigquery connection "rpc.tech_audit.request".
2022-01-25 01:58:37.868639 (Thread-1): Compiling rpc.tech_audit.request
2022-01-25 01:58:37.884236 (Thread-1): finished collecting timing info
2022-01-25 01:58:37.884518 (Thread-1): Opening a new connection, currently in state init
2022-01-25 01:58:37.884920 (Thread-1): On rpc.tech_audit.request: SELECT DISTINCT * 
FROM (

    SELECT 
    domain,
    eventid,
    url,
    crawl_id,
    RANK () over (PARTITION BY domain, url, crawl_report_month ORDER BY crawl_id desc) as rank_crawl,
    RANK () over (PARTITION BY crawl_id, domain, url, crawl_report_month ORDER BY eventid asc) as rank_event,
    primary_url,
    canonical_url,  
    crawl_datetime,  
    crawl_date,
    crawl_month,
    crawl_report_month,
    found_at_sitemap,
    http_status_code,
    level,
    schema_type,
    header_content_type,
    word_count, 
    page_title,
    page_title_length,
    description,
    description_length,
    indexable,
    robots_noindex,
    meta_noindex,
    is_self_canonical,
    backlink_count,
    backlink_domain_count,
    redirected_to_url,
    found_at_url,
    rel_next_url,
    rel_prev_url,
    links_in_count,
    links_out_count,
    external_links_count,
    internal_links_count,
    h1_tag,
    h2_tag,
    redirect_chain,
    redirected_to_status_code,
    is_redirect_loop,
    duplicate_page,
    duplicate_page_count,
    duplicate_body,
    duplicate_body_count,
    form_submit,
    infinite_scroll,
    decimal_price,
    currency_price,
    google_maps,
    add_to_cart,
    learn_more,
    review,
    size,
    paginated_page     
    FROM 
     ( 
        --  SELECT 
        -- Crawl_id as crawl_id,
        -- regexp_extract(Url,r'^(?:https?:\/\/)?(?:www\.)?([^\/]+)') as domain,
        -- EventId as eventid,
        -- Crawl_Datetime as crawl_datetime,  
        -- cast(Crawl_Datetime as date) crawl_date,
        -- DATE_TRUNC(date( Crawl_Datetime ), month) as crawl_month,
        -- CASE WHEN extract(DAY from Crawl_Datetime) >= 15 THEN DATE_TRUNC(date( Crawl_Datetime ), month) ELSE date_sub(DATE_TRUNC(date( Crawl_Datetime ), month), INTERVAL 1 MONTH) END as crawl_report_month,
        -- Url as url,
        -- Primary_Url as primary_url,
        -- Canonical_Url as canonical_url,  
        -- Found_At_Sitemap as found_at_sitemap,
        -- Http_Status_Code as http_status_code,
        -- Level as level,
        -- Schema_Type as schema_type,
        -- Header_Content_Type as header_content_type,
        -- Word_Count as word_count, 
        -- Page_Title as page_title,
        -- Page_Title_Length as page_title_length,
        -- Description as description,
        -- Description_Length as description_length,
        -- Indexable as indexable,
        -- Robots_Noindex as robots_noindex,
        -- Meta_Noindex as meta_noindex,
        -- Is_Self_Canonical as is_self_canonical,
        -- Backlink_Count as  backlink_count,
        -- Backlink_Domain_Count as backlink_domain_count,
        -- Redirected_To_Url as redirected_to_url,
        -- Found_At_Url as found_at_url,
        -- Rel_Next_Url as rel_next_url,
        -- Rel_Prev_Url as rel_prev_url,
        -- Links_In_Count as links_in_count,
        -- Links_Out_Count as links_out_count,
        -- External_Links_Count as external_links_count,
        -- Internal_Links_Count as internal_links_count,
        -- H1_Tag as h1_tag,
        -- H2_Tag as h2_tag, 
        -- Redirect_Chain as redirect_chain,
        -- Redirected_To_Status_Code as redirected_to_status_code,
        -- Is_Redirect_Loop as is_redirect_loop,
        -- Duplicate_Page as duplicate_page,
        -- Duplicate_Page_Count as duplicate_page_count,
        -- Duplicate_Body as duplicate_body,
        -- Duplicate_Body_Count as duplicate_body_count,
        -- Form_Submit as form_submit,
        -- Infinite_Scroll as infinite_scroll,
        -- Decimal_Price as decimal_price,
        -- Currency_Price as currency_price,
        -- Google_Maps as google_maps,
        -- Add_To_Cart as add_to_cart,
        -- Learn_More as learn_more,
        -- Review as review,
        -- Size as size,
        -- Paginated_Page as paginated_page    
        -- FROM 
        --  `seo-data-pipeline-89.raw.deepcrawl`

        -- UNION ALL

        SELECT 
        crawl_id,
        regexp_extract(url,r'^(?:https?:\/\/)?(?:www\.)?([^\/]+)') as domain,
        1 as eventid,
        cast(crawl_datetime as timestamp) crawl_datetime, 
        cast(crawl_datetime as date) crawl_date,
        DATE_TRUNC(date( crawl_datetime ), month) as crawl_month,
        CASE WHEN extract(DAY from crawl_datetime) >= 15 THEN DATE_TRUNC(date( crawl_datetime ), month) ELSE date_sub(DATE_TRUNC(date( crawl_datetime ), month), INTERVAL 1 MONTH) END as crawl_report_month,
        url,
        primary_url,
        canonical_url,  
        found_at_sitemap,
        http_status_code,
        level,
        custom_extraction_7 schema_type,
        header_content_type,
        word_count, 
        page_title,
        page_title_length,
        description,
        description_length,
        indexable,
        robots_noindex,
        meta_noindex,
        is_self_canonical,
        CAST(backlink_count as int64) as backlink_count,
        CAST(backlink_domain_count AS int64) as backlink_domain_count,
        redirected_to_url,
        found_at_url,
        rel_next_url,
        rel_prev_url,
        links_in_count,
        links_out_count,
        external_links_count,
        internal_links_count,
        h1_tag,
        h2_tag,
        redirect_chain,
        redirected_to_status_code,
        is_redirect_loop,
        duplicate_page,
        duplicate_page_count,
        duplicate_body,
        duplicate_body_count,
        custom_extraction_10 as form_submit, -- qt_form_submit form_submit,
        custom_extraction_11 as infinite_scroll, -- qt_infinite_scroll infinite_scroll,
        custom_extraction_4 as decimal_price,
        custom_extraction_3 as currency_price,
        custom_extraction_12 google_maps, -- qt_google_maps google_maps,
        custom_extraction_2 add_to_cart, -- add_to_cart,
        custom_extraction_6 learn_more, -- learn_more,
        custom_extraction_5 review, -- review,
        custom_extraction_8 size, -- size,      
        paginated_page     
        FROM 
        `seo-data-pipeline-89`.`bq_sources`.`deepcrawl`  
     )
)

WHERE rank_crawl = 1 and rank_event =1
limit 500
/* limit added automatically by dbt cloud */
2022-01-25 01:58:38.187463 (Thread-34): handling poll request
2022-01-25 01:58:38.187942 (Thread-34): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe88ce80d0>]}
2022-01-25 01:58:38.189901 (Thread-34): sending response (<Response 8880 bytes [200 OK]>) to 10.0.41.222
2022-01-25 01:58:39.560643 (Thread-35): handling poll request
2022-01-25 01:58:39.561106 (Thread-35): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe88cd8df0>]}
2022-01-25 01:58:39.561964 (Thread-35): sending response (<Response 413 bytes [200 OK]>) to 10.0.42.85
2022-01-25 01:58:39.929832 (Thread-1): finished collecting timing info
2022-01-25 01:58:40.910635 (Thread-36): handling poll request
2022-01-25 01:58:40.911062 (Thread-36): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe890005b0>]}
2022-01-25 01:58:40.918884 (Thread-36): sending response (<Response 189191 bytes [200 OK]>) to 10.0.34.138
2022-01-25 01:59:05.167657 (Thread-37): handling status request
2022-01-25 01:59:05.169679 (Thread-37): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe89000190>]}
2022-01-25 01:59:05.177865 (Thread-37): sending response (<Response 32943 bytes [200 OK]>) to 10.0.13.8
2022-01-25 01:59:05.518995 (Thread-38): handling run_sql request
2022-01-25 01:59:05.519433 (Thread-38): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe89000160>]}
2022-01-25 01:59:06.342765 (Thread-38): sending response (<Response 137 bytes [200 OK]>) to 10.0.25.116
2022-01-25 01:59:06.364203 (MainThread): Acquiring new bigquery connection "rpc.tech_audit.request".
2022-01-25 01:59:06.388526 (MainThread): Found 25 models, 0 tests, 0 snapshots, 0 analyses, 327 macros, 0 operations, 0 seed files, 5 sources
2022-01-25 01:59:06.389053 (Thread-1): Acquiring new bigquery connection "rpc.tech_audit.request".
2022-01-25 01:59:06.389163 (Thread-1): Compiling rpc.tech_audit.request
2022-01-25 01:59:06.405515 (Thread-1): finished collecting timing info
2022-01-25 01:59:06.405766 (Thread-1): Opening a new connection, currently in state init
2022-01-25 01:59:06.406141 (Thread-1): On rpc.tech_audit.request: SELECT *
FROM (

  SELECT
  site,
  domain,
  crawl_id,
  eventid,
  urls_to_canonical,
  url_canonical_trailing_slash_match,
  max_trailing_slash_match,
  url,
  url_stripped,
  non_html_url,
  domain_canonical,
  canonical_url,
  canonical_url_stripped,
  query_string_url_first_param,
  query_string_url,
  query_string_canonical_url,  
  url_protocol,
  canonical_url_protocol,
  is_canonicalized,
  crawl_datetime,
  max(crawl_datetime) OVER w3 as latest_crawl_datetime,  
  first_value(query_string_url) over w4 as latest_query_string_url,
  crawl_date,
  crawl_month,
  crawl_report_month,
  found_at_sitemap,
  is_in_sitemap,
  sitemap_canonicalization_score,
  max_sitemap_canonicalization_score,
  http_status_code,
  level,
  schema_type,
  header_content_type,
  word_count, 
  page_title,
  page_title_length,
  description,
  description_length,
  indexable,
  robots_noindex,
  meta_noindex,
  is_self_canonical,
  backlink_count,
  backlink_domain_count,
  redirected_to_url,
  self_redirect,
  found_at_url,
  rel_next_url,
  rel_prev_url,
  links_in_count,
  links_out_count,
  external_links_count,
  internal_links_count,
  h1_tag,
  h2_tag,
  redirect_chain,
  redirected_to_status_code,
  is_redirect_loop,
  duplicate_page,
  duplicate_page_count,
  duplicate_body,
  duplicate_body_count,
  qt_dec_price,
  qt_cur_price,
  qt_add_to_cart,
  qt_google_maps,
  qt_learn_more,
  qt_reviews,
  qt_size,
  qt_form_submit,
  qt_infinite_scroll,
  decimal_price,
  currency_price,
  add_to_cart,
  learn_more,
  review,
  size,
  paginated_page
  FROM 
  (
    SELECT 
    eventid,
    b.site,
    a.domain,
    crawl_id,
    count(distinct(url)) over w2 urls_to_canonical, 
    url_canonical_trailing_slash_match,
    max(url_canonical_trailing_slash_match) over w2 as max_trailing_slash_match,
    url,  
    url_stripped,
    non_html_url,
    domain_canonical,
    canonical_url,
    canonical_url_stripped,
    query_string_url_first_param,
    query_string_url,
    query_string_canonical_url,  
    url_protocol,
    canonical_url_protocol,
    is_canonicalized,                 
    crawl_datetime,
    crawl_date,
    crawl_month,
    crawl_report_month,
    STRING_AGG (found_at_sitemap) over w1 as found_at_sitemap,
    is_in_sitemap,
    sitemap_canonicalization_score,
    max(sitemap_canonicalization_score) over w1 as max_sitemap_canonicalization_score,
    http_status_code,
    level,
    schema_type,
    header_content_type,
    word_count, 
    page_title,
    page_title_length,
    description,
    description_length,
    indexable,
    robots_noindex,
    meta_noindex,
    is_self_canonical,
    backlink_count,
    backlink_domain_count,
    redirected_to_url,
    self_redirect,
    max(found_at_url) over w1 as found_at_url,
    rel_next_url,
    rel_prev_url,
    links_in_count,
    links_out_count,
    external_links_count,
    internal_links_count,
    h1_tag,
    h2_tag,
    redirect_chain,
    redirected_to_status_code,
    is_redirect_loop,
    duplicate_page,
    duplicate_page_count,
    duplicate_body,
    duplicate_body_count,
    qt_dec_price,
    qt_cur_price,
    qt_add_to_cart,
    qt_google_maps,
    qt_learn_more,
    qt_reviews,
    qt_size,
    qt_form_submit,
    qt_infinite_scroll,
    decimal_price,
    currency_price,
    add_to_cart,
    learn_more,
    review,
    size,
    paginated_page
    FROM
    ( 

      SELECT
      eventid,
      domain,
      crawl_id,
      CASE WHEN url = canonical_url THEN url
          WHEN url_stripped = canonical_url_stripped AND query_string_url_first_param = query_string_canonical_url THEN canonical_url
          ELSE url_stripped
          END as url,
      url_stripped,
      non_html_url,
      domain_canonical,
      canonical_url,
      canonical_url_stripped,
      query_string_url_first_param,
      query_string_url,
      query_string_canonical_url,  
      url_protocol,
      canonical_url_protocol,
      is_canonicalized,  
      is_canonicalized + is_in_sitemap as sitemap_canonicalization_score,
      CASE WHEN substr(url_stripped,length(url),1) = substr(canonical_url_stripped,length(canonical_url),1) THEN 1 ELSE 0 END as url_canonical_trailing_slash_match,            
      crawl_datetime,
      crawl_date,
      crawl_month,
      crawl_report_month,
      found_at_sitemap,
      is_in_sitemap,
      http_status_code,
      level,
      schema_type,
      header_content_type,
      word_count, 
      page_title,
      page_title_length,
      description,
      description_length,
      indexable,
      robots_noindex,
      meta_noindex,
      is_self_canonical,
      backlink_count,
      backlink_domain_count,
      redirected_to_url,
      self_redirect,
      found_at_url,
      rel_next_url,
      rel_prev_url,
      links_in_count,
      links_out_count,
      external_links_count,
      internal_links_count,
      h1_tag,
      h2_tag,
      redirect_chain,
      redirected_to_status_code,
      is_redirect_loop,
      duplicate_page,
      duplicate_page_count,
      duplicate_body,
      duplicate_body_count,
      qt_dec_price,
      qt_cur_price,
      qt_add_to_cart,
      qt_google_maps,
      qt_learn_more,
      qt_reviews,
      qt_size,
      qt_form_submit,
      qt_infinite_scroll,
      decimal_price,
      currency_price,
      add_to_cart,
      learn_more,
      review,
      size,
      paginated_page 
      FROM 
      (   

        SELECT 
        eventid,
        crawl_id,
        lower(replace(replace(replace(url,'www.',''),'http://',''),'https://','')) as url,
        lower(regexp_replace(replace(replace(replace(url,'www.',''),'http://',''),'https://',''),r'\?.*$','')) as url_stripped,
        regexp_contains(url, '.img$|.png$|.jpg$|.css$.|js$|.pdf$') as non_html_url,
        domain,
        regexp_extract(canonical_url,r'^(?:https?:\/\/)?(?:www\.)?([^\/]+)') as domain_canonical,
        lower(replace(replace(replace(canonical_url,'www.',''),'http://',''),'https://','')) canonical_url,
        lower(regexp_replace(replace(replace(replace(canonical_url,'www.',''),'http://',''),'https://',''),r'\?.*$','')) as canonical_url_stripped,    
        ifnull(split(split(url, '?')[SAFE_ORDINAL(2)],'&')[SAFE_ORDINAL(1)], '') query_string_url_first_param,
        ifnull(split(url, '?')[SAFE_ORDINAL(2)], '') as query_string_url,
        ifnull(split(canonical_url, '?')[SAFE_ORDINAL(2)], '') as query_string_canonical_url,
        case when url like 'https%' then 'https' 
          when url like 'http%' then 'http'
          else 'none' end as url_protocol,
        case when canonical_url like 'https%' then 'https' 
          when canonical_url like 'http%' then 'http'
          else 'none' end as canonical_url_protocol, 
        case 
          when canonical_url is not null then 1
          else 0 end as is_canonicalized,
        crawl_datetime,  
        crawl_date,
        crawl_month,
        crawl_report_month,
        found_at_sitemap,
        case 
            when found_at_sitemap is not null then 1
            else 0 end as is_in_sitemap,
        http_status_code,
        level,
        lower(schema_type) schema_type,
        header_content_type,
        word_count, 
        page_title,
        page_title_length,
        description,
        description_length,
        indexable,
        robots_noindex,
        meta_noindex,
        is_self_canonical,
        cast(backlink_count as int64) backlink_count,
        cast(backlink_domain_count as int64) backlink_domain_count,
        redirected_to_url,
        CASE WHEN regexp_extract(trim(redirected_to_url, '/'),r'^(?:https?:\/\/)?(?:www\.)?([^\/]+)') = regexp_extract(url ,r'^(?:https?:\/\/)?(?:www\.)?([^\/]+)')
          OR regexp_extract(trim(url, '/'),r'^(?:https?:\/\/)?(?:www\.)?([^\/]+)') = regexp_extract(redirected_to_url ,r'^(?:https?:\/\/)?(?:www\.)?([^\/]+)')
          THEN 1 ELSE 0 END as self_redirect,
        found_at_url,
        rel_next_url,
        rel_prev_url,
        links_in_count,
        links_out_count,
        external_links_count,
        internal_links_count,
        lower(replace(replace(replace(h1_tag, "[\"",""),"\"]",""),'"','')) h1_tag,
        lower(replace(replace(replace(h2_tag, "[\"",""),"\"]",""),'"','')) h2_tag,
        redirect_chain,
        redirected_to_status_code,
        is_redirect_loop,
        duplicate_page,
        duplicate_page_count,
        duplicate_body,
        duplicate_body_count,
        form_submit,
        infinite_scroll,
        (LENGTH(decimal_price) - LENGTH(REGEXP_REPLACE(decimal_price, '"', '')))/2 as qt_dec_price,
        (LENGTH(currency_price) - LENGTH(REGEXP_REPLACE(currency_price, '"', '')))/2 as qt_cur_price,
        (LENGTH(add_to_cart) - LENGTH(REGEXP_REPLACE(add_to_cart, '"', '')))/2 as qt_add_to_cart,
        (LENGTH(Google_Maps) - LENGTH(REGEXP_REPLACE(Google_Maps, '"', '')))/2 as qt_google_maps,
        (LENGTH(Learn_More) - LENGTH(REGEXP_REPLACE(Learn_More, '"', '')))/2 as qt_learn_more,
        (LENGTH(Review) - LENGTH(REGEXP_REPLACE(Review, '"', '')))/2 as qt_reviews,
        (LENGTH(Size) - LENGTH(REGEXP_REPLACE(Size, '"', '')))/2 as qt_size,
        (LENGTH(form_submit) - LENGTH(REGEXP_REPLACE(form_submit, '"', '')))/2 as qt_form_submit,
        (LENGTH(infinite_scroll) - LENGTH(REGEXP_REPLACE(infinite_scroll, '"', '')))/2 as qt_infinite_scroll,
        decimal_price,
        currency_price,
        google_maps,
        add_to_cart,
        learn_more,
        review,
        size,
        paginated_page      
        FROM  `seo-data-pipeline-89`.`adp_thecifhw`.`deepcrawl_latest_crawl_proc` 
        WHERE url not like '%target=_blank%'
        AND ( url = primary_url OR primary_url is null )
        AND http_status_code not in (401, 403, 503)
        AND header_content_type = 'text/html'
        
          
      )
    )  a
    LEFT JOIN `seo-data-pipeline-89`.`adp_thecifhw`.`domains_proc` b
    ON (
      a.domain = b.domain
    )
    
    WHERE non_html_url = false
    WINDOW w1 as (PARTITION BY a.domain, crawl_report_month, url ),
    w2 as (PARTITION BY a.domain, crawl_id, canonical_url)
  )
  WHERE max_trailing_slash_match = url_canonical_trailing_slash_match
  AND sitemap_canonicalization_score = max_sitemap_canonicalization_score
  AND self_redirect = 0
  WINDOW w3 as (PARTITION BY domain, crawl_report_month, url),
  w4 as (PARTITION BY domain, crawl_report_month, url ORDER BY found_at_sitemap desc, is_canonicalized desc, crawl_datetime desc, eventid desc )

) 

WHERE latest_crawl_datetime = crawl_datetime
AND latest_query_string_url = query_string_url
GROUP BY   
site,
domain,
crawl_id,
eventid,
urls_to_canonical,
latest_crawl_datetime,  
latest_query_string_url,  
site,
url,
url_stripped,
non_html_url,
domain_canonical,
canonical_url,
canonical_url_stripped,
query_string_url_first_param,
query_string_url,
query_string_canonical_url,
url_protocol,
canonical_url_protocol,
is_canonicalized,
crawl_datetime,
crawl_date,
crawl_month,
crawl_report_month,
found_at_sitemap,
is_in_sitemap,
sitemap_canonicalization_score,
max_sitemap_canonicalization_score,
http_status_code,
level,
schema_type,
header_content_type,
word_count, 
page_title,
page_title_length,
description,
description_length,
indexable,
robots_noindex,
meta_noindex,
is_self_canonical,
backlink_count,
backlink_domain_count,
redirected_to_url,
self_redirect,
found_at_url,
rel_next_url,
rel_prev_url,
links_in_count,
links_out_count,
external_links_count,
internal_links_count,
h1_tag,
h2_tag,
redirect_chain,
redirected_to_status_code,
is_redirect_loop,
duplicate_page,
duplicate_page_count,
duplicate_body,
duplicate_body_count,
qt_dec_price,
qt_cur_price,
qt_add_to_cart,
qt_google_maps,
qt_learn_more,
qt_reviews,
qt_size,
qt_form_submit,
qt_infinite_scroll,
decimal_price,
currency_price,
add_to_cart,
learn_more,
review,
size,
paginated_page,
url_canonical_trailing_slash_match,
max_trailing_slash_match
limit 500
/* limit added automatically by dbt cloud */
2022-01-25 01:59:06.846063 (Thread-39): handling poll request
2022-01-25 01:59:06.846524 (Thread-39): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe88ffce50>]}
2022-01-25 01:59:06.848423 (Thread-39): sending response (<Response 14986 bytes [200 OK]>) to 10.0.27.56
2022-01-25 01:59:08.186568 (Thread-40): handling poll request
2022-01-25 01:59:08.187009 (Thread-40): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe88ffc1c0>]}
2022-01-25 01:59:08.187928 (Thread-40): sending response (<Response 400 bytes [200 OK]>) to 10.0.2.170
2022-01-25 01:59:09.687278 (Thread-1): finished collecting timing info
2022-01-25 01:59:09.938075 (Thread-41): handling poll request
2022-01-25 01:59:09.938503 (Thread-41): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe89052850>]}
2022-01-25 01:59:09.971669 (Thread-41): sending response (<Response 238055 bytes [200 OK]>) to 10.0.11.77
2022-01-25 01:59:16.477192 (Thread-42): handling status request
2022-01-25 01:59:16.477647 (Thread-42): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe890526d0>]}
2022-01-25 01:59:16.485930 (Thread-42): sending response (<Response 32943 bytes [200 OK]>) to 10.0.2.170
2022-01-25 01:59:16.835896 (Thread-43): handling run_sql request
2022-01-25 01:59:16.836345 (Thread-43): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe89052820>]}
2022-01-25 01:59:17.636052 (Thread-43): sending response (<Response 137 bytes [200 OK]>) to 10.0.25.116
2022-01-25 01:59:17.656462 (MainThread): Acquiring new bigquery connection "rpc.tech_audit.request".
2022-01-25 01:59:17.677278 (MainThread): Found 25 models, 0 tests, 0 snapshots, 0 analyses, 327 macros, 0 operations, 0 seed files, 5 sources
2022-01-25 01:59:17.677741 (Thread-1): Acquiring new bigquery connection "rpc.tech_audit.request".
2022-01-25 01:59:17.677845 (Thread-1): Compiling rpc.tech_audit.request
2022-01-25 01:59:17.693030 (Thread-1): finished collecting timing info
2022-01-25 01:59:17.693261 (Thread-1): Opening a new connection, currently in state init
2022-01-25 01:59:17.693648 (Thread-1): On rpc.tech_audit.request: SELECT 
a.crawl_id,
a.site,
b.run_date report_date,
a.crawl_datetime,
a.crawl_date,
domain,
domain_canonical,
url,
url_stripped,
canonical_url,
canonical_status,
url_protocol,
canonical_url_protocol,
protocol_match,
protocol_count,
path_count,
first_path,
second_path,
last_path,
filename,
last_subfolder,
last_subfolder_canonical,
first_subfolder,
second_subfolder,
urls_to_canonical,
found_at_sitemap,
http_status_code,
level,
schema_type,
header_content_type,
word_count, 
med_word_count,
replace(replace(page_title,'(',''),')','') page_title,
page_title_length,
replace(replace(description,'(',''),')','') description,
description_length,
indexable,
robots_noindex,
meta_noindex,
is_self_canonical,
backlink_count,
backlink_domain_count,
med_ref_domain_count,
bottom_quartile_ref_domain_count,
redirected_to_url,
found_at_url,
rel_next_url,
rel_prev_url,
links_in_count,
bottom_quartile_internal_links_in_count,
top_quartile_internal_links_in_count,
links_out_count,
bottom_quartile_internal_links_out_count,
external_links_count,
internal_links_count,
h1_tag,
h2_tag,
redirect_chain,
redirected_to_status_code,
is_redirect_loop,
duplicate_page,
duplicate_page_count,
duplicate_body,
duplicate_body_count,
class_path,
class_sitemap,
class_schema,
flag_google_maps,
flag_blog_path,
flag_blog_h1,
flag_high_word_count,
flag_thin_page,
flag_reviews,
flag_select_size,
flag_add_to_cart,
flag_prices,
flag_above_avg_prices,
flag_form_submit,
flag_learn_more,
flag_info_path,
flag_paginated,
case 
	WHEN http_status_code in (403, 404) THEN '' 	
	when first_path = '' then 'homepage'
  	when class_schema = 'category' then class_schema
	when class_sitemap in ('page','none','') and class_path in ('blog','category','author','event','local','info','product') then class_path
	when class_sitemap in ('page','none','') and class_schema is not null then class_schema
	when class_sitemap != 'page' and class_sitemap is not null then class_sitemap
	when class_path != '' then class_path
	else class_sitemap end as page_type

-- CASE WHEN http_status_code in (403, 404) THEN '' 
-- 	WHEN url = domain THEN 'homepage'
-- 	WHEN url like '%404%' THEN '404'
-- 	WHEN class_schema is not null THEN class_schema 
-- 	WHEN class_sitemap is not null THEN class_sitemap
-- 	WHEN flag_learn_more = 1 OR flag_paginated = 1 OR url like '%/category/%' THEN 'category'
-- 	WHEN (flag_reviews + flag_select_size + flag_add_to_cart + flag_prices) >= 2 THEN 'product'
-- 	WHEN flag_google_maps = 1 THEN 'local'
-- 	WHEN flag_form_submit = 1 THEN 'lead generation'
-- 	WHEN flag_thin_page = 1 THEN 'thin content'
-- 	ELSE 'general content' END as page_type 
FROM 
(
	SELECT 
	crawl_id,
	site,
	crawl_datetime,
	crawl_date,
	crawl_month,
	crawl_report_month,
	domain,
	domain_canonical,
	url,
	url_stripped,
	canonical_url,
	canonical_status,
	url_protocol,
	canonical_url_protocol,
	protocol_match,
	protocol_count,
	path_count,
	first_path,
	second_path,
	last_path,
	filename,
	last_subfolder,
	last_subfolder_canonical,
	first_subfolder,
	second_subfolder,
	urls_to_canonical,
	found_at_sitemap,
	http_status_code,
	level,
	schema_type,
	header_content_type,
	word_count, 
	med_word_count,
	page_title,
	page_title_length,
	description,
	description_length,
	indexable,
	robots_noindex,
	meta_noindex,
	is_self_canonical,
	backlink_count,
	backlink_domain_count,
	PERCENTILE_DISC(backlink_domain_count, 0.5 IGNORE NULLS) OVER w1 AS med_ref_domain_count,
	PERCENTILE_DISC(backlink_domain_count, 0.25 IGNORE NULLS) OVER w1 AS bottom_quartile_ref_domain_count,
	redirected_to_url,
	found_at_url,
	rel_next_url,
	rel_prev_url,
  	links_in_count,
  	PERCENTILE_DISC(links_in_count, 0.25 IGNORE NULLS) OVER w1 AS bottom_quartile_internal_links_in_count,
	PERCENTILE_DISC(links_in_count, 0.75 IGNORE NULLS) OVER w1 AS top_quartile_internal_links_in_count,
  	links_out_count,
  	PERCENTILE_DISC(internal_links_count, 0.25 IGNORE NULLS) OVER w1 AS bottom_quartile_internal_links_out_count,
  	external_links_count,
  	internal_links_count,	
	h1_tag,
	h2_tag,
	redirect_chain,
	redirected_to_status_code,
	is_redirect_loop,
	duplicate_page,
	duplicate_page_count,
	duplicate_body,
	duplicate_body_count,
	class_path,
	class_sitemap,
	class_schema,
	flag_google_maps,
	flag_blog_path,
	flag_blog_h1,
	flag_high_word_count,
	flag_thin_page,
	flag_reviews,
	flag_select_size,
	flag_add_to_cart,
	flag_prices,
	flag_above_avg_prices,
	flag_learn_more,
	flag_info_path,
	flag_form_submit,
	flag_paginated
	-- (flag_reviews + flag_select_size + flag_add_to_cart + flag_prices) as product_score,
	-- (flag_reviews + flag_select_size + flag_add_to_cart + flag_above_avg_prices) as category_score,
	-- (flag_blog_path + flag_blog_h1 + flag_high_word_count) as article_score
	FROM `seo-data-pipeline-89`.`adp_thecifhw`.`deepcrawl_url_proc`
	WINDOW w1 as (PARTITION BY domain, crawl_month)
) a
LEFT JOIN `seo-data-pipeline-89`.`adp_thecifhw`.`crawl_dates` b
ON (
	a.crawl_id = b.crawl_id AND
	a.site = b.site
)
WHERE (found_at_url is not null OR found_at_sitemap is not null)
limit 500
/* limit added automatically by dbt cloud */
2022-01-25 01:59:17.984454 (Thread-44): handling poll request
2022-01-25 01:59:17.984945 (Thread-44): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe890ba0a0>]}
2022-01-25 01:59:17.986790 (Thread-44): sending response (<Response 7929 bytes [200 OK]>) to 10.0.13.8
2022-01-25 01:59:19.336606 (Thread-45): handling poll request
2022-01-25 01:59:19.337061 (Thread-45): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efeb5f45640>]}
2022-01-25 01:59:19.337932 (Thread-45): sending response (<Response 401 bytes [200 OK]>) to 10.0.27.56
2022-01-25 01:59:20.035821 (Thread-1): finished collecting timing info
2022-01-25 01:59:20.685255 (Thread-46): handling poll request
2022-01-25 01:59:20.685680 (Thread-46): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe890865b0>]}
2022-01-25 01:59:20.706166 (Thread-46): sending response (<Response 525123 bytes [200 OK]>) to 10.0.42.85
2022-01-25 01:59:55.060707 (Thread-47): handling status request
2022-01-25 01:59:55.062302 (Thread-47): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe89086100>]}
2022-01-25 01:59:55.070265 (Thread-47): sending response (<Response 32943 bytes [200 OK]>) to 10.0.27.85
2022-01-25 01:59:55.473332 (Thread-48): handling run_sql request
2022-01-25 01:59:55.473777 (Thread-48): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe89082b80>]}
2022-01-25 01:59:56.292455 (Thread-48): sending response (<Response 137 bytes [200 OK]>) to 10.0.44.76
2022-01-25 01:59:56.313453 (MainThread): Acquiring new bigquery connection "rpc.tech_audit.request".
2022-01-25 01:59:56.333608 (MainThread): Found 25 models, 0 tests, 0 snapshots, 0 analyses, 327 macros, 0 operations, 0 seed files, 5 sources
2022-01-25 01:59:56.334062 (Thread-1): Acquiring new bigquery connection "rpc.tech_audit.request".
2022-01-25 01:59:56.334168 (Thread-1): Compiling rpc.tech_audit.request
2022-01-25 01:59:56.348739 (Thread-1): finished collecting timing info
2022-01-25 01:59:56.348971 (Thread-1): Opening a new connection, currently in state init
2022-01-25 01:59:56.349339 (Thread-1): On rpc.tech_audit.request: select
crawl_id,
site,
domain,
domain_canonical,
crawl_datetime,
crawl_date,
crawl_month,
crawl_report_month,
url,
url_stripped,
canonical_url,
canonical_status,
path_count,
ifnull(first_path, '') first_path,
ifnull(second_path, '') second_path,
ifnull(last_path, '') last_path,
ifnull(split(split(last_path,'.')[SAFE_ORDINAL(2)],'?')[SAFE_ORDINAL(1)],'') as filename,
trim(replace(url, last_path, ''),'/') last_subfolder,
trim(replace(canonical_url, last_path, ''),'/') last_subfolder_canonical,
case when trim(replace(url, last_path, ''),'/') = domain then domain else concat(domain,'/',first_path) end as first_subfolder,
case when trim(replace(url, last_path, ''),'/') = domain then domain 
  when second_path is not null then concat(domain,'/',first_path,'/',second_path) 
  else '' end as second_subfolder,
urls_to_canonical,
url_protocol,
canonical_url_protocol,
case when url_protocol = canonical_url_protocol then 1 else 0 end as protocol_match,
count(distinct(url_protocol)) over (partition by url) protocol_count,
found_at_sitemap,
http_status_code,
level,
schema_type,
header_content_type,
word_count, 
med_word_count,
lower(page_title) page_title,
page_title_length,
lower(description) description,
description_length,
indexable,
robots_noindex,
meta_noindex,
is_self_canonical,
backlink_count,
backlink_domain_count,
redirected_to_url,
found_at_url,
rel_next_url,
rel_prev_url,
links_in_count,
links_out_count,
external_links_count,
internal_links_count,
h1_tag,
h2_tag,
redirect_chain,
redirected_to_status_code,
is_redirect_loop,
duplicate_page,
duplicate_page_count,
duplicate_body,
duplicate_body_count,
case 
  when first_path like '%category%' then 'category'
  when first_path like '%blog%' or first_path like '%resource%' or first_path like '%article%' then 'blog'
  when first_path like '%product%' then 'product'
  when first_path like '%author%' then 'author'
  when first_path like '%location%' or first_path like '%stores%' then 'local'
  when regexp_contains(first_path, r'sitemap|cart|disclaimer|customer-service|returns|faq|warranty|affiliate|loyalty|register|wholesale|account|wishlist|jobs|password|contact|login|signup|privacy|about') then 'info'
  when second_path = '' or second_path is null then 'page'
  else first_path end as class_path,
case when found_at_sitemap is null then null
  when found_at_sitemap like '%category%' then 'category'
  when found_at_sitemap like '%product%' then 'product'
  when found_at_sitemap like '%author%' then 'author'  
  when found_at_sitemap like '%post%' then 'blog'
  when found_at_sitemap like '%location%' then 'local'
  when found_at_sitemap like '%page%' then 'page'
  else null end as class_sitemap,
case when schema_type like '%product%' then 'product'
  when schema_type like '%collection%' or schema_type like '%category%' then 'category'
  when schema_type like '%author%' then 'author'  
  when ( schema_type like '%creativework%' or schema_type like '%blog%' or schema_type like '%article%') then 'blog'
  when schema_type like '%event%' then 'event'
  when schema_type like '%local%' or schema_type like '%place%' then 'local'
  else null end as class_schema,
case when qt_google_maps > min_google_maps then 1 else 0 end as flag_google_maps,
case when qt_cur_price > min_cur_price then 1 else 0 end as flag_prices,
case when qt_cur_price > avg_cur_price then 1 else 0 end as flag_above_avg_prices,
case when qt_cur_price = min_cur_price then 1 else 0 end as flag_min_prices,
case when qt_add_to_cart > min_add_to_cart then 1 else 0 end as flag_add_to_cart,
case when qt_reviews > min_reviews then 1 else 0 end as flag_reviews,
case when qt_size > min_size then 1 else 0 end as flag_select_size,
case when qt_learn_more > med_learn_more then 1 else 0 end as flag_learn_more,
case when med_word_count > word_count then 1 else 0 end as flag_high_word_count,
case when word_count < 500 then 1 else 0 end as flag_thin_page,
case when qt_form_submit > min_form_submit then 1 else 0 end as flag_form_submit,
case when regexp_contains(url, r'/blog|blog.|resource|article|knowledge') then 1 else 0 end as flag_blog_path,
case when regexp_contains(h1_tag, r'/blog|blog.|resource|article|knowledge') then 1 else 0 end as flag_blog_h1,
case when regexp_contains(url, r'sitemap|customer-service|returns|affiliate|loyalty|register|wholesale|about-us|help|account|wishlist|jobs|password|contact|stores|login|signup') then 1 else 0 end as flag_info_path,
case when rel_next_url is not null or rel_prev_url is not null or paginated_page = true then 1 else 0 end as flag_paginated 

FROM 
 (
  SELECT
  crawl_id,
  site,
  domain,
  domain_canonical,
  crawl_datetime,
  extract(date from crawl_datetime) crawl_date, 
  extract(month from crawl_datetime) crawl_month,
    extract(month from crawl_datetime) crawl_report_month,
  url,
  url_stripped,
  canonical_url,
  ARRAY_LENGTH(SPLIT(url, '/')) path_count,
  SPLIT(url, '/')[SAFE_ORDINAL(2)] first_path,
  SPLIT(url, '/')[SAFE_ORDINAL(3)] second_path,
  ARRAY_REVERSE(SPLIT(url, '/'))[SAFE_ORDINAL(1)] last_path,
  ARRAY_REVERSE(SPLIT(canonical_url, '/'))[SAFE_ORDINAL(1)] last_path_canonical,
  urls_to_canonical,
  case when url = canonical_url then 'self'
    when canonical_url = '' or canonical_url is null then 'missing_canonical'
    else 'canonicalized' end as canonical_status,
  url_protocol,
  canonical_url_protocol,
  found_at_sitemap,
  http_status_code,
  level,
  schema_type,
  header_content_type,
  word_count, 
  page_title,
  page_title_length,
  description,
  description_length,
  indexable,
  robots_noindex,
  meta_noindex,
  is_self_canonical,
  backlink_count,
  backlink_domain_count,
  redirected_to_url,
  found_at_url,
  rel_next_url,
  rel_prev_url,
  links_in_count,
  links_out_count,
  external_links_count,
  internal_links_count,
  h1_tag,
  h2_tag,
  redirect_chain,
  redirected_to_status_code,
  is_redirect_loop,
  duplicate_page,
  duplicate_page_count,
  duplicate_body,
  duplicate_body_count,
  PERCENTILE_DISC(word_count, 0.5 RESPECT NULLS) OVER w2 AS med_word_count,
  qt_dec_price,
  min(qt_dec_price) OVER w1 AS min_dec_price,
  avg(qt_dec_price) OVER w1 AS avg_dec_price,
  PERCENTILE_DISC(qt_dec_price, 0.5 RESPECT NULLS) OVER w2 AS med_dec_price,
  qt_cur_price,
  min(qt_cur_price) OVER w1 AS min_cur_price,
  avg(qt_cur_price) OVER w1 AS avg_cur_price,
  PERCENTILE_DISC(qt_cur_price, 0.5 RESPECT NULLS) OVER w2 AS med_cur_price,
  qt_add_to_cart,
  min(qt_add_to_cart) OVER w1 AS min_add_to_cart,
  qt_reviews,
  min(qt_reviews) OVER w1 AS min_reviews,
  qt_size,
  min(qt_size) OVER w1 AS min_size,
  qt_google_maps,
  min(qt_google_maps) OVER w1 AS min_google_maps,
  qt_learn_more,
  PERCENTILE_CONT(qt_learn_more, .5) OVER w2 AS med_learn_more,
  qt_form_submit,
  min(qt_form_submit) OVER w1 AS min_form_submit,
  qt_infinite_scroll,
  paginated_page
  FROM `seo-data-pipeline-89`.`adp_thecifhw`.`deepcrawl_proc` 
  WINDOW w1 as (PARTITION BY domain, extract(date from crawl_datetime), header_content_type, http_status_code ORDER BY domain desc),
  w2 as (PARTITION BY domain, extract(date from crawl_datetime), header_content_type, http_status_code)

  )
limit 500
/* limit added automatically by dbt cloud */
2022-01-25 01:59:56.644899 (Thread-49): handling poll request
2022-01-25 01:59:56.645367 (Thread-49): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe8906e670>]}
2022-01-25 01:59:56.647265 (Thread-49): sending response (<Response 9921 bytes [200 OK]>) to 10.0.32.47
2022-01-25 01:59:58.073790 (Thread-50): handling poll request
2022-01-25 01:59:58.074225 (Thread-50): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe8906e220>]}
2022-01-25 01:59:58.075120 (Thread-50): sending response (<Response 404 bytes [200 OK]>) to 10.0.40.45
2022-01-25 01:59:59.063464 (Thread-1): finished collecting timing info
2022-01-25 01:59:59.469143 (Thread-51): handling poll request
2022-01-25 01:59:59.469604 (Thread-51): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe89069970>]}
2022-01-25 01:59:59.479386 (Thread-51): sending response (<Response 201044 bytes [200 OK]>) to 10.0.32.47
2022-01-25 02:00:03.285881 (Thread-52): handling status request
2022-01-25 02:00:03.286322 (Thread-52): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe890696d0>]}
2022-01-25 02:00:03.294700 (Thread-52): sending response (<Response 32943 bytes [200 OK]>) to 10.0.24.39
2022-01-25 02:00:03.731000 (Thread-53): handling run_sql request
2022-01-25 02:00:03.731450 (Thread-53): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe88c65880>]}
2022-01-25 02:00:04.564186 (Thread-53): sending response (<Response 137 bytes [200 OK]>) to 10.0.2.170
2022-01-25 02:00:04.584191 (MainThread): Acquiring new bigquery connection "rpc.tech_audit.request".
2022-01-25 02:00:04.605025 (MainThread): Found 25 models, 0 tests, 0 snapshots, 0 analyses, 327 macros, 0 operations, 0 seed files, 5 sources
2022-01-25 02:00:04.605566 (Thread-1): Acquiring new bigquery connection "rpc.tech_audit.request".
2022-01-25 02:00:04.605680 (Thread-1): Compiling rpc.tech_audit.request
2022-01-25 02:00:04.621404 (Thread-1): finished collecting timing info
2022-01-25 02:00:04.621684 (Thread-1): Opening a new connection, currently in state init
2022-01-25 02:00:04.622099 (Thread-1): On rpc.tech_audit.request: SELECT
site, 
domain,
account,
date,
unix_date,
url,
sum(sessions) sessions,
sum(transaction_revenue) transaction_revenue,
sum(transactions) transactions,
CASE WHEN sum(sessions) > 0 THEN sum(transactions) / sum(sessions) ELSE 0 END as ecommerce_conversion_rate,
sum(goal_completions_all_goals) goal_completions_all_goals,
CASE WHEN sum(sessions) > 0 THEN sum(goal_completions_all_goals) / sum(sessions) ELSE 0 END as goal_conversion_rate_all_goals,
CASE WHEN sum(sessions) > 0 THEN sum(bounces) / sum(sessions) ELSE null END as bounce_rate,
CASE WHEN sum(sessions) > 0 THEN sum(seconds_on_site)/sum(sessions) ELSE null END as avg_seconds_on_site
FROM (

    SELECT
    a.site, 
    a.domain,
    a.account,
    a.date,
    unix_date,
    CASE WHEN b.url is not null THEN b.url
        ELSE regexp_replace(a.url, r'\?.*$', '') END as url,
        -- WHEN regexp_contains(a.url, r'^.*\/([^\/]+?\.[^\/]+)$') THEN regexp_replace(a.url, r'\?.*$', '')
        -- ELSE trim(regexp_replace(a.url, r'\?.*$',''),'/') END as url,        
    sessions,
    transaction_revenue,
    transactions,
    goal_completions_all_goals,
    seconds_on_site,
    bounces
    FROM `seo-data-pipeline-89`.`adp_thecifhw`.`ga_proc` a
    LEFT JOIN `seo-data-pipeline-89`.`adp_thecifhw`.`deepcrawl_stats` b
    ON (
        a.date = b.report_date AND 
        a.site = b.site AND 
         a.url = b.url 
    )
)
GROUP BY site, domain, account, date, unix_date, url
limit 500
/* limit added automatically by dbt cloud */
2022-01-25 02:00:04.914484 (Thread-54): handling poll request
2022-01-25 02:00:04.914968 (Thread-54): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe883ce220>]}
2022-01-25 02:00:04.916912 (Thread-54): sending response (<Response 4075 bytes [200 OK]>) to 10.0.35.206
2022-01-25 02:00:06.250903 (Thread-55): handling poll request
2022-01-25 02:00:06.251339 (Thread-55): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe883ce700>]}
2022-01-25 02:00:06.252208 (Thread-55): sending response (<Response 398 bytes [200 OK]>) to 10.0.11.77
2022-01-25 02:00:07.175342 (Thread-1): finished collecting timing info
2022-01-25 02:00:07.612173 (Thread-56): handling poll request
2022-01-25 02:00:07.612612 (Thread-56): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe883ce9d0>]}
2022-01-25 02:00:07.617380 (Thread-56): sending response (<Response 24543 bytes [200 OK]>) to 10.0.44.76
2022-01-25 02:00:12.346964 (Thread-57): handling status request
2022-01-25 02:00:12.347432 (Thread-57): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe883cedf0>]}
2022-01-25 02:00:12.355814 (Thread-57): sending response (<Response 32943 bytes [200 OK]>) to 10.0.32.47
2022-01-25 02:00:12.737317 (Thread-58): handling run_sql request
2022-01-25 02:00:12.737750 (Thread-58): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe883ce640>]}
2022-01-25 02:00:13.560325 (Thread-58): sending response (<Response 137 bytes [200 OK]>) to 10.0.35.206
2022-01-25 02:00:13.580978 (MainThread): Acquiring new bigquery connection "rpc.tech_audit.request".
2022-01-25 02:00:13.605597 (MainThread): Found 25 models, 0 tests, 0 snapshots, 0 analyses, 327 macros, 0 operations, 0 seed files, 5 sources
2022-01-25 02:00:13.606227 (Thread-1): Acquiring new bigquery connection "rpc.tech_audit.request".
2022-01-25 02:00:13.606340 (Thread-1): Compiling rpc.tech_audit.request
2022-01-25 02:00:13.624881 (Thread-1): finished collecting timing info
2022-01-25 02:00:13.625260 (Thread-1): Opening a new connection, currently in state init
2022-01-25 02:00:13.625794 (Thread-1): On rpc.tech_audit.request: SELECT 
site,
domain,
account,
date,
unix_date,
date_of_entry,
url,
sum(sessions) sessions,
sum(transaction_revenue) transaction_revenue,
sum(transactions) transactions,
sum(goal_completions_all_goals) goal_completions_all_goals,
sum(bounces) bounces,
sum(seconds_on_site) seconds_on_site
FROM (

    SELECT
    site,
    domain,
    account,
    date,
    unix_date,
    date_of_entry,
    url_untrimmed,
    first_value(url_untrimmed) over (PARTITION BY site, domain, account, date, url_trimmed ORDER BY sessions desc) url,
    replace(regexp_extract(url_trimmed,r'^(?:https?:\/\/)?(?:www\.)?([^\/]+)'),'(not set)','') as url_domain,
    sessions,
    transaction_revenue,
    transactions,
    goal_completions_all_goals,
    bounces,
    seconds_on_site
    FROM (

        SELECT
        b.site, 
        a.domain,
        account,
        month date, 
        unix_date,
        date_of_entry,
        CASE WHEN regexp_contains(landing_page_path,a.domain) 
          THEN lower(regexp_replace(replace(replace(replace(landing_page_path,'www.',''),'http://',''),'https://',''),r'\#.*$',''))
          ELSE lower(regexp_replace(replace(replace(replace(CONCAT(a.domain,landing_page_path),'www.',''),'http://',''),'https://',''),r'\#.*$',''))
          END as url_untrimmed,
        CASE WHEN regexp_contains(landing_page_path,a.domain) 
          THEN trim(lower(regexp_replace(replace(replace(replace(landing_page_path,'www.',''),'http://',''),'https://',''),r'\#.*$','')),'/')
          ELSE trim(lower(regexp_replace(replace(replace(replace(CONCAT(a.domain,landing_page_path),'www.',''),'http://',''),'https://',''),r'\#.*$','')),'/')
          END as url_trimmed,          
        sum(sessions) sessions,
        sum(transaction_revenue) transaction_revenue,
        sum(transactions) transactions,
        sum(goal_completions_all_goals) goal_completions_all_goals,
        sum(bounces) bounces,
        sum(seconds_on_site) seconds_on_site
        FROM (
                SELECT 
	              -- extract(date from ga_date) date, 
                rtrim(web_property_id) as account,
                date_trunc(cast(ga_date as date), month) as month,
                -- date_trunc(ga_date, month) as month,
                -- extract(month from ga_date) month,
                unix_date(cast(date_trunc(cast(ga_date as date), month) as date)) unix_date,
                _sdc_received_at time_of_entry,
                cast(_sdc_received_at as date) date_of_entry,
                first_value(_sdc_received_at) OVER (PARTITION BY web_property_id, ga_landingpagepath, ga_hostname, date_trunc(cast(ga_date as date), month)  ORDER BY _sdc_received_at desc) lv,
                replace(ga_hostname,'www.','') domain,
                trim(replace(ga_hostname,'www.',''),'/') domain_trimmed,
                ga_landingpagepath landing_page_path,
                cast(ga_sessions as int64) sessions,
                cast(ga_transactionrevenue as int64) transaction_revenue,
                cast(ga_transactions as int64) transactions,
                cast(ga_goalcompletionsall as int64) goal_completions_all_goals,
                cast(ga_bouncerate as int64) bounces,
                cast(cast(ga_avgsessionduration as BIGNUMERIC) as int64)     seconds_on_site
                FROM     `seo-data-pipeline-89`.`bq_sources`.`ga`
                WHERE ( ga_sessions > 0 or ga_transactions > 0 or ga_goalcompletionsall > 0 )
                and ga_landingpagepath not like '%.xml%'
                and ga_landingpagepath != '(not set)'

                ) a
        LEFT JOIN `seo-data-pipeline-89`.`adp_thecifhw`.`domains_proc` b
        ON (
            a.account = b.google_analytics_account
        )
        WHERE time_of_entry = lv
        GROUP BY b.site, a.domain, account, month, unix_date, date_of_entry, url_untrimmed, url_trimmed
    )
)

GROUP BY site, domain, account, date, unix_date, date_of_entry, url
limit 500
/* limit added automatically by dbt cloud */
2022-01-25 02:00:14.068186 (Thread-59): handling poll request
2022-01-25 02:00:14.068688 (Thread-59): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe883e5460>]}
2022-01-25 02:00:14.071456 (Thread-59): sending response (<Response 6589 bytes [200 OK]>) to 10.0.24.171
2022-01-25 02:00:15.651472 (Thread-60): handling poll request
2022-01-25 02:00:15.651919 (Thread-60): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe883cea90>]}
2022-01-25 02:00:15.652862 (Thread-60): sending response (<Response 386 bytes [200 OK]>) to 10.0.11.77
2022-01-25 02:00:17.009499 (Thread-61): handling poll request
2022-01-25 02:00:17.009932 (Thread-61): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe883cebb0>]}
2022-01-25 02:00:17.010816 (Thread-61): sending response (<Response 386 bytes [200 OK]>) to 10.0.35.206
2022-01-25 02:00:18.230218 (Thread-1): finished collecting timing info
2022-01-25 02:00:18.423234 (Thread-62): handling poll request
2022-01-25 02:00:18.423685 (Thread-62): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe88396100>]}
2022-01-25 02:00:18.430777 (Thread-62): sending response (<Response 96504 bytes [200 OK]>) to 10.0.32.47
2022-01-25 02:00:20.797557 (Thread-63): handling status request
2022-01-25 02:00:20.798005 (Thread-63): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe88396640>]}
2022-01-25 02:00:20.806266 (Thread-63): sending response (<Response 32943 bytes [200 OK]>) to 10.0.42.85
2022-01-25 02:00:21.155125 (Thread-64): handling run_sql request
2022-01-25 02:00:21.155568 (Thread-64): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe883966d0>]}
2022-01-25 02:00:21.966184 (Thread-64): sending response (<Response 137 bytes [200 OK]>) to 10.0.27.56
2022-01-25 02:00:21.988599 (MainThread): Acquiring new bigquery connection "rpc.tech_audit.request".
2022-01-25 02:00:22.010934 (MainThread): Found 25 models, 0 tests, 0 snapshots, 0 analyses, 327 macros, 0 operations, 0 seed files, 5 sources
2022-01-25 02:00:22.011508 (Thread-1): Acquiring new bigquery connection "rpc.tech_audit.request".
2022-01-25 02:00:22.011618 (Thread-1): Compiling rpc.tech_audit.request
2022-01-25 02:00:22.027821 (Thread-1): finished collecting timing info
2022-01-25 02:00:22.028071 (Thread-1): Opening a new connection, currently in state init
2022-01-25 02:00:22.028486 (Thread-1): On rpc.tech_audit.request: with ga as (

	SELECT 
	a.date report_date, 
	unix_date, 
	b.unix_run_date,
	b.unix_mom_date,
	b.unix_yoy_date,
	a.account, 
	a.site, 
	a.domain,
	url, 
	sessions,
	transaction_revenue,
	transactions,
	ecommerce_conversion_rate,
	goal_completions_all_goals,
	goal_conversion_rate_all_goals,
	bounce_rate,
	avg_seconds_on_site
	FROM `seo-data-pipeline-89`.`adp_thecifhw`.`ga_proc_url_mapping` a
	LEFT JOIN `seo-data-pipeline-89`.`adp_thecifhw`.`dates` b
	ON (
		a.site = b.site AND
		( a.unix_date = b.unix_run_date OR a.unix_date = b.unix_mom_date OR a.unix_date >= b.unix_yoy_date )
	)
)

SELECT  
date,
account,
site,
domain,
url,
sum(sessions_30d) as sessions_30d,
sum(transaction_revenue_30d) transaction_revenue_30d,
sum(transactions_30d) as transactions_30d,
max(ecommerce_conversion_rate_30d) as ecommerce_conversion_rate_30d,
sum(goal_completions_all_goals_30d) as goal_completions_all_goals_30d,
max(goal_conversion_rate_all_goals_30d) as goal_conversion_rate_all_goals_30d,
max(bounce_rate_30d) bounce_rate_30d,
max(avg_seconds_on_site_30d) as avg_seconds_on_site_30d,
sum(sessions_mom) as sessions_mom,
sum(transaction_revenue_mom) transaction_revenue_mom,
sum(transactions_mom) as transactions_mom,
max(ecommerce_conversion_rate_mom) as ecommerce_conversion_rate_mom,
sum(goal_completions_all_goals_mom) as goal_completions_all_goals_mom,
max(goal_conversion_rate_all_goals_mom) as goal_conversion_rate_all_goals_mom,
max(bounce_rate_mom) bounce_rate_mom,
max(avg_seconds_on_site_mom) as avg_seconds_on_site_mom,
sum(sessions_yoy) as sessions_yoy,
sum(transaction_revenue_yoy) transaction_revenue_yoy,
sum(transactions_yoy) as transactions_yoy,
max(ecommerce_conversion_rate_yoy) as ecommerce_conversion_rate_yoy,
sum(goal_completions_all_goals_yoy) as goal_completions_all_goals_yoy,
max(goal_conversion_rate_all_goals_yoy) as goal_conversion_rate_all_goals_yoy,
max(bounce_rate_yoy) bounce_rate_yoy,
max(avg_seconds_on_site_yoy) as avg_seconds_on_site_yoy,
sum(sessions_ttm) as sessions_ttm,
sum(transaction_revenue_ttm) transaction_revenue_ttm,
sum(transactions_ttm) as transactions_ttm,
max(ecommerce_conversion_rate_ttm) as ecommerce_conversion_rate_ttm,
sum(goal_completions_all_goals_ttm) as goal_completions_all_goals_ttm,
max(goal_conversion_rate_all_goals_ttm) as goal_conversion_rate_all_goals_ttm,
max(bounce_rate_ttm) bounce_rate_ttm,
max(avg_seconds_on_site_ttm) as avg_seconds_on_site_ttm,
CASE WHEN sum(transactions_30d) > 0 THEN sum(transactions_30d)
		ELSE sum(goal_completions_all_goals_30d) END as blended_conversions_30d,
CASE WHEN max(ecommerce_conversion_rate_30d) > 0 THEN max(ecommerce_conversion_rate_30d)
	ELSE max(goal_conversion_rate_all_goals_30d) END as blended_conversion_rate_30d
FROM (

	SELECT
	date_from_unix_date(unix_run_date) date,
	account,
	site,
	domain,
	url,
	case when unix_date = unix_run_date then sessions else null end as sessions_30d,
	case when unix_date = unix_run_date then transaction_revenue else null end as transaction_revenue_30d,
	case when unix_date = unix_run_date then transactions else null end as transactions_30d,
	case when unix_date = unix_run_date then ecommerce_conversion_rate else null end as ecommerce_conversion_rate_30d,
	case when unix_date = unix_run_date then goal_completions_all_goals else null end as goal_completions_all_goals_30d,
	case when unix_date = unix_run_date then goal_conversion_rate_all_goals else null end as goal_conversion_rate_all_goals_30d,
	case when unix_date = unix_run_date then bounce_rate else null end as bounce_rate_30d,
	case when unix_date = unix_run_date then avg_seconds_on_site else null end as avg_seconds_on_site_30d,
	null as sessions_mom,
	null as transaction_revenue_mom,
	null as transactions_mom,
	null as ecommerce_conversion_rate_mom,
	null as goal_completions_all_goals_mom,
	null as goal_conversion_rate_all_goals_mom,
	null as bounce_rate_mom,
	null as avg_seconds_on_site_mom,
	null as sessions_yoy,
	null as transaction_revenue_yoy,
	null as transactions_yoy,
	null as ecommerce_conversion_rate_yoy,
	null as goal_completions_all_goals_yoy,
	null as goal_conversion_rate_all_goals_yoy,
	null as bounce_rate_yoy,
	null as avg_seconds_on_site_yoy,
	null as sessions_ttm,
	null as transaction_revenue_ttm,
	null as transactions_ttm,
	null as ecommerce_conversion_rate_ttm,
	null as goal_completions_all_goals_ttm,
	null as goal_conversion_rate_all_goals_ttm,
	null as bounce_rate_ttm,
	null as avg_seconds_on_site_ttm
	FROM ga

	UNION ALL	

	SELECT
	date_from_unix_date(unix_run_date) date,
	account,
	site,
	domain,
	url,
	null as sessions_30d,
	null as transaction_revenue_30d,
	null as transactions_30d,
	null as ecommerce_conversion_rate_30d,
	null as goal_completions_all_goals_30d,
	null as goal_conversion_rate_all_goals_30d,
	null as bounce_rate_30d,
	null as avg_seconds_on_site_30d,	
	case when unix_date = unix_mom_date then sessions else null end as sessions_mom,
	case when unix_date = unix_mom_date then transaction_revenue else null end as transaction_revenue_mom,
	case when unix_date = unix_mom_date then transactions else null end as transactions_mom,
	case when unix_date = unix_mom_date then ecommerce_conversion_rate else null end as ecommerce_conversion_rate_mom,
	case when unix_date = unix_mom_date then goal_completions_all_goals else null end as goal_completions_all_goals_mom,
	case when unix_date = unix_mom_date then goal_conversion_rate_all_goals else null end as goal_conversion_rate_all_goals_mom,
	case when unix_date = unix_mom_date then bounce_rate else null end as bounce_rate_mom,
	case when unix_date = unix_mom_date then avg_seconds_on_site else null end as avg_seconds_on_site_mom,
	null as sessions_yoy,
	null as transaction_revenue_yoy,
	null as transactions_yoy,
	null as ecommerce_conversion_rate_yoy,
	null as goal_completions_all_goals_yoy,
	null as goal_conversion_rate_all_goals_yoy,
	null as bounce_rate_yoy,
	null as avg_seconds_on_site_yoy,
	null as sessions_ttm,
	null as transaction_revenue_ttm,
	null as transactions_ttm,
	null as ecommerce_conversion_rate_ttm,
	null as goal_completions_all_goals_ttm,
	null as goal_conversion_rate_all_goals_ttm,
	null as bounce_rate_ttm,
	null as avg_seconds_on_site_ttm
	FROM ga	

	UNION ALL

	SELECT
	date_from_unix_date(unix_run_date) date,
	account,
	site,
	domain,
	url,
	null as sessions_30d,
	null as transaction_revenue_30d,
	null as transactions_30d,
	null as ecommerce_conversion_rate_30d,
	null as goal_completions_all_goals_30d,
	null as goal_conversion_rate_all_goals_30d,
	null as bounce_rate_30d,
	null as avg_seconds_on_site_30d,	
	null as sessions_mom,
	null as transaction_revenue_mom,
	null as transactions_mom,
	null as ecommerce_conversion_rate_mom,
	null as goal_completions_all_goals_mom,
	null as goal_conversion_rate_all_goals_mom,
	null as bounce_rate_mom,
	null as avg_seconds_on_site_mom,
	case when unix_date = unix_yoy_date then sessions else null end as sessions_yoy,
	case when unix_date = unix_yoy_date then transaction_revenue else null end as transaction_revenue_yoy,
	case when unix_date = unix_yoy_date then transactions else null end as transactions_yoy,
	case when unix_date = unix_yoy_date then ecommerce_conversion_rate else null end as ecommerce_conversion_rate_yoy,
	case when unix_date = unix_yoy_date then goal_completions_all_goals else null end as goal_completions_all_goals_yoy,
	case when unix_date = unix_yoy_date then goal_conversion_rate_all_goals else null end as goal_conversion_rate_all_goals_yoy,
	case when unix_date = unix_yoy_date then bounce_rate else null end as bounce_rate_yoy,
	case when unix_date = unix_yoy_date then avg_seconds_on_site else null end as avg_seconds_on_site_yoy,
	null as sessions_ttm,
	null as transaction_revenue_ttm,
	null as transactions_ttm,
	null as ecommerce_conversion_rate_ttm,
	null as goal_completions_all_goals_ttm,
	null as goal_conversion_rate_all_goals_ttm,
	null as bounce_rate_ttm,
	null as avg_seconds_on_site_ttm
	FROM ga		

	UNION ALL

	SELECT
	date_from_unix_date(unix_run_date) date,
	account,
	site,
	domain,
	url,
	null as sessions_30d,
	null as transaction_revenue_30d,
	null as transactions_30d,
	null as ecommerce_conversion_rate_30d,
	null as goal_completions_all_goals_30d,
	null as goal_conversion_rate_all_goals_30d,
	null as bounce_rate_30d,
	null as avg_seconds_on_site_30d,	
	null as sessions_mom,
	null as transaction_revenue_mom,
	null as transactions_mom,
	null as ecommerce_conversion_rate_mom,
	null as goal_completions_all_goals_mom,
	null as goal_conversion_rate_all_goals_mom,
	null as bounce_rate_mom,
	null as avg_seconds_on_site_mom,
	null as sessions_yoy,
	null as transaction_revenue_yoy,
	null as transactions_yoy,
	null as ecommerce_conversion_rate_yoy,
	null as goal_completions_all_goals_yoy,
	null as goal_conversion_rate_all_goals_yoy,
	null as bounce_rate_yoy,
	null as avg_seconds_on_site_yoy,
	case when unix_date > unix_yoy_date then sessions else null end as sessions_ttm,
	case when unix_date > unix_yoy_date then transaction_revenue else null end as transaction_revenue_ttm,
	case when unix_date > unix_yoy_date then transactions else null end as transactions_ttm,
	case when unix_date > unix_yoy_date then ecommerce_conversion_rate else null end as ecommerce_conversion_rate_ttm,
	case when unix_date > unix_yoy_date then goal_completions_all_goals else null end as goal_completions_all_goals_ttm,
	case when unix_date > unix_yoy_date then goal_conversion_rate_all_goals else null end as goal_conversion_rate_all_goals_ttm,
	case when unix_date > unix_yoy_date then bounce_rate else null end as bounce_rate_ttm,
	case when unix_date > unix_yoy_date then avg_seconds_on_site else null end as avg_seconds_on_site_ttm
	FROM ga			
)
group by date, account, site, domain, url
limit 500
/* limit added automatically by dbt cloud */
2022-01-25 02:00:22.320754 (Thread-65): handling poll request
2022-01-25 02:00:22.321230 (Thread-65): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe8835f9d0>]}
2022-01-25 02:00:22.323185 (Thread-65): sending response (<Response 12750 bytes [200 OK]>) to 10.0.40.45
2022-01-25 02:00:23.716263 (Thread-66): handling poll request
2022-01-25 02:00:23.716748 (Thread-66): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe8835fe20>]}
2022-01-25 02:00:23.717672 (Thread-66): sending response (<Response 386 bytes [200 OK]>) to 10.0.34.138
2022-01-25 02:00:24.692066 (Thread-1): finished collecting timing info
2022-01-25 02:00:25.078738 (Thread-67): handling poll request
2022-01-25 02:00:25.079176 (Thread-67): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe882c2730>]}
2022-01-25 02:00:25.086136 (Thread-67): sending response (<Response 111937 bytes [200 OK]>) to 10.0.2.170
2022-01-25 02:00:29.756132 (Thread-68): handling status request
2022-01-25 02:00:29.756573 (Thread-68): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe882c2d30>]}
2022-01-25 02:00:29.764908 (Thread-68): sending response (<Response 32943 bytes [200 OK]>) to 10.0.40.45
2022-01-25 02:00:30.087710 (Thread-69): handling run_sql request
2022-01-25 02:00:30.088133 (Thread-69): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe882c2070>]}
2022-01-25 02:00:30.898857 (Thread-69): sending response (<Response 137 bytes [200 OK]>) to 10.0.2.170
2022-01-25 02:00:30.918943 (MainThread): Acquiring new bigquery connection "rpc.tech_audit.request".
2022-01-25 02:00:30.939673 (MainThread): Found 25 models, 0 tests, 0 snapshots, 0 analyses, 327 macros, 0 operations, 0 seed files, 5 sources
2022-01-25 02:00:30.940210 (Thread-1): Acquiring new bigquery connection "rpc.tech_audit.request".
2022-01-25 02:00:30.940325 (Thread-1): Compiling rpc.tech_audit.request
2022-01-25 02:00:30.955698 (Thread-1): finished collecting timing info
2022-01-25 02:00:30.955962 (Thread-1): Opening a new connection, currently in state init
2022-01-25 02:00:30.956348 (Thread-1): On rpc.tech_audit.request: SELECT
site, 
domain,
account,
date,
unix_date,
url,
keyword,
branded_flag,
sum(impressions) impressions,
sum(clicks) clicks,
CASE WHEN sum(impressions) > 0 THEN sum(clicks) / sum(impressions) END as ctr,
CASE WHEN sum(impressions) > 0 THEN sum(average_position*impressions)/sum(impressions) ELSE null END as avg_position,
sum(top_3_keywords) top_3_keywords,
sum(top_5_keywords) top_5_keywords,
sum(top_10_keywords) top_10_keywords,
sum(top_20_keywords) top_20_keywords
FROM (

	SELECT
	a.site, 
	a.domain,
	a.account,
	date,
	unix_date,
	CASE WHEN b.url is not null THEN b.url
		ELSE regexp_replace(a.url, r'\?.*$', '') END as url,
		-- WHEN regexp_contains(a.url, r'^.*\/([^\/]+?\.[^\/]+)$') THEN regexp_replace(a.url, r'\?.*$', '')
  --       ELSE trim(regexp_replace(a.url, r'\?.*$',''),'/') END as url,
    keyword,
    branded_flag,
	impressions,
	clicks,
	average_position,
	top_3_keywords,
	top_5_keywords,
	top_10_keywords,
	top_20_keywords
	FROM `seo-data-pipeline-89`.`adp_thecifhw`.`search_console_keyword_proc` a
    LEFT JOIN `seo-data-pipeline-89`.`adp_thecifhw`.`deepcrawl_stats` b
    ON (
        a.date = b.report_date AND 
        a.site = b.site AND 
        (a.url = b.url OR concat(a.url, '/') = b.url )
    )
)
GROUP BY site, domain, account, date, unix_date, url, keyword, branded_flag
limit 500
/* limit added automatically by dbt cloud */
2022-01-25 02:00:31.348043 (Thread-70): handling poll request
2022-01-25 02:00:31.348511 (Thread-70): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe882c5dc0>]}
2022-01-25 02:00:31.350401 (Thread-70): sending response (<Response 4002 bytes [200 OK]>) to 10.0.44.76
2022-01-25 02:00:32.693099 (Thread-71): handling poll request
2022-01-25 02:00:32.693521 (Thread-71): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe882c5910>]}
2022-01-25 02:00:32.717747 (Thread-71): sending response (<Response 430 bytes [200 OK]>) to 10.0.2.170
2022-01-25 02:00:33.019119 (Thread-1): finished collecting timing info
2022-01-25 02:00:34.076190 (Thread-72): handling poll request
2022-01-25 02:00:34.076633 (Thread-72): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe883896a0>]}
2022-01-25 02:00:34.086237 (Thread-72): sending response (<Response 112971 bytes [200 OK]>) to 10.0.11.77
2022-01-25 02:01:22.805460 (Thread-73): handling status request
2022-01-25 02:01:22.808213 (Thread-73): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe88389d00>]}
2022-01-25 02:01:22.817412 (Thread-73): sending response (<Response 32943 bytes [200 OK]>) to 10.0.2.170
2022-01-25 02:01:23.173427 (Thread-74): handling run_sql request
2022-01-25 02:01:23.173871 (Thread-74): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe88389310>]}
2022-01-25 02:01:23.982908 (Thread-74): sending response (<Response 137 bytes [200 OK]>) to 10.0.32.47
2022-01-25 02:01:24.003566 (MainThread): Acquiring new bigquery connection "rpc.tech_audit.request".
2022-01-25 02:01:24.026016 (MainThread): Found 25 models, 0 tests, 0 snapshots, 0 analyses, 327 macros, 0 operations, 0 seed files, 5 sources
2022-01-25 02:01:24.026500 (Thread-1): Acquiring new bigquery connection "rpc.tech_audit.request".
2022-01-25 02:01:24.026608 (Thread-1): Compiling rpc.tech_audit.request
2022-01-25 02:01:24.041786 (Thread-1): finished collecting timing info
2022-01-25 02:01:24.042019 (Thread-1): Opening a new connection, currently in state init
2022-01-25 02:01:24.042391 (Thread-1): On rpc.tech_audit.request: with gsc as (

	SELECT 
	a.date, 
	unix_date, 
	b.unix_run_date,
	b.unix_mom_date,
	b.unix_yoy_date,	
	a.account,
	a.site,
	a.domain,
	url,
	keyword,
	sum(impressions) impressions,
	sum(clicks) clicks,
	CASE WHEN sum(impressions) > 0 THEN sum(clicks) / sum(impressions) END as ctr,
	CASE WHEN sum(impressions) > 0 THEN sum(avg_position*impressions)/sum(impressions) ELSE null END as avg_position
	FROM `seo-data-pipeline-89`.`adp_thecifhw`.`search_console_keyword_proc_url_mapping` a 
	LEFT JOIN `seo-data-pipeline-89`.`adp_thecifhw`.`dates` b
		ON (
			a.site = b.site AND
			( a.unix_date = b.unix_run_date OR a.unix_date = b.unix_mom_date OR a.unix_date = b.unix_yoy_date )
		)
	WHERE branded_flag = 0 
	GROUP BY a.date, unix_date, unix_run_date, unix_mom_date, unix_yoy_date, account, a.site, a.domain, url, keyword
)

SELECT
date,
account,
site,
domain,
url,
keyword,
CASE WHEN clicks_mom_pct > 0 THEN 'Rising' 
	WHEN clicks_mom_pct < 0 THEN 'Falling'
	WHEN clicks_mom_pct = 0 THEN 'Flat'
	WHEN clicks_mom_pct is null THEN 'New this Month'
	ELSE null END as keyword_bucket,
impressions_30d,
clicks_30d,
sum(clicks_30d) OVER (PARTITION BY date, site) as total_clicks_30d,
ctr_30d,
avg_position_30d,
impressions_mom,
impressions_mom_pct,
clicks_mom,
clicks_mom_pct,
ctr_mom,
avg_position_mom,
impressions_yoy,
clicks_yoy,
clicks_yoy_pct,
ctr_yoy,
avg_position_yoy
FROM (

	SELECT  
	date,
	account,
	site,
	domain,
	url,
	keyword,
	sum(impressions_30d) as impressions_30d,
	sum(clicks_30d) clicks_30d,
	max(ctr_30d) as ctr_30d,
	max(avg_position_30d) as avg_position_30d,
	sum(impressions_mom) as impressions_mom,
	CASE WHEN sum(impressions_mom) > 0 THEN (sum(impressions_30d) - sum(impressions_mom)) / sum(impressions_mom) ELSE null END as impressions_mom_pct,
	sum(impressions_30d) - sum(impressions_mom) as impressions_mom_gain,
	sum(clicks_mom) clicks_mom,
	CASE WHEN sum(clicks_mom) > 0 THEN (sum(clicks_30d) - sum(clicks_mom)) / sum(clicks_mom) ELSE null END as clicks_mom_pct,
	max(ctr_mom) as ctr_mom,
	min(avg_position_mom) as avg_position_mom,
	sum(impressions_yoy) as impressions_yoy,
	sum(clicks_yoy) clicks_yoy,
	CASE WHEN sum(clicks_yoy) > 0 THEN (sum(clicks_30d) - sum(clicks_yoy)) / sum(clicks_yoy) ELSE null END as clicks_yoy_pct,
	max(ctr_yoy) as ctr_yoy,
	min(avg_position_yoy) as avg_position_yoy
	FROM (

		SELECT
		date_from_unix_date(unix_run_date) date,
		account,
		site,
		domain,
		url,
		keyword,
		case when unix_date = unix_run_date then impressions else null end as impressions_30d,
		case when unix_date = unix_run_date then clicks else null end as clicks_30d,
		case when unix_date = unix_run_date then ctr else null end as ctr_30d,
		case when unix_date = unix_run_date then avg_position else null end as avg_position_30d,
		null as impressions_mom,
		null as clicks_mom,
		null as ctr_mom,
		null as avg_position_mom,
		null as impressions_yoy,
		null as clicks_yoy,
		null as ctr_yoy,
		null as avg_position_yoy
		FROM gsc

		UNION ALL	

		SELECT
		date_from_unix_date(unix_run_date) date,
		account,
		site,
		domain,
		url,
		keyword,
		null as impressions_30d,
		null as clicks_30d,
		null as ctr_30d,
		null as avg_position_30d,
		case when unix_date = unix_mom_date then impressions else null end as impressions_mom,
		case when unix_date = unix_mom_date then clicks else null end as clicks_mom,
		case when unix_date = unix_mom_date then ctr else null end as ctr_mom,
		case when unix_date = unix_mom_date then avg_position else null end as avg_position_mom,
		null as impressions_yoy,
		null as clicks_yoy,
		null as ctr_yoy,
		null as avg_position_yoy
		FROM gsc

		UNION ALL

		SELECT
		date_from_unix_date(unix_run_date) date,
		account,
		site,
		domain,
		url,
		keyword,
		null as impressions_30d,
		null as clicks_30d,
		null as ctr_30d,
		null as avg_position_30d,
		null as impressions_mom,
		null as clicks_mom,
		null as ctr_mom,
		null as avg_position_mom,
		case when unix_date = unix_yoy_date then impressions else null end as impressions_yoy,
		case when unix_date = unix_yoy_date then clicks else null end as clicks_yoy,
		case when unix_date = unix_yoy_date then ctr else null end as ctr_yoy,
		case when unix_date = unix_yoy_date then avg_position else null end as avg_position_yoy
		FROM gsc
	)
	group by date, account, site, domain, url, keyword
)
limit 500
/* limit added automatically by dbt cloud */
2022-01-25 02:01:24.503884 (Thread-75): handling poll request
2022-01-25 02:01:24.504363 (Thread-75): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe881e1730>]}
2022-01-25 02:01:24.506321 (Thread-75): sending response (<Response 7257 bytes [200 OK]>) to 10.0.41.222
2022-01-25 02:01:25.852704 (Thread-76): handling poll request
2022-01-25 02:01:25.853135 (Thread-76): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe881e1bb0>]}
2022-01-25 02:01:25.854010 (Thread-76): sending response (<Response 419 bytes [200 OK]>) to 10.0.44.76
2022-01-25 02:01:27.220467 (Thread-77): handling poll request
2022-01-25 02:01:27.220925 (Thread-77): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe881e1dc0>]}
2022-01-25 02:01:27.221788 (Thread-77): sending response (<Response 419 bytes [200 OK]>) to 10.0.41.222
2022-01-25 02:01:28.064108 (Thread-1): finished collecting timing info
2022-01-25 02:01:28.576220 (Thread-78): handling poll request
2022-01-25 02:01:28.576658 (Thread-78): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe882d3a00>]}
2022-01-25 02:01:28.584325 (Thread-78): sending response (<Response 156532 bytes [200 OK]>) to 10.0.24.171
2022-01-25 02:01:32.804334 (Thread-79): handling status request
2022-01-25 02:01:32.804792 (Thread-79): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe882d3b50>]}
2022-01-25 02:01:32.812849 (Thread-79): sending response (<Response 32943 bytes [200 OK]>) to 10.0.44.76
2022-01-25 02:01:33.157286 (Thread-80): handling run_sql request
2022-01-25 02:01:33.157725 (Thread-80): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe882d3e80>]}
2022-01-25 02:01:34.004908 (Thread-80): sending response (<Response 137 bytes [200 OK]>) to 10.0.40.45
2022-01-25 02:01:34.025697 (MainThread): Acquiring new bigquery connection "rpc.tech_audit.request".
2022-01-25 02:01:34.046329 (MainThread): Found 25 models, 0 tests, 0 snapshots, 0 analyses, 327 macros, 0 operations, 0 seed files, 5 sources
2022-01-25 02:01:34.046797 (Thread-1): Acquiring new bigquery connection "rpc.tech_audit.request".
2022-01-25 02:01:34.046901 (Thread-1): Compiling rpc.tech_audit.request
2022-01-25 02:01:34.062053 (Thread-1): finished collecting timing info
2022-01-25 02:01:34.062286 (Thread-1): Opening a new connection, currently in state init
2022-01-25 02:01:34.062669 (Thread-1): On rpc.tech_audit.request: with gsc as (

	SELECT 
	a.date, 
	unix_date, 
	b.unix_run_date,
	b.unix_mom_date,
	b.unix_yoy_date,
	a.account, 
	a.site, 
	a.domain,
	url, 
	impressions,
	clicks,
	ctr,
	avg_position
	FROM `seo-data-pipeline-89`.`adp_thecifhw`.`search_console_url_proc_url_mapping` a
	LEFT JOIN `seo-data-pipeline-89`.`adp_thecifhw`.`dates` b
	ON (
		a.site = b.site AND
		( a.unix_date = b.unix_run_date OR a.unix_date = b.unix_mom_date OR a.unix_date >= b.unix_yoy_date )
	)
)

SELECT  
date,
account,
site,
domain,
url,
sum(impressions_30d) as impressions_30d,
sum(clicks_30d) clicks_30d,
max(ctr_30d) as ctr_30d,
max(avg_position_30d) as avg_position_30d,
sum(impressions_mom) as impressions_mom,
sum(clicks_mom) clicks_mom,
max(ctr_mom) as ctr_mom,
min(avg_position_mom) as avg_position_mom,
sum(impressions_yoy) as impressions_yoy,
sum(clicks_yoy) clicks_yoy,
max(ctr_yoy) as ctr_yoy,
min(avg_position_yoy) as avg_position_yoy,
sum(impressions_ttm) as impressions_ttm,
sum(clicks_ttm) clicks_ttm,
max(ctr_ttm) as ctr_ttm,
min(avg_position_ttm) as avg_position_ttm
FROM (

	SELECT
	date_from_unix_date(unix_run_date) date,
	account,
	site,
	domain,
	url,
	case when unix_date = unix_run_date then impressions else null end as impressions_30d,
	case when unix_date = unix_run_date then clicks else null end as clicks_30d,
	case when unix_date = unix_run_date then ctr else null end as ctr_30d,
	case when unix_date = unix_run_date then avg_position else null end as avg_position_30d,
	null as impressions_mom,
	null as clicks_mom,
	null as ctr_mom,
	null as avg_position_mom,
	null as impressions_yoy,
	null as clicks_yoy,
	null as ctr_yoy,
	null as avg_position_yoy,
	null as impressions_ttm,
	null as clicks_ttm,
	null as ctr_ttm,
	null as avg_position_ttm	
	FROM gsc

	UNION ALL	

	SELECT
	date_from_unix_date(unix_run_date) date,
	account,
	site,
	domain,
	url,
	null as impressions_30d,
	null as clicks_30d,
	null as ctr_30d,
	null as avg_position_30d,
	case when unix_date = unix_mom_date then impressions else null end as impressions_mom,
	case when unix_date = unix_mom_date then clicks else null end as clicks_mom,
	case when unix_date = unix_mom_date then ctr else null end as ctr_mom,
	case when unix_date = unix_mom_date then avg_position else null end as avg_position_mom,
	null as impressions_yoy,
	null as clicks_yoy,
	null as ctr_yoy,
	null as avg_position_yoy,
	null as impressions_ttm,
	null as clicks_ttm,
	null as ctr_ttm,
	null as avg_position_ttm	
	FROM gsc

	UNION ALL

	SELECT
	date_from_unix_date(unix_run_date) date,
	account,
	site,
	domain,
	url,
	null as impressions_30d,
	null as clicks_30d,
	null as ctr_30d,
	null as avg_position_30d,
	null as impressions_mom,
	null as clicks_mom,
	null as ctr_mom,
	null as avg_position_mom,
	case when unix_date = unix_yoy_date then impressions else null end as impressions_yoy,
	case when unix_date = unix_yoy_date then clicks else null end as clicks_yoy,
	case when unix_date = unix_yoy_date then ctr else null end as ctr_yoy,
	case when unix_date = unix_yoy_date then avg_position else null end as avg_position_yoy,
	null as impressions_ttm,
	null as clicks_ttm,
	null as ctr_ttm,
	null as avg_position_ttm	
	FROM gsc

	UNION ALL

	SELECT
	date_from_unix_date(unix_run_date) date,
	account,
	site,
	domain,
	url,
	null as impressions_30d,
	null as clicks_30d,
	null as ctr_30d,
	null as avg_position_30d,
	null as impressions_mom,
	null as clicks_mom,
	null as ctr_mom,
	null as avg_position_mom,
	case when unix_date = unix_yoy_date then impressions else null end as impressions_yoy,
	case when unix_date = unix_yoy_date then clicks else null end as clicks_yoy,
	case when unix_date = unix_yoy_date then ctr else null end as ctr_yoy,
	case when unix_date = unix_yoy_date then avg_position else null end as avg_position_yoy,
	case when unix_date > unix_yoy_date then impressions else null end as impressions_ttm,
	case when unix_date > unix_yoy_date then clicks else null end as clicks_ttm,
	case when unix_date > unix_yoy_date then ctr else null end as ctr_ttm,
	case when unix_date > unix_yoy_date then avg_position else null end as avg_position_ttm
	FROM gsc
)
group by date, account, site, domain, url
limit 500
/* limit added automatically by dbt cloud */
2022-01-25 02:01:34.335880 (Thread-81): handling poll request
2022-01-25 02:01:34.336345 (Thread-81): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe882d9df0>]}
2022-01-25 02:01:34.338292 (Thread-81): sending response (<Response 7041 bytes [200 OK]>) to 10.0.7.136
2022-01-25 02:01:35.670345 (Thread-82): handling poll request
2022-01-25 02:01:35.670776 (Thread-82): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe882d9e80>]}
2022-01-25 02:01:35.671651 (Thread-82): sending response (<Response 415 bytes [200 OK]>) to 10.0.0.123
2022-01-25 02:01:36.425121 (Thread-1): finished collecting timing info
2022-01-25 02:01:37.018271 (Thread-83): handling poll request
2022-01-25 02:01:37.018734 (Thread-83): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe882c2280>]}
2022-01-25 02:01:37.027242 (Thread-83): sending response (<Response 110181 bytes [200 OK]>) to 10.0.24.171
2022-01-25 02:01:39.827991 (Thread-84): handling status request
2022-01-25 02:01:39.828423 (Thread-84): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe882c2bb0>]}
2022-01-25 02:01:39.837151 (Thread-84): sending response (<Response 32943 bytes [200 OK]>) to 10.0.25.116
2022-01-25 02:01:40.194236 (Thread-85): handling run_sql request
2022-01-25 02:01:40.194664 (Thread-85): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe882f5520>]}
2022-01-25 02:01:41.001871 (Thread-85): sending response (<Response 137 bytes [200 OK]>) to 10.0.44.76
2022-01-25 02:01:41.023028 (MainThread): Acquiring new bigquery connection "rpc.tech_audit.request".
2022-01-25 02:01:41.044890 (MainThread): Found 25 models, 0 tests, 0 snapshots, 0 analyses, 327 macros, 0 operations, 0 seed files, 5 sources
2022-01-25 02:01:41.045426 (Thread-1): Acquiring new bigquery connection "rpc.tech_audit.request".
2022-01-25 02:01:41.045536 (Thread-1): Compiling rpc.tech_audit.request
2022-01-25 02:01:41.062094 (Thread-1): finished collecting timing info
2022-01-25 02:01:41.062364 (Thread-1): Opening a new connection, currently in state init
2022-01-25 02:01:41.062803 (Thread-1): On rpc.tech_audit.request: SELECT 
coalesce(a.date, b.report_date) date, 
crawl_date,
coalesce(a.site, b.site) site,
coalesce(a.domain, b.domain) domain,
coalesce(a.url, b.url) url,
CASE 
	WHEN http_status_code is not null AND sessions_30d > 0 AND impressions_30d > 0 THEN 'Deepcrawl, GA, GSC'
	WHEN http_status_code is not null AND sessions_30d > 0 THEN 'Deepcrawl, GA'
	WHEN http_status_code is not null AND impressions_30d > 0 THEN 'Deepcrawl, GSC'
	WHEN http_status_code is not null THEN 'Deepcrawl' 
	WHEN sessions_30d > 0 AND impressions_30d > 0 THEN 'GA, GSC'
	WHEN sessions_30d > 0 THEN 'GA'
	WHEN impressions_30d > 0 THEN 'GSC'
	ELSE null END as found_at,
-- deepcrawl data
case when found_at_sitemap is not null then 'yes' else 'no' end as in_sitemap,
found_at_sitemap,
CASE WHEN b.page_type is null THEN 'None (missing from crawl)'
	ELSE b.page_type END as page_type,
url_stripped,
url_protocol,
canonical_url_protocol,
protocol_match,
protocol_count,
canonical_url,
canonical_status,
urls_to_canonical,
first_subfolder,
second_subfolder,
last_subfolder,
last_subfolder_canonical,
http_status_code,
level,
schema_type,
header_content_type,
word_count, 
page_title,
case when regexp_contains(page_title, main_keyword) OR regexp_contains(page_title, best_keyword)  then 1
	when ( main_keyword is not null or main_keyword != '' ) then 0 else 2 end as title_contains_top_keyword,
page_title_length,
description,
case when regexp_contains(description, main_keyword) OR regexp_contains(description, best_keyword) then 1 
	when ( main_keyword is not null or main_keyword != '' ) then 0 else 2 end as description_contains_top_keyword,
description_length,
indexable,
robots_noindex,
meta_noindex,
CASE WHEN robots_noindex = TRUE or meta_noindex = TRUE then 1 else 0 end as is_noindex,
is_self_canonical,
redirected_to_url,
found_at_url,
rel_next_url,
rel_prev_url,
links_in_count internal_links_in_count,
bottom_quartile_internal_links_in_count,
top_quartile_internal_links_in_count,
links_out_count,
external_links_count,
internal_links_count internal_links_out_count,
bottom_quartile_internal_links_out_count,
flag_paginated,
case when regexp_contains(coalesce(a.url, b.url), r'\/\d') then 1 else 0 end as url_contains_digit,
h1_tag,
h2_tag,
redirect_chain,
redirected_to_status_code,
is_redirect_loop,
duplicate_page,
duplicate_page_count,
duplicate_body,
duplicate_body_count,
-- gsc + ga data
sessions_30d,
bottom_quartile_sessions_30d,
med_sessions_30d,
top_quartile_sessions_30d,
total_organic_sessions_30d,
CASE WHEN total_organic_sessions_30d > 0 THEN sessions_30d / total_organic_sessions_30d ELSE null END as pct_of_organic_sessions_30d,
transaction_revenue_30d,
transactions_30d,
CASE WHEN total_organic_transactions_30d > 0 THEN transactions_30d / total_organic_transactions_30d ELSE null END as pct_of_organic_transactions_30d,
ecommerce_conversion_rate_30d,
med_transaction_conversion_rate_30d,
goal_completions_all_goals_30d,
CASE WHEN total_organic_goal_completions_all_goals_30d > 0 THEN goal_completions_all_goals_30d / total_organic_goal_completions_all_goals_30d ELSE null END as pct_of_organic_goal_completions_all_goals_30d,
goal_conversion_rate_all_goals_30d,
med_goal_conversion_rate_30d,
blended_conversions_30d,	
bottom_quartile_blended_conversions_30d,	
med_blended_conversions_30d,	
top_quartile_blended_conversions_30d,	
blended_conversion_rate_30d,	
bottom_quartile_blended_conversion_rate_30d,	
med_blended_conversion_rate_30d,	
top_quartile_blended_conversion_rate_30d,
bounce_rate_30d,
avg_seconds_on_site_30d,
sessions_mom,
case when sessions_mom > 0 then (sessions_30d-sessions_mom)/sessions_mom else null end sessions_mom_pct,
case when total_organic_sessions_mom > 0 then (total_organic_sessions_30d-total_organic_sessions_mom)/total_organic_sessions_mom else null end total_organic_sessions_mom_pct,
transaction_revenue_mom,
case when transaction_revenue_mom > 0 then (transaction_revenue_30d-transaction_revenue_mom)/transaction_revenue_mom else null end transaction_revenue_mom_pct,
transactions_mom,
case when transactions_mom > 0 then (transactions_30d-transactions_mom)/transactions_mom else null end transactions_mom_pct,
ecommerce_conversion_rate_mom,
case when ecommerce_conversion_rate_mom > 0 then (ecommerce_conversion_rate_30d-ecommerce_conversion_rate_mom)/ecommerce_conversion_rate_mom else null end ecommerce_conversion_rate_mom_pct,
case when total_organic_ecommerce_conversion_rate_mom > 0 then (total_organic_ecommerce_conversion_rate_30d-total_organic_ecommerce_conversion_rate_mom)/total_organic_ecommerce_conversion_rate_mom else null end total_organic_ecommerce_conversion_rate_mom_pct,
goal_completions_all_goals_mom,
case when goal_completions_all_goals_mom > 0 then (goal_completions_all_goals_30d-goal_completions_all_goals_mom)/goal_completions_all_goals_mom else null end goal_completions_all_goals_mom_pct,
goal_conversion_rate_all_goals_mom,
case when goal_conversion_rate_all_goals_mom > 0 then (goal_conversion_rate_all_goals_30d-goal_conversion_rate_all_goals_mom)/goal_conversion_rate_all_goals_mom else null end goal_conversion_rate_all_goals_mom_pct,
case when total_organic_goal_conversion_rate_mom > 0 then (total_organic_goal_conversion_rate_30d-total_organic_goal_conversion_rate_mom)/total_organic_goal_conversion_rate_mom else null end total_organic_goal_conversion_rate_mom_pct,
sessions_yoy,
case when sessions_yoy > 0 then (sessions_30d-sessions_yoy)/sessions_yoy else null end sessions_yoy_pct,
case when total_organic_sessions_yoy > 0 then (total_organic_sessions_30d-total_organic_sessions_yoy)/total_organic_sessions_yoy else null end total_organic_sessions_yoy_pct,
transaction_revenue_yoy,
case when transaction_revenue_yoy > 0 then (transaction_revenue_30d-transaction_revenue_yoy)/transaction_revenue_yoy else null end transaction_revenue_yoy_pct,
transactions_yoy,
case when transactions_yoy > 0 then (transactions_30d-transactions_yoy)/transactions_yoy else null end transactions_yoy_pct,
ecommerce_conversion_rate_yoy,
case when ecommerce_conversion_rate_yoy > 0 then (ecommerce_conversion_rate_30d-ecommerce_conversion_rate_yoy)/ecommerce_conversion_rate_yoy else null end ecommerce_conversion_rate_yoy_pct,
case when total_organic_ecommerce_conversion_rate_yoy > 0 then (total_organic_ecommerce_conversion_rate_30d-total_organic_ecommerce_conversion_rate_yoy)/total_organic_ecommerce_conversion_rate_yoy else null end total_organic_ecommerce_conversion_rate_yoy_pct,
goal_completions_all_goals_yoy,
case when transactions_yoy > 0 then (goal_completions_all_goals_30d-goal_completions_all_goals_yoy)/transactions_yoy else null end goal_completions_all_goals_yoy_pct,
goal_conversion_rate_all_goals_yoy,
case when goal_conversion_rate_all_goals_yoy > 0 then (goal_conversion_rate_all_goals_30d-goal_conversion_rate_all_goals_yoy)/goal_conversion_rate_all_goals_yoy else null end goal_conversion_rate_all_goals_yoy_pct,
case when total_organic_goal_conversion_rate_yoy > 0 then (total_organic_goal_conversion_rate_30d-total_organic_goal_conversion_rate_yoy)/total_organic_goal_conversion_rate_yoy else null end total_organic_goal_conversion_rate_yoy_pct,
sessions_ttm,
transaction_revenue_ttm,
transactions_ttm,
ecommerce_conversion_rate_ttm,
goal_completions_all_goals_ttm,
goal_conversion_rate_all_goals_ttm,
bounce_rate_ttm,
avg_seconds_on_site_ttm,
case when sessions_30d > sessions_mom then TRUE else FALSE end as gaining_traffic_mom,
case when sessions_30d > sessions_yoy then TRUE else FALSE end as gaining_traffic_yoy,
backlink_count,
backlink_domain_count ref_domain_count,
med_ref_domain_count,
bottom_quartile_ref_domain_count,
impressions_30d,
total_impressions_30d,
CASE WHEN total_impressions_30d > 0 THEN impressions_30d / total_impressions_30d ELSE null END as pct_of_total_impressions_30d,
med_impressions_30d,
top_10pct_impressions_30d,
clicks_30d,
total_clicks_30d,
ctr_30d,
med_ctr_30d,
total_ctr_30d,
avg_position_30d,
impressions_mom,
total_impressions_mom,
case when impressions_mom > 0 then (impressions_30d-impressions_mom)/impressions_mom else null end impressions_mom_pct,
case when total_impressions_mom > 0 then (total_impressions_30d-total_impressions_mom)/total_impressions_mom else null end total_impressions_mom_pct,
clicks_mom,
total_clicks_mom,
case when clicks_mom > 0 then (clicks_30d-clicks_mom)/clicks_mom else null end clicks_mom_pct,
case when total_clicks_mom > 0 then (total_clicks_30d-total_clicks_mom)/total_clicks_mom else null end total_clicks_mom_pct,
ctr_mom,
total_ctr_mom,
case when ctr_mom > 0 then (ctr_30d-ctr_mom)/ctr_mom else null end ctr_mom_pct,
case when total_ctr_mom > 0 then (total_ctr_30d-total_ctr_mom)/total_ctr_mom else null end total_ctr_mom_pct,
avg_position_mom,
impressions_yoy,
total_impressions_yoy,
case when impressions_yoy > 0 then (impressions_30d-impressions_yoy)/impressions_yoy else null end impressions_yoy_pct,
case when total_impressions_yoy > 0 then (total_impressions_30d-total_impressions_yoy)/total_impressions_yoy else null end total_impressions_yoy_pct,
clicks_yoy,
total_clicks_yoy,
case when clicks_yoy > 0 then (clicks_30d-clicks_yoy)/clicks_yoy else null end clicks_yoy_pct,
case when total_clicks_yoy > 0 then (total_clicks_30d-total_clicks_yoy)/total_clicks_yoy else null end total_clicks_yoy_pct,
ctr_yoy,	
total_ctr_yoy,
case when ctr_yoy > 0 then (ctr_30d-ctr_yoy)/ctr_yoy else null end ctr_yoy_pct,
case when total_ctr_yoy > 0 then (total_ctr_30d-total_ctr_yoy)/total_ctr_yoy else null end total_ctr_yoy_pct,
impressions_ttm,
clicks_ttm,
ctr_ttm,
avg_position_ttm,
avg_position_yoy,	
top_3_keywords,
top_5_keywords,
top_10_keywords,
top_20_keywords,
main_keyword,
main_impressions,
main_clicks,
main_avg_position,
main_top_url,
CASE WHEN main_top_url != a.url and main_keyword != '' THEN 1 ELSE 0 END as main_keyword_cannibalization_flag,
main_top_url_clicks,
best_keyword,
best_impressions,
best_clicks,
best_avg_position,
best_top_url,
best_top_url_clicks,
CASE WHEN best_top_url != a.url and best_keyword != '' THEN 1 ELSE 0 END as best_keyword_cannibalization_flag
FROM 
  `seo-data-pipeline-89`.`adp_thecifhw`.`agg_traffic` a
FULL OUTER JOIN `seo-data-pipeline-89`.`adp_thecifhw`.`deepcrawl_stats` b
ON ( a.url = b.url
	and a.site = b.site
	and a.date = b.report_date )
limit 500
/* limit added automatically by dbt cloud */
2022-01-25 02:01:41.330580 (Thread-86): handling poll request
2022-01-25 02:01:41.331052 (Thread-86): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe882dd760>]}
2022-01-25 02:01:41.333012 (Thread-86): sending response (<Response 13044 bytes [200 OK]>) to 10.0.7.136
2022-01-25 02:01:42.679885 (Thread-87): handling poll request
2022-01-25 02:01:42.680345 (Thread-87): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe882ddd00>]}
2022-01-25 02:01:42.681306 (Thread-87): sending response (<Response 383 bytes [200 OK]>) to 10.0.27.56
2022-01-25 02:01:44.055954 (Thread-88): handling poll request
2022-01-25 02:01:44.056384 (Thread-88): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe882ddeb0>]}
2022-01-25 02:01:44.057310 (Thread-88): sending response (<Response 383 bytes [200 OK]>) to 10.0.25.116
2022-01-25 02:01:44.271072 (Thread-1): finished collecting timing info
2022-01-25 02:01:45.455442 (Thread-89): handling poll request
2022-01-25 02:01:45.455876 (Thread-89): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe88375640>]}
2022-01-25 02:01:45.500199 (Thread-89): sending response (<Response 850790 bytes [200 OK]>) to 10.0.18.33
2022-01-25 02:01:49.448244 (Thread-90): handling status request
2022-01-25 02:01:49.448698 (Thread-90): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe88375cd0>]}
2022-01-25 02:01:49.456606 (Thread-90): sending response (<Response 32943 bytes [200 OK]>) to 10.0.34.138
2022-01-25 02:01:49.891132 (Thread-91): handling run_sql request
2022-01-25 02:01:49.891559 (Thread-91): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe88375130>]}
2022-01-25 02:01:50.705794 (Thread-91): sending response (<Response 137 bytes [200 OK]>) to 10.0.7.136
2022-01-25 02:01:50.727423 (MainThread): Acquiring new bigquery connection "rpc.tech_audit.request".
2022-01-25 02:01:50.750682 (MainThread): Found 25 models, 0 tests, 0 snapshots, 0 analyses, 327 macros, 0 operations, 0 seed files, 5 sources
2022-01-25 02:01:50.751202 (Thread-1): Acquiring new bigquery connection "rpc.tech_audit.request".
2022-01-25 02:01:50.751309 (Thread-1): Compiling rpc.tech_audit.request
2022-01-25 02:01:50.769796 (Thread-1): finished collecting timing info
2022-01-25 02:01:50.770062 (Thread-1): Opening a new connection, currently in state init
2022-01-25 02:01:50.770496 (Thread-1): On rpc.tech_audit.request: SELECT 
date,
site,
domain,
url,
ifnull(sum(impressions_30d), 0) impressions_30d,
ifnull(max(total_impressions_30d), 0) total_impressions_30d,
ifnull(max(med_impressions_30d), 0) med_impressions_30d,
ifnull(max(top_10pct_impressions_30d), 0) top_10pct_impressions_30d,
ifnull(sum(clicks_30d), 0) clicks_30d,
ifnull(max(total_clicks_30d), 0) total_clicks_30d,
ifnull(max(ctr_30d), 0) ctr_30d,
ifnull(max(med_ctr_30d), 0) med_ctr_30d,
ifnull(CASE WHEN max(total_impressions_30d) > 0 THEN max(total_clicks_30d) / max(total_impressions_30d) ELSE null END, 0) as total_ctr_30d,
ifnull(max(avg_position_30d), 0) avg_position_30d,
ifnull(sum(impressions_mom), 0) impressions_mom,
ifnull(max(total_impressions_mom), 0) total_impressions_mom,
ifnull(sum(clicks_mom), 0) clicks_mom,
ifnull(max(total_clicks_mom), 0) total_clicks_mom,
ifnull(max(ctr_mom), 0) ctr_mom,
ifnull(CASE WHEN max(total_impressions_mom) > 0 THEN max(total_clicks_mom) / max(total_impressions_mom) ELSE null END, 0) as total_ctr_mom,
ifnull(max(avg_position_mom), 0) avg_position_mom,
ifnull(sum(impressions_yoy), 0) impressions_yoy,
ifnull(max(total_impressions_yoy), 0) total_impressions_yoy,
ifnull(sum(clicks_yoy), 0) clicks_yoy,
ifnull(max(total_clicks_yoy), 0) total_clicks_yoy,
ifnull(max(ctr_yoy), 0) ctr_yoy,
ifnull(CASE WHEN max(total_impressions_yoy) > 0 THEN max(total_clicks_yoy) / max(total_impressions_yoy) ELSE null END, 0) as total_ctr_yoy,
ifnull(max(avg_position_yoy), 0) avg_position_yoy,
ifnull(sum(impressions_ttm), 0) impressions_ttm,
ifnull(sum(clicks_ttm), 0) clicks_ttm,
ifnull(max(ctr_ttm), 0) ctr_ttm,
ifnull(max(avg_position_ttm), 0) avg_position_ttm,
ifnull(sum(top_3_keywords), 0) top_3_keywords,
ifnull(sum(top_5_keywords), 0) top_5_keywords,
ifnull(sum(top_10_keywords), 0) top_10_keywords,
ifnull(sum(top_20_keywords), 0) top_20_keywords,
max(main_keyword) main_keyword,
max(main_impressions) main_impressions,
max(main_clicks) main_clicks,
max(main_avg_position) main_avg_position,
max(main_top_url) main_top_url,
max(main_top_url_clicks) main_top_url_clicks,
max(best_keyword) best_keyword,
max(best_impressions) best_impressions,
max(best_clicks) best_clicks,
max(best_avg_position) best_avg_position,
max(best_top_url) best_top_url,
max(best_top_url_clicks) best_top_url_clicks,
ifnull(sum(sessions_30d), 0) sessions_30d,
ifnull(max(total_organic_sessions_30d), 0) total_organic_sessions_30d,
ifnull(max(bottom_quartile_sessions_30d), 0) bottom_quartile_sessions_30d,
ifnull(max(med_sessions_30d), 0) med_sessions_30d,
ifnull(max(top_quartile_sessions_30d), 0) top_quartile_sessions_30d,	
ifnull(sum(transaction_revenue_30d), 0) transaction_revenue_30d,
ifnull(sum(transactions_30d), 0) transactions_30d,
ifnull(max(total_organic_transactions_30d), 0) total_organic_transactions_30d,
ifnull(max(ecommerce_conversion_rate_30d), 0) ecommerce_conversion_rate_30d,
ifnull(max(med_transaction_conversion_rate_30d), 0) med_transaction_conversion_rate_30d,
ifnull(CASE WHEN max(total_organic_sessions_30d) > 0 THEN max(total_organic_transactions_30d) / max(total_organic_sessions_30d) ELSE null END, 0) as total_organic_ecommerce_conversion_rate_30d,
ifnull(sum(goal_completions_all_goals_30d), 0) goal_completions_all_goals_30d,
ifnull(max(total_organic_goal_completions_all_goals_30d), 0) total_organic_goal_completions_all_goals_30d,
ifnull(max(goal_conversion_rate_all_goals_30d), 0) goal_conversion_rate_all_goals_30d,
ifnull(CASE WHEN max(total_organic_sessions_30d) > 0 THEN max(total_organic_goal_completions_all_goals_30d) / max(total_organic_sessions_30d) ELSE null END, 0) as total_organic_goal_conversion_rate_30d,
ifnull(max(blended_conversions_30d), 0) blended_conversions_30d,	
ifnull(max(blended_conversion_rate_30d), 0) blended_conversion_rate_30d,	
ifnull(max(bottom_quartile_blended_conversions_30d), 0) bottom_quartile_blended_conversions_30d,	
ifnull(max(med_blended_conversions_30d), 0) med_blended_conversions_30d,	
ifnull(max(top_quartile_blended_conversions_30d), 0) top_quartile_blended_conversions_30d,	
ifnull(max(bottom_quartile_blended_conversion_rate_30d), 0) bottom_quartile_blended_conversion_rate_30d,	
ifnull(max(med_blended_conversion_rate_30d), 0) med_blended_conversion_rate_30d,	
ifnull(max(top_quartile_blended_conversion_rate_30d), 0) top_quartile_blended_conversion_rate_30d, 
ifnull(max(bounce_rate_30d), 0) bounce_rate_30d,
ifnull(max(avg_seconds_on_site_30d), 0) avg_seconds_on_site_30d,
ifnull(max(med_goal_conversion_rate_30d),0) med_goal_conversion_rate_30d,
ifnull(sum(sessions_mom), 0) sessions_mom,
ifnull(max(total_organic_sessions_mom), 0) total_organic_sessions_mom,
ifnull(sum(transaction_revenue_mom), 0) transaction_revenue_mom,
ifnull(sum(transactions_mom), 0) transactions_mom,
ifnull(max(total_organic_transactions_mom), 0) total_organic_transactions_mom,
ifnull(max(ecommerce_conversion_rate_mom), 0) ecommerce_conversion_rate_mom,
ifnull(CASE WHEN max(total_organic_sessions_mom) > 0 THEN max(total_organic_transactions_mom) / max(total_organic_sessions_mom) ELSE null END, 0) as total_organic_ecommerce_conversion_rate_mom,
ifnull(sum(goal_completions_all_goals_mom), 0) goal_completions_all_goals_mom,
ifnull(max(total_organic_goal_completions_all_goals_mom), 0) total_organic_goal_completions_all_goals_mom,
ifnull(max(goal_conversion_rate_all_goals_mom), 0) goal_conversion_rate_all_goals_mom,
ifnull(CASE WHEN max(total_organic_sessions_mom) > 0 THEN max(total_organic_goal_completions_all_goals_mom) / max(total_organic_sessions_mom) ELSE null END, 0) as total_organic_goal_conversion_rate_mom,
ifnull(max(bounce_rate_mom), 0) bounce_rate_mom,
ifnull(max(avg_seconds_on_site_mom), 0) avg_seconds_on_site_mom,
ifnull(sum(sessions_yoy), 0) sessions_yoy,
ifnull(max(total_organic_sessions_yoy), 0) total_organic_sessions_yoy,
ifnull(sum(transaction_revenue_yoy), 0) transaction_revenue_yoy,
ifnull(sum(transactions_yoy), 0) transactions_yoy,
ifnull(max(total_organic_transactions_yoy), 0) total_organic_transactions_yoy,
ifnull(max(ecommerce_conversion_rate_yoy), 0) ecommerce_conversion_rate_yoy,
ifnull(CASE WHEN max(total_organic_sessions_yoy) > 0 THEN max(total_organic_transactions_yoy) / max(total_organic_sessions_yoy) ELSE null END, 0) as total_organic_ecommerce_conversion_rate_yoy,
ifnull(sum(goal_completions_all_goals_yoy), 0) goal_completions_all_goals_yoy,
ifnull(max(total_organic_goal_completions_all_goals_yoy), 0) total_organic_goal_completions_all_goals_yoy,
ifnull(max(goal_conversion_rate_all_goals_yoy), 0) goal_conversion_rate_all_goals_yoy,
ifnull(CASE WHEN max(total_organic_sessions_yoy) > 0 THEN max(total_organic_goal_completions_all_goals_yoy) / max(total_organic_sessions_yoy) ELSE null END, 0) as total_organic_goal_conversion_rate_yoy,
ifnull(max(bounce_rate_yoy), 0) bounce_rate_yoy,
ifnull(max(avg_seconds_on_site_yoy), 0) avg_seconds_on_site_yoy,
ifnull(sum(sessions_ttm), 0) sessions_ttm,
ifnull(sum(transaction_revenue_ttm), 0) transaction_revenue_ttm,
ifnull(sum(transactions_ttm), 0) transactions_ttm,
ifnull(max(ecommerce_conversion_rate_ttm), 0) ecommerce_conversion_rate_ttm,
ifnull(sum(goal_completions_all_goals_ttm), 0) goal_completions_all_goals_ttm,
ifnull(max(goal_conversion_rate_all_goals_ttm), 0) goal_conversion_rate_all_goals_ttm,
ifnull(max(bounce_rate_ttm), 0) bounce_rate_ttm,
ifnull(max(avg_seconds_on_site_ttm), 0) avg_seconds_on_site_ttm
FROM (

	SELECT 
	date,
	account,
	site,
	domain,
	url,
	impressions_30d,
	sum(impressions_30d) over w1 as total_impressions_30d,
	PERCENTILE_DISC(impressions_30d, 0.5 IGNORE NULLS) OVER w1 AS med_impressions_30d,
	PERCENTILE_DISC(impressions_30d, 0.9 IGNORE NULLS) OVER w1 AS top_10pct_impressions_30d,		
	clicks_30d,
	sum(clicks_30d) over w1 as total_clicks_30d,
	ctr_30d,	
	PERCENTILE_DISC(ctr_30d, 0.5 IGNORE NULLS) OVER w1 AS med_ctr_30d,
	avg_position_30d,
	impressions_mom,
	sum(impressions_mom) over w1 as total_impressions_mom,
	clicks_mom,
	sum(clicks_mom) over w1 as total_clicks_mom,
	ctr_mom,
	avg_position_mom,
	impressions_yoy,
	sum(impressions_yoy) over w1 as total_impressions_yoy,
	clicks_yoy,
	sum(clicks_yoy) over w1 as total_clicks_yoy,
	ctr_yoy,	
	avg_position_yoy,	
	impressions_ttm,
	clicks_ttm,
	ctr_ttm,	
	avg_position_ttm,		
	null as top_3_keywords,
	null as top_5_keywords,
	null as top_10_keywords,
	null as top_20_keywords,
	'' as main_keyword,
	null as main_impressions,
	null as main_clicks,
	null as main_avg_position,
	'' as main_top_url,
	null as main_top_url_clicks,
	'' as best_keyword,
	null as best_impressions,
	null as best_clicks,
	null as best_avg_position,
	'' as best_top_url,
	null as best_top_url_clicks,
	null as sessions_30d,
	null as total_organic_sessions_30d,
	null as bottom_quartile_sessions_30d,
	null as med_sessions_30d,
	null as top_quartile_sessions_30d,	
	null as transaction_revenue_30d,
	null as transactions_30d,
	null as total_organic_transactions_30d,
	null as ecommerce_conversion_rate_30d,
	null as med_transaction_conversion_rate_30d,
	null as goal_completions_all_goals_30d,
	null as total_organic_goal_completions_all_goals_30d,
	null as goal_conversion_rate_all_goals_30d,
	null as med_goal_conversion_rate_30d,
	null as blended_conversions_30d,	
	null as bottom_quartile_blended_conversions_30d,	
	null as med_blended_conversions_30d,	
	null as top_quartile_blended_conversions_30d,	
	null as blended_conversion_rate_30d,	
	null as bottom_quartile_blended_conversion_rate_30d,	
	null as med_blended_conversion_rate_30d,	
	null as top_quartile_blended_conversion_rate_30d, 
	null as bounce_rate_30d,
	null as avg_seconds_on_site_30d,
	null as sessions_mom,
	null as total_organic_sessions_mom,
	null as transaction_revenue_mom,
	null as transactions_mom,
	null as total_organic_transactions_mom,
	null as ecommerce_conversion_rate_mom,
	null as goal_completions_all_goals_mom,
	null as total_organic_goal_completions_all_goals_mom,
	null as goal_conversion_rate_all_goals_mom,
	null as bounce_rate_mom,
	null as avg_seconds_on_site_mom,
	null as sessions_yoy,
	null as total_organic_sessions_yoy,
	null as transaction_revenue_yoy,
	null as transactions_yoy,
	null as total_organic_transactions_yoy,
	null as ecommerce_conversion_rate_yoy,
	null as goal_completions_all_goals_yoy,
	null as total_organic_goal_completions_all_goals_yoy,
	null as goal_conversion_rate_all_goals_yoy,
	null as bounce_rate_yoy,
	null as avg_seconds_on_site_yoy,
	null as sessions_ttm,
	null as transaction_revenue_ttm,
	null as transactions_ttm,
	null as ecommerce_conversion_rate_ttm,
	null as goal_completions_all_goals_ttm,
	null as goal_conversion_rate_all_goals_ttm,
	null as bounce_rate_ttm,
	null as avg_seconds_on_site_ttm
	FROM `seo-data-pipeline-89`.`adp_thecifhw`.`search_console_url_stats`
	WINDOW w1 as (PARTITION BY date, site)

	UNION ALL  

	SELECT 
	date,
	account,
	site,
	domain,
	url,
	null as impressions_30d,
	null as total_impressions_30d,
	null as med_impressions_30d,
	null as top_10pct_impressions_30d,
	null as clicks_30d,
	null as total_clicks_30d,
	null as ctr_30d,
	null as med_ctr_30d,
	null as avg_position_30d,
	null as impressions_mom,
	null as total_impressions_mom,
	null as clicks_mom,
	null as total_clicks_mom,
	null as ctr_mom,
	null as avg_position_mom,
	null as impressions_yoy,
	null as total_impressions_yoy,
	null as clicks_yoy,
	null as total_clicks_yoy,
	null as ctr_yoy,
	null as avg_position_yoy,		
	null as impressions_ttm,
	null as clicks_ttm,
	null as ctr_ttm,
	null as avg_position_ttm,			
	top_3_keywords,
	top_5_keywords,
	top_10_keywords,
	top_20_keywords,
	main_keyword,
	main_impressions,
	main_clicks,
	main_avg_position,
	main_top_url,
	main_top_url_clicks,
	best_keyword,
	best_impressions,
	best_clicks,
	best_avg_position,
	best_top_url,
	best_top_url_clicks,
	null as sessions_30d,
	null as total_organic_sessions_30d,
	null as bottom_quartile_sessions_30d,
	null as med_sessions_30d,
	null as top_quartile_sessions_30d,	
	null as transaction_revenue_30d,
	null as transactions_30d,
	null as total_organic_transactions_30d,
	null as ecommerce_conversion_rate_30d,
	null as med_transaction_conversion_rate_30d,
	null as goal_completions_all_goals_30d,
	null as total_organic_goal_completions_all_goals_30d,
	null as goal_conversion_rate_all_goals_30d,
	null as med_goal_conversion_rate_30d,
	null as blended_conversions_30d,	
	null as bottom_quartile_blended_conversions_30d,	
	null as med_blended_conversions_30d,	
	null as top_quartile_blended_conversions_30d,	
	null as blended_conversion_rate_30d,	
	null as bottom_quartile_blended_conversion_rate_30d,	
	null as med_blended_conversion_rate_30d,	
	null as top_quartile_blended_conversion_rate_30d, 
	null as bounce_rate_30d,
	null as avg_seconds_on_site_30d,
	null as sessions_mom,
	null as total_organic_sessions_mom,
	null as transaction_revenue_mom,
	null as transactions_mom,
	null as total_organic_transactions_mom,
	null as ecommerce_conversion_rate_mom,
	null as goal_completions_all_goals_mom,
	null as total_organic_goal_completions_all_goals_mom,
	null as goal_conversion_rate_all_goals_mom,
	null as bounce_rate_mom,
	null as avg_seconds_on_site_mom,
	null as sessions_yoy,
	null as total_organic_sessions_yoy,
	null as transaction_revenue_yoy,
	null as transactions_yoy,
	null as total_organic_transactions_yoy,
	null as ecommerce_conversion_rate_yoy,
	null as goal_completions_all_goals_yoy,
	null as total_organic_goal_completions_all_goals_yoy,
	null as goal_conversion_rate_all_goals_yoy,
	null as bounce_rate_yoy,
	null as avg_seconds_on_site_yoy,
	null as sessions_ttm,
	null as transaction_revenue_ttm,
	null as transactions_ttm,
	null as ecommerce_conversion_rate_ttm,
	null as goal_completions_all_goals_ttm,
	null as goal_conversion_rate_all_goals_ttm,
	null as bounce_rate_ttm,
	null as avg_seconds_on_site_ttm
	FROM `seo-data-pipeline-89`.`adp_thecifhw`.`search_console_url_keyword_stats`

	UNION ALL  

	SELECT 
	date,
	account,
	site,
	domain,
	url,
	null as impressions_30d,
	null as total_impressions_30d,
	null as med_impressions_30d,
	null as top_10pct_impressions_30d,	
	null as clicks_30d,
	null as total_clicks_30d,
	null as ctr_30d,
	null as med_ctr_30d,
	null as avg_position_30d,
	null as impressions_mom,
	null as total_impressions_mom,
	null as clicks_mom,
	null as total_clicks_mom,
	null as ctr_mom,
	null as avg_position_mom,
	null as impressions_yoy,
	null as total_impressions_yoy,
	null as clicks_yoy,
	null as total_clicks_yoy,
	null as ctr_yoy,
	null as avg_position_yoy,		
	null as impressions_ttm,
	null as clicks_ttm,
	null as ctr_ttm,
	null as avg_position_ttm,			
	null as top_3_keywords,
	null as top_5_keywords,
	null as top_10_keywords,
	null as top_20_keywords,
	'' as main_keyword,
	null as main_impressions,
	null as main_clicks,
	null as main_avg_position,
	'' as main_top_url,
	null as main_top_url_clicks,
	'' as best_keyword,
	null as best_impressions,
	null as best_clicks,
	null as best_avg_position,
	'' as best_top_url,
	null as best_top_url_clicks,
	sessions_30d,
	sum(sessions_30d) over w1 as total_organic_sessions_30d,
	PERCENTILE_DISC(sessions_30d, 0.25 IGNORE NULLS) OVER w1 AS bottom_quartile_sessions_30d,
	PERCENTILE_DISC(sessions_30d, 0.5 IGNORE NULLS) OVER w1 AS med_sessions_30d,
	PERCENTILE_DISC(sessions_30d, 0.75 IGNORE NULLS) OVER w1 AS top_quartile_sessions_30d,		
	transaction_revenue_30d,
	transactions_30d,
	sum(transactions_30d) over w1 as total_organic_transactions_30d,
	ecommerce_conversion_rate_30d,
	PERCENTILE_DISC(ecommerce_conversion_rate_30d, 0.5 IGNORE NULLS) OVER w1 AS med_transaction_conversion_rate_30d,
	goal_completions_all_goals_30d,
	sum(goal_completions_all_goals_30d) over w1 as total_organic_goal_completions_all_goals_30d,
	goal_conversion_rate_all_goals_30d,
	PERCENTILE_DISC(goal_conversion_rate_all_goals_30d, 0.5 IGNORE NULLS) OVER w1 AS med_goal_conversion_rate_30d,
	blended_conversions_30d,	
	PERCENTILE_DISC(blended_conversions_30d, 0.25 IGNORE NULLS) OVER w1 AS bottom_quartile_blended_conversions_30d,	
	PERCENTILE_DISC(blended_conversions_30d, 0.5 IGNORE NULLS) OVER w1 AS med_blended_conversions_30d,	
	PERCENTILE_DISC(blended_conversions_30d, 0.75 IGNORE NULLS) OVER w1 AS top_quartile_blended_conversions_30d,	
	blended_conversion_rate_30d,	
	PERCENTILE_DISC(blended_conversion_rate_30d, 0.25 IGNORE NULLS) OVER w1 AS bottom_quartile_blended_conversion_rate_30d,	
	PERCENTILE_DISC(blended_conversion_rate_30d, 0.5 IGNORE NULLS) OVER w1 AS med_blended_conversion_rate_30d,	
	PERCENTILE_DISC(blended_conversion_rate_30d, 0.75 IGNORE NULLS) OVER w1 AS top_quartile_blended_conversion_rate_30d, 
	bounce_rate_30d,
	avg_seconds_on_site_30d,
	sessions_mom,
	sum(sessions_mom) over w1 as total_organic_sessions_mom,
	transaction_revenue_mom,
	transactions_mom,
	sum(transactions_mom) over w1 as total_organic_transactions_mom,
	ecommerce_conversion_rate_mom,
	goal_completions_all_goals_mom,
	sum(goal_completions_all_goals_mom) over w1 as total_organic_goal_completions_all_goals_mom,
	goal_conversion_rate_all_goals_mom,
	bounce_rate_mom,
	avg_seconds_on_site_mom,
	sessions_yoy,
	sum(sessions_yoy) over w1 as total_organic_sessions_yoy,
	transaction_revenue_yoy,
	transactions_yoy,
	sum(transactions_yoy) over w1 as total_organic_transactions_yoy,
	ecommerce_conversion_rate_yoy,
	goal_completions_all_goals_yoy,
	sum(goal_completions_all_goals_yoy) over w1 as total_organic_goal_completions_all_goals_yoy,
	goal_conversion_rate_all_goals_yoy,
	bounce_rate_yoy,
	avg_seconds_on_site_yoy,
	sessions_ttm,
	transaction_revenue_ttm,
	transactions_ttm,
	ecommerce_conversion_rate_ttm,
	goal_completions_all_goals_ttm,
	goal_conversion_rate_all_goals_ttm,
	bounce_rate_ttm,
	avg_seconds_on_site_ttm
	FROM `seo-data-pipeline-89`.`adp_thecifhw`.`ga_stats`  
	WINDOW w1 as (PARTITION BY date, site)
) 
WHERE date is not null
GROUP BY date, site, domain, url
limit 500
/* limit added automatically by dbt cloud */
2022-01-25 02:01:51.099579 (Thread-92): handling poll request
2022-01-25 02:01:51.100048 (Thread-92): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe882f5fd0>]}
2022-01-25 02:01:51.102083 (Thread-92): sending response (<Response 21154 bytes [200 OK]>) to 10.0.2.170
2022-01-25 02:01:52.530243 (Thread-93): handling poll request
2022-01-25 02:01:52.530666 (Thread-93): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe882f5ca0>]}
2022-01-25 02:01:52.531521 (Thread-93): sending response (<Response 387 bytes [200 OK]>) to 10.0.13.8
2022-01-25 02:01:53.462973 (Thread-1): finished collecting timing info
2022-01-25 02:01:53.866556 (Thread-94): handling poll request
2022-01-25 02:01:53.866997 (Thread-94): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe882d9670>]}
2022-01-25 02:01:53.901009 (Thread-94): sending response (<Response 361688 bytes [200 OK]>) to 10.0.2.170
2022-01-25 02:02:06.003981 (Thread-95): handling status request
2022-01-25 02:02:06.004442 (Thread-95): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe882d9b50>]}
2022-01-25 02:02:06.013140 (Thread-95): sending response (<Response 32943 bytes [200 OK]>) to 10.0.34.138
2022-01-25 02:02:06.350343 (Thread-96): handling run_sql request
2022-01-25 02:02:06.350778 (Thread-96): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe882d99a0>]}
2022-01-25 02:02:07.164389 (Thread-96): sending response (<Response 137 bytes [200 OK]>) to 10.0.11.77
2022-01-25 02:02:07.187101 (MainThread): Acquiring new bigquery connection "rpc.tech_audit.request".
2022-01-25 02:02:07.208840 (MainThread): Found 25 models, 0 tests, 0 snapshots, 0 analyses, 327 macros, 0 operations, 0 seed files, 5 sources
2022-01-25 02:02:07.209335 (Thread-1): Acquiring new bigquery connection "rpc.tech_audit.request".
2022-01-25 02:02:07.209447 (Thread-1): Compiling rpc.tech_audit.request
2022-01-25 02:02:07.225555 (Thread-1): finished collecting timing info
2022-01-25 02:02:07.225809 (Thread-1): Opening a new connection, currently in state init
2022-01-25 02:02:07.226204 (Thread-1): On rpc.tech_audit.request: with agg_all as (

	SELECT
	date,
	crawl_date,
	site,
	domain,
	url,
	found_at,
	found_at_sitemap,
	canonical_url,
	page_type,
	url_stripped,
	url_protocol,
	canonical_url_protocol,
	protocol_match,
	protocol_count,
	canonical_status,
	urls_to_canonical,
	first_subfolder,
	second_subfolder,
	last_subfolder,
	last_subfolder_canonical,
	http_status_code,
	level,
	schema_type,
	header_content_type,
	word_count, 
	page_title,
	title_contains_top_keyword,
	page_title_length,
	description,
	description_contains_top_keyword,
	description_length,
	indexable,
	robots_noindex,
	meta_noindex,
	is_noindex,
	is_self_canonical,
	redirected_to_url,
	found_at_url,
	rel_next_url,
	rel_prev_url,
	flag_paginated,
	internal_links_in_count,
	bottom_quartile_internal_links_in_count,
	top_quartile_internal_links_in_count,
	links_out_count,
	external_links_count,
	internal_links_out_count,
	bottom_quartile_internal_links_out_count,
	h1_tag,
	h2_tag,
	redirect_chain,
	redirected_to_status_code,
	is_redirect_loop,
	duplicate_page,
	duplicate_page_count,
	duplicate_body,
	duplicate_body_count,
	url_contains_digit,

	-- ga + gsc data
	sessions_30d,
	lag(sessions_30d) over mom as sessions_30d_mom,
	bottom_quartile_sessions_30d,
	med_sessions_30d,
	pct_of_organic_sessions_30d,
	transaction_revenue_30d,
	lag(transaction_revenue_30d) over mom as transaction_revenue_30d_mom,
	transactions_30d,
	lag(transactions_30d) over mom as transactions_30d_mom,
	pct_of_organic_transactions_30d,
	ecommerce_conversion_rate_30d,
	med_transaction_conversion_rate_30d,
	goal_completions_all_goals_30d,
	lag(goal_completions_all_goals_30d) over mom as goal_completions_all_goals_30d_mom,
	pct_of_organic_goal_completions_all_goals_30d,
	goal_conversion_rate_all_goals_30d,
	med_goal_conversion_rate_30d,
	blended_conversions_30d,	
	blended_conversion_rate_30d,
	bounce_rate_30d,
	avg_seconds_on_site_30d,
	sessions_mom,
	sessions_mom_pct,
	total_organic_sessions_mom_pct,
	transaction_revenue_mom,
	transaction_revenue_mom_pct,
	transactions_mom,
	transactions_mom_pct,
	ecommerce_conversion_rate_mom_pct,
	total_organic_ecommerce_conversion_rate_mom_pct,
	goal_completions_all_goals_mom,
	goal_completions_all_goals_mom_pct,
	goal_conversion_rate_all_goals_mom_pct,
	total_organic_goal_conversion_rate_mom_pct,
	sessions_yoy,
	sessions_yoy_pct,
	total_organic_sessions_yoy_pct,
	transaction_revenue_yoy,
	transaction_revenue_yoy_pct,
	transactions_yoy,
	transactions_yoy_pct,
	ecommerce_conversion_rate_yoy_pct,
	total_organic_ecommerce_conversion_rate_yoy_pct,
	goal_completions_all_goals_yoy,
	goal_completions_all_goals_yoy_pct,
	goal_conversion_rate_all_goals_yoy_pct,
	total_organic_goal_conversion_rate_yoy_pct,
	sessions_ttm,
	transaction_revenue_ttm,
	transactions_ttm,
	ecommerce_conversion_rate_ttm,
	goal_completions_all_goals_ttm,
	goal_conversion_rate_all_goals_ttm,
	bounce_rate_ttm,
	avg_seconds_on_site_ttm,
	gaining_traffic_mom,
	gaining_traffic_yoy,
	backlink_count,
	ref_domain_count,
	med_ref_domain_count,
	bottom_quartile_ref_domain_count,
	impressions_30d,
	pct_of_total_impressions_30d,
	med_impressions_30d,
	top_10pct_impressions_30d,
	total_impressions_30d,
	clicks_30d,
	total_clicks_30d,
	ctr_30d,
	med_ctr_30d,
	total_ctr_30d,
	avg_position_30d,
	impressions_mom,
	total_impressions_mom,
	impressions_mom_pct,
	total_impressions_mom_pct,
	clicks_mom,
	total_clicks_mom,
	clicks_mom_pct,
	total_clicks_mom_pct,
	ctr_mom,
	total_ctr_mom,
	ctr_mom_pct,
	total_ctr_mom_pct,
	avg_position_mom,
	impressions_yoy,
	total_impressions_yoy,
	impressions_yoy_pct,
	total_impressions_yoy_pct,
	clicks_yoy,
	total_clicks_yoy,
	clicks_yoy_pct,
	total_clicks_yoy_pct,
	ctr_yoy,	
	total_ctr_yoy,
	ctr_yoy_pct,
	total_ctr_yoy_pct,
	avg_position_yoy,
	impressions_ttm,
	clicks_ttm,
	ctr_ttm,
	avg_position_ttm,	
	top_3_keywords,
	top_5_keywords,
	top_10_keywords,
	top_20_keywords,
	main_keyword,
	main_impressions,
	main_clicks,
	main_avg_position,
	main_top_url,
	main_keyword_cannibalization_flag,
	main_top_url_clicks,
	best_keyword,
	best_impressions,
	best_clicks,
	best_avg_position,
	best_top_url,
	best_top_url_clicks,
	best_keyword_cannibalization_flag
	FROM `seo-data-pipeline-89`.`adp_thecifhw`.`agg_all`
	WHERE found_at is not null
	WINDOW mom as (PARTITION BY site,domain,url ORDER BY date asc)	
)




SELECT
date,
crawl_date,
site,
domain,
url,
found_at,
found_at_sitemap,
canonical_url,
page_type,

--indicative actions roll up to each other, nested one by one
case
	when http_status_code in (403, 404) AND cast(backlink_count as int64) > 0 AND internal_links_in_count > 0  THEN '301 redirect + remove internal link from found_at_url' 
	when http_status_code in (403, 404) AND backlink_count > 0 THEN '301 redirect'
	when http_status_code in (403, 404) THEN 'Remove internal link from found_at_url'
	when http_status_code = 302 THEN '301 redirect to redirected_to_url'
	when http_status_code = 301 and lower(redirect_chain) = 'true' THEN 'Fix redirect chain'
	-- modify potentially to recommend fixing link to point to redirected_to_url
	when http_status_code = 301 and lower(redirect_chain) = 'false' THEN 'Leave 301 as is'
	when http_status_code in (403, 404) THEN '404, investigate'
	else '' end as http_status_action,

case 
	-- added < 200 word count condition 2/26/20
	when canonical_status = 'canonicalized' then ''
	when (http_status_code != 200 or is_noindex = 1 or word_count < 200 ) and found_at_sitemap is not null then concat('Remove from sitemap: ', coalesce(found_at_sitemap) ) 
	when is_noindex = 0 and found_at_sitemap is null and flag_paginated = 0 and url not like '%/page/%' and sessions_30d > 0 and http_status_code = 200 then 'Likely add to sitemap'
	else '' end as sitemap_action,

case 
	when http_status_code in (301, 403, 404) then ''
	when canonical_status = 'missing_canonical' then 'Missing canonical'
	when canonical_status = 'canonicalized' and flag_paginated = 1 and is_self_canonical = FALSE then 'Self-canonicalize, paginated page'
	when canonical_status = 'canonicalized' then 'Canonicalized, leave as is'
	else '' end as canonical_action,

case
	when http_status_code is null and sessions_ttm > 0 and url not like '%404%' and url not like '%403%' and flag_paginated = 0 then 'Missing from crawl'
	when http_status_code is null and sessions_30d = 0 and flag_paginated = 0 then 'Page likely removed'
	-- updated sessions_ttm threshold to 100
	when sessions_ttm < 100 and sessions_30d = 0 and canonical_status != 'canonicalized' and is_noindex = 0 and flag_paginated = 0 then 'Review content for relevance (potential noindex)'
	else '' end as crawl_action,		

-- review page_type classification algo
-- push these schema classifications down into a lower proc model (and push other proc from deepcrawl up)
case 
	when http_status_code != 200 OR flag_paginated = 1 OR canonical_status = 'canonicalized' then '' 
	when level >= 2 and schema_type not like '%breadcrumb%' then 'Add breadcrumb schema' 
	when page_type = 'product' and schema_type not like '%product%' then 'Add product schema'
	-- when page_type = 'product_category' and schema_type not like '%itemlistordertype%' then 'Add itemlistordertype schema'
	when page_type = 'blog' and schema_type not like '%article%' then 'Add article schema'
	when page_type = 'local' and schema_type not like '%localbusiness%' then 'Add localbusiness schema'
	when page_type = 'homepage' and schema_type not like '%organization%' then 'Add organization schema'
	else '' END as schema_action,


-- analytics actions are separate from other actions - only display if admin_action in ('', 'add to sitemap', 'missing from crawl')

CASE WHEN http_status_code != 200 OR flag_paginated = 1 OR canonical_status = 'canonicalized'  THEN '' 
	WHEN http_status_code = 200 AND main_keyword_cannibalization_flag = 1 AND best_keyword_cannibalization_flag = 1 AND main_keyword = best_keyword AND is_self_canonical = TRUE THEN 'Cannibalizing main keyword'
	WHEN http_status_code = 200 AND main_keyword_cannibalization_flag = 1 AND best_keyword_cannibalization_flag = 1 AND main_keyword != best_keyword AND is_self_canonical = TRUE THEN 'Cannibalizing main + best keywords'
	WHEN http_status_code = 200 AND main_keyword_cannibalization_flag = 1 AND best_keyword_cannibalization_flag = 0 AND is_self_canonical = TRUE THEN 'Cannibalizing main keyword'
	WHEN http_status_code = 200 AND main_keyword_cannibalization_flag = 0 AND best_keyword_cannibalization_flag = 1 AND is_self_canonical = TRUE THEN 'Cannibalizing best keyword'
	ELSE '' END as cannibalization_action,

CASE WHEN http_status_code != 200 OR flag_paginated = 1 OR canonical_status = 'canonicalized' THEN '' 
	WHEN http_status_code = 200 AND sessions_30d != 0 AND sessions_30d_mom != 0 AND (sessions_30d - sessions_30d_mom)/sessions_30d > 0 AND total_organic_sessions_mom_pct > 0 AND (sessions_30d - sessions_30d_mom)/sessions_30d > (total_organic_sessions_mom_pct*1.25) THEN 'Rising content'
	WHEN http_status_code = 200 AND sessions_30d != 0 AND sessions_30d_mom != 0 AND (sessions_30d - sessions_30d_mom)/sessions_30d > 0 AND total_organic_sessions_mom_pct < 0 THEN 'Rising content'
	WHEN http_status_code = 200 AND sessions_30d != 0 AND sessions_30d_mom != 0 AND (sessions_30d - sessions_30d_mom)/sessions_30d < 0 AND total_organic_sessions_mom_pct < 0 AND (sessions_30d - sessions_30d_mom)/sessions_30d < (total_organic_sessions_mom_pct*1.25) THEN 'Falling content'
	WHEN http_status_code = 200 AND sessions_30d != 0 AND sessions_30d_mom != 0 AND (sessions_30d - sessions_30d_mom)/sessions_30d < 0 AND total_organic_sessions_mom_pct > 0 THEN 'Falling content'
	ELSE '' END as content_trajectory,
		
CASE WHEN http_status_code != 200 OR flag_paginated = 1 OR canonical_status = 'canonicalized' THEN ''
	WHEN http_status_code = 200 AND sessions_30d < 5 and transactions_30d = 0 and goal_completions_all_goals_30d = 0 and backlink_count > 0 THEN 'Potential 301: low traffic, has external links'
	WHEN http_status_code = 200 AND sessions_30d < 5 and transactions_30d = 0 and goal_completions_all_goals_30d = 0 and backlink_count = 0  THEN 'Potential removal: low traffic, 0 conversions or backlinks'
	WHEN http_status_code = 200 AND page_type = 'lead generation' and transactions_30d = 0 and goal_completions_all_goals_30d = 0 
	AND ( transactions_ttm > 0 or goal_completions_all_goals_ttm > 0 ) THEN 'inactive lead gen page: 0 conversions'
	ELSE '' END as content_action,

CASE WHEN http_status_code != 200 OR flag_paginated = 1 OR canonical_status = 'canonicalized' THEN '' 
	WHEN http_status_code = 200 AND internal_links_out_count <= bottom_quartile_internal_links_out_count and ( sessions_30d > med_sessions_30d or ref_domain_count >= med_ref_domain_count ) THEN 'Add internal outlinks'
	WHEN http_status_code = 200 AND internal_links_in_count <= bottom_quartile_internal_links_in_count and ( sessions_30d > med_sessions_30d or ref_domain_count >= med_ref_domain_count ) THEN 'Add internal inlinks'
	WHEN http_status_code = 200 AND internal_links_in_count >= top_quartile_internal_links_in_count and ( sessions_30d <= bottom_quartile_sessions_30d or ref_domain_count <= bottom_quartile_ref_domain_count ) THEN 'Reduce internal inlinks'
	ELSE '' END as internal_link_action,

CASE WHEN http_status_code != 200 OR flag_paginated = 1 OR canonical_status = 'canonicalized' THEN '' 
	WHEN http_status_code = 200 AND ((main_avg_position >= 3 and main_avg_position <= 25 ) or ( best_avg_position >= 3 and best_avg_position <= 25 )) THEN 'Target external links: KWs within reach'
	WHEN http_status_code = 200 AND ( top_20_keywords - top_3_keywords ) >= 3 THEN 'Target external links: KWs within reach'
	WHEN http_status_code = 200 AND sessions_mom_pct > total_organic_sessions_mom_pct AND ref_domain_count < med_ref_domain_count THEN 'Target external links: rising content'
	ELSE '' END as external_link_action,

CASE WHEN http_status_code != 200 OR flag_paginated = 1 OR canonical_status = 'canonicalized' THEN '' 
	WHEN http_status_code = 200 AND (description is null or page_title is null ) and http_status_code is not null then 'Metas missing' 
	WHEN http_status_code = 200 AND (title_contains_top_keyword + description_contains_top_keyword) = 0 AND (best_impressions > 0 OR main_impressions > 0) then concat('Update metas to include main or best keyword') 
	WHEN http_status_code = 200 AND impressions_mom_pct > total_impressions_mom_pct and ctr_30d < med_ctr_30d AND (best_impressions > 0 OR main_impressions > 0) THEN 'Low CTR: review meta relevance for top keywords'
	else '' end as meta_rewrite_action,

-- category actions (only display pagination_action if category_action is blank)

-- case when page_type = 'category' and page_type_rank > 10 and sessions_30d < 5 and url not like '%/page/%' then concat('potential 301 to top category: ', first_value(url) over (partition by page_type, domain, date order by page_type_rank asc)) else '' end as category_action,
'' as category_action,

case when page_type = 'category' and flag_paginated = 0 and url_contains_digit = 1 then 'Needs pagination' else '' end as pagination_action,

url_stripped,
url_protocol,
canonical_url_protocol,
protocol_match,
protocol_count,
canonical_status,
urls_to_canonical,
first_subfolder,
second_subfolder,
last_subfolder,
last_subfolder_canonical,
http_status_code,
level,
schema_type,
header_content_type,
word_count, 
page_title,
title_contains_top_keyword,
page_title_length,
description,
description_contains_top_keyword,
description_length,
indexable,
robots_noindex,
meta_noindex,
is_noindex,
is_self_canonical,
redirected_to_url,
found_at_url,
rel_next_url,
rel_prev_url,
flag_paginated,
internal_links_in_count,
bottom_quartile_internal_links_in_count,
top_quartile_internal_links_in_count,
links_out_count,
external_links_count,
internal_links_out_count,
bottom_quartile_internal_links_out_count,
h1_tag,
h2_tag,
redirect_chain,
redirected_to_status_code,
is_redirect_loop,
duplicate_page,
duplicate_page_count,
duplicate_body,
duplicate_body_count,

-- ga + gsc data
sessions_30d,
sessions_30d_mom,
bottom_quartile_sessions_30d,
med_sessions_30d,
pct_of_organic_sessions_30d,
transaction_revenue_30d,
transaction_revenue_30d_mom,
transactions_30d,
transactions_30d_mom,
pct_of_organic_transactions_30d,
ecommerce_conversion_rate_30d,
med_transaction_conversion_rate_30d,
goal_completions_all_goals_30d,
goal_completions_all_goals_30d_mom,
pct_of_organic_goal_completions_all_goals_30d,
goal_conversion_rate_all_goals_30d,
med_goal_conversion_rate_30d,
blended_conversions_30d,	
blended_conversion_rate_30d,
bounce_rate_30d,
avg_seconds_on_site_30d,
sessions_mom,
sessions_mom_pct,
total_organic_sessions_mom_pct,
transaction_revenue_mom,
transaction_revenue_mom_pct,
transactions_mom,
transactions_mom_pct,
ecommerce_conversion_rate_mom_pct,
total_organic_ecommerce_conversion_rate_mom_pct,
goal_completions_all_goals_mom,
goal_completions_all_goals_mom_pct,
goal_conversion_rate_all_goals_mom_pct,
total_organic_goal_conversion_rate_mom_pct,
sessions_yoy,
sessions_yoy_pct,
total_organic_sessions_yoy_pct,
transaction_revenue_yoy,
transaction_revenue_yoy_pct,
transactions_yoy,
transactions_yoy_pct,
ecommerce_conversion_rate_yoy_pct,
total_organic_ecommerce_conversion_rate_yoy_pct,
goal_completions_all_goals_yoy,
goal_completions_all_goals_yoy_pct,
goal_conversion_rate_all_goals_yoy_pct,
total_organic_goal_conversion_rate_yoy_pct,
sessions_ttm,
transaction_revenue_ttm,
transactions_ttm,
ecommerce_conversion_rate_ttm,
goal_completions_all_goals_ttm,
goal_conversion_rate_all_goals_ttm,
bounce_rate_ttm,
avg_seconds_on_site_ttm,
gaining_traffic_mom,
gaining_traffic_yoy,
backlink_count,
ref_domain_count,
med_ref_domain_count,
bottom_quartile_ref_domain_count,
impressions_30d,
pct_of_total_impressions_30d,
med_impressions_30d,
top_10pct_impressions_30d,
total_impressions_30d,
clicks_30d,
total_clicks_30d,
ctr_30d,
med_ctr_30d,
total_ctr_30d,
avg_position_30d,
impressions_mom,
total_impressions_mom,
impressions_mom_pct,
total_impressions_mom_pct,
clicks_mom,
total_clicks_mom,
clicks_mom_pct,
total_clicks_mom_pct,
ctr_mom,
total_ctr_mom,
ctr_mom_pct,
total_ctr_mom_pct,
avg_position_mom,
impressions_yoy,
total_impressions_yoy,
impressions_yoy_pct,
total_impressions_yoy_pct,
clicks_yoy,
total_clicks_yoy,
clicks_yoy_pct,
total_clicks_yoy_pct,
ctr_yoy,	
total_ctr_yoy,
ctr_yoy_pct,
total_ctr_yoy_pct,
avg_position_yoy,
impressions_ttm,
clicks_ttm,
ctr_ttm,
avg_position_ttm,	
top_3_keywords,
top_5_keywords,
top_10_keywords,
top_20_keywords,
main_keyword,
main_impressions,
main_clicks,
main_avg_position,
main_top_url,
main_keyword_cannibalization_flag,
main_top_url_clicks,
best_keyword,
best_impressions,
best_clicks,
best_avg_position,
best_top_url,
best_top_url_clicks,
best_keyword_cannibalization_flag
FROM agg_all
-- WHERE ( sessions_30d > 0 or sessions_mom > 0 or sessions_yoy > 0 or page_type is not null )
limit 500
/* limit added automatically by dbt cloud */
2022-01-25 02:02:07.555766 (Thread-97): handling poll request
2022-01-25 02:02:07.556265 (Thread-97): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe882ddd90>]}
2022-01-25 02:02:07.558349 (Thread-97): sending response (<Response 20156 bytes [200 OK]>) to 10.0.18.33
2022-01-25 02:02:08.918823 (Thread-98): handling poll request
2022-01-25 02:02:08.919306 (Thread-98): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe88375790>]}
2022-01-25 02:02:08.920197 (Thread-98): sending response (<Response 399 bytes [200 OK]>) to 10.0.41.222
2022-01-25 02:02:10.267356 (Thread-99): handling poll request
2022-01-25 02:02:10.267784 (Thread-99): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe88375100>]}
2022-01-25 02:02:10.268619 (Thread-99): sending response (<Response 399 bytes [200 OK]>) to 10.0.35.206
2022-01-25 02:02:11.457332 (Thread-1): finished collecting timing info
2022-01-25 02:02:11.628450 (Thread-100): handling poll request
2022-01-25 02:02:11.628941 (Thread-100): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe882cf6d0>]}
2022-01-25 02:02:11.629924 (Thread-100): sending response (<Response 807 bytes [200 OK]>) to 10.0.27.56
2022-01-25 02:02:12.979438 (Thread-101): handling poll request
2022-01-25 02:02:12.979869 (Thread-101): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe882cfd90>]}
2022-01-25 02:02:13.054106 (Thread-101): sending response (<Response 904075 bytes [200 OK]>) to 10.0.42.85
2022-01-25 02:05:48.393647 (Thread-102): handling status request
2022-01-25 02:05:48.395252 (Thread-102): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe88375550>]}
2022-01-25 02:05:48.403400 (Thread-102): sending response (<Response 32943 bytes [200 OK]>) to 10.0.18.33
2022-01-25 02:05:48.681120 (Thread-103): handling status request
2022-01-25 02:05:48.681561 (Thread-103): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe882cfe50>]}
2022-01-25 02:05:48.689691 (Thread-103): sending response (<Response 32943 bytes [200 OK]>) to 10.0.35.206
2022-01-25 02:05:48.743034 (Thread-104): handling cli_args request
2022-01-25 02:05:48.743538 (Thread-104): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe882d9be0>]}
2022-01-25 02:05:49.558684 (Thread-104): sending response (<Response 137 bytes [200 OK]>) to 10.0.18.33
2022-01-25 02:05:49.627802 (MainThread): Partial parsing not enabled
2022-01-25 02:05:49.631208 (MainThread): Parsing macros/generate_schema_name.sql
2022-01-25 02:05:49.632816 (MainThread): Parsing macros/catalog.sql
2022-01-25 02:05:49.638916 (MainThread): Parsing macros/adapters.sql
2022-01-25 02:05:49.656275 (MainThread): Parsing macros/etc.sql
2022-01-25 02:05:49.657602 (MainThread): Parsing macros/materializations/table.sql
2022-01-25 02:05:49.666565 (MainThread): Parsing macros/materializations/seed.sql
2022-01-25 02:05:49.669133 (MainThread): Parsing macros/materializations/view.sql
2022-01-25 02:05:49.671739 (MainThread): Parsing macros/materializations/snapshot.sql
2022-01-25 02:05:49.673548 (MainThread): Parsing macros/materializations/incremental.sql
2022-01-25 02:05:49.685108 (MainThread): Parsing macros/materializations/copy.sql
2022-01-25 02:05:49.689821 (MainThread): Parsing macros/core.sql
2022-01-25 02:05:49.693198 (MainThread): Parsing macros/materializations/helpers.sql
2022-01-25 02:05:49.701311 (MainThread): Parsing macros/materializations/view/view.sql
2022-01-25 02:05:49.707091 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-01-25 02:05:49.711710 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-01-25 02:05:49.730881 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-01-25 02:05:49.746003 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-01-25 02:05:49.747785 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-01-25 02:05:49.773894 (MainThread): Parsing macros/materializations/table/table.sql
2022-01-25 02:05:49.780162 (MainThread): Parsing macros/materializations/common/merge.sql
2022-01-25 02:05:49.793031 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-01-25 02:05:49.798709 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-01-25 02:05:49.800459 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-01-25 02:05:49.801450 (MainThread): Parsing macros/etc/datetime.sql
2022-01-25 02:05:49.809454 (MainThread): Parsing macros/etc/query.sql
2022-01-25 02:05:49.810500 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-01-25 02:05:49.812109 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-01-25 02:05:49.813995 (MainThread): Parsing macros/etc/is_incremental.sql
2022-01-25 02:05:49.815558 (MainThread): Parsing macros/adapters/common.sql
2022-01-25 02:05:49.854669 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-01-25 02:05:49.857328 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-01-25 02:05:49.858865 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-01-25 02:05:49.860747 (MainThread): Parsing macros/schema_tests/unique.sql
2022-01-25 02:05:49.877040 (MainThread): Parsing macros/logger/pretty_time.sql
2022-01-25 02:05:49.880015 (MainThread): Parsing macros/logger/log_info.sql
2022-01-25 02:05:49.882577 (MainThread): Parsing macros/logger/pretty_log_format.sql
2022-01-25 02:05:49.885409 (MainThread): Parsing macros/sql/pivot.sql
2022-01-25 02:05:49.890860 (MainThread): Parsing macros/sql/star.sql
2022-01-25 02:05:49.895744 (MainThread): Parsing macros/sql/surrogate_key.sql
2022-01-25 02:05:49.901047 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2022-01-25 02:05:49.907471 (Thread-105): handling poll request
2022-01-25 02:05:49.907899 (Thread-105): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe882eb430>]}
2022-01-25 02:05:49.911911 (Thread-105): sending response (<Response 11496 bytes [200 OK]>) to 10.0.24.39
2022-01-25 02:05:49.905052 (MainThread): Parsing macros/sql/get_column_values.sql
2022-01-25 02:05:49.911711 (MainThread): Parsing macros/sql/groupby.sql
2022-01-25 02:05:49.914804 (MainThread): Parsing macros/sql/get_tables_by_pattern_sql.sql
2022-01-25 02:05:49.922610 (MainThread): Parsing macros/sql/nullcheck_table.sql
2022-01-25 02:05:49.926010 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2022-01-25 02:05:49.929536 (MainThread): Parsing macros/sql/get_relations_by_pattern.sql
2022-01-25 02:05:49.934775 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2022-01-25 02:05:49.939850 (MainThread): Parsing macros/sql/safe_add.sql
2022-01-25 02:05:49.943096 (MainThread): Parsing macros/sql/unpivot.sql
2022-01-25 02:05:49.952312 (MainThread): Parsing macros/sql/generate_series.sql
2022-01-25 02:05:49.958204 (MainThread): Parsing macros/sql/nullcheck.sql
2022-01-25 02:05:49.961241 (MainThread): Parsing macros/sql/union.sql
2022-01-25 02:05:49.971091 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2022-01-25 02:05:49.996414 (MainThread): Parsing macros/web/get_url_parameter.sql
2022-01-25 02:05:49.999797 (MainThread): Parsing macros/web/get_url_path.sql
2022-01-25 02:05:50.003987 (MainThread): Parsing macros/web/get_url_host.sql
2022-01-25 02:05:50.007433 (MainThread): Parsing macros/datetime/date_spine.sql
2022-01-25 02:05:50.013791 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2022-01-25 02:05:50.017591 (MainThread): Parsing macros/schema_tests/not_constant.sql
2022-01-25 02:05:50.020790 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2022-01-25 02:05:50.023936 (MainThread): Parsing macros/schema_tests/equality.sql
2022-01-25 02:05:50.029425 (MainThread): Parsing macros/schema_tests/test_not_null_where.sql
2022-01-25 02:05:50.032810 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2022-01-25 02:05:50.036109 (MainThread): Parsing macros/schema_tests/test_unique_where.sql
2022-01-25 02:05:50.040079 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2022-01-25 02:05:50.047973 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2022-01-25 02:05:50.051942 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2022-01-25 02:05:50.056698 (MainThread): Parsing macros/schema_tests/recency.sql
2022-01-25 02:05:50.060227 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2022-01-25 02:05:50.065978 (MainThread): Parsing macros/geo/haversine_distance.sql
2022-01-25 02:05:50.069281 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2022-01-25 02:05:50.073824 (MainThread): Parsing macros/cross_db_utils/length.sql
2022-01-25 02:05:50.077534 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2022-01-25 02:05:50.083186 (MainThread): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2022-01-25 02:05:50.085458 (MainThread): Parsing macros/cross_db_utils/right.sql
2022-01-25 02:05:50.089295 (MainThread): Parsing macros/cross_db_utils/hash.sql
2022-01-25 02:05:50.092369 (MainThread): Parsing macros/cross_db_utils/replace.sql
2022-01-25 02:05:50.095433 (MainThread): Parsing macros/cross_db_utils/concat.sql
2022-01-25 02:05:50.099350 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2022-01-25 02:05:50.101984 (MainThread): Parsing macros/cross_db_utils/identifier.sql
2022-01-25 02:05:50.105283 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2022-01-25 02:05:50.115938 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2022-01-25 02:05:50.120021 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2022-01-25 02:05:50.128804 (MainThread): Parsing macros/cross_db_utils/position.sql
2022-01-25 02:05:50.132030 (MainThread): Parsing macros/cross_db_utils/literal.sql
2022-01-25 02:05:50.134929 (MainThread): Parsing macros/cross_db_utils/_is_ephemeral.sql
2022-01-25 02:05:50.138268 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2022-01-25 02:05:50.144857 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2022-01-25 02:05:50.148144 (MainThread): Parsing macros/cross_db_utils/except.sql
2022-01-25 02:05:50.150932 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2022-01-25 02:05:50.154687 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2022-01-25 02:05:50.159215 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2022-01-25 02:05:50.168750 (MainThread): Partial parsing not enabled
2022-01-25 02:05:50.227032 (MainThread): Acquiring new bigquery connection "model.tech_audit.agg_all".
2022-01-25 02:05:50.251861 (MainThread): Acquiring new bigquery connection "model.tech_audit.agg_traffic".
2022-01-25 02:05:50.268289 (MainThread): Acquiring new bigquery connection "model.tech_audit.actions_diffs_count".
2022-01-25 02:05:50.289218 (MainThread): Acquiring new bigquery connection "model.tech_audit.actions_diffs".
2022-01-25 02:05:50.304711 (MainThread): Acquiring new bigquery connection "model.tech_audit.actions_count".
2022-01-25 02:05:50.324465 (MainThread): Acquiring new bigquery connection "model.tech_audit.actions_data_studio".
2022-01-25 02:05:50.337239 (MainThread): Acquiring new bigquery connection "model.tech_audit.domains_proc".
2022-01-25 02:05:50.348346 (MainThread): Acquiring new bigquery connection "model.tech_audit.crawl_dates".
2022-01-25 02:05:50.362131 (MainThread): Acquiring new bigquery connection "model.tech_audit.dates".
2022-01-25 02:05:50.376152 (MainThread): Acquiring new bigquery connection "model.tech_audit.ga_stats".
2022-01-25 02:05:50.390979 (MainThread): Acquiring new bigquery connection "model.tech_audit.ga_proc_url_mapping".
2022-01-25 02:05:50.405021 (MainThread): Acquiring new bigquery connection "model.tech_audit.ga_proc".
2022-01-25 02:05:50.419911 (MainThread): Acquiring new bigquery connection "model.tech_audit.search_console_keyword_stats".
2022-01-25 02:05:50.434426 (MainThread): Acquiring new bigquery connection "model.tech_audit.search_console_url_proc_url_mapping".
2022-01-25 02:05:50.448147 (MainThread): Acquiring new bigquery connection "model.tech_audit.search_console_url_keyword_stats".
2022-01-25 02:05:50.463421 (MainThread): Acquiring new bigquery connection "model.tech_audit.search_console_keyword_proc_url_mapping".
2022-01-25 02:05:50.477128 (MainThread): Acquiring new bigquery connection "model.tech_audit.search_console_url_stats".
2022-01-25 02:05:50.491177 (MainThread): Acquiring new bigquery connection "model.tech_audit.search_console_keyword_proc".
2022-01-25 02:05:50.504870 (MainThread): Acquiring new bigquery connection "model.tech_audit.search_console_url_proc".
2022-01-25 02:05:50.519655 (MainThread): Acquiring new bigquery connection "model.tech_audit.deepcrawl_proc".
2022-01-25 02:05:50.534843 (MainThread): Acquiring new bigquery connection "model.tech_audit.deepcrawl_latest_crawl_proc".
2022-01-25 02:05:50.548379 (MainThread): Acquiring new bigquery connection "model.tech_audit.deepcrawl_url_proc".
2022-01-25 02:05:50.561616 (MainThread): Acquiring new bigquery connection "model.tech_audit.deepcrawl_stats".
2022-01-25 02:05:50.575155 (MainThread): Acquiring new bigquery connection "model.tech_audit.actions_proc".
2022-01-25 02:05:50.589061 (MainThread): Acquiring new bigquery connection "model.tech_audit.actions_hierarchy".
2022-01-25 02:05:51.014034 (MainThread): Found 25 models, 0 tests, 0 snapshots, 0 analyses, 327 macros, 0 operations, 0 seed files, 5 sources
2022-01-25 02:05:51.018045 (MainThread): 
2022-01-25 02:05:51.018366 (MainThread): Acquiring new bigquery connection "master".
2022-01-25 02:05:51.043220 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_seo-data-pipeline-89".
2022-01-25 02:05:51.043385 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-01-25 02:05:51.274391 (Thread-106): handling poll request
2022-01-25 02:05:51.274817 (Thread-106): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe882e7f40>]}
2022-01-25 02:05:51.280829 (Thread-106): sending response (<Response 24055 bytes [200 OK]>) to 10.0.35.206
2022-01-25 02:05:51.292770 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_seo-data-pipeline-89_adp_thecifhw".
2022-01-25 02:05:51.292906 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-01-25 02:05:51.594139 (MainThread): 02:05:51 | Concurrency: 1 threads (target='default')
2022-01-25 02:05:51.594272 (MainThread): 02:05:51 | 
2022-01-25 02:05:51.596380 (Thread-1): Began running node model.tech_audit.domains_proc
2022-01-25 02:05:51.597320 (Thread-1): 02:05:51 | 1 of 25 START table model adp_thecifhw.domains_proc.................. [RUN]
2022-01-25 02:05:51.597570 (Thread-1): Acquiring new bigquery connection "model.tech_audit.domains_proc".
2022-01-25 02:05:51.597654 (Thread-1): Compiling model.tech_audit.domains_proc
2022-01-25 02:05:51.610167 (Thread-1): Writing injected SQL for node "model.tech_audit.domains_proc"
2022-01-25 02:05:51.625597 (Thread-1): finished collecting timing info
2022-01-25 02:05:51.645372 (Thread-1): Opening a new connection, currently in state closed
2022-01-25 02:05:51.890847 (Thread-1): Writing runtime SQL for node "model.tech_audit.domains_proc"
2022-01-25 02:05:51.904867 (Thread-1): On model.tech_audit.domains_proc: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.tech_audit.domains_proc"} */


  create or replace table `seo-data-pipeline-89`.`adp_thecifhw`.`domains_proc`
  
  
  OPTIONS()
  as (
    SELECT
site,
domain,
search_console_account,
google_analytics_account
FROM (

	SELECT
	distinct(client_name) site,
	trim(replace(replace(replace(domain,'www.',''),'http://',''),'https://',''),'/') domain,
	domain search_console_account,
	case when data_source = 'Google Analytics' then account end google_analytics_account,
	og_time_of_entry time_of_entry,
	first_value(og_time_of_entry) OVER (PARTITION BY client_name ORDER BY og_time_of_entry DESC) lv
	FROM `seo-data-pipeline-89.bq_sources.accounts`
	WHERE client_name is not null
)
WHERE lv = time_of_entry AND google_analytics_account is not null
group by site, domain, search_console_account, google_analytics_account
  );
    
2022-01-25 02:05:52.288155 (Thread-1): finished collecting timing info
2022-01-25 02:05:52.288719 (Thread-1): Database Error in model domains_proc (models/admin/domains_proc.sql)
  Billing has not been enabled for this project. Enable billing at https://console.cloud.google.com/billing. Table expiration time must be less than 60 days while in sandbox mode.
  compiled SQL at target/run/tech_audit/models/admin/domains_proc.sql
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/bigquery/connections.py", line 103, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/bigquery/connections.py", line 442, in _retry_and_handle
    return retry.retry_target(
  File "/usr/local/lib/python3.8/dist-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/bigquery/connections.py", line 266, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/bigquery/connections.py", line 428, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/lib/python3.8/dist-packages/google/cloud/bigquery/job.py", line 3207, in result
    super(QueryJob, self).result(retry=retry, timeout=timeout)
  File "/usr/local/lib/python3.8/dist-packages/google/cloud/bigquery/job.py", line 812, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/lib/python3.8/dist-packages/google/api_core/future/polling.py", line 127, in result
    raise self._exception
google.api_core.exceptions.Forbidden: 403 Billing has not been enabled for this project. Enable billing at https://console.cloud.google.com/billing. Table expiration time must be less than 60 days while in sandbox mode.

(job ID: 15b3ca48-a522-4f76-a0c5-0dbb4888edb7)

                                                        -----Query Job SQL Follows-----                                                         

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.tech_audit.domains_proc"} */
   2:
   3:
   4:  create or replace table `seo-data-pipeline-89`.`adp_thecifhw`.`domains_proc`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    SELECT
  10:site,
  11:domain,
  12:search_console_account,
  13:google_analytics_account
  14:FROM (
  15:
  16:	SELECT
  17:	distinct(client_name) site,
  18:	trim(replace(replace(replace(domain,'www.',''),'http://',''),'https://',''),'/') domain,
  19:	domain search_console_account,
  20:	case when data_source = 'Google Analytics' then account end google_analytics_account,
  21:	og_time_of_entry time_of_entry,
  22:	first_value(og_time_of_entry) OVER (PARTITION BY client_name ORDER BY og_time_of_entry DESC) lv
  23:	FROM `seo-data-pipeline-89.bq_sources.accounts`
  24:	WHERE client_name is not null
  25:)
  26:WHERE lv = time_of_entry AND google_analytics_account is not null
  27:group by site, domain, search_console_account, google_analytics_account
  28:  );
  29:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 333, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 276, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 378, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/run.py", line 233, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 128, in macro
  File "/usr/local/lib/python3.8/dist-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/lib/python3.8/dist-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 224, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/bigquery/connections.py", line 275, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/bigquery/connections.py", line 268, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/bigquery/connections.py", line 442, in _retry_and_handle
    return retry.retry_target(
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/bigquery/connections.py", line 111, in exception_handler
    self.handle_error(e, message)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/bigquery/connections.py", line 95, in handle_error
    raise DatabaseException(error_msg)
dbt.exceptions.DatabaseException: Database Error in model domains_proc (models/admin/domains_proc.sql)
  Billing has not been enabled for this project. Enable billing at https://console.cloud.google.com/billing. Table expiration time must be less than 60 days while in sandbox mode.
  compiled SQL at target/run/tech_audit/models/admin/domains_proc.sql
2022-01-25 02:05:52.290994 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a64fca5b-db69-4558-af77-b48a38a2711e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd718f65700>]}
2022-01-25 02:05:52.292093 (Thread-1): 02:05:52 | 1 of 25 ERROR creating table model adp_thecifhw.domains_proc......... [ERROR in 0.69s]
2022-01-25 02:05:52.292187 (Thread-1): Finished running node model.tech_audit.domains_proc
2022-01-25 02:05:52.292291 (Thread-1): Began running node model.tech_audit.deepcrawl_latest_crawl_proc
2022-01-25 02:05:52.293408 (Thread-1): 02:05:52 | 2 of 25 START table model adp_thecifhw.deepcrawl_latest_crawl_proc... [RUN]
2022-01-25 02:05:52.293621 (Thread-1): Acquiring new bigquery connection "model.tech_audit.deepcrawl_latest_crawl_proc".
2022-01-25 02:05:52.293695 (Thread-1): Compiling model.tech_audit.deepcrawl_latest_crawl_proc
2022-01-25 02:05:52.301514 (Thread-1): Writing injected SQL for node "model.tech_audit.deepcrawl_latest_crawl_proc"
2022-01-25 02:05:52.334259 (Thread-1): finished collecting timing info
2022-01-25 02:05:52.340401 (Thread-1): Opening a new connection, currently in state closed
2022-01-25 02:05:52.526533 (Thread-1): Writing runtime SQL for node "model.tech_audit.deepcrawl_latest_crawl_proc"
2022-01-25 02:05:52.561391 (Thread-1): On model.tech_audit.deepcrawl_latest_crawl_proc: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.tech_audit.deepcrawl_latest_crawl_proc"} */


  create or replace table `seo-data-pipeline-89`.`adp_thecifhw`.`deepcrawl_latest_crawl_proc`
  
  
  OPTIONS()
  as (
    SELECT DISTINCT * 
FROM (

    SELECT 
    domain,
    eventid,
    url,
    crawl_id,
    RANK () over (PARTITION BY domain, url, crawl_report_month ORDER BY crawl_id desc) as rank_crawl,
    RANK () over (PARTITION BY crawl_id, domain, url, crawl_report_month ORDER BY eventid asc) as rank_event,
    primary_url,
    canonical_url,  
    crawl_datetime,  
    crawl_date,
    crawl_month,
    crawl_report_month,
    found_at_sitemap,
    http_status_code,
    level,
    schema_type,
    header_content_type,
    word_count, 
    page_title,
    page_title_length,
    description,
    description_length,
    indexable,
    robots_noindex,
    meta_noindex,
    is_self_canonical,
    backlink_count,
    backlink_domain_count,
    redirected_to_url,
    found_at_url,
    rel_next_url,
    rel_prev_url,
    links_in_count,
    links_out_count,
    external_links_count,
    internal_links_count,
    h1_tag,
    h2_tag,
    redirect_chain,
    redirected_to_status_code,
    is_redirect_loop,
    duplicate_page,
    duplicate_page_count,
    duplicate_body,
    duplicate_body_count,
    form_submit,
    infinite_scroll,
    decimal_price,
    currency_price,
    google_maps,
    add_to_cart,
    learn_more,
    review,
    size,
    paginated_page     
    FROM 
     ( 
        --  SELECT 
        -- Crawl_id as crawl_id,
        -- regexp_extract(Url,r'^(?:https?:\/\/)?(?:www\.)?([^\/]+)') as domain,
        -- EventId as eventid,
        -- Crawl_Datetime as crawl_datetime,  
        -- cast(Crawl_Datetime as date) crawl_date,
        -- DATE_TRUNC(date( Crawl_Datetime ), month) as crawl_month,
        -- CASE WHEN extract(DAY from Crawl_Datetime) >= 15 THEN DATE_TRUNC(date( Crawl_Datetime ), month) ELSE date_sub(DATE_TRUNC(date( Crawl_Datetime ), month), INTERVAL 1 MONTH) END as crawl_report_month,
        -- Url as url,
        -- Primary_Url as primary_url,
        -- Canonical_Url as canonical_url,  
        -- Found_At_Sitemap as found_at_sitemap,
        -- Http_Status_Code as http_status_code,
        -- Level as level,
        -- Schema_Type as schema_type,
        -- Header_Content_Type as header_content_type,
        -- Word_Count as word_count, 
        -- Page_Title as page_title,
        -- Page_Title_Length as page_title_length,
        -- Description as description,
        -- Description_Length as description_length,
        -- Indexable as indexable,
        -- Robots_Noindex as robots_noindex,
        -- Meta_Noindex as meta_noindex,
        -- Is_Self_Canonical as is_self_canonical,
        -- Backlink_Count as  backlink_count,
        -- Backlink_Domain_Count as backlink_domain_count,
        -- Redirected_To_Url as redirected_to_url,
        -- Found_At_Url as found_at_url,
        -- Rel_Next_Url as rel_next_url,
        -- Rel_Prev_Url as rel_prev_url,
        -- Links_In_Count as links_in_count,
        -- Links_Out_Count as links_out_count,
        -- External_Links_Count as external_links_count,
        -- Internal_Links_Count as internal_links_count,
        -- H1_Tag as h1_tag,
        -- H2_Tag as h2_tag, 
        -- Redirect_Chain as redirect_chain,
        -- Redirected_To_Status_Code as redirected_to_status_code,
        -- Is_Redirect_Loop as is_redirect_loop,
        -- Duplicate_Page as duplicate_page,
        -- Duplicate_Page_Count as duplicate_page_count,
        -- Duplicate_Body as duplicate_body,
        -- Duplicate_Body_Count as duplicate_body_count,
        -- Form_Submit as form_submit,
        -- Infinite_Scroll as infinite_scroll,
        -- Decimal_Price as decimal_price,
        -- Currency_Price as currency_price,
        -- Google_Maps as google_maps,
        -- Add_To_Cart as add_to_cart,
        -- Learn_More as learn_more,
        -- Review as review,
        -- Size as size,
        -- Paginated_Page as paginated_page    
        -- FROM 
        --  `seo-data-pipeline-89.raw.deepcrawl`

        -- UNION ALL

        SELECT 
        crawl_id,
        regexp_extract(url,r'^(?:https?:\/\/)?(?:www\.)?([^\/]+)') as domain,
        1 as eventid,
        cast(crawl_datetime as timestamp) crawl_datetime, 
        cast(crawl_datetime as date) crawl_date,
        DATE_TRUNC(date( crawl_datetime ), month) as crawl_month,
        CASE WHEN extract(DAY from crawl_datetime) >= 15 THEN DATE_TRUNC(date( crawl_datetime ), month) ELSE date_sub(DATE_TRUNC(date( crawl_datetime ), month), INTERVAL 1 MONTH) END as crawl_report_month,
        url,
        primary_url,
        canonical_url,  
        found_at_sitemap,
        http_status_code,
        level,
        custom_extraction_7 schema_type,
        header_content_type,
        word_count, 
        page_title,
        page_title_length,
        description,
        description_length,
        indexable,
        robots_noindex,
        meta_noindex,
        is_self_canonical,
        CAST(backlink_count as int64) as backlink_count,
        CAST(backlink_domain_count AS int64) as backlink_domain_count,
        redirected_to_url,
        found_at_url,
        rel_next_url,
        rel_prev_url,
        links_in_count,
        links_out_count,
        external_links_count,
        internal_links_count,
        h1_tag,
        h2_tag,
        redirect_chain,
        redirected_to_status_code,
        is_redirect_loop,
        duplicate_page,
        duplicate_page_count,
        duplicate_body,
        duplicate_body_count,
        custom_extraction_10 as form_submit, -- qt_form_submit form_submit,
        custom_extraction_11 as infinite_scroll, -- qt_infinite_scroll infinite_scroll,
        custom_extraction_4 as decimal_price,
        custom_extraction_3 as currency_price,
        custom_extraction_12 google_maps, -- qt_google_maps google_maps,
        custom_extraction_2 add_to_cart, -- add_to_cart,
        custom_extraction_6 learn_more, -- learn_more,
        custom_extraction_5 review, -- review,
        custom_extraction_8 size, -- size,      
        paginated_page     
        FROM 
        `seo-data-pipeline-89`.`bq_sources`.`deepcrawl`  
     )
)

WHERE rank_crawl = 1 and rank_event =1
  );
    
2022-01-25 02:05:52.649887 (Thread-107): handling poll request
2022-01-25 02:05:52.650311 (Thread-107): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe8827eb20>]}
2022-01-25 02:05:52.653208 (Thread-107): sending response (<Response 25822 bytes [200 OK]>) to 10.0.25.116
2022-01-25 02:05:52.939350 (Thread-1): finished collecting timing info
2022-01-25 02:05:52.939886 (Thread-1): Database Error in model deepcrawl_latest_crawl_proc (models/base/deepcrawl/deepcrawl_latest_crawl_proc.sql)
  Billing has not been enabled for this project. Enable billing at https://console.cloud.google.com/billing. Table expiration time must be less than 60 days while in sandbox mode.
  compiled SQL at target/run/tech_audit/models/base/deepcrawl/deepcrawl_latest_crawl_proc.sql
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/bigquery/connections.py", line 103, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/bigquery/connections.py", line 442, in _retry_and_handle
    return retry.retry_target(
  File "/usr/local/lib/python3.8/dist-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/bigquery/connections.py", line 266, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/bigquery/connections.py", line 428, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/lib/python3.8/dist-packages/google/cloud/bigquery/job.py", line 3207, in result
    super(QueryJob, self).result(retry=retry, timeout=timeout)
  File "/usr/local/lib/python3.8/dist-packages/google/cloud/bigquery/job.py", line 812, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/lib/python3.8/dist-packages/google/api_core/future/polling.py", line 127, in result
    raise self._exception
google.api_core.exceptions.Forbidden: 403 Billing has not been enabled for this project. Enable billing at https://console.cloud.google.com/billing. Table expiration time must be less than 60 days while in sandbox mode.

(job ID: 4e107382-6c41-4170-af62-f73ee89fb395)

                                                                                           -----Query Job SQL Follows-----                                                                                           

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.tech_audit.deepcrawl_latest_crawl_proc"} */
   2:
   3:
   4:  create or replace table `seo-data-pipeline-89`.`adp_thecifhw`.`deepcrawl_latest_crawl_proc`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    SELECT DISTINCT * 
  10:FROM (
  11:
  12:    SELECT 
  13:    domain,
  14:    eventid,
  15:    url,
  16:    crawl_id,
  17:    RANK () over (PARTITION BY domain, url, crawl_report_month ORDER BY crawl_id desc) as rank_crawl,
  18:    RANK () over (PARTITION BY crawl_id, domain, url, crawl_report_month ORDER BY eventid asc) as rank_event,
  19:    primary_url,
  20:    canonical_url,  
  21:    crawl_datetime,  
  22:    crawl_date,
  23:    crawl_month,
  24:    crawl_report_month,
  25:    found_at_sitemap,
  26:    http_status_code,
  27:    level,
  28:    schema_type,
  29:    header_content_type,
  30:    word_count, 
  31:    page_title,
  32:    page_title_length,
  33:    description,
  34:    description_length,
  35:    indexable,
  36:    robots_noindex,
  37:    meta_noindex,
  38:    is_self_canonical,
  39:    backlink_count,
  40:    backlink_domain_count,
  41:    redirected_to_url,
  42:    found_at_url,
  43:    rel_next_url,
  44:    rel_prev_url,
  45:    links_in_count,
  46:    links_out_count,
  47:    external_links_count,
  48:    internal_links_count,
  49:    h1_tag,
  50:    h2_tag,
  51:    redirect_chain,
  52:    redirected_to_status_code,
  53:    is_redirect_loop,
  54:    duplicate_page,
  55:    duplicate_page_count,
  56:    duplicate_body,
  57:    duplicate_body_count,
  58:    form_submit,
  59:    infinite_scroll,
  60:    decimal_price,
  61:    currency_price,
  62:    google_maps,
  63:    add_to_cart,
  64:    learn_more,
  65:    review,
  66:    size,
  67:    paginated_page     
  68:    FROM 
  69:     ( 
  70:        --  SELECT 
  71:        -- Crawl_id as crawl_id,
  72:        -- regexp_extract(Url,r'^(?:https?:\/\/)?(?:www\.)?([^\/]+)') as domain,
  73:        -- EventId as eventid,
  74:        -- Crawl_Datetime as crawl_datetime,  
  75:        -- cast(Crawl_Datetime as date) crawl_date,
  76:        -- DATE_TRUNC(date( Crawl_Datetime ), month) as crawl_month,
  77:        -- CASE WHEN extract(DAY from Crawl_Datetime) >= 15 THEN DATE_TRUNC(date( Crawl_Datetime ), month) ELSE date_sub(DATE_TRUNC(date( Crawl_Datetime ), month), INTERVAL 1 MONTH) END as crawl_report_month,
  78:        -- Url as url,
  79:        -- Primary_Url as primary_url,
  80:        -- Canonical_Url as canonical_url,  
  81:        -- Found_At_Sitemap as found_at_sitemap,
  82:        -- Http_Status_Code as http_status_code,
  83:        -- Level as level,
  84:        -- Schema_Type as schema_type,
  85:        -- Header_Content_Type as header_content_type,
  86:        -- Word_Count as word_count, 
  87:        -- Page_Title as page_title,
  88:        -- Page_Title_Length as page_title_length,
  89:        -- Description as description,
  90:        -- Description_Length as description_length,
  91:        -- Indexable as indexable,
  92:        -- Robots_Noindex as robots_noindex,
  93:        -- Meta_Noindex as meta_noindex,
  94:        -- Is_Self_Canonical as is_self_canonical,
  95:        -- Backlink_Count as  backlink_count,
  96:        -- Backlink_Domain_Count as backlink_domain_count,
  97:        -- Redirected_To_Url as redirected_to_url,
  98:        -- Found_At_Url as found_at_url,
  99:        -- Rel_Next_Url as rel_next_url,
 100:        -- Rel_Prev_Url as rel_prev_url,
 101:        -- Links_In_Count as links_in_count,
 102:        -- Links_Out_Count as links_out_count,
 103:        -- External_Links_Count as external_links_count,
 104:        -- Internal_Links_Count as internal_links_count,
 105:        -- H1_Tag as h1_tag,
 106:        -- H2_Tag as h2_tag, 
 107:        -- Redirect_Chain as redirect_chain,
 108:        -- Redirected_To_Status_Code as redirected_to_status_code,
 109:        -- Is_Redirect_Loop as is_redirect_loop,
 110:        -- Duplicate_Page as duplicate_page,
 111:        -- Duplicate_Page_Count as duplicate_page_count,
 112:        -- Duplicate_Body as duplicate_body,
 113:        -- Duplicate_Body_Count as duplicate_body_count,
 114:        -- Form_Submit as form_submit,
 115:        -- Infinite_Scroll as infinite_scroll,
 116:        -- Decimal_Price as decimal_price,
 117:        -- Currency_Price as currency_price,
 118:        -- Google_Maps as google_maps,
 119:        -- Add_To_Cart as add_to_cart,
 120:        -- Learn_More as learn_more,
 121:        -- Review as review,
 122:        -- Size as size,
 123:        -- Paginated_Page as paginated_page    
 124:        -- FROM 
 125:        --  `seo-data-pipeline-89.raw.deepcrawl`
 126:
 127:        -- UNION ALL
 128:
 129:        SELECT 
 130:        crawl_id,
 131:        regexp_extract(url,r'^(?:https?:\/\/)?(?:www\.)?([^\/]+)') as domain,
 132:        1 as eventid,
 133:        cast(crawl_datetime as timestamp) crawl_datetime, 
 134:        cast(crawl_datetime as date) crawl_date,
 135:        DATE_TRUNC(date( crawl_datetime ), month) as crawl_month,
 136:        CASE WHEN extract(DAY from crawl_datetime) >= 15 THEN DATE_TRUNC(date( crawl_datetime ), month) ELSE date_sub(DATE_TRUNC(date( crawl_datetime ), month), INTERVAL 1 MONTH) END as crawl_report_month,
 137:        url,
 138:        primary_url,
 139:        canonical_url,  
 140:        found_at_sitemap,
 141:        http_status_code,
 142:        level,
 143:        custom_extraction_7 schema_type,
 144:        header_content_type,
 145:        word_count, 
 146:        page_title,
 147:        page_title_length,
 148:        description,
 149:        description_length,
 150:        indexable,
 151:        robots_noindex,
 152:        meta_noindex,
 153:        is_self_canonical,
 154:        CAST(backlink_count as int64) as backlink_count,
 155:        CAST(backlink_domain_count AS int64) as backlink_domain_count,
 156:        redirected_to_url,
 157:        found_at_url,
 158:        rel_next_url,
 159:        rel_prev_url,
 160:        links_in_count,
 161:        links_out_count,
 162:        external_links_count,
 163:        internal_links_count,
 164:        h1_tag,
 165:        h2_tag,
 166:        redirect_chain,
 167:        redirected_to_status_code,
 168:        is_redirect_loop,
 169:        duplicate_page,
 170:        duplicate_page_count,
 171:        duplicate_body,
 172:        duplicate_body_count,
 173:        custom_extraction_10 as form_submit, -- qt_form_submit form_submit,
 174:        custom_extraction_11 as infinite_scroll, -- qt_infinite_scroll infinite_scroll,
 175:        custom_extraction_4 as decimal_price,
 176:        custom_extraction_3 as currency_price,
 177:        custom_extraction_12 google_maps, -- qt_google_maps google_maps,
 178:        custom_extraction_2 add_to_cart, -- add_to_cart,
 179:        custom_extraction_6 learn_more, -- learn_more,
 180:        custom_extraction_5 review, -- review,
 181:        custom_extraction_8 size, -- size,      
 182:        paginated_page     
 183:        FROM 
 184:        `seo-data-pipeline-89`.`bq_sources`.`deepcrawl`  
 185:     )
 186:)
 187:
 188:WHERE rank_crawl = 1 and rank_event =1
 189:  );
 190:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 333, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 276, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 378, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/run.py", line 233, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 128, in macro
  File "/usr/local/lib/python3.8/dist-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/lib/python3.8/dist-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 224, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/bigquery/connections.py", line 275, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/bigquery/connections.py", line 268, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/bigquery/connections.py", line 442, in _retry_and_handle
    return retry.retry_target(
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/bigquery/connections.py", line 111, in exception_handler
    self.handle_error(e, message)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/bigquery/connections.py", line 95, in handle_error
    raise DatabaseException(error_msg)
dbt.exceptions.DatabaseException: Database Error in model deepcrawl_latest_crawl_proc (models/base/deepcrawl/deepcrawl_latest_crawl_proc.sql)
  Billing has not been enabled for this project. Enable billing at https://console.cloud.google.com/billing. Table expiration time must be less than 60 days while in sandbox mode.
  compiled SQL at target/run/tech_audit/models/base/deepcrawl/deepcrawl_latest_crawl_proc.sql
2022-01-25 02:05:52.940713 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a64fca5b-db69-4558-af77-b48a38a2711e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd718f65b80>]}
2022-01-25 02:05:52.941732 (Thread-1): 02:05:52 | 2 of 25 ERROR creating table model adp_thecifhw.deepcrawl_latest_crawl_proc [ERROR in 0.65s]
2022-01-25 02:05:52.941819 (Thread-1): Finished running node model.tech_audit.deepcrawl_latest_crawl_proc
2022-01-25 02:05:52.941926 (Thread-1): Began running node model.tech_audit.ga_proc
2022-01-25 02:05:52.942015 (Thread-1): 02:05:52 | 3 of 25 SKIP relation adp_thecifhw.ga_proc........................... [SKIP]
2022-01-25 02:05:52.942070 (Thread-1): Finished running node model.tech_audit.ga_proc
2022-01-25 02:05:52.942133 (Thread-1): Began running node model.tech_audit.search_console_url_proc
2022-01-25 02:05:52.942196 (Thread-1): 02:05:52 | 4 of 25 SKIP relation adp_thecifhw.search_console_url_proc........... [SKIP]
2022-01-25 02:05:52.942243 (Thread-1): Finished running node model.tech_audit.search_console_url_proc
2022-01-25 02:05:52.942303 (Thread-1): Began running node model.tech_audit.search_console_keyword_proc
2022-01-25 02:05:52.942362 (Thread-1): 02:05:52 | 5 of 25 SKIP relation adp_thecifhw.search_console_keyword_proc....... [SKIP]
2022-01-25 02:05:52.942408 (Thread-1): Finished running node model.tech_audit.search_console_keyword_proc
2022-01-25 02:05:52.943684 (Thread-1): Began running node model.tech_audit.deepcrawl_proc
2022-01-25 02:05:52.943788 (Thread-1): 02:05:52 | 6 of 25 SKIP relation adp_thecifhw.deepcrawl_proc.................... [SKIP]
2022-01-25 02:05:52.943845 (Thread-1): Finished running node model.tech_audit.deepcrawl_proc
2022-01-25 02:05:52.943941 (Thread-1): Began running node model.tech_audit.dates
2022-01-25 02:05:52.944011 (Thread-1): 02:05:52 | 7 of 25 SKIP relation adp_thecifhw.dates............................. [SKIP]
2022-01-25 02:05:52.944059 (Thread-1): Finished running node model.tech_audit.dates
2022-01-25 02:05:52.944643 (Thread-1): Began running node model.tech_audit.crawl_dates
2022-01-25 02:05:52.944754 (Thread-1): 02:05:52 | 8 of 25 SKIP relation adp_thecifhw.crawl_dates....................... [SKIP]
2022-01-25 02:05:52.944804 (Thread-1): Finished running node model.tech_audit.crawl_dates
2022-01-25 02:05:52.944869 (Thread-1): Began running node model.tech_audit.deepcrawl_url_proc
2022-01-25 02:05:52.944930 (Thread-1): 02:05:52 | 9 of 25 SKIP relation adp_thecifhw.deepcrawl_url_proc................ [SKIP]
2022-01-25 02:05:52.944975 (Thread-1): Finished running node model.tech_audit.deepcrawl_url_proc
2022-01-25 02:05:52.945529 (Thread-1): Began running node model.tech_audit.deepcrawl_stats
2022-01-25 02:05:52.945621 (Thread-1): 02:05:52 | 10 of 25 SKIP relation adp_thecifhw.deepcrawl_stats.................. [SKIP]
2022-01-25 02:05:52.945671 (Thread-1): Finished running node model.tech_audit.deepcrawl_stats
2022-01-25 02:05:52.946171 (Thread-1): Began running node model.tech_audit.search_console_keyword_proc_url_mapping
2022-01-25 02:05:52.946261 (Thread-1): 02:05:52 | 11 of 25 SKIP relation adp_thecifhw.search_console_keyword_proc_url_mapping [SKIP]
2022-01-25 02:05:52.946310 (Thread-1): Finished running node model.tech_audit.search_console_keyword_proc_url_mapping
2022-01-25 02:05:52.946375 (Thread-1): Began running node model.tech_audit.ga_proc_url_mapping
2022-01-25 02:05:52.946436 (Thread-1): 02:05:52 | 12 of 25 SKIP relation adp_thecifhw.ga_proc_url_mapping.............. [SKIP]
2022-01-25 02:05:52.946482 (Thread-1): Finished running node model.tech_audit.ga_proc_url_mapping
2022-01-25 02:05:52.946538 (Thread-1): Began running node model.tech_audit.search_console_url_proc_url_mapping
2022-01-25 02:05:52.946595 (Thread-1): 02:05:52 | 13 of 25 SKIP relation adp_thecifhw.search_console_url_proc_url_mapping [SKIP]
2022-01-25 02:05:52.946640 (Thread-1): Finished running node model.tech_audit.search_console_url_proc_url_mapping
2022-01-25 02:05:52.947411 (Thread-1): Began running node model.tech_audit.ga_stats
2022-01-25 02:05:52.947517 (Thread-1): 02:05:52 | 14 of 25 SKIP relation adp_thecifhw.ga_stats......................... [SKIP]
2022-01-25 02:05:52.947583 (Thread-1): Finished running node model.tech_audit.ga_stats
2022-01-25 02:05:52.947651 (Thread-1): Began running node model.tech_audit.search_console_url_keyword_stats
2022-01-25 02:05:52.947713 (Thread-1): 02:05:52 | 15 of 25 SKIP relation adp_thecifhw.search_console_url_keyword_stats. [SKIP]
2022-01-25 02:05:52.947758 (Thread-1): Finished running node model.tech_audit.search_console_url_keyword_stats
2022-01-25 02:05:52.947813 (Thread-1): Began running node model.tech_audit.search_console_url_stats
2022-01-25 02:05:52.947870 (Thread-1): 02:05:52 | 16 of 25 SKIP relation adp_thecifhw.search_console_url_stats......... [SKIP]
2022-01-25 02:05:52.947920 (Thread-1): Finished running node model.tech_audit.search_console_url_stats
2022-01-25 02:05:52.947977 (Thread-1): Began running node model.tech_audit.search_console_keyword_stats
2022-01-25 02:05:52.948035 (Thread-1): 02:05:52 | 17 of 25 SKIP relation adp_thecifhw.search_console_keyword_stats..... [SKIP]
2022-01-25 02:05:52.948080 (Thread-1): Finished running node model.tech_audit.search_console_keyword_stats
2022-01-25 02:05:52.948533 (Thread-1): Began running node model.tech_audit.agg_traffic
2022-01-25 02:05:52.948617 (Thread-1): 02:05:52 | 18 of 25 SKIP relation adp_thecifhw.agg_traffic...................... [SKIP]
2022-01-25 02:05:52.948704 (Thread-1): Finished running node model.tech_audit.agg_traffic
2022-01-25 02:05:52.949104 (Thread-1): Began running node model.tech_audit.agg_all
2022-01-25 02:05:52.949180 (Thread-1): 02:05:52 | 19 of 25 SKIP relation adp_thecifhw.agg_all.......................... [SKIP]
2022-01-25 02:05:52.949227 (Thread-1): Finished running node model.tech_audit.agg_all
2022-01-25 02:05:52.949825 (Thread-1): Began running node model.tech_audit.actions_proc
2022-01-25 02:05:52.949900 (Thread-1): 02:05:52 | 20 of 25 SKIP relation adp_thecifhw.actions_proc..................... [SKIP]
2022-01-25 02:05:52.949957 (Thread-1): Finished running node model.tech_audit.actions_proc
2022-01-25 02:05:52.950513 (Thread-1): Began running node model.tech_audit.actions_hierarchy
2022-01-25 02:05:52.950592 (Thread-1): 02:05:52 | 21 of 25 SKIP relation adp_thecifhw.actions_hierarchy................ [SKIP]
2022-01-25 02:05:52.950640 (Thread-1): Finished running node model.tech_audit.actions_hierarchy
2022-01-25 02:05:52.951089 (Thread-1): Began running node model.tech_audit.actions_diffs
2022-01-25 02:05:52.951174 (Thread-1): 02:05:52 | 22 of 25 SKIP relation adp_thecifhw.actions_diffs.................... [SKIP]
2022-01-25 02:05:52.951222 (Thread-1): Finished running node model.tech_audit.actions_diffs
2022-01-25 02:05:52.951287 (Thread-1): Began running node model.tech_audit.actions_count
2022-01-25 02:05:52.951346 (Thread-1): 02:05:52 | 23 of 25 SKIP relation adp_thecifhw.actions_count.................... [SKIP]
2022-01-25 02:05:52.951391 (Thread-1): Finished running node model.tech_audit.actions_count
2022-01-25 02:05:52.951447 (Thread-1): Began running node model.tech_audit.actions_data_studio
2022-01-25 02:05:52.951519 (Thread-1): 02:05:52 | 24 of 25 SKIP relation adp_thecifhw.actions_data_studio.............. [SKIP]
2022-01-25 02:05:52.951572 (Thread-1): Finished running node model.tech_audit.actions_data_studio
2022-01-25 02:05:52.952122 (Thread-1): Began running node model.tech_audit.actions_diffs_count
2022-01-25 02:05:52.952195 (Thread-1): 02:05:52 | 25 of 25 SKIP relation adp_thecifhw.actions_diffs_count.............. [SKIP]
2022-01-25 02:05:52.952254 (Thread-1): Finished running node model.tech_audit.actions_diffs_count
2022-01-25 02:05:52.953336 (MainThread): Acquiring new bigquery connection "master".
2022-01-25 02:05:52.953656 (MainThread): 02:05:52 | 
2022-01-25 02:05:52.953721 (MainThread): 02:05:52 | Finished running 25 table models in 1.94s.
2022-01-25 02:05:52.953769 (MainThread): Connection 'master' was properly closed.
2022-01-25 02:05:52.953807 (MainThread): Connection 'model.tech_audit.deepcrawl_latest_crawl_proc' was properly closed.
2022-01-25 02:05:53.052243 (MainThread): 
2022-01-25 02:05:53.052410 (MainThread): Completed with 2 errors and 0 warnings:
2022-01-25 02:05:53.052467 (MainThread): 
2022-01-25 02:05:53.052521 (MainThread): Database Error in model domains_proc (models/admin/domains_proc.sql)
2022-01-25 02:05:53.052562 (MainThread):   Billing has not been enabled for this project. Enable billing at https://console.cloud.google.com/billing. Table expiration time must be less than 60 days while in sandbox mode.
2022-01-25 02:05:53.052600 (MainThread):   compiled SQL at target/run/tech_audit/models/admin/domains_proc.sql
2022-01-25 02:05:53.052641 (MainThread): 
2022-01-25 02:05:53.052710 (MainThread): Database Error in model deepcrawl_latest_crawl_proc (models/base/deepcrawl/deepcrawl_latest_crawl_proc.sql)
2022-01-25 02:05:53.052751 (MainThread):   Billing has not been enabled for this project. Enable billing at https://console.cloud.google.com/billing. Table expiration time must be less than 60 days while in sandbox mode.
2022-01-25 02:05:53.052787 (MainThread):   compiled SQL at target/run/tech_audit/models/base/deepcrawl/deepcrawl_latest_crawl_proc.sql
2022-01-25 02:05:53.052843 (MainThread): 
Done. PASS=0 WARN=0 ERROR=2 SKIP=23 TOTAL=25
2022-01-25 02:05:54.010683 (Thread-108): handling poll request
2022-01-25 02:05:54.011120 (Thread-108): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe8827e0d0>]}
2022-01-25 02:05:54.061804 (Thread-108): sending response (<Response 269785 bytes [200 OK]>) to 10.0.24.171
2022-01-25 02:05:54.790360 (Thread-109): handling status request
2022-01-25 02:05:54.790783 (Thread-109): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe882c59a0>]}
2022-01-25 02:05:54.799039 (Thread-109): sending response (<Response 32943 bytes [200 OK]>) to 10.0.2.170
2022-01-25 02:05:54.969812 (Thread-110): handling status request
2022-01-25 02:05:54.970248 (Thread-110): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '8714af59-61c7-452b-b6cc-c68eb57747ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe881e12e0>]}
2022-01-25 02:05:54.978154 (Thread-110): sending response (<Response 32943 bytes [200 OK]>) to 10.0.35.206
2022-02-04 13:26:13.180768 (MainThread): Running with dbt=0.18.1
2022-02-04 13:26:13.328173 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.rpc.server.RPCServerTask'>, debug=False, defer=None, exclude=None, host='0.0.0.0', log_cache_events=False, log_format='default', models=None, partial_parse=True, port=8580, profile='user', profiles_dir='/usr/src/develop/.dbt', project_dir=None, record_timing_info=None, rpc_method=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='rpc', write_json=True)
2022-02-04 13:26:13.339146 (MainThread): Tracking: tracking
2022-02-04 13:26:13.357759 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe0f03f130>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe00194c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe00194c70>]}
2022-02-04 13:26:13.358089 (MainThread): Serving RPC server at 0.0.0.0:8580, pid=21
2022-02-04 13:26:13.358416 (MainThread): Supported methods: ['cli_args', 'compile', 'compile_sql', 'deps', 'docs.generate', 'gc', 'get-manifest', 'kill', 'poll', 'ps', 'run', 'run-operation', 'run_sql', 'seed', 'snapshot', 'snapshot-freshness', 'status', 'test']
2022-02-04 13:26:13.358627 (MainThread): Send requests to http://localhost:8580/jsonrpc
2022-02-04 13:26:13.391265 (Thread-12): Parsing macros/generate_schema_name.sql
2022-02-04 13:26:13.392800 (Thread-12): Parsing macros/catalog.sql
2022-02-04 13:26:13.398874 (Thread-12): Parsing macros/adapters.sql
2022-02-04 13:26:13.415960 (Thread-12): Parsing macros/etc.sql
2022-02-04 13:26:13.417121 (Thread-12): Parsing macros/materializations/table.sql
2022-02-04 13:26:13.425973 (Thread-12): Parsing macros/materializations/seed.sql
2022-02-04 13:26:13.428399 (Thread-12): Parsing macros/materializations/view.sql
2022-02-04 13:26:13.430948 (Thread-12): Parsing macros/materializations/snapshot.sql
2022-02-04 13:26:13.432639 (Thread-12): Parsing macros/materializations/incremental.sql
2022-02-04 13:26:13.443905 (Thread-12): Parsing macros/materializations/copy.sql
2022-02-04 13:26:13.448577 (Thread-12): Parsing macros/core.sql
2022-02-04 13:26:13.451863 (Thread-12): Parsing macros/materializations/helpers.sql
2022-02-04 13:26:13.459750 (Thread-12): Parsing macros/materializations/view/view.sql
2022-02-04 13:26:13.465765 (Thread-12): Parsing macros/materializations/view/create_or_replace_view.sql
2022-02-04 13:26:13.470246 (Thread-12): Parsing macros/materializations/seed/seed.sql
2022-02-04 13:26:13.489012 (Thread-12): Parsing macros/materializations/snapshot/strategies.sql
2022-02-04 13:26:13.503722 (Thread-12): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-02-04 13:26:13.505421 (Thread-12): Parsing macros/materializations/snapshot/snapshot.sql
2022-02-04 13:26:13.530996 (Thread-12): Parsing macros/materializations/table/table.sql
2022-02-04 13:26:13.536953 (Thread-12): Parsing macros/materializations/common/merge.sql
2022-02-04 13:26:13.549533 (Thread-12): Parsing macros/materializations/incremental/incremental.sql
2022-02-04 13:26:13.554989 (Thread-12): Parsing macros/materializations/incremental/helpers.sql
2022-02-04 13:26:13.556692 (Thread-12): Parsing macros/etc/get_custom_alias.sql
2022-02-04 13:26:13.557636 (Thread-12): Parsing macros/etc/datetime.sql
2022-02-04 13:26:13.565481 (Thread-12): Parsing macros/etc/query.sql
2022-02-04 13:26:13.566470 (Thread-12): Parsing macros/etc/get_custom_database.sql
2022-02-04 13:26:13.568000 (Thread-12): Parsing macros/etc/get_custom_schema.sql
2022-02-04 13:26:13.569833 (Thread-12): Parsing macros/etc/is_incremental.sql
2022-02-04 13:26:13.571336 (Thread-12): Parsing macros/adapters/common.sql
2022-02-04 13:26:13.610870 (Thread-12): Parsing macros/schema_tests/accepted_values.sql
2022-02-04 13:26:13.613473 (Thread-12): Parsing macros/schema_tests/not_null.sql
2022-02-04 13:26:13.614969 (Thread-12): Parsing macros/schema_tests/relationships.sql
2022-02-04 13:26:13.617117 (Thread-12): Parsing macros/schema_tests/unique.sql
2022-02-04 13:26:13.635640 (Thread-12): Parsing macros/logger/pretty_time.sql
2022-02-04 13:26:13.643012 (Thread-12): Parsing macros/logger/log_info.sql
2022-02-04 13:26:13.650484 (Thread-12): Parsing macros/logger/pretty_log_format.sql
2022-02-04 13:26:13.658667 (Thread-12): Parsing macros/sql/pivot.sql
2022-02-04 13:26:13.668487 (Thread-12): Parsing macros/sql/star.sql
2022-02-04 13:26:13.677459 (Thread-12): Parsing macros/sql/surrogate_key.sql
2022-02-04 13:26:13.687074 (Thread-12): Parsing macros/sql/get_query_results_as_dict.sql
2022-02-04 13:26:13.695168 (Thread-12): Parsing macros/sql/get_column_values.sql
2022-02-04 13:26:13.705819 (Thread-12): Parsing macros/sql/groupby.sql
2022-02-04 13:26:13.714056 (Thread-12): Parsing macros/sql/get_tables_by_pattern_sql.sql
2022-02-04 13:26:13.726470 (Thread-12): Parsing macros/sql/nullcheck_table.sql
2022-02-04 13:26:13.733785 (Thread-12): Parsing macros/sql/get_tables_by_prefix_sql.sql
2022-02-04 13:26:13.741835 (Thread-12): Parsing macros/sql/get_relations_by_pattern.sql
2022-02-04 13:26:13.751014 (Thread-12): Parsing macros/sql/get_relations_by_prefix.sql
2022-02-04 13:26:13.760249 (Thread-12): Parsing macros/sql/safe_add.sql
2022-02-04 13:26:13.768457 (Thread-12): Parsing macros/sql/unpivot.sql
2022-02-04 13:26:13.781563 (Thread-12): Parsing macros/sql/generate_series.sql
2022-02-04 13:26:13.792269 (Thread-12): Parsing macros/sql/nullcheck.sql
2022-02-04 13:26:13.799948 (Thread-12): Parsing macros/sql/union.sql
2022-02-04 13:26:13.813782 (Thread-12): Parsing macros/materializations/insert_by_period_materialization.sql
2022-02-04 13:26:13.842599 (Thread-12): Parsing macros/web/get_url_parameter.sql
2022-02-04 13:26:13.850694 (Thread-12): Parsing macros/web/get_url_path.sql
2022-02-04 13:26:13.859873 (Thread-12): Parsing macros/web/get_url_host.sql
2022-02-04 13:26:13.867591 (Thread-12): Parsing macros/datetime/date_spine.sql
2022-02-04 13:26:13.877923 (Thread-12): Parsing macros/schema_tests/expression_is_true.sql
2022-02-04 13:26:13.885921 (Thread-12): Parsing macros/schema_tests/not_constant.sql
2022-02-04 13:26:13.893219 (Thread-12): Parsing macros/schema_tests/at_least_one.sql
2022-02-04 13:26:13.900829 (Thread-12): Parsing macros/schema_tests/equality.sql
2022-02-04 13:26:14.011398 (Thread-12): Parsing macros/schema_tests/test_not_null_where.sql
2022-02-04 13:26:14.019657 (Thread-12): Parsing macros/schema_tests/equal_rowcount.sql
2022-02-04 13:26:14.028482 (Thread-12): Parsing macros/schema_tests/test_unique_where.sql
2022-02-04 13:26:14.037001 (Thread-12): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2022-02-04 13:26:14.049757 (Thread-12): Parsing macros/schema_tests/relationships_where.sql
2022-02-04 13:26:14.058101 (Thread-12): Parsing macros/schema_tests/unique_combination_of_columns.sql
2022-02-04 13:26:14.067410 (Thread-12): Parsing macros/schema_tests/recency.sql
2022-02-04 13:26:14.076209 (Thread-12): Parsing macros/schema_tests/cardinality_equality.sql
2022-02-04 13:26:14.085019 (Thread-12): Parsing macros/geo/haversine_distance.sql
2022-02-04 13:26:14.092623 (Thread-12): Parsing macros/cross_db_utils/split_part.sql
2022-02-04 13:26:14.100797 (Thread-12): Parsing macros/cross_db_utils/length.sql
2022-02-04 13:26:14.108229 (Thread-12): Parsing macros/cross_db_utils/current_timestamp.sql
2022-02-04 13:26:14.117482 (Thread-12): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2022-02-04 13:26:14.125005 (Thread-12): Parsing macros/cross_db_utils/right.sql
2022-02-04 13:26:14.133766 (Thread-12): Parsing macros/cross_db_utils/hash.sql
2022-02-04 13:26:14.141574 (Thread-12): Parsing macros/cross_db_utils/replace.sql
2022-02-04 13:26:14.149770 (Thread-12): Parsing macros/cross_db_utils/concat.sql
2022-02-04 13:26:14.159067 (Thread-12): Parsing macros/cross_db_utils/_is_relation.sql
2022-02-04 13:26:14.166340 (Thread-12): Parsing macros/cross_db_utils/identifier.sql
2022-02-04 13:26:14.178963 (Thread-12): Parsing macros/cross_db_utils/datediff.sql
2022-02-04 13:26:14.194159 (Thread-12): Parsing macros/cross_db_utils/dateadd.sql
2022-02-04 13:26:14.202332 (Thread-12): Parsing macros/cross_db_utils/datatypes.sql
2022-02-04 13:26:14.214548 (Thread-12): Parsing macros/cross_db_utils/position.sql
2022-02-04 13:26:14.222666 (Thread-12): Parsing macros/cross_db_utils/literal.sql
2022-02-04 13:26:14.230400 (Thread-12): Parsing macros/cross_db_utils/_is_ephemeral.sql
2022-02-04 13:26:14.239131 (Thread-12): Parsing macros/cross_db_utils/width_bucket.sql
2022-02-04 13:26:14.250673 (Thread-12): Parsing macros/cross_db_utils/date_trunc.sql
2022-02-04 13:26:14.258726 (Thread-12): Parsing macros/cross_db_utils/except.sql
2022-02-04 13:26:14.266561 (Thread-12): Parsing macros/cross_db_utils/safe_cast.sql
2022-02-04 13:26:14.275435 (Thread-12): Parsing macros/cross_db_utils/last_day.sql
2022-02-04 13:26:14.285241 (Thread-12): Parsing macros/cross_db_utils/intersect.sql
2022-02-04 13:26:14.353125 (Thread-12): Acquiring new bigquery connection "model.tech_audit.agg_all".
2022-02-04 13:26:14.383523 (Thread-12): Acquiring new bigquery connection "model.tech_audit.agg_traffic".
2022-02-04 13:26:14.404640 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_diffs_count".
2022-02-04 13:26:14.430471 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_diffs".
2022-02-04 13:26:14.449562 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_count".
2022-02-04 13:26:14.473331 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_data_studio".
2022-02-04 13:26:14.491533 (Thread-12): Acquiring new bigquery connection "model.tech_audit.domains_proc".
2022-02-04 13:26:14.508489 (Thread-12): Acquiring new bigquery connection "model.tech_audit.crawl_dates".
2022-02-04 13:26:14.528631 (Thread-12): Acquiring new bigquery connection "model.tech_audit.dates".
2022-02-04 13:26:14.546656 (Thread-12): Acquiring new bigquery connection "model.tech_audit.ga_stats".
2022-02-04 13:26:14.566865 (Thread-12): Acquiring new bigquery connection "model.tech_audit.ga_proc_url_mapping".
2022-02-04 13:26:14.585310 (Thread-12): Acquiring new bigquery connection "model.tech_audit.ga_proc".
2022-02-04 13:26:14.603993 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_keyword_stats".
2022-02-04 13:26:14.625428 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_url_proc_url_mapping".
2022-02-04 13:26:14.643698 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_url_keyword_stats".
2022-02-04 13:26:14.663563 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_keyword_proc_url_mapping".
2022-02-04 13:26:14.682037 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_url_stats".
2022-02-04 13:26:14.701257 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_keyword_proc".
2022-02-04 13:26:14.720624 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_url_proc".
2022-02-04 13:26:14.739838 (Thread-12): Acquiring new bigquery connection "model.tech_audit.deepcrawl_proc".
2022-02-04 13:26:14.759387 (Thread-12): Acquiring new bigquery connection "model.tech_audit.deepcrawl_latest_crawl_proc".
2022-02-04 13:26:14.777251 (Thread-12): Acquiring new bigquery connection "model.tech_audit.deepcrawl_url_proc".
2022-02-04 13:26:14.796573 (Thread-12): Acquiring new bigquery connection "model.tech_audit.deepcrawl_stats".
2022-02-04 13:26:14.815598 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_proc".
2022-02-04 13:26:14.835098 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_hierarchy".
2022-02-04 13:26:15.670807 (Thread-13): handling status request
2022-02-04 13:26:15.671256 (Thread-13): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'c98f83c4-4b25-4cd8-b37f-dedec6bcc6fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efde0e415b0>]}
2022-02-04 13:26:15.680428 (Thread-13): sending response (<Response 32943 bytes [200 OK]>) to 10.0.5.97
2022-02-04 13:26:15.681792 (Thread-14): handling status request
2022-02-04 13:26:15.682239 (Thread-14): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'c98f83c4-4b25-4cd8-b37f-dedec6bcc6fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efde0e66ee0>]}
2022-02-04 13:26:15.690257 (Thread-14): sending response (<Response 32943 bytes [200 OK]>) to 10.0.20.252
2022-02-04 13:26:15.736823 (Thread-15): handling status request
2022-02-04 13:26:15.737246 (Thread-15): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'c98f83c4-4b25-4cd8-b37f-dedec6bcc6fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efde0e1efd0>]}
2022-02-04 13:26:15.745115 (Thread-15): sending response (<Response 32943 bytes [200 OK]>) to 10.0.43.152
2022-02-04 13:26:15.746020 (Thread-16): handling ps request
2022-02-04 13:26:15.746653 (Thread-16): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'c98f83c4-4b25-4cd8-b37f-dedec6bcc6fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efde0e38f40>]}
2022-02-04 13:26:15.748144 (Thread-16): sending response (<Response 104 bytes [200 OK]>) to 10.0.11.111
2022-02-04 16:36:58.277375 (MainThread): Running with dbt=0.18.1
2022-02-04 16:36:58.432054 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.rpc.server.RPCServerTask'>, debug=False, defer=None, exclude=None, host='0.0.0.0', log_cache_events=False, log_format='default', models=None, partial_parse=True, port=8580, profile='user', profiles_dir='/usr/src/develop/.dbt', project_dir=None, record_timing_info=None, rpc_method=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='rpc', write_json=True)
2022-02-04 16:36:58.445324 (MainThread): Tracking: tracking
2022-02-04 16:36:58.464679 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb8b01156a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb8a86ae880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb8a86aedf0>]}
2022-02-04 16:36:58.466331 (MainThread): Serving RPC server at 0.0.0.0:8580, pid=21
2022-02-04 16:36:58.466702 (MainThread): Supported methods: ['cli_args', 'compile', 'compile_sql', 'deps', 'docs.generate', 'gc', 'get-manifest', 'kill', 'poll', 'ps', 'run', 'run-operation', 'run_sql', 'seed', 'snapshot', 'snapshot-freshness', 'status', 'test']
2022-02-04 16:36:58.466913 (MainThread): Send requests to http://localhost:8580/jsonrpc
2022-02-04 16:36:58.494378 (Thread-12): Parsing macros/generate_schema_name.sql
2022-02-04 16:36:58.496227 (Thread-12): Parsing macros/catalog.sql
2022-02-04 16:36:58.502993 (Thread-12): Parsing macros/adapters.sql
2022-02-04 16:36:58.521499 (Thread-12): Parsing macros/etc.sql
2022-02-04 16:36:58.522870 (Thread-12): Parsing macros/materializations/table.sql
2022-02-04 16:36:58.532196 (Thread-12): Parsing macros/materializations/seed.sql
2022-02-04 16:36:58.534914 (Thread-12): Parsing macros/materializations/view.sql
2022-02-04 16:36:58.537585 (Thread-12): Parsing macros/materializations/snapshot.sql
2022-02-04 16:36:58.539397 (Thread-12): Parsing macros/materializations/incremental.sql
2022-02-04 16:36:58.551335 (Thread-12): Parsing macros/materializations/copy.sql
2022-02-04 16:36:58.556855 (Thread-12): Parsing macros/core.sql
2022-02-04 16:36:58.561539 (Thread-12): Parsing macros/materializations/helpers.sql
2022-02-04 16:36:58.573969 (Thread-12): Parsing macros/materializations/view/view.sql
2022-02-04 16:36:58.581282 (Thread-12): Parsing macros/materializations/view/create_or_replace_view.sql
2022-02-04 16:36:58.586219 (Thread-12): Parsing macros/materializations/seed/seed.sql
2022-02-04 16:36:58.605678 (Thread-12): Parsing macros/materializations/snapshot/strategies.sql
2022-02-04 16:36:58.621139 (Thread-12): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-02-04 16:36:58.623009 (Thread-12): Parsing macros/materializations/snapshot/snapshot.sql
2022-02-04 16:36:58.650134 (Thread-12): Parsing macros/materializations/table/table.sql
2022-02-04 16:36:58.656647 (Thread-12): Parsing macros/materializations/common/merge.sql
2022-02-04 16:36:58.669865 (Thread-12): Parsing macros/materializations/incremental/incremental.sql
2022-02-04 16:36:58.675807 (Thread-12): Parsing macros/materializations/incremental/helpers.sql
2022-02-04 16:36:58.677671 (Thread-12): Parsing macros/etc/get_custom_alias.sql
2022-02-04 16:36:58.678699 (Thread-12): Parsing macros/etc/datetime.sql
2022-02-04 16:36:58.686880 (Thread-12): Parsing macros/etc/query.sql
2022-02-04 16:36:58.687982 (Thread-12): Parsing macros/etc/get_custom_database.sql
2022-02-04 16:36:58.689684 (Thread-12): Parsing macros/etc/get_custom_schema.sql
2022-02-04 16:36:58.691585 (Thread-12): Parsing macros/etc/is_incremental.sql
2022-02-04 16:36:58.693179 (Thread-12): Parsing macros/adapters/common.sql
2022-02-04 16:36:58.733292 (Thread-12): Parsing macros/schema_tests/accepted_values.sql
2022-02-04 16:36:58.736050 (Thread-12): Parsing macros/schema_tests/not_null.sql
2022-02-04 16:36:58.737623 (Thread-12): Parsing macros/schema_tests/relationships.sql
2022-02-04 16:36:58.739685 (Thread-12): Parsing macros/schema_tests/unique.sql
2022-02-04 16:36:58.753631 (Thread-12): Parsing macros/logger/pretty_time.sql
2022-02-04 16:36:58.759294 (Thread-12): Parsing macros/logger/log_info.sql
2022-02-04 16:36:58.764801 (Thread-12): Parsing macros/logger/pretty_log_format.sql
2022-02-04 16:36:58.770290 (Thread-12): Parsing macros/sql/pivot.sql
2022-02-04 16:36:58.778633 (Thread-12): Parsing macros/sql/star.sql
2022-02-04 16:36:58.786176 (Thread-12): Parsing macros/sql/surrogate_key.sql
2022-02-04 16:36:58.793713 (Thread-12): Parsing macros/sql/get_query_results_as_dict.sql
2022-02-04 16:36:58.800165 (Thread-12): Parsing macros/sql/get_column_values.sql
2022-02-04 16:36:58.809563 (Thread-12): Parsing macros/sql/groupby.sql
2022-02-04 16:36:58.815546 (Thread-12): Parsing macros/sql/get_tables_by_pattern_sql.sql
2022-02-04 16:36:58.826693 (Thread-12): Parsing macros/sql/nullcheck_table.sql
2022-02-04 16:36:58.832877 (Thread-12): Parsing macros/sql/get_tables_by_prefix_sql.sql
2022-02-04 16:36:58.839213 (Thread-12): Parsing macros/sql/get_relations_by_pattern.sql
2022-02-04 16:36:58.847363 (Thread-12): Parsing macros/sql/get_relations_by_prefix.sql
2022-02-04 16:36:58.855349 (Thread-12): Parsing macros/sql/safe_add.sql
2022-02-04 16:36:58.861046 (Thread-12): Parsing macros/sql/unpivot.sql
2022-02-04 16:36:58.872345 (Thread-12): Parsing macros/sql/generate_series.sql
2022-02-04 16:36:58.881592 (Thread-12): Parsing macros/sql/nullcheck.sql
2022-02-04 16:36:58.888087 (Thread-12): Parsing macros/sql/union.sql
2022-02-04 16:36:58.902412 (Thread-12): Parsing macros/materializations/insert_by_period_materialization.sql
2022-02-04 16:36:58.931163 (Thread-12): Parsing macros/web/get_url_parameter.sql
2022-02-04 16:36:58.937816 (Thread-12): Parsing macros/web/get_url_path.sql
2022-02-04 16:36:58.944443 (Thread-12): Parsing macros/web/get_url_host.sql
2022-02-04 16:36:58.951168 (Thread-12): Parsing macros/datetime/date_spine.sql
2022-02-04 16:36:58.960212 (Thread-12): Parsing macros/schema_tests/expression_is_true.sql
2022-02-04 16:36:58.966745 (Thread-12): Parsing macros/schema_tests/not_constant.sql
2022-02-04 16:36:58.972833 (Thread-12): Parsing macros/schema_tests/at_least_one.sql
2022-02-04 16:36:58.978549 (Thread-12): Parsing macros/schema_tests/equality.sql
2022-02-04 16:36:59.107937 (Thread-12): Parsing macros/schema_tests/test_not_null_where.sql
2022-02-04 16:36:59.114507 (Thread-12): Parsing macros/schema_tests/equal_rowcount.sql
2022-02-04 16:36:59.120781 (Thread-12): Parsing macros/schema_tests/test_unique_where.sql
2022-02-04 16:36:59.127510 (Thread-12): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2022-02-04 16:36:59.137755 (Thread-12): Parsing macros/schema_tests/relationships_where.sql
2022-02-04 16:36:59.144635 (Thread-12): Parsing macros/schema_tests/unique_combination_of_columns.sql
2022-02-04 16:36:59.152209 (Thread-12): Parsing macros/schema_tests/recency.sql
2022-02-04 16:36:59.158528 (Thread-12): Parsing macros/schema_tests/cardinality_equality.sql
2022-02-04 16:36:59.165916 (Thread-12): Parsing macros/geo/haversine_distance.sql
2022-02-04 16:36:59.172096 (Thread-12): Parsing macros/cross_db_utils/split_part.sql
2022-02-04 16:36:59.178460 (Thread-12): Parsing macros/cross_db_utils/length.sql
2022-02-04 16:36:59.184143 (Thread-12): Parsing macros/cross_db_utils/current_timestamp.sql
2022-02-04 16:36:59.192122 (Thread-12): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2022-02-04 16:36:59.197147 (Thread-12): Parsing macros/cross_db_utils/right.sql
2022-02-04 16:36:59.204260 (Thread-12): Parsing macros/cross_db_utils/hash.sql
2022-02-04 16:36:59.209855 (Thread-12): Parsing macros/cross_db_utils/replace.sql
2022-02-04 16:36:59.216079 (Thread-12): Parsing macros/cross_db_utils/concat.sql
2022-02-04 16:36:59.222884 (Thread-12): Parsing macros/cross_db_utils/_is_relation.sql
2022-02-04 16:36:59.228674 (Thread-12): Parsing macros/cross_db_utils/identifier.sql
2022-02-04 16:36:59.234837 (Thread-12): Parsing macros/cross_db_utils/datediff.sql
2022-02-04 16:36:59.248173 (Thread-12): Parsing macros/cross_db_utils/dateadd.sql
2022-02-04 16:36:59.254775 (Thread-12): Parsing macros/cross_db_utils/datatypes.sql
2022-02-04 16:36:59.266078 (Thread-12): Parsing macros/cross_db_utils/position.sql
2022-02-04 16:36:59.272232 (Thread-12): Parsing macros/cross_db_utils/literal.sql
2022-02-04 16:36:59.277285 (Thread-12): Parsing macros/cross_db_utils/_is_ephemeral.sql
2022-02-04 16:36:59.283170 (Thread-12): Parsing macros/cross_db_utils/width_bucket.sql
2022-02-04 16:36:59.292713 (Thread-12): Parsing macros/cross_db_utils/date_trunc.sql
2022-02-04 16:36:59.298611 (Thread-12): Parsing macros/cross_db_utils/except.sql
2022-02-04 16:36:59.304226 (Thread-12): Parsing macros/cross_db_utils/safe_cast.sql
2022-02-04 16:36:59.310857 (Thread-12): Parsing macros/cross_db_utils/last_day.sql
2022-02-04 16:36:59.318236 (Thread-12): Parsing macros/cross_db_utils/intersect.sql
2022-02-04 16:36:59.384692 (Thread-12): Acquiring new bigquery connection "model.tech_audit.agg_all".
2022-02-04 16:36:59.416176 (Thread-12): Acquiring new bigquery connection "model.tech_audit.agg_traffic".
2022-02-04 16:36:59.438079 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_diffs_count".
2022-02-04 16:36:59.465259 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_diffs".
2022-02-04 16:36:59.485037 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_count".
2022-02-04 16:36:59.507976 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_data_studio".
2022-02-04 16:36:59.525104 (Thread-12): Acquiring new bigquery connection "model.tech_audit.domains_proc".
2022-02-04 16:36:59.539610 (Thread-12): Acquiring new bigquery connection "model.tech_audit.crawl_dates".
2022-02-04 16:36:59.557640 (Thread-12): Acquiring new bigquery connection "model.tech_audit.dates".
2022-02-04 16:36:59.576991 (Thread-12): Acquiring new bigquery connection "model.tech_audit.ga_stats".
2022-02-04 16:36:59.596468 (Thread-12): Acquiring new bigquery connection "model.tech_audit.ga_proc_url_mapping".
2022-02-04 16:36:59.614996 (Thread-12): Acquiring new bigquery connection "model.tech_audit.ga_proc".
2022-02-04 16:36:59.634717 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_keyword_stats".
2022-02-04 16:36:59.652489 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_url_proc_url_mapping".
2022-02-04 16:36:59.670475 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_url_keyword_stats".
2022-02-04 16:36:59.689947 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_keyword_proc_url_mapping".
2022-02-04 16:36:59.708992 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_url_stats".
2022-02-04 16:36:59.726635 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_keyword_proc".
2022-02-04 16:36:59.743972 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_url_proc".
2022-02-04 16:36:59.763160 (Thread-12): Acquiring new bigquery connection "model.tech_audit.deepcrawl_proc".
2022-02-04 16:36:59.784203 (Thread-12): Acquiring new bigquery connection "model.tech_audit.deepcrawl_latest_crawl_proc".
2022-02-04 16:36:59.802762 (Thread-12): Acquiring new bigquery connection "model.tech_audit.deepcrawl_url_proc".
2022-02-04 16:36:59.820724 (Thread-12): Acquiring new bigquery connection "model.tech_audit.deepcrawl_stats".
2022-02-04 16:36:59.840792 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_proc".
2022-02-04 16:36:59.859869 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_hierarchy".
2022-02-04 16:37:01.682486 (Thread-13): handling status request
2022-02-04 16:37:01.684149 (Thread-13): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aba1ddda-8aaa-4999-a1c4-fb96ef30a518', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb8a83ae910>]}
2022-02-04 16:37:01.693591 (Thread-13): sending response (<Response 32943 bytes [200 OK]>) to 10.0.19.16
2022-02-04 16:37:01.704044 (Thread-14): handling status request
2022-02-04 16:37:01.704468 (Thread-14): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aba1ddda-8aaa-4999-a1c4-fb96ef30a518', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb8a83a8580>]}
2022-02-04 16:37:01.712806 (Thread-14): sending response (<Response 32943 bytes [200 OK]>) to 10.0.12.215
2022-02-04 16:37:01.781017 (Thread-15): handling ps request
2022-02-04 16:37:01.781495 (Thread-15): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aba1ddda-8aaa-4999-a1c4-fb96ef30a518', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb8a83dcaf0>]}
2022-02-04 16:37:01.783133 (Thread-15): sending response (<Response 104 bytes [200 OK]>) to 10.0.12.152
2022-02-04 16:37:01.894066 (Thread-16): handling status request
2022-02-04 16:37:01.894522 (Thread-16): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'aba1ddda-8aaa-4999-a1c4-fb96ef30a518', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb8a83a6b20>]}
2022-02-04 16:37:01.903510 (Thread-16): sending response (<Response 32943 bytes [200 OK]>) to 10.0.41.14
2022-06-15 21:35:21.363054 (MainThread): Running with dbt=0.18.1
2022-06-15 21:35:21.597564 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.rpc.server.RPCServerTask'>, debug=False, defer=None, exclude=None, host='0.0.0.0', log_cache_events=False, log_format='default', models=None, partial_parse=True, port=8580, profile='user', profiles_dir='/usr/src/develop/.dbt', project_dir=None, record_timing_info=None, rpc_method=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='rpc', write_json=True)
2022-06-15 21:35:21.609837 (MainThread): Tracking: tracking
2022-06-15 21:35:21.630404 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf202b7fa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf1c110040>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf1c110760>]}
2022-06-15 21:35:21.630836 (MainThread): Serving RPC server at 0.0.0.0:8580, pid=22
2022-06-15 21:35:21.631228 (MainThread): Supported methods: ['cli_args', 'compile', 'compile_sql', 'deps', 'docs.generate', 'gc', 'get-manifest', 'kill', 'poll', 'ps', 'run', 'run-operation', 'run_sql', 'seed', 'snapshot', 'snapshot-freshness', 'status', 'test']
2022-06-15 21:35:21.631463 (MainThread): Send requests to http://localhost:8580/jsonrpc
2022-06-15 21:35:21.665311 (Thread-12): Parsing macros/generate_schema_name.sql
2022-06-15 21:35:21.667787 (Thread-12): Parsing macros/adapters.sql
2022-06-15 21:35:21.689433 (Thread-12): Parsing macros/etc.sql
2022-06-15 21:35:21.691154 (Thread-12): Parsing macros/catalog.sql
2022-06-15 21:35:21.699429 (Thread-12): Parsing macros/materializations/table.sql
2022-06-15 21:35:21.709162 (Thread-12): Parsing macros/materializations/seed.sql
2022-06-15 21:35:21.711885 (Thread-12): Parsing macros/materializations/incremental.sql
2022-06-15 21:35:21.723851 (Thread-12): Parsing macros/materializations/copy.sql
2022-06-15 21:35:21.727936 (Thread-12): Parsing macros/materializations/snapshot.sql
2022-06-15 21:35:21.729732 (Thread-12): Parsing macros/materializations/view.sql
2022-06-15 21:35:21.733138 (Thread-12): Parsing macros/core.sql
2022-06-15 21:35:21.736643 (Thread-12): Parsing macros/adapters/common.sql
2022-06-15 21:35:21.777270 (Thread-12): Parsing macros/etc/datetime.sql
2022-06-15 21:35:21.785625 (Thread-12): Parsing macros/etc/get_custom_schema.sql
2022-06-15 21:35:21.787614 (Thread-12): Parsing macros/etc/get_custom_alias.sql
2022-06-15 21:35:21.788563 (Thread-12): Parsing macros/etc/is_incremental.sql
2022-06-15 21:35:21.790110 (Thread-12): Parsing macros/etc/get_custom_database.sql
2022-06-15 21:35:21.791710 (Thread-12): Parsing macros/etc/query.sql
2022-06-15 21:35:21.792738 (Thread-12): Parsing macros/schema_tests/unique.sql
2022-06-15 21:35:21.794617 (Thread-12): Parsing macros/schema_tests/not_null.sql
2022-06-15 21:35:21.796100 (Thread-12): Parsing macros/schema_tests/accepted_values.sql
2022-06-15 21:35:21.798723 (Thread-12): Parsing macros/schema_tests/relationships.sql
2022-06-15 21:35:21.800539 (Thread-12): Parsing macros/materializations/helpers.sql
2022-06-15 21:35:21.808892 (Thread-12): Parsing macros/materializations/table/table.sql
2022-06-15 21:35:21.815363 (Thread-12): Parsing macros/materializations/snapshot/strategies.sql
2022-06-15 21:35:21.830863 (Thread-12): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-06-15 21:35:21.832656 (Thread-12): Parsing macros/materializations/snapshot/snapshot.sql
2022-06-15 21:35:21.859910 (Thread-12): Parsing macros/materializations/seed/seed.sql
2022-06-15 21:35:21.879477 (Thread-12): Parsing macros/materializations/common/merge.sql
2022-06-15 21:35:21.892817 (Thread-12): Parsing macros/materializations/view/create_or_replace_view.sql
2022-06-15 21:35:21.897760 (Thread-12): Parsing macros/materializations/view/view.sql
2022-06-15 21:35:21.903650 (Thread-12): Parsing macros/materializations/incremental/helpers.sql
2022-06-15 21:35:21.905441 (Thread-12): Parsing macros/materializations/incremental/incremental.sql
2022-06-15 21:35:21.924037 (Thread-12): Parsing macros/logger/pretty_time.sql
2022-06-15 21:35:21.932639 (Thread-12): Parsing macros/logger/log_info.sql
2022-06-15 21:35:21.940660 (Thread-12): Parsing macros/logger/pretty_log_format.sql
2022-06-15 21:35:21.948434 (Thread-12): Parsing macros/sql/pivot.sql
2022-06-15 21:35:21.959664 (Thread-12): Parsing macros/sql/star.sql
2022-06-15 21:35:21.969118 (Thread-12): Parsing macros/sql/surrogate_key.sql
2022-06-15 21:35:21.978113 (Thread-12): Parsing macros/sql/get_query_results_as_dict.sql
2022-06-15 21:35:21.985805 (Thread-12): Parsing macros/sql/get_column_values.sql
2022-06-15 21:35:21.996331 (Thread-12): Parsing macros/sql/groupby.sql
2022-06-15 21:35:22.003944 (Thread-12): Parsing macros/sql/get_tables_by_pattern_sql.sql
2022-06-15 21:35:22.015520 (Thread-12): Parsing macros/sql/nullcheck_table.sql
2022-06-15 21:35:22.023878 (Thread-12): Parsing macros/sql/get_tables_by_prefix_sql.sql
2022-06-15 21:35:22.032434 (Thread-12): Parsing macros/sql/get_relations_by_pattern.sql
2022-06-15 21:35:22.041537 (Thread-12): Parsing macros/sql/get_relations_by_prefix.sql
2022-06-15 21:35:22.050671 (Thread-12): Parsing macros/sql/safe_add.sql
2022-06-15 21:35:22.058606 (Thread-12): Parsing macros/sql/unpivot.sql
2022-06-15 21:35:22.072346 (Thread-12): Parsing macros/sql/generate_series.sql
2022-06-15 21:35:22.081909 (Thread-12): Parsing macros/sql/nullcheck.sql
2022-06-15 21:35:22.090121 (Thread-12): Parsing macros/sql/union.sql
2022-06-15 21:35:22.099959 (Thread-13): handling ps request
2022-06-15 21:35:22.100454 (Thread-13): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '1d241b9b-9612-4a09-b8b0-526593f4e175', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf1c0c8760>]}
2022-06-15 21:35:22.102360 (Thread-13): sending response (<Response 104 bytes [200 OK]>) to 10.0.5.232
2022-06-15 21:35:22.104669 (Thread-12): Parsing macros/materializations/insert_by_period_materialization.sql
2022-06-15 21:35:22.134360 (Thread-12): Parsing macros/web/get_url_parameter.sql
2022-06-15 21:35:22.142910 (Thread-12): Parsing macros/web/get_url_path.sql
2022-06-15 21:35:22.153126 (Thread-12): Parsing macros/web/get_url_host.sql
2022-06-15 21:35:22.161785 (Thread-12): Parsing macros/datetime/date_spine.sql
2022-06-15 21:35:22.171909 (Thread-12): Parsing macros/schema_tests/expression_is_true.sql
2022-06-15 21:35:22.179592 (Thread-12): Parsing macros/schema_tests/not_constant.sql
2022-06-15 21:35:22.186985 (Thread-12): Parsing macros/schema_tests/at_least_one.sql
2022-06-15 21:35:22.195551 (Thread-12): Parsing macros/schema_tests/equality.sql
2022-06-15 21:35:22.205810 (Thread-12): Parsing macros/schema_tests/test_not_null_where.sql
2022-06-15 21:35:22.213093 (Thread-12): Parsing macros/schema_tests/equal_rowcount.sql
2022-06-15 21:35:22.220779 (Thread-12): Parsing macros/schema_tests/test_unique_where.sql
2022-06-15 21:35:22.229071 (Thread-12): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2022-06-15 21:35:22.241638 (Thread-12): Parsing macros/schema_tests/relationships_where.sql
2022-06-15 21:35:22.248623 (Thread-14): handling status request
2022-06-15 21:35:22.249091 (Thread-14): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '1d241b9b-9612-4a09-b8b0-526593f4e175', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf1c043a90>]}
2022-06-15 21:35:22.250639 (Thread-14): sending response (<Response 184 bytes [200 OK]>) to 10.0.5.232
2022-06-15 21:35:22.251660 (Thread-12): Parsing macros/schema_tests/unique_combination_of_columns.sql
2022-06-15 21:35:22.261290 (Thread-12): Parsing macros/schema_tests/recency.sql
2022-06-15 21:35:22.269233 (Thread-12): Parsing macros/schema_tests/cardinality_equality.sql
2022-06-15 21:35:22.277402 (Thread-12): Parsing macros/geo/haversine_distance.sql
2022-06-15 21:35:22.285161 (Thread-12): Parsing macros/cross_db_utils/split_part.sql
2022-06-15 21:35:22.293197 (Thread-12): Parsing macros/cross_db_utils/length.sql
2022-06-15 21:35:22.300694 (Thread-12): Parsing macros/cross_db_utils/current_timestamp.sql
2022-06-15 21:35:22.310915 (Thread-12): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2022-06-15 21:35:22.318427 (Thread-12): Parsing macros/cross_db_utils/right.sql
2022-06-15 21:35:22.327100 (Thread-12): Parsing macros/cross_db_utils/hash.sql
2022-06-15 21:35:22.334056 (Thread-12): Parsing macros/cross_db_utils/replace.sql
2022-06-15 21:35:22.341214 (Thread-12): Parsing macros/cross_db_utils/concat.sql
2022-06-15 21:35:22.348583 (Thread-12): Parsing macros/cross_db_utils/_is_relation.sql
2022-06-15 21:35:22.355889 (Thread-12): Parsing macros/cross_db_utils/identifier.sql
2022-06-15 21:35:22.364218 (Thread-12): Parsing macros/cross_db_utils/datediff.sql
2022-06-15 21:35:22.381978 (Thread-12): Parsing macros/cross_db_utils/dateadd.sql
2022-06-15 21:35:22.390023 (Thread-12): Parsing macros/cross_db_utils/datatypes.sql
2022-06-15 21:35:22.399313 (Thread-15): handling status request
2022-06-15 21:35:22.399721 (Thread-15): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '1d241b9b-9612-4a09-b8b0-526593f4e175', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf1c069b50>]}
2022-06-15 21:35:22.400422 (Thread-15): sending response (<Response 184 bytes [200 OK]>) to 10.0.5.232
2022-06-15 21:35:22.406393 (Thread-12): Parsing macros/cross_db_utils/position.sql
2022-06-15 21:35:22.414447 (Thread-12): Parsing macros/cross_db_utils/literal.sql
2022-06-15 21:35:22.421100 (Thread-12): Parsing macros/cross_db_utils/_is_ephemeral.sql
2022-06-15 21:35:22.429829 (Thread-12): Parsing macros/cross_db_utils/width_bucket.sql
2022-06-15 21:35:22.440570 (Thread-12): Parsing macros/cross_db_utils/date_trunc.sql
2022-06-15 21:35:22.447887 (Thread-12): Parsing macros/cross_db_utils/except.sql
2022-06-15 21:35:22.455614 (Thread-12): Parsing macros/cross_db_utils/safe_cast.sql
2022-06-15 21:35:22.465285 (Thread-12): Parsing macros/cross_db_utils/last_day.sql
2022-06-15 21:35:22.473225 (Thread-12): Parsing macros/cross_db_utils/intersect.sql
2022-06-15 21:35:22.538392 (Thread-12): Acquiring new bigquery connection "model.tech_audit.agg_all".
2022-06-15 21:35:22.561791 (Thread-16): handling status request
2022-06-15 21:35:22.562201 (Thread-16): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '1d241b9b-9612-4a09-b8b0-526593f4e175', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf0c6ac6a0>]}
2022-06-15 21:35:22.562856 (Thread-16): sending response (<Response 184 bytes [200 OK]>) to 10.0.5.232
2022-06-15 21:35:22.571756 (Thread-12): Acquiring new bigquery connection "model.tech_audit.agg_traffic".
2022-06-15 21:35:22.594761 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_diffs_count".
2022-06-15 21:35:22.622935 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_diffs".
2022-06-15 21:35:22.643206 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_count".
2022-06-15 21:35:22.668233 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_data_studio".
2022-06-15 21:35:22.686359 (Thread-12): Acquiring new bigquery connection "model.tech_audit.domains_proc".
2022-06-15 21:35:22.701609 (Thread-12): Acquiring new bigquery connection "model.tech_audit.crawl_dates".
2022-06-15 21:35:22.722433 (Thread-12): Acquiring new bigquery connection "model.tech_audit.dates".
2022-06-15 21:35:22.741534 (Thread-12): Acquiring new bigquery connection "model.tech_audit.ga_stats".
2022-06-15 21:35:22.762514 (Thread-12): Acquiring new bigquery connection "model.tech_audit.ga_proc_url_mapping".
2022-06-15 21:35:22.781362 (Thread-12): Acquiring new bigquery connection "model.tech_audit.ga_proc".
2022-06-15 21:35:22.802651 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_keyword_stats".
2022-06-15 21:35:22.822804 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_url_proc_url_mapping".
2022-06-15 21:35:22.841320 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_url_keyword_stats".
2022-06-15 21:35:22.862380 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_keyword_proc_url_mapping".
2022-06-15 21:35:22.882055 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_url_stats".
2022-06-15 21:35:22.896924 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_keyword_proc".
2022-06-15 21:35:22.912426 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_url_proc".
2022-06-15 21:35:22.926965 (Thread-12): Acquiring new bigquery connection "model.tech_audit.deepcrawl_proc".
2022-06-15 21:35:22.942799 (Thread-12): Acquiring new bigquery connection "model.tech_audit.deepcrawl_latest_crawl_proc".
2022-06-15 21:35:22.957210 (Thread-12): Acquiring new bigquery connection "model.tech_audit.deepcrawl_url_proc".
2022-06-15 21:35:22.971385 (Thread-12): Acquiring new bigquery connection "model.tech_audit.deepcrawl_stats".
2022-06-15 21:35:22.986249 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_proc".
2022-06-15 21:35:23.001290 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_hierarchy".
2022-06-15 21:35:24.046748 (Thread-17): handling status request
2022-06-15 21:35:24.047244 (Thread-17): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '1d241b9b-9612-4a09-b8b0-526593f4e175', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf0c662880>]}
2022-06-15 21:35:24.055441 (Thread-17): sending response (<Response 32943 bytes [200 OK]>) to 10.0.5.232
2022-06-15 21:35:24.088403 (Thread-18): handling status request
2022-06-15 21:35:24.088734 (Thread-18): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '1d241b9b-9612-4a09-b8b0-526593f4e175', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf0c5ff490>]}
2022-06-15 21:35:24.096801 (Thread-18): sending response (<Response 32943 bytes [200 OK]>) to 10.0.5.232
2022-06-15 21:35:24.391225 (Thread-19): handling status request
2022-06-15 21:35:24.391690 (Thread-19): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '1d241b9b-9612-4a09-b8b0-526593f4e175', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf0c58e250>]}
2022-06-15 21:35:24.399732 (Thread-19): sending response (<Response 32943 bytes [200 OK]>) to 10.0.5.232
2022-06-15 21:35:36.212640 (Thread-20): handling status request
2022-06-15 21:35:36.214980 (Thread-20): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '1d241b9b-9612-4a09-b8b0-526593f4e175', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf0c662730>]}
2022-06-15 21:35:36.223174 (Thread-20): sending response (<Response 32943 bytes [200 OK]>) to 10.0.5.232
2022-06-15 21:43:48.758410 (Thread-21): handling status request
2022-06-15 21:43:48.761130 (Thread-21): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '1d241b9b-9612-4a09-b8b0-526593f4e175', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf0c647c10>]}
2022-06-15 21:43:48.769927 (Thread-21): sending response (<Response 32943 bytes [200 OK]>) to 10.0.5.232
2022-06-15 21:43:49.043345 (Thread-22): handling run_sql request
2022-06-15 21:43:49.043824 (Thread-22): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '1d241b9b-9612-4a09-b8b0-526593f4e175', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf0c660ee0>]}
2022-06-15 21:43:49.046618 (Thread-22): Connection 'model.tech_audit.actions_hierarchy' was properly closed.
2022-06-15 21:43:49.971493 (Thread-22): sending response (<Response 137 bytes [200 OK]>) to 10.0.5.232
2022-06-15 21:43:49.990564 (MainThread): Acquiring new bigquery connection "rpc.tech_audit.request".
2022-06-15 21:43:50.015023 (MainThread): Found 25 models, 0 tests, 0 snapshots, 0 analyses, 327 macros, 0 operations, 0 seed files, 5 sources
2022-06-15 21:43:50.015540 (Thread-1): Acquiring new bigquery connection "rpc.tech_audit.request".
2022-06-15 21:43:50.015656 (Thread-1): Compiling rpc.tech_audit.request
2022-06-15 21:43:50.031560 (Thread-1): finished collecting timing info
2022-06-15 21:43:50.031820 (Thread-1): Opening a new connection, currently in state init
2022-06-15 21:43:50.032215 (Thread-1): On rpc.tech_audit.request: with deepcrawl as (

SELECT
    site,
    crawl_id,
    lag(crawl_id) over w1 previous_crawl_id,
    lead(crawl_id) over w1 next_crawl_id,
    crawl_report_month
    FROM (
      SELECT
      site,
      crawl_id,
      crawl_report_month
      FROM `seo-data-pipeline-89`.`adp_thecifhw`.`deepcrawl_proc`
      GROUP BY site, crawl_id, crawl_report_month
    )
    WINDOW w1 as (PARTITION BY site ORDER BY crawl_id asc)
)

SELECT
site,
run_date,
max(crawl_id_proc) crawl_id,
max(crawl_report_month_proc) crawl_report_month
FROM (

  SELECT
  site,
  run_date,
  crawl_report_month,
  CASE WHEN run_date = crawl_report_month THEN crawl_id
    WHEN crawl_report_month < run_date THEN crawl_id
    WHEN crawl_report_month > run_date and previous_crawl_id is null THEN crawl_id
    ELSE null END as crawl_id_proc,
  CASE WHEN run_date = crawl_report_month THEN crawl_report_month
    WHEN crawl_report_month < run_date THEN crawl_report_month
    WHEN crawl_report_month > run_date and previous_crawl_id is null THEN crawl_report_month
    ELSE null END as crawl_report_month_proc
  FROM (

    SELECT
    a.site,
    a.run_date,
    b.crawl_id,
    b.previous_crawl_id,
    b.next_crawl_id,
    b.crawl_report_month
    FROM `seo-data-pipeline-89`.`adp_thecifhw`.`dates` a
    JOIN deepcrawl b
    ON (
      a.site = b.site
    )
  )
)
GROUP BY site, run_date
limit 500
/* limit added automatically by dbt cloud */
2022-06-15 21:43:50.236081 (Thread-23): handling poll request
2022-06-15 21:43:50.236602 (Thread-23): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '1d241b9b-9612-4a09-b8b0-526593f4e175', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf0c2658e0>]}
2022-06-15 21:43:50.239930 (Thread-23): sending response (<Response 3989 bytes [200 OK]>) to 10.0.5.232
2022-06-15 21:43:51.577511 (Thread-1): finished collecting timing info
2022-06-15 21:43:51.603165 (Thread-24): handling poll request
2022-06-15 21:43:51.745456 (Thread-24): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '1d241b9b-9612-4a09-b8b0-526593f4e175', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf1ded9610>]}
2022-06-15 21:43:51.749024 (Thread-24): sending response (<Response 9987 bytes [200 OK]>) to 10.0.5.232
2022-06-16 01:08:23.561128 (MainThread): Running with dbt=0.18.1
2022-06-16 01:08:23.784625 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.rpc.server.RPCServerTask'>, debug=False, defer=None, exclude=None, host='0.0.0.0', log_cache_events=False, log_format='default', models=None, partial_parse=True, port=8580, profile='user', profiles_dir='/usr/src/develop/.dbt', project_dir=None, record_timing_info=None, rpc_method=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='rpc', write_json=True)
2022-06-16 01:08:23.795907 (MainThread): Tracking: tracking
2022-06-16 01:08:23.815633 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5abc48fb50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5aa82c5e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5aa82c5580>]}
2022-06-16 01:08:23.816024 (MainThread): Serving RPC server at 0.0.0.0:8580, pid=22
2022-06-16 01:08:23.816381 (MainThread): Supported methods: ['cli_args', 'compile', 'compile_sql', 'deps', 'docs.generate', 'gc', 'get-manifest', 'kill', 'poll', 'ps', 'run', 'run-operation', 'run_sql', 'seed', 'snapshot', 'snapshot-freshness', 'status', 'test']
2022-06-16 01:08:23.816604 (MainThread): Send requests to http://localhost:8580/jsonrpc
2022-06-16 01:08:23.851545 (Thread-12): Parsing macros/generate_schema_name.sql
2022-06-16 01:08:23.853094 (Thread-12): Parsing macros/adapters.sql
2022-06-16 01:08:23.871949 (Thread-12): Parsing macros/etc.sql
2022-06-16 01:08:23.873132 (Thread-12): Parsing macros/catalog.sql
2022-06-16 01:08:23.879010 (Thread-12): Parsing macros/materializations/table.sql
2022-06-16 01:08:23.888234 (Thread-12): Parsing macros/materializations/seed.sql
2022-06-16 01:08:23.891214 (Thread-12): Parsing macros/materializations/incremental.sql
2022-06-16 01:08:23.902820 (Thread-12): Parsing macros/materializations/copy.sql
2022-06-16 01:08:23.906788 (Thread-12): Parsing macros/materializations/snapshot.sql
2022-06-16 01:08:23.908507 (Thread-12): Parsing macros/materializations/view.sql
2022-06-16 01:08:23.911833 (Thread-12): Parsing macros/core.sql
2022-06-16 01:08:23.915208 (Thread-12): Parsing macros/adapters/common.sql
2022-06-16 01:08:23.955168 (Thread-12): Parsing macros/etc/datetime.sql
2022-06-16 01:08:23.963858 (Thread-12): Parsing macros/etc/get_custom_schema.sql
2022-06-16 01:08:23.965705 (Thread-12): Parsing macros/etc/get_custom_alias.sql
2022-06-16 01:08:23.966820 (Thread-12): Parsing macros/etc/is_incremental.sql
2022-06-16 01:08:23.968432 (Thread-12): Parsing macros/etc/get_custom_database.sql
2022-06-16 01:08:23.969985 (Thread-12): Parsing macros/etc/query.sql
2022-06-16 01:08:23.970999 (Thread-12): Parsing macros/schema_tests/unique.sql
2022-06-16 01:08:23.972793 (Thread-12): Parsing macros/schema_tests/not_null.sql
2022-06-16 01:08:23.974222 (Thread-12): Parsing macros/schema_tests/accepted_values.sql
2022-06-16 01:08:23.976763 (Thread-12): Parsing macros/schema_tests/relationships.sql
2022-06-16 01:08:23.978518 (Thread-12): Parsing macros/materializations/helpers.sql
2022-06-16 01:08:23.986608 (Thread-12): Parsing macros/materializations/table/table.sql
2022-06-16 01:08:23.992934 (Thread-12): Parsing macros/materializations/snapshot/strategies.sql
2022-06-16 01:08:24.007848 (Thread-12): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-06-16 01:08:24.009502 (Thread-12): Parsing macros/materializations/snapshot/snapshot.sql
2022-06-16 01:08:24.035841 (Thread-12): Parsing macros/materializations/seed/seed.sql
2022-06-16 01:08:24.054546 (Thread-12): Parsing macros/materializations/common/merge.sql
2022-06-16 01:08:24.067304 (Thread-12): Parsing macros/materializations/view/create_or_replace_view.sql
2022-06-16 01:08:24.071976 (Thread-12): Parsing macros/materializations/view/view.sql
2022-06-16 01:08:24.077632 (Thread-12): Parsing macros/materializations/incremental/helpers.sql
2022-06-16 01:08:24.079360 (Thread-12): Parsing macros/materializations/incremental/incremental.sql
2022-06-16 01:08:24.097882 (Thread-12): Parsing macros/logger/pretty_time.sql
2022-06-16 01:08:24.105692 (Thread-12): Parsing macros/logger/log_info.sql
2022-06-16 01:08:24.113447 (Thread-12): Parsing macros/logger/pretty_log_format.sql
2022-06-16 01:08:24.120692 (Thread-12): Parsing macros/sql/pivot.sql
2022-06-16 01:08:24.131897 (Thread-12): Parsing macros/sql/star.sql
2022-06-16 01:08:24.141829 (Thread-12): Parsing macros/sql/surrogate_key.sql
2022-06-16 01:08:24.151076 (Thread-12): Parsing macros/sql/get_query_results_as_dict.sql
2022-06-16 01:08:24.159125 (Thread-12): Parsing macros/sql/get_column_values.sql
2022-06-16 01:08:24.170152 (Thread-12): Parsing macros/sql/groupby.sql
2022-06-16 01:08:24.177367 (Thread-12): Parsing macros/sql/get_tables_by_pattern_sql.sql
2022-06-16 01:08:24.188906 (Thread-12): Parsing macros/sql/nullcheck_table.sql
2022-06-16 01:08:24.196987 (Thread-12): Parsing macros/sql/get_tables_by_prefix_sql.sql
2022-06-16 01:08:24.205500 (Thread-12): Parsing macros/sql/get_relations_by_pattern.sql
2022-06-16 01:08:24.214651 (Thread-12): Parsing macros/sql/get_relations_by_prefix.sql
2022-06-16 01:08:24.222814 (Thread-12): Parsing macros/sql/safe_add.sql
2022-06-16 01:08:24.229721 (Thread-12): Parsing macros/sql/unpivot.sql
2022-06-16 01:08:24.242985 (Thread-12): Parsing macros/sql/generate_series.sql
2022-06-16 01:08:24.252952 (Thread-12): Parsing macros/sql/nullcheck.sql
2022-06-16 01:08:24.261086 (Thread-12): Parsing macros/sql/union.sql
2022-06-16 01:08:24.274340 (Thread-12): Parsing macros/materializations/insert_by_period_materialization.sql
2022-06-16 01:08:24.302991 (Thread-12): Parsing macros/web/get_url_parameter.sql
2022-06-16 01:08:24.310435 (Thread-12): Parsing macros/web/get_url_path.sql
2022-06-16 01:08:24.319210 (Thread-12): Parsing macros/web/get_url_host.sql
2022-06-16 01:08:24.325992 (Thread-12): Parsing macros/datetime/date_spine.sql
2022-06-16 01:08:24.336864 (Thread-12): Parsing macros/schema_tests/expression_is_true.sql
2022-06-16 01:08:24.343532 (Thread-12): Parsing macros/schema_tests/not_constant.sql
2022-06-16 01:08:24.350810 (Thread-12): Parsing macros/schema_tests/at_least_one.sql
2022-06-16 01:08:24.358935 (Thread-12): Parsing macros/schema_tests/equality.sql
2022-06-16 01:08:24.368984 (Thread-12): Parsing macros/schema_tests/test_not_null_where.sql
2022-06-16 01:08:24.375814 (Thread-12): Parsing macros/schema_tests/equal_rowcount.sql
2022-06-16 01:08:24.382986 (Thread-12): Parsing macros/schema_tests/test_unique_where.sql
2022-06-16 01:08:24.390719 (Thread-12): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2022-06-16 01:08:24.402257 (Thread-12): Parsing macros/schema_tests/relationships_where.sql
2022-06-16 01:08:24.411688 (Thread-12): Parsing macros/schema_tests/unique_combination_of_columns.sql
2022-06-16 01:08:24.421268 (Thread-12): Parsing macros/schema_tests/recency.sql
2022-06-16 01:08:24.429513 (Thread-12): Parsing macros/schema_tests/cardinality_equality.sql
2022-06-16 01:08:24.437153 (Thread-12): Parsing macros/geo/haversine_distance.sql
2022-06-16 01:08:24.445754 (Thread-12): Parsing macros/cross_db_utils/split_part.sql
2022-06-16 01:08:24.454337 (Thread-12): Parsing macros/cross_db_utils/length.sql
2022-06-16 01:08:24.462118 (Thread-12): Parsing macros/cross_db_utils/current_timestamp.sql
2022-06-16 01:08:24.471511 (Thread-12): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2022-06-16 01:08:24.478673 (Thread-12): Parsing macros/cross_db_utils/right.sql
2022-06-16 01:08:24.487916 (Thread-12): Parsing macros/cross_db_utils/hash.sql
2022-06-16 01:08:24.494973 (Thread-12): Parsing macros/cross_db_utils/replace.sql
2022-06-16 01:08:24.502023 (Thread-12): Parsing macros/cross_db_utils/concat.sql
2022-06-16 01:08:24.510800 (Thread-12): Parsing macros/cross_db_utils/_is_relation.sql
2022-06-16 01:08:24.518761 (Thread-12): Parsing macros/cross_db_utils/identifier.sql
2022-06-16 01:08:24.527381 (Thread-12): Parsing macros/cross_db_utils/datediff.sql
2022-06-16 01:08:24.543388 (Thread-12): Parsing macros/cross_db_utils/dateadd.sql
2022-06-16 01:08:24.551896 (Thread-12): Parsing macros/cross_db_utils/datatypes.sql
2022-06-16 01:08:24.565164 (Thread-12): Parsing macros/cross_db_utils/position.sql
2022-06-16 01:08:24.574804 (Thread-12): Parsing macros/cross_db_utils/literal.sql
2022-06-16 01:08:24.583616 (Thread-12): Parsing macros/cross_db_utils/_is_ephemeral.sql
2022-06-16 01:08:24.592560 (Thread-12): Parsing macros/cross_db_utils/width_bucket.sql
2022-06-16 01:08:24.604396 (Thread-12): Parsing macros/cross_db_utils/date_trunc.sql
2022-06-16 01:08:24.613463 (Thread-12): Parsing macros/cross_db_utils/except.sql
2022-06-16 01:08:24.622262 (Thread-12): Parsing macros/cross_db_utils/safe_cast.sql
2022-06-16 01:08:24.630648 (Thread-12): Parsing macros/cross_db_utils/last_day.sql
2022-06-16 01:08:24.639593 (Thread-12): Parsing macros/cross_db_utils/intersect.sql
2022-06-16 01:08:24.703140 (Thread-12): Acquiring new bigquery connection "model.tech_audit.agg_all".
2022-06-16 01:08:24.733148 (Thread-12): Acquiring new bigquery connection "model.tech_audit.agg_traffic".
2022-06-16 01:08:24.755164 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_diffs_count".
2022-06-16 01:08:24.781409 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_diffs".
2022-06-16 01:08:24.800393 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_count".
2022-06-16 01:08:24.826579 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_data_studio".
2022-06-16 01:08:24.843715 (Thread-12): Acquiring new bigquery connection "model.tech_audit.domains_proc".
2022-06-16 01:08:24.858371 (Thread-12): Acquiring new bigquery connection "model.tech_audit.crawl_dates".
2022-06-16 01:08:24.877430 (Thread-12): Acquiring new bigquery connection "model.tech_audit.dates".
2022-06-16 01:08:24.896223 (Thread-12): Acquiring new bigquery connection "model.tech_audit.ga_stats".
2022-06-16 01:08:24.914829 (Thread-12): Acquiring new bigquery connection "model.tech_audit.ga_proc_url_mapping".
2022-06-16 01:08:24.933360 (Thread-12): Acquiring new bigquery connection "model.tech_audit.ga_proc".
2022-06-16 01:08:24.952002 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_keyword_stats".
2022-06-16 01:08:24.971424 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_url_proc_url_mapping".
2022-06-16 01:08:24.989497 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_url_keyword_stats".
2022-06-16 01:08:25.010175 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_keyword_proc_url_mapping".
2022-06-16 01:08:25.029160 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_url_stats".
2022-06-16 01:08:25.048091 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_keyword_proc".
2022-06-16 01:08:25.067300 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_url_proc".
2022-06-16 01:08:25.086658 (Thread-12): Acquiring new bigquery connection "model.tech_audit.deepcrawl_proc".
2022-06-16 01:08:25.106810 (Thread-12): Acquiring new bigquery connection "model.tech_audit.deepcrawl_latest_crawl_proc".
2022-06-16 01:08:25.123997 (Thread-12): Acquiring new bigquery connection "model.tech_audit.deepcrawl_url_proc".
2022-06-16 01:08:25.141606 (Thread-12): Acquiring new bigquery connection "model.tech_audit.deepcrawl_stats".
2022-06-16 01:08:25.162571 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_proc".
2022-06-16 01:08:25.182057 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_hierarchy".
2022-06-16 01:08:26.894464 (Thread-13): handling ps request
2022-06-16 01:08:26.894982 (Thread-13): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'f7598d7c-d5b7-4d13-a200-7d26e00c1e13', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5a86fc1490>]}
2022-06-16 01:08:26.896730 (Thread-13): sending response (<Response 104 bytes [200 OK]>) to 10.0.3.87
2022-06-16 01:08:27.106799 (Thread-14): handling status request
2022-06-16 01:08:27.107314 (Thread-14): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'f7598d7c-d5b7-4d13-a200-7d26e00c1e13', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5a86fb2ac0>]}
2022-06-16 01:08:27.116345 (Thread-14): sending response (<Response 32943 bytes [200 OK]>) to 10.0.3.87
2022-06-16 01:08:27.230479 (Thread-15): handling status request
2022-06-16 01:08:27.230811 (Thread-15): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'f7598d7c-d5b7-4d13-a200-7d26e00c1e13', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5a86f69070>]}
2022-06-16 01:08:27.238664 (Thread-15): sending response (<Response 32943 bytes [200 OK]>) to 10.0.3.87
2022-06-16 01:08:27.370552 (Thread-16): handling status request
2022-06-16 01:08:27.370872 (Thread-16): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'f7598d7c-d5b7-4d13-a200-7d26e00c1e13', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5a86fcfc10>]}
2022-06-16 01:08:27.378523 (Thread-16): sending response (<Response 32943 bytes [200 OK]>) to 10.0.3.87
2022-06-16 01:08:49.416278 (Thread-17): handling status request
2022-06-16 01:08:49.417390 (Thread-17): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'f7598d7c-d5b7-4d13-a200-7d26e00c1e13', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5a86fd3eb0>]}
2022-06-16 01:08:49.425351 (Thread-17): sending response (<Response 32943 bytes [200 OK]>) to 10.0.3.87
2022-06-16 01:09:21.763806 (Thread-18): handling status request
2022-06-16 01:09:21.765703 (Thread-18): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'f7598d7c-d5b7-4d13-a200-7d26e00c1e13', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5a86f1faf0>]}
2022-06-16 01:09:21.773505 (Thread-18): sending response (<Response 32943 bytes [200 OK]>) to 10.0.3.87
2022-06-16 01:09:24.786042 (MainThread): Connection 'model.tech_audit.actions_hierarchy' was properly closed.
2022-06-16 01:09:24.827448 (Thread-19): Parsing macros/generate_schema_name.sql
2022-06-16 01:09:24.828777 (Thread-19): Parsing macros/adapters.sql
2022-06-16 01:09:24.846183 (Thread-19): Parsing macros/etc.sql
2022-06-16 01:09:24.847398 (Thread-19): Parsing macros/catalog.sql
2022-06-16 01:09:24.853025 (Thread-19): Parsing macros/materializations/table.sql
2022-06-16 01:09:24.861910 (Thread-19): Parsing macros/materializations/seed.sql
2022-06-16 01:09:24.864465 (Thread-19): Parsing macros/materializations/incremental.sql
2022-06-16 01:09:24.875920 (Thread-19): Parsing macros/materializations/copy.sql
2022-06-16 01:09:24.879883 (Thread-19): Parsing macros/materializations/snapshot.sql
2022-06-16 01:09:24.881561 (Thread-19): Parsing macros/materializations/view.sql
2022-06-16 01:09:24.884825 (Thread-19): Parsing macros/core.sql
2022-06-16 01:09:24.888198 (Thread-19): Parsing macros/adapters/common.sql
2022-06-16 01:09:24.927404 (Thread-19): Parsing macros/etc/datetime.sql
2022-06-16 01:09:24.935380 (Thread-19): Parsing macros/etc/get_custom_schema.sql
2022-06-16 01:09:24.937210 (Thread-19): Parsing macros/etc/get_custom_alias.sql
2022-06-16 01:09:24.938109 (Thread-19): Parsing macros/etc/is_incremental.sql
2022-06-16 01:09:24.939628 (Thread-19): Parsing macros/etc/get_custom_database.sql
2022-06-16 01:09:24.941171 (Thread-19): Parsing macros/etc/query.sql
2022-06-16 01:09:24.942149 (Thread-19): Parsing macros/schema_tests/unique.sql
2022-06-16 01:09:24.943933 (Thread-19): Parsing macros/schema_tests/not_null.sql
2022-06-16 01:09:24.945353 (Thread-19): Parsing macros/schema_tests/accepted_values.sql
2022-06-16 01:09:24.947901 (Thread-19): Parsing macros/schema_tests/relationships.sql
2022-06-16 01:09:24.949648 (Thread-19): Parsing macros/materializations/helpers.sql
2022-06-16 01:09:24.957818 (Thread-19): Parsing macros/materializations/table/table.sql
2022-06-16 01:09:24.964065 (Thread-19): Parsing macros/materializations/snapshot/strategies.sql
2022-06-16 01:09:24.978929 (Thread-19): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-06-16 01:09:24.980592 (Thread-19): Parsing macros/materializations/snapshot/snapshot.sql
2022-06-16 01:09:25.007206 (Thread-19): Parsing macros/materializations/seed/seed.sql
2022-06-16 01:09:25.026165 (Thread-19): Parsing macros/materializations/common/merge.sql
2022-06-16 01:09:25.039131 (Thread-19): Parsing macros/materializations/view/create_or_replace_view.sql
2022-06-16 01:09:25.043876 (Thread-19): Parsing macros/materializations/view/view.sql
2022-06-16 01:09:25.049631 (Thread-19): Parsing macros/materializations/incremental/helpers.sql
2022-06-16 01:09:25.051351 (Thread-19): Parsing macros/materializations/incremental/incremental.sql
2022-06-16 01:09:25.064968 (Thread-19): Parsing macros/logger/pretty_time.sql
2022-06-16 01:09:25.068008 (Thread-19): Parsing macros/logger/log_info.sql
2022-06-16 01:09:25.070554 (Thread-19): Parsing macros/logger/pretty_log_format.sql
2022-06-16 01:09:25.073932 (Thread-19): Parsing macros/sql/pivot.sql
2022-06-16 01:09:25.082575 (Thread-19): Parsing macros/sql/star.sql
2022-06-16 01:09:25.089976 (Thread-19): Parsing macros/sql/surrogate_key.sql
2022-06-16 01:09:25.097116 (Thread-19): Parsing macros/sql/get_query_results_as_dict.sql
2022-06-16 01:09:25.102091 (Thread-19): Parsing macros/sql/get_column_values.sql
2022-06-16 01:09:25.109865 (Thread-19): Parsing macros/sql/groupby.sql
2022-06-16 01:09:25.113221 (Thread-19): Parsing macros/sql/get_tables_by_pattern_sql.sql
2022-06-16 01:09:25.123577 (Thread-19): Parsing macros/sql/nullcheck_table.sql
2022-06-16 01:09:25.127445 (Thread-19): Parsing macros/sql/get_tables_by_prefix_sql.sql
2022-06-16 01:09:25.131128 (Thread-19): Parsing macros/sql/get_relations_by_pattern.sql
2022-06-16 01:09:25.137251 (Thread-19): Parsing macros/sql/get_relations_by_prefix.sql
2022-06-16 01:09:25.141837 (Thread-19): Parsing macros/sql/safe_add.sql
2022-06-16 01:09:25.144715 (Thread-19): Parsing macros/sql/unpivot.sql
2022-06-16 01:09:25.152972 (Thread-19): Parsing macros/sql/generate_series.sql
2022-06-16 01:09:25.158712 (Thread-19): Parsing macros/sql/nullcheck.sql
2022-06-16 01:09:25.161669 (Thread-19): Parsing macros/sql/union.sql
2022-06-16 01:09:25.170704 (Thread-19): Parsing macros/materializations/insert_by_period_materialization.sql
2022-06-16 01:09:25.195548 (Thread-19): Parsing macros/web/get_url_parameter.sql
2022-06-16 01:09:25.198359 (Thread-19): Parsing macros/web/get_url_path.sql
2022-06-16 01:09:25.202128 (Thread-19): Parsing macros/web/get_url_host.sql
2022-06-16 01:09:25.205233 (Thread-19): Parsing macros/datetime/date_spine.sql
2022-06-16 01:09:25.210939 (Thread-19): Parsing macros/schema_tests/expression_is_true.sql
2022-06-16 01:09:25.213913 (Thread-19): Parsing macros/schema_tests/not_constant.sql
2022-06-16 01:09:25.216642 (Thread-19): Parsing macros/schema_tests/at_least_one.sql
2022-06-16 01:09:25.219382 (Thread-19): Parsing macros/schema_tests/equality.sql
2022-06-16 01:09:25.224946 (Thread-19): Parsing macros/schema_tests/test_not_null_where.sql
2022-06-16 01:09:25.228077 (Thread-19): Parsing macros/schema_tests/equal_rowcount.sql
2022-06-16 01:09:25.231006 (Thread-19): Parsing macros/schema_tests/test_unique_where.sql
2022-06-16 01:09:25.234271 (Thread-19): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2022-06-16 01:09:25.241637 (Thread-19): Parsing macros/schema_tests/relationships_where.sql
2022-06-16 01:09:25.245465 (Thread-19): Parsing macros/schema_tests/unique_combination_of_columns.sql
2022-06-16 01:09:25.251095 (Thread-19): Parsing macros/schema_tests/recency.sql
2022-06-16 01:09:25.254142 (Thread-19): Parsing macros/schema_tests/cardinality_equality.sql
2022-06-16 01:09:25.257879 (Thread-19): Parsing macros/geo/haversine_distance.sql
2022-06-16 01:09:25.260873 (Thread-19): Parsing macros/cross_db_utils/split_part.sql
2022-06-16 01:09:25.263928 (Thread-19): Parsing macros/cross_db_utils/length.sql
2022-06-16 01:09:25.266528 (Thread-19): Parsing macros/cross_db_utils/current_timestamp.sql
2022-06-16 01:09:25.270967 (Thread-19): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2022-06-16 01:09:25.273062 (Thread-19): Parsing macros/cross_db_utils/right.sql
2022-06-16 01:09:25.276604 (Thread-19): Parsing macros/cross_db_utils/hash.sql
2022-06-16 01:09:25.279421 (Thread-19): Parsing macros/cross_db_utils/replace.sql
2022-06-16 01:09:25.281845 (Thread-19): Parsing macros/cross_db_utils/concat.sql
2022-06-16 01:09:25.285302 (Thread-19): Parsing macros/cross_db_utils/_is_relation.sql
2022-06-16 01:09:25.288030 (Thread-19): Parsing macros/cross_db_utils/identifier.sql
2022-06-16 01:09:25.291051 (Thread-19): Parsing macros/cross_db_utils/datediff.sql
2022-06-16 01:09:25.301274 (Thread-19): Parsing macros/cross_db_utils/dateadd.sql
2022-06-16 01:09:25.304979 (Thread-19): Parsing macros/cross_db_utils/datatypes.sql
2022-06-16 01:09:25.312440 (Thread-19): Parsing macros/cross_db_utils/position.sql
2022-06-16 01:09:25.315251 (Thread-19): Parsing macros/cross_db_utils/literal.sql
2022-06-16 01:09:25.317511 (Thread-19): Parsing macros/cross_db_utils/_is_ephemeral.sql
2022-06-16 01:09:25.320614 (Thread-19): Parsing macros/cross_db_utils/width_bucket.sql
2022-06-16 01:09:25.327026 (Thread-19): Parsing macros/cross_db_utils/date_trunc.sql
2022-06-16 01:09:25.329975 (Thread-19): Parsing macros/cross_db_utils/except.sql
2022-06-16 01:09:25.332318 (Thread-19): Parsing macros/cross_db_utils/safe_cast.sql
2022-06-16 01:09:25.335845 (Thread-19): Parsing macros/cross_db_utils/last_day.sql
2022-06-16 01:09:25.339628 (Thread-19): Parsing macros/cross_db_utils/intersect.sql
2022-06-16 01:09:25.507227 (Thread-19): Acquiring new bigquery connection "model.tech_audit.agg_all".
2022-06-16 01:09:25.522252 (Thread-19): Acquiring new bigquery connection "model.tech_audit.agg_traffic".
2022-06-16 01:09:25.538201 (Thread-19): Acquiring new bigquery connection "model.tech_audit.actions_diffs_count".
2022-06-16 01:09:25.558884 (Thread-19): Acquiring new bigquery connection "model.tech_audit.actions_diffs".
2022-06-16 01:09:25.573447 (Thread-19): Acquiring new bigquery connection "model.tech_audit.actions_count".
2022-06-16 01:09:25.590994 (Thread-19): Acquiring new bigquery connection "model.tech_audit.actions_data_studio".
2022-06-16 01:09:25.603238 (Thread-19): Acquiring new bigquery connection "model.tech_audit.domains_proc".
2022-06-16 01:09:25.613606 (Thread-19): Acquiring new bigquery connection "model.tech_audit.crawl_dates".
2022-06-16 01:09:25.622553 (Thread-20): handling status request
2022-06-16 01:09:25.622935 (Thread-20): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'f7598d7c-d5b7-4d13-a200-7d26e00c1e13', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5aa81e5400>]}
2022-06-16 01:09:25.623582 (Thread-20): sending response (<Response 184 bytes [200 OK]>) to 10.0.3.87
2022-06-16 01:09:25.628239 (Thread-19): Acquiring new bigquery connection "model.tech_audit.dates".
2022-06-16 01:09:25.641777 (Thread-19): Acquiring new bigquery connection "model.tech_audit.ga_stats".
2022-06-16 01:09:25.655600 (Thread-19): Acquiring new bigquery connection "model.tech_audit.ga_proc_url_mapping".
2022-06-16 01:09:25.668512 (Thread-19): Acquiring new bigquery connection "model.tech_audit.ga_proc".
2022-06-16 01:09:25.681713 (Thread-19): Acquiring new bigquery connection "model.tech_audit.search_console_keyword_stats".
2022-06-16 01:09:25.695210 (Thread-19): Acquiring new bigquery connection "model.tech_audit.search_console_url_proc_url_mapping".
2022-06-16 01:09:25.708045 (Thread-19): Acquiring new bigquery connection "model.tech_audit.search_console_url_keyword_stats".
2022-06-16 01:09:25.722306 (Thread-19): Acquiring new bigquery connection "model.tech_audit.search_console_keyword_proc_url_mapping".
2022-06-16 01:09:25.736098 (Thread-19): Acquiring new bigquery connection "model.tech_audit.search_console_url_stats".
2022-06-16 01:09:25.749470 (Thread-19): Acquiring new bigquery connection "model.tech_audit.search_console_keyword_proc".
2022-06-16 01:09:25.762510 (Thread-19): Acquiring new bigquery connection "model.tech_audit.search_console_url_proc".
2022-06-16 01:09:25.775721 (Thread-19): Acquiring new bigquery connection "model.tech_audit.deepcrawl_proc".
2022-06-16 01:09:25.790782 (Thread-19): Acquiring new bigquery connection "model.tech_audit.deepcrawl_latest_crawl_proc".
2022-06-16 01:09:25.803857 (Thread-19): Acquiring new bigquery connection "model.tech_audit.deepcrawl_url_proc".
2022-06-16 01:09:25.816560 (Thread-19): Acquiring new bigquery connection "model.tech_audit.deepcrawl_stats".
2022-06-16 01:09:25.830869 (Thread-19): Acquiring new bigquery connection "model.tech_audit.actions_proc".
2022-06-16 01:09:25.844814 (Thread-19): Acquiring new bigquery connection "model.tech_audit.actions_hierarchy".
2022-06-16 01:09:25.924469 (Thread-21): handling status request
2022-06-16 01:09:25.925045 (Thread-21): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'f7598d7c-d5b7-4d13-a200-7d26e00c1e13', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5aa81bc9a0>]}
2022-06-16 01:09:25.925727 (Thread-21): sending response (<Response 184 bytes [200 OK]>) to 10.0.3.87
2022-06-16 01:09:27.190506 (Thread-22): handling status request
2022-06-16 01:09:27.191007 (Thread-22): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'f7598d7c-d5b7-4d13-a200-7d26e00c1e13', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5a86f9fe80>]}
2022-06-16 01:09:27.199115 (Thread-22): sending response (<Response 32943 bytes [200 OK]>) to 10.0.3.87
2022-06-16 01:09:47.198476 (Thread-23): handling status request
2022-06-16 01:09:47.198951 (Thread-23): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'f7598d7c-d5b7-4d13-a200-7d26e00c1e13', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5a86f54f40>]}
2022-06-16 01:09:47.206855 (Thread-23): sending response (<Response 32943 bytes [200 OK]>) to 10.0.3.87
2022-06-16 01:25:17.815748 (MainThread): Running with dbt=0.18.1
2022-06-16 01:25:18.032695 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.rpc.server.RPCServerTask'>, debug=False, defer=None, exclude=None, host='0.0.0.0', log_cache_events=False, log_format='default', models=None, partial_parse=True, port=8580, profile='user', profiles_dir='/usr/src/develop/.dbt', project_dir=None, record_timing_info=None, rpc_method=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='rpc', write_json=True)
2022-06-16 01:25:18.044159 (MainThread): Tracking: tracking
2022-06-16 01:25:18.063963 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd2d4b30cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd2d0185ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd2d01859a0>]}
2022-06-16 01:25:18.064314 (MainThread): Serving RPC server at 0.0.0.0:8580, pid=22
2022-06-16 01:25:18.064732 (MainThread): Supported methods: ['cli_args', 'compile', 'compile_sql', 'deps', 'docs.generate', 'gc', 'get-manifest', 'kill', 'poll', 'ps', 'run', 'run-operation', 'run_sql', 'seed', 'snapshot', 'snapshot-freshness', 'status', 'test']
2022-06-16 01:25:18.065012 (MainThread): Send requests to http://localhost:8580/jsonrpc
2022-06-16 01:25:18.085789 (Thread-12): Parsing macros/generate_schema_name.sql
2022-06-16 01:25:18.087310 (Thread-12): Parsing macros/adapters.sql
2022-06-16 01:25:18.106376 (Thread-12): Parsing macros/etc.sql
2022-06-16 01:25:18.107606 (Thread-12): Parsing macros/catalog.sql
2022-06-16 01:25:18.113251 (Thread-12): Parsing macros/materializations/table.sql
2022-06-16 01:25:18.122281 (Thread-12): Parsing macros/materializations/seed.sql
2022-06-16 01:25:18.124810 (Thread-12): Parsing macros/materializations/incremental.sql
2022-06-16 01:25:18.136485 (Thread-12): Parsing macros/materializations/copy.sql
2022-06-16 01:25:18.140475 (Thread-12): Parsing macros/materializations/snapshot.sql
2022-06-16 01:25:18.142157 (Thread-12): Parsing macros/materializations/view.sql
2022-06-16 01:25:18.145462 (Thread-12): Parsing macros/core.sql
2022-06-16 01:25:18.148838 (Thread-12): Parsing macros/adapters/common.sql
2022-06-16 01:25:18.188258 (Thread-12): Parsing macros/etc/datetime.sql
2022-06-16 01:25:18.196258 (Thread-12): Parsing macros/etc/get_custom_schema.sql
2022-06-16 01:25:18.198082 (Thread-12): Parsing macros/etc/get_custom_alias.sql
2022-06-16 01:25:18.198999 (Thread-12): Parsing macros/etc/is_incremental.sql
2022-06-16 01:25:18.200516 (Thread-12): Parsing macros/etc/get_custom_database.sql
2022-06-16 01:25:18.202056 (Thread-12): Parsing macros/etc/query.sql
2022-06-16 01:25:18.203086 (Thread-12): Parsing macros/schema_tests/unique.sql
2022-06-16 01:25:18.204886 (Thread-12): Parsing macros/schema_tests/not_null.sql
2022-06-16 01:25:18.206324 (Thread-12): Parsing macros/schema_tests/accepted_values.sql
2022-06-16 01:25:18.208846 (Thread-12): Parsing macros/schema_tests/relationships.sql
2022-06-16 01:25:18.210602 (Thread-12): Parsing macros/materializations/helpers.sql
2022-06-16 01:25:18.218809 (Thread-12): Parsing macros/materializations/table/table.sql
2022-06-16 01:25:18.225126 (Thread-12): Parsing macros/materializations/snapshot/strategies.sql
2022-06-16 01:25:18.240115 (Thread-12): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-06-16 01:25:18.241762 (Thread-12): Parsing macros/materializations/snapshot/snapshot.sql
2022-06-16 01:25:18.268076 (Thread-12): Parsing macros/materializations/seed/seed.sql
2022-06-16 01:25:18.286752 (Thread-12): Parsing macros/materializations/common/merge.sql
2022-06-16 01:25:18.299434 (Thread-12): Parsing macros/materializations/view/create_or_replace_view.sql
2022-06-16 01:25:18.304120 (Thread-12): Parsing macros/materializations/view/view.sql
2022-06-16 01:25:18.309779 (Thread-12): Parsing macros/materializations/incremental/helpers.sql
2022-06-16 01:25:18.311495 (Thread-12): Parsing macros/materializations/incremental/incremental.sql
2022-06-16 01:25:18.325986 (Thread-12): Parsing macros/logger/pretty_time.sql
2022-06-16 01:25:18.329352 (Thread-12): Parsing macros/logger/log_info.sql
2022-06-16 01:25:18.332581 (Thread-12): Parsing macros/logger/pretty_log_format.sql
2022-06-16 01:25:18.335687 (Thread-12): Parsing macros/sql/pivot.sql
2022-06-16 01:25:18.342040 (Thread-12): Parsing macros/sql/star.sql
2022-06-16 01:25:18.347468 (Thread-12): Parsing macros/sql/surrogate_key.sql
2022-06-16 01:25:18.353227 (Thread-12): Parsing macros/sql/get_query_results_as_dict.sql
2022-06-16 01:25:18.357561 (Thread-12): Parsing macros/sql/get_column_values.sql
2022-06-16 01:25:18.364090 (Thread-12): Parsing macros/sql/groupby.sql
2022-06-16 01:25:18.367693 (Thread-12): Parsing macros/sql/get_tables_by_pattern_sql.sql
2022-06-16 01:25:18.375861 (Thread-12): Parsing macros/sql/nullcheck_table.sql
2022-06-16 01:25:18.379615 (Thread-12): Parsing macros/sql/get_tables_by_prefix_sql.sql
2022-06-16 01:25:18.383491 (Thread-12): Parsing macros/sql/get_relations_by_pattern.sql
2022-06-16 01:25:18.389135 (Thread-12): Parsing macros/sql/get_relations_by_prefix.sql
2022-06-16 01:25:18.394574 (Thread-12): Parsing macros/sql/safe_add.sql
2022-06-16 01:25:18.398350 (Thread-12): Parsing macros/sql/unpivot.sql
2022-06-16 01:25:18.408185 (Thread-12): Parsing macros/sql/generate_series.sql
2022-06-16 01:25:18.414583 (Thread-12): Parsing macros/sql/nullcheck.sql
2022-06-16 01:25:18.418914 (Thread-12): Parsing macros/sql/union.sql
2022-06-16 01:25:18.429156 (Thread-12): Parsing macros/materializations/insert_by_period_materialization.sql
2022-06-16 01:25:18.455475 (Thread-12): Parsing macros/web/get_url_parameter.sql
2022-06-16 01:25:18.459244 (Thread-12): Parsing macros/web/get_url_path.sql
2022-06-16 01:25:18.465927 (Thread-12): Parsing macros/web/get_url_host.sql
2022-06-16 01:25:18.470059 (Thread-12): Parsing macros/datetime/date_spine.sql
2022-06-16 01:25:18.477449 (Thread-12): Parsing macros/schema_tests/expression_is_true.sql
2022-06-16 01:25:18.481240 (Thread-12): Parsing macros/schema_tests/not_constant.sql
2022-06-16 01:25:18.485360 (Thread-12): Parsing macros/schema_tests/at_least_one.sql
2022-06-16 01:25:18.489143 (Thread-12): Parsing macros/schema_tests/equality.sql
2022-06-16 01:25:18.495470 (Thread-12): Parsing macros/schema_tests/test_not_null_where.sql
2022-06-16 01:25:18.499668 (Thread-12): Parsing macros/schema_tests/equal_rowcount.sql
2022-06-16 01:25:18.503819 (Thread-12): Parsing macros/schema_tests/test_unique_where.sql
2022-06-16 01:25:18.508259 (Thread-12): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2022-06-16 01:25:18.516778 (Thread-12): Parsing macros/schema_tests/relationships_where.sql
2022-06-16 01:25:18.521518 (Thread-12): Parsing macros/schema_tests/unique_combination_of_columns.sql
2022-06-16 01:25:18.526745 (Thread-12): Parsing macros/schema_tests/recency.sql
2022-06-16 01:25:18.530627 (Thread-12): Parsing macros/schema_tests/cardinality_equality.sql
2022-06-16 01:25:18.535376 (Thread-12): Parsing macros/geo/haversine_distance.sql
2022-06-16 01:25:18.539211 (Thread-12): Parsing macros/cross_db_utils/split_part.sql
2022-06-16 01:25:18.543290 (Thread-12): Parsing macros/cross_db_utils/length.sql
2022-06-16 01:25:18.546775 (Thread-12): Parsing macros/cross_db_utils/current_timestamp.sql
2022-06-16 01:25:18.552013 (Thread-12): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2022-06-16 01:25:18.554784 (Thread-12): Parsing macros/cross_db_utils/right.sql
2022-06-16 01:25:18.559146 (Thread-12): Parsing macros/cross_db_utils/hash.sql
2022-06-16 01:25:18.562894 (Thread-12): Parsing macros/cross_db_utils/replace.sql
2022-06-16 01:25:18.566267 (Thread-12): Parsing macros/cross_db_utils/concat.sql
2022-06-16 01:25:18.570545 (Thread-12): Parsing macros/cross_db_utils/_is_relation.sql
2022-06-16 01:25:18.574076 (Thread-12): Parsing macros/cross_db_utils/identifier.sql
2022-06-16 01:25:18.578330 (Thread-12): Parsing macros/cross_db_utils/datediff.sql
2022-06-16 01:25:18.589332 (Thread-12): Parsing macros/cross_db_utils/dateadd.sql
2022-06-16 01:25:18.593959 (Thread-12): Parsing macros/cross_db_utils/datatypes.sql
2022-06-16 01:25:18.602627 (Thread-12): Parsing macros/cross_db_utils/position.sql
2022-06-16 01:25:18.606538 (Thread-12): Parsing macros/cross_db_utils/literal.sql
2022-06-16 01:25:18.609764 (Thread-12): Parsing macros/cross_db_utils/_is_ephemeral.sql
2022-06-16 01:25:18.613810 (Thread-12): Parsing macros/cross_db_utils/width_bucket.sql
2022-06-16 01:25:18.621194 (Thread-12): Parsing macros/cross_db_utils/date_trunc.sql
2022-06-16 01:25:18.625346 (Thread-12): Parsing macros/cross_db_utils/except.sql
2022-06-16 01:25:18.628847 (Thread-12): Parsing macros/cross_db_utils/safe_cast.sql
2022-06-16 01:25:18.633088 (Thread-12): Parsing macros/cross_db_utils/last_day.sql
2022-06-16 01:25:18.638096 (Thread-12): Parsing macros/cross_db_utils/intersect.sql
2022-06-16 01:25:18.695712 (Thread-12): Acquiring new bigquery connection "model.tech_audit.agg_all".
2022-06-16 01:25:18.721379 (Thread-12): Acquiring new bigquery connection "model.tech_audit.agg_traffic".
2022-06-16 01:25:18.738224 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_diffs_count".
2022-06-16 01:25:18.759103 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_diffs".
2022-06-16 01:25:18.774532 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_count".
2022-06-16 01:25:18.794208 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_data_studio".
2022-06-16 01:25:18.807588 (Thread-12): Acquiring new bigquery connection "model.tech_audit.domains_proc".
2022-06-16 01:25:18.818860 (Thread-12): Acquiring new bigquery connection "model.tech_audit.crawl_dates".
2022-06-16 01:25:18.832588 (Thread-12): Acquiring new bigquery connection "model.tech_audit.dates".
2022-06-16 01:25:18.846407 (Thread-12): Acquiring new bigquery connection "model.tech_audit.ga_stats".
2022-06-16 01:25:18.861142 (Thread-12): Acquiring new bigquery connection "model.tech_audit.ga_proc_url_mapping".
2022-06-16 01:25:18.875395 (Thread-12): Acquiring new bigquery connection "model.tech_audit.ga_proc".
2022-06-16 01:25:18.890847 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_keyword_stats".
2022-06-16 01:25:18.905497 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_url_proc_url_mapping".
2022-06-16 01:25:18.918935 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_url_keyword_stats".
2022-06-16 01:25:18.934304 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_keyword_proc_url_mapping".
2022-06-16 01:25:18.948281 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_url_stats".
2022-06-16 01:25:18.962355 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_keyword_proc".
2022-06-16 01:25:18.976568 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_url_proc".
2022-06-16 01:25:18.991083 (Thread-12): Acquiring new bigquery connection "model.tech_audit.deepcrawl_proc".
2022-06-16 01:25:19.006788 (Thread-12): Acquiring new bigquery connection "model.tech_audit.deepcrawl_latest_crawl_proc".
2022-06-16 01:25:19.020528 (Thread-12): Acquiring new bigquery connection "model.tech_audit.deepcrawl_url_proc".
2022-06-16 01:25:19.034248 (Thread-12): Acquiring new bigquery connection "model.tech_audit.deepcrawl_stats".
2022-06-16 01:25:19.049187 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_proc".
2022-06-16 01:25:19.063984 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_hierarchy".
2022-06-16 01:25:24.416865 (Thread-13): handling status request
2022-06-16 01:25:24.417346 (Thread-13): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'ca0f3c86-c72f-4eff-a1d7-bb842180b889', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd2c0584790>]}
2022-06-16 01:25:24.426163 (Thread-13): sending response (<Response 32943 bytes [200 OK]>) to 10.0.3.87
2022-06-16 01:25:24.614609 (Thread-14): handling ps request
2022-06-16 01:25:24.615085 (Thread-14): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'ca0f3c86-c72f-4eff-a1d7-bb842180b889', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd2c0584160>]}
2022-06-16 01:25:24.616659 (Thread-14): sending response (<Response 104 bytes [200 OK]>) to 10.0.3.87
2022-06-16 01:25:24.742498 (Thread-15): handling status request
2022-06-16 01:25:24.742962 (Thread-15): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'ca0f3c86-c72f-4eff-a1d7-bb842180b889', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd2c057b790>]}
2022-06-16 01:25:24.750707 (Thread-15): sending response (<Response 32943 bytes [200 OK]>) to 10.0.3.87
2022-06-16 01:25:24.784949 (Thread-16): handling status request
2022-06-16 01:25:24.785260 (Thread-16): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'ca0f3c86-c72f-4eff-a1d7-bb842180b889', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd2c02fb790>]}
2022-06-16 01:25:24.792985 (Thread-16): sending response (<Response 32943 bytes [200 OK]>) to 10.0.3.87
2022-06-16 01:25:40.430621 (Thread-17): handling status request
2022-06-16 01:25:40.431098 (Thread-17): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'ca0f3c86-c72f-4eff-a1d7-bb842180b889', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd2c0301970>]}
2022-06-16 01:25:40.439015 (Thread-17): sending response (<Response 32943 bytes [200 OK]>) to 10.0.3.87
2022-07-13 19:25:20.187566 (MainThread): Running with dbt=0.18.1
2022-07-13 19:25:20.407885 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.rpc.server.RPCServerTask'>, debug=False, defer=None, exclude=None, host='0.0.0.0', log_cache_events=False, log_format='default', models=None, partial_parse=True, port=8580, profile='user', profiles_dir='/usr/src/develop/.dbt', project_dir=None, record_timing_info=None, rpc_method=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='rpc', write_json=True)
2022-07-13 19:25:20.418641 (MainThread): Tracking: tracking
2022-07-13 19:25:20.438546 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa33a649970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa3393fc130>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa3393fcbe0>]}
2022-07-13 19:25:20.438892 (MainThread): Serving RPC server at 0.0.0.0:8580, pid=22
2022-07-13 19:25:20.439260 (MainThread): Supported methods: ['cli_args', 'compile', 'compile_sql', 'deps', 'docs.generate', 'gc', 'get-manifest', 'kill', 'poll', 'ps', 'run', 'run-operation', 'run_sql', 'seed', 'snapshot', 'snapshot-freshness', 'status', 'test']
2022-07-13 19:25:20.439493 (MainThread): Send requests to http://localhost:8580/jsonrpc
2022-07-13 19:25:20.471507 (Thread-12): Parsing macros/generate_schema_name.sql
2022-07-13 19:25:20.473283 (Thread-12): Parsing macros/adapters.sql
2022-07-13 19:25:20.491411 (Thread-12): Parsing macros/etc.sql
2022-07-13 19:25:20.492653 (Thread-12): Parsing macros/catalog.sql
2022-07-13 19:25:20.498270 (Thread-12): Parsing macros/materializations/table.sql
2022-07-13 19:25:20.507179 (Thread-12): Parsing macros/materializations/seed.sql
2022-07-13 19:25:20.509696 (Thread-12): Parsing macros/materializations/incremental.sql
2022-07-13 19:25:20.521024 (Thread-12): Parsing macros/materializations/copy.sql
2022-07-13 19:25:20.524943 (Thread-12): Parsing macros/materializations/snapshot.sql
2022-07-13 19:25:20.526620 (Thread-12): Parsing macros/materializations/view.sql
2022-07-13 19:25:20.529909 (Thread-12): Parsing macros/core.sql
2022-07-13 19:25:20.533262 (Thread-12): Parsing macros/adapters/common.sql
2022-07-13 19:25:20.572446 (Thread-12): Parsing macros/etc/datetime.sql
2022-07-13 19:25:20.580390 (Thread-12): Parsing macros/etc/get_custom_schema.sql
2022-07-13 19:25:20.582217 (Thread-12): Parsing macros/etc/get_custom_alias.sql
2022-07-13 19:25:20.583115 (Thread-12): Parsing macros/etc/is_incremental.sql
2022-07-13 19:25:20.584642 (Thread-12): Parsing macros/etc/get_custom_database.sql
2022-07-13 19:25:20.586187 (Thread-12): Parsing macros/etc/query.sql
2022-07-13 19:25:20.587179 (Thread-12): Parsing macros/schema_tests/unique.sql
2022-07-13 19:25:20.588976 (Thread-12): Parsing macros/schema_tests/not_null.sql
2022-07-13 19:25:20.590420 (Thread-12): Parsing macros/schema_tests/accepted_values.sql
2022-07-13 19:25:20.592941 (Thread-12): Parsing macros/schema_tests/relationships.sql
2022-07-13 19:25:20.594696 (Thread-12): Parsing macros/materializations/helpers.sql
2022-07-13 19:25:20.602764 (Thread-12): Parsing macros/materializations/table/table.sql
2022-07-13 19:25:20.609036 (Thread-12): Parsing macros/materializations/snapshot/strategies.sql
2022-07-13 19:25:20.623782 (Thread-12): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-07-13 19:25:20.625462 (Thread-12): Parsing macros/materializations/snapshot/snapshot.sql
2022-07-13 19:25:20.651863 (Thread-12): Parsing macros/materializations/seed/seed.sql
2022-07-13 19:25:20.670494 (Thread-12): Parsing macros/materializations/common/merge.sql
2022-07-13 19:25:20.683133 (Thread-12): Parsing macros/materializations/view/create_or_replace_view.sql
2022-07-13 19:25:20.687994 (Thread-12): Parsing macros/materializations/view/view.sql
2022-07-13 19:25:20.693639 (Thread-12): Parsing macros/materializations/incremental/helpers.sql
2022-07-13 19:25:20.695325 (Thread-12): Parsing macros/materializations/incremental/incremental.sql
2022-07-13 19:25:20.719051 (Thread-12): Parsing macros/logger/pretty_time.sql
2022-07-13 19:25:20.727071 (Thread-12): Parsing macros/logger/log_info.sql
2022-07-13 19:25:20.735187 (Thread-12): Parsing macros/logger/pretty_log_format.sql
2022-07-13 19:25:20.743505 (Thread-12): Parsing macros/sql/pivot.sql
2022-07-13 19:25:20.753748 (Thread-12): Parsing macros/sql/star.sql
2022-07-13 19:25:20.763163 (Thread-12): Parsing macros/sql/surrogate_key.sql
2022-07-13 19:25:20.773276 (Thread-12): Parsing macros/sql/get_query_results_as_dict.sql
2022-07-13 19:25:20.783053 (Thread-12): Parsing macros/sql/get_column_values.sql
2022-07-13 19:25:20.794539 (Thread-12): Parsing macros/sql/groupby.sql
2022-07-13 19:25:20.802824 (Thread-12): Parsing macros/sql/get_tables_by_pattern_sql.sql
2022-07-13 19:25:20.816357 (Thread-12): Parsing macros/sql/nullcheck_table.sql
2022-07-13 19:25:20.824324 (Thread-12): Parsing macros/sql/get_tables_by_prefix_sql.sql
2022-07-13 19:25:20.832798 (Thread-12): Parsing macros/sql/get_relations_by_pattern.sql
2022-07-13 19:25:20.842976 (Thread-12): Parsing macros/sql/get_relations_by_prefix.sql
2022-07-13 19:25:20.853119 (Thread-12): Parsing macros/sql/safe_add.sql
2022-07-13 19:25:20.861944 (Thread-12): Parsing macros/sql/unpivot.sql
2022-07-13 19:25:20.875336 (Thread-12): Parsing macros/sql/generate_series.sql
2022-07-13 19:25:20.886279 (Thread-12): Parsing macros/sql/nullcheck.sql
2022-07-13 19:25:20.895075 (Thread-12): Parsing macros/sql/union.sql
2022-07-13 19:25:20.910681 (Thread-12): Parsing macros/materializations/insert_by_period_materialization.sql
2022-07-13 19:25:20.940432 (Thread-12): Parsing macros/web/get_url_parameter.sql
2022-07-13 19:25:20.948856 (Thread-12): Parsing macros/web/get_url_path.sql
2022-07-13 19:25:20.958527 (Thread-12): Parsing macros/web/get_url_host.sql
2022-07-13 19:25:20.966862 (Thread-12): Parsing macros/datetime/date_spine.sql
2022-07-13 19:25:20.979058 (Thread-12): Parsing macros/schema_tests/expression_is_true.sql
2022-07-13 19:25:20.987430 (Thread-12): Parsing macros/schema_tests/not_constant.sql
2022-07-13 19:25:20.995925 (Thread-12): Parsing macros/schema_tests/at_least_one.sql
2022-07-13 19:25:21.004514 (Thread-12): Parsing macros/schema_tests/equality.sql
2022-07-13 19:25:21.015670 (Thread-12): Parsing macros/schema_tests/test_not_null_where.sql
2022-07-13 19:25:21.024789 (Thread-12): Parsing macros/schema_tests/equal_rowcount.sql
2022-07-13 19:25:21.033477 (Thread-12): Parsing macros/schema_tests/test_unique_where.sql
2022-07-13 19:25:21.043121 (Thread-12): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2022-07-13 19:25:21.055705 (Thread-12): Parsing macros/schema_tests/relationships_where.sql
2022-07-13 19:25:21.065272 (Thread-12): Parsing macros/schema_tests/unique_combination_of_columns.sql
2022-07-13 19:25:21.075668 (Thread-12): Parsing macros/schema_tests/recency.sql
2022-07-13 19:25:21.084952 (Thread-12): Parsing macros/schema_tests/cardinality_equality.sql
2022-07-13 19:25:21.094904 (Thread-12): Parsing macros/geo/haversine_distance.sql
2022-07-13 19:25:21.103766 (Thread-12): Parsing macros/cross_db_utils/split_part.sql
2022-07-13 19:25:21.112578 (Thread-12): Parsing macros/cross_db_utils/length.sql
2022-07-13 19:25:21.120370 (Thread-12): Parsing macros/cross_db_utils/current_timestamp.sql
2022-07-13 19:25:21.130296 (Thread-12): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2022-07-13 19:25:21.137975 (Thread-12): Parsing macros/cross_db_utils/right.sql
2022-07-13 19:25:21.147348 (Thread-12): Parsing macros/cross_db_utils/hash.sql
2022-07-13 19:25:21.155895 (Thread-12): Parsing macros/cross_db_utils/replace.sql
2022-07-13 19:25:21.164408 (Thread-12): Parsing macros/cross_db_utils/concat.sql
2022-07-13 19:25:21.173774 (Thread-12): Parsing macros/cross_db_utils/_is_relation.sql
2022-07-13 19:25:21.181832 (Thread-12): Parsing macros/cross_db_utils/identifier.sql
2022-07-13 19:25:21.190703 (Thread-12): Parsing macros/cross_db_utils/datediff.sql
2022-07-13 19:25:21.206608 (Thread-12): Parsing macros/cross_db_utils/dateadd.sql
2022-07-13 19:25:21.215680 (Thread-12): Parsing macros/cross_db_utils/datatypes.sql
2022-07-13 19:25:21.228888 (Thread-12): Parsing macros/cross_db_utils/position.sql
2022-07-13 19:25:21.237508 (Thread-12): Parsing macros/cross_db_utils/literal.sql
2022-07-13 19:25:21.245416 (Thread-12): Parsing macros/cross_db_utils/_is_ephemeral.sql
2022-07-13 19:25:21.254201 (Thread-12): Parsing macros/cross_db_utils/width_bucket.sql
2022-07-13 19:25:21.265723 (Thread-12): Parsing macros/cross_db_utils/date_trunc.sql
2022-07-13 19:25:21.274318 (Thread-12): Parsing macros/cross_db_utils/except.sql
2022-07-13 19:25:21.282695 (Thread-12): Parsing macros/cross_db_utils/safe_cast.sql
2022-07-13 19:25:21.291860 (Thread-12): Parsing macros/cross_db_utils/last_day.sql
2022-07-13 19:25:21.302040 (Thread-12): Parsing macros/cross_db_utils/intersect.sql
2022-07-13 19:25:21.371375 (Thread-12): Acquiring new bigquery connection "model.tech_audit.agg_all".
2022-07-13 19:25:21.401578 (Thread-12): Acquiring new bigquery connection "model.tech_audit.agg_traffic".
2022-07-13 19:25:21.426438 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_diffs_count".
2022-07-13 19:25:21.454846 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_diffs".
2022-07-13 19:25:21.475951 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_count".
2022-07-13 19:25:21.500174 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_data_studio".
2022-07-13 19:25:21.517961 (Thread-12): Acquiring new bigquery connection "model.tech_audit.domains_proc".
2022-07-13 19:25:21.537729 (Thread-12): Acquiring new bigquery connection "model.tech_audit.crawl_dates".
2022-07-13 19:25:21.556698 (Thread-12): Acquiring new bigquery connection "model.tech_audit.dates".
2022-07-13 19:25:21.575315 (Thread-12): Acquiring new bigquery connection "model.tech_audit.ga_stats".
2022-07-13 19:25:21.595836 (Thread-12): Acquiring new bigquery connection "model.tech_audit.ga_proc_url_mapping".
2022-07-13 19:25:21.614198 (Thread-12): Acquiring new bigquery connection "model.tech_audit.ga_proc".
2022-07-13 19:25:21.633383 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_keyword_stats".
2022-07-13 19:25:21.651414 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_url_proc_url_mapping".
2022-07-13 19:25:21.669794 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_url_keyword_stats".
2022-07-13 19:25:21.690613 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_keyword_proc_url_mapping".
2022-07-13 19:25:21.710219 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_url_stats".
2022-07-13 19:25:21.729874 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_keyword_proc".
2022-07-13 19:25:21.748585 (Thread-12): Acquiring new bigquery connection "model.tech_audit.search_console_url_proc".
2022-07-13 19:25:21.767198 (Thread-12): Acquiring new bigquery connection "model.tech_audit.deepcrawl_proc".
2022-07-13 19:25:21.787965 (Thread-12): Acquiring new bigquery connection "model.tech_audit.deepcrawl_latest_crawl_proc".
2022-07-13 19:25:21.807270 (Thread-12): Acquiring new bigquery connection "model.tech_audit.deepcrawl_url_proc".
2022-07-13 19:25:21.829659 (Thread-12): Acquiring new bigquery connection "model.tech_audit.deepcrawl_stats".
2022-07-13 19:25:21.870998 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_proc".
2022-07-13 19:25:21.898398 (Thread-12): Acquiring new bigquery connection "model.tech_audit.actions_hierarchy".
2022-07-13 19:25:23.972225 (Thread-13): handling ps request
2022-07-13 19:25:23.974217 (Thread-13): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e63de33f-5365-43e4-b2ec-32e74cd4e213', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa339135b80>]}
2022-07-13 19:25:23.975863 (Thread-13): sending response (<Response 104 bytes [200 OK]>) to 10.0.16.160
2022-07-13 19:25:24.122923 (Thread-14): handling status request
2022-07-13 19:25:24.123383 (Thread-14): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e63de33f-5365-43e4-b2ec-32e74cd4e213', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa339135b80>]}
2022-07-13 19:25:24.132157 (Thread-14): sending response (<Response 32943 bytes [200 OK]>) to 10.0.16.160
2022-07-13 19:25:24.400118 (Thread-15): handling status request
2022-07-13 19:25:24.400577 (Thread-15): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e63de33f-5365-43e4-b2ec-32e74cd4e213', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa33907b760>]}
2022-07-13 19:25:24.408787 (Thread-15): sending response (<Response 32943 bytes [200 OK]>) to 10.0.16.160
2022-07-13 19:25:24.409997 (Thread-16): handling status request
2022-07-13 19:25:24.410398 (Thread-16): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'e63de33f-5365-43e4-b2ec-32e74cd4e213', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa33914aa00>]}
2022-07-13 19:25:24.418151 (Thread-16): sending response (<Response 32943 bytes [200 OK]>) to 10.0.16.160
